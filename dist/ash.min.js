(function(){var d;d={signals:{},core:{},ext:{Dictionary:function(){return function(){}}(),getClassName:function(c){var b;return null!=(b=c.className)?b:c.name}},fsm:{},tick:{},tools:{}};"function"===typeof define&&null!=define.amd?define(function(){return d}):this.ash=d}).call(this);(function(){ash.signals.ListenerNode=function(){function d(){}d.prototype.previous=null;d.prototype.next=null;d.prototype.listener=null;d.prototype.once=!1;return d}()}).call(this);(function(){var d;d=ash.signals.ListenerNode;ash.signals.ListenerNodePool=function(){function c(){}c.prototype.tail=null;c.prototype.cacheTail=null;c.prototype.get=function(){var b;return null!==this.tail?(b=this.tail,this.tail=this.tail.previous,b.previous=null,b):new d};c.prototype.dispose=function(b){b.listener=null;b.once=!1;b.next=null;b.previous=this.tail;this.tail=b};c.prototype.cache=function(b){b.listener=null;b.previous=this.cacheTail;this.cacheTail=b};c.prototype.releaseCache=function(){for(var b;null!==
this.cacheTail;)b=this.cacheTail,this.cacheTail=b.previous,b.next=null,b.previous=this.tail,this.tail=b};return c}()}).call(this);(function(){var d;d=ash.signals.ListenerNodePool;ash.signals.SignalBase=function(){function c(){this.nodes=[];this.keys=[];this.listenerNodePool=new d;this.numListeners=0}c.prototype.head=null;c.prototype.tail=null;c.prototype.numListeners=0;c.prototype.keys=null;c.prototype.nodes=null;c.prototype.listenerNodePool=null;c.prototype.toAddHead=null;c.prototype.toAddTail=null;c.prototype.dispatching=!1;c.prototype.startDispatch=function(){this.dispatching=!0};c.prototype.endDispatch=function(){this.dispatching=
!1;this.toAddHead&&(this.head?(this.tail.next=this.toAddHead,this.toAddHead.previous=this.tail):this.head=this.toAddHead,this.tail=this.toAddTail,this.toAddTail=this.toAddHead=null);this.listenerNodePool.releaseCache()};c.prototype.getNode=function(b){var a;for(a=this.head;null!==a&&a.listener!==b;)a=a.next;if(null===a)for(a=this.toAddHead;null!==a&&a.listener!==b;)a=a.next;return a};c.prototype.add=function(b){var a;-1===this.keys.indexOf(b)&&(a=this.listenerNodePool.get(),a.listener=b,this.nodes.push(a),
this.keys.push(b),this.addNode(a))};c.prototype.addOnce=function(b){var a;-1===this.keys.indexOf(b)&&(a=this.listenerNodePool.get(),a.listener=b,a.once=!0,this.nodes.push(a),this.keys.push(b),this.addNode(a))};c.prototype.addNode=function(b){this.dispatching?null===this.toAddHead?this.toAddHead=this.toAddTail=b:(this.toAddTail.next=b,b.previous=this.toAddTail,this.toAddTail=b):null===this.head?this.head=this.tail=b:(this.tail.next=b,b.previous=this.tail,this.tail=b);this.numListeners++};c.prototype.remove=
function(b){var a;b=this.keys.indexOf(b);if(a=this.nodes[b])this.head===a&&(this.head=this.head.next),this.tail===a&&(this.tail=this.tail.previous),this.toAddHead===a&&(this.toAddHead=this.toAddHead.next),this.toAddTail===a&&(this.toAddTail=this.toAddTail.previous),a.previous&&(a.previous.next=a.next),a.next&&(a.next.previous=a.previous),this.nodes.splice(b,1),this.keys.splice(b,1),this.dispatching?this.listenerNodePool.cache(a):this.listenerNodePool.dispose(a),this.numListeners--};c.prototype.removeAll=
function(){for(var b,a;this.head;)a=this.head,this.head=this.head.next,b=this.keys.indexOf(a.listener),this.nodes.splice(b,1),this.listenerNodePool.dispose(a);this.nodes=[];this.keys=[];this.toAddTail=this.toAddHead=this.tail=null;this.numListeners=0};return c}()}).call(this);(function(){var d=function(b,a){function f(){this.constructor=b}for(var g in a)c.call(a,g)&&(b[g]=a[g]);f.prototype=a.prototype;b.prototype=new f;b.__super__=a.prototype;return b},c={}.hasOwnProperty;ash.signals.Signal0=function(b){function a(){return a.__super__.constructor.apply(this,arguments)}d(a,b);a.prototype.dispatch=function(){var a;this.startDispatch();for(a=this.head;null!==a;)a.listener(),a.once&&this.remove(a.listener),a=a.next;return this.endDispatch()};return a}(ash.signals.SignalBase)}).call(this);(function(){var d=function(b,a){function f(){this.constructor=b}for(var g in a)c.call(a,g)&&(b[g]=a[g]);f.prototype=a.prototype;b.prototype=new f;b.__super__=a.prototype;return b},c={}.hasOwnProperty;ash.signals.Signal1=function(b){function a(){return a.__super__.constructor.apply(this,arguments)}d(a,b);a.prototype.dispatch=function(a){var b;this.startDispatch();for(b=this.head;null!==b;)b.listener(a),b.once&&this.remove(b.listener),b=b.next;return this.endDispatch()};return a}(ash.signals.SignalBase)}).call(this);(function(){var d=function(b,a){function f(){this.constructor=b}for(var g in a)c.call(a,g)&&(b[g]=a[g]);f.prototype=a.prototype;b.prototype=new f;b.__super__=a.prototype;return b},c={}.hasOwnProperty;ash.signals.Signal2=function(b){function a(){return a.__super__.constructor.apply(this,arguments)}d(a,b);a.prototype.dispatch=function(a,b){var c;this.startDispatch();for(c=this.head;c;)c.listener(a,b),c.once&&this.remove(c.listener),c=c.next;return this.endDispatch()};return a}(ash.signals.SignalBase)}).call(this);(function(){var d=function(b,a){function f(){this.constructor=b}for(var g in a)c.call(a,g)&&(b[g]=a[g]);f.prototype=a.prototype;b.prototype=new f;b.__super__=a.prototype;return b},c={}.hasOwnProperty;ash.signals.Signal3=function(b){function a(){return a.__super__.constructor.apply(this,arguments)}d(a,b);a.prototype.dispatch=function(a,b,c){var d;this.startDispatch();for(d=this.head;null!==d;)d.listener(a,b,c),d.once&&this.remove(d.listener),d=d.next;return this.endDispatch()};return a}(ash.signals.SignalBase)}).call(this);(function(){var d,c,b;c=ash.signals.Signal2;d=ash.ext.Dictionary;b=ash.ext.getClassName;ash.core.Entity=function(){function a(b){null==b&&(b="");Object.defineProperties(this,{name:{get:function(){return this._name},set:function(a){var b;if(this._name!==a)return b=this._name,this._name=a,this.nameChanged.dispatch(this,b)}}});this.componentAdded=new c;this.componentRemoved=new c;this.nameChanged=new c;this.components=new d;""!==b?(null==a.nameCount[b]&&(a.nameCount[b]=0),this._name=b+ ++a.nameCount[b]):
this._name="_entity"+ ++f}var f;a.nameCount={};f=0;a.prototype._name="";a.prototype.componentAdded=null;a.prototype.componentRemoved=null;a.prototype.nameChanged=null;a.prototype.previous=null;a.prototype.next=null;a.prototype.components=null;a.prototype.add=function(a,c){null==c&&(c=a.constructor);b(c)in this.components&&this.remove(c);this.components[b(c)]=a;this.componentAdded.dispatch(this,c);return this};a.prototype.remove=function(a){var c;c=null!=b(a)?b(a):a;return(a=this.components[c])?(delete this.components[c],
this.componentRemoved.dispatch(this,c),a):null};a.prototype.get=function(a){return this.components[b(a)]};a.prototype.getAll=function(){var a,b,c,d,f;b=[];f=this.components;c=0;for(d=f.length;c<d;c++)a=f[c],b.push(a);return b};a.prototype.has=function(a){return b(a)in this.components};return a}()}).call(this);(function(){ash.core.EntityList=function(){function d(){}d.prototype.head=null;d.prototype.tail=null;d.prototype.add=function(c){this.head?(this.tail.next=c,c.previous=this.tail,c.next=null,this.tail=c):(this.head=this.tail=c,c.next=c.previous=null)};d.prototype.remove=function(c){this.head===c&&(this.head=this.head.next);this.tail===c&&(this.tail=this.tail.previous);c.previous&&(c.previous.next=c.next);c.next&&(c.next.previous=c.previous)};d.prototype.removeAll=function(){for(var c;this.head;)c=
this.head,this.head=this.head.next,c.previous=null,c.next=null;this.tail=null};return d}()}).call(this);(function(){ash.core.Node=function(){function d(){}d.prototype.entity=null;d.prototype.previous=null;d.prototype.next=null;return d}()}).call(this);(function(){var d;d=ash.signals.Signal1;ash.core.NodeList=function(){function c(){this.nodeAdded=new d;this.nodeRemoved=new d}c.prototype.head=null;c.prototype.tail=null;c.prototype.nodeAdded=null;c.prototype.nodeRemoved=null;c.prototype.add=function(b){this.head?(this.tail.next=b,b.previous=this.tail,b.next=null,this.tail=b):(this.head=this.tail=b,b.next=b.previous=null);this.nodeAdded.dispatch(b)};c.prototype.remove=function(b){this.head===b&&(this.head=this.head.next);this.tail===b&&(this.tail=
this.tail.previous);b.previous&&(b.previous.next=b.next);b.next&&(b.next.previous=b.previous);this.nodeRemoved.dispatch(b)};c.prototype.removeAll=function(){for(var b;this.head;)b=this.head,this.head=this.head.next,b.previous=null,b.next=null,this.nodeRemoved.dispatch(b);this.tail=null};Object.defineProperties(c.prototype,{empty:{get:function(){return null===this.head}}});c.prototype.swap=function(b,a){var c;b.previous===a?(b.previous=a.previous,a.previous=b,a.next=b.next,b.next=a):a.previous===b?
(a.previous=b.previous,b.previous=a,b.next=a.next,a.next=b):(c=b.previous,b.previous=a.previous,a.previous=c,c=b.next,b.next=a.next,a.next=c);this.head===b?this.head=a:this.head===a&&(this.head=b);this.tail===b?this.tail=a:this.tail===a&&(this.tail=b);null!==b.previous&&(b.previous.next=b);null!==a.previous&&(a.previous.next=a);null!==b.next&&(b.next.previous=b);null!==a.next&&(a.next.previous=a)};c.prototype.insertionSort=function(b){var a,c,d;if(this.head!==this.tail)for(a=d=this.head.next;null!==
a;){d=a.next;for(c=a.previous;null!==c;){if(0<=b(a,c)){a!==c.next&&(this.tail===a&&(this.tail=a.previous),a.previous.next=a.next,null!==a.next&&(a.next.previous=a.previous),a.next=c.next,a.previous=c,a.next.previous=a,c.next=a);break}c=c.previous}null===c&&(this.tail===a&&(this.tail=a.previous),a.previous.next=a.next,null!==a.next&&(a.next.previous=a.previous),a.next=this.head,this.head.previous=a,a.previous=null,this.head=a);a=d}};c.prototype.mergeSort=function(b){var a,c,d,e;if(this.head!==this.tail){c=
[];for(e=this.head;null!==e;){for(a=e;null!==a.next&&0>=b(a,a.next);)a=a.next;d=a.next;e.previous=a.next=null;c.push(e);e=d}for(;1<c.length;)c.push(this.merge(c.shift(),c.shift(),b));for(this.tail=this.head=c[0];null!==this.tail.next;)this.tail=this.tail.next}};c.prototype.merge=function(b,a,c){var d,e;0>=c(b,a)?(d=e=b,b=b.next):(d=e=a,a=a.next);for(;null!==b&&null!==a;)0>=c(b,a)?(e.next=b,b.previous=e,e=b,b=b.next):(e.next=a,a.previous=e,e=a,a=a.next);null!==b?(e.next=b,b.previous=e):(e.next=a,a.previous=
e);return d};return c}()}).call(this);(function(){ash.core.NodePool=function(){function d(c,b){this.nodeClass=c;this.components=b}d.prototype.tail=null;d.prototype.nodeClass=null;d.prototype.cacheTail=null;d.prototype.components=null;d.prototype.get=function(){var c;this.tail?(c=this.tail,this.tail=this.tail.previous,c.previous=null):c=new this.nodeClass;return c};d.prototype.dispose=function(c){for(var b in this.components)c[b]=null;c.entity=null;c.next=null;c.previous=this.tail;this.tail=c};d.prototype.cache=function(c){c.previous=
this.cacheTail;this.cacheTail=c};d.prototype.releaseCache=function(){for(var c;this.cacheTail;)c=this.cacheTail,this.cacheTail=c.previous,this.dispose(c)};return d}()}).call(this);(function(){var d=function(c,b){return function(){return c.apply(b,arguments)}};ash.core.System=function(){function c(){this.update=d(this.update,this)}c.prototype.previous=null;c.prototype.next=null;c.prototype.priority=0;c.prototype.addToEngine=function(b){};c.prototype.removeFromEngine=function(b){};c.prototype.update=function(b){};return c}()}).call(this);(function(){ash.core.SystemList=function(){function d(){}d.prototype.head=null;d.prototype.tail=null;d.prototype.add=function(c){var b;if(this.head){for(b=this.tail;b&&!(b.priority<=c.priority);)b=b.previous;b===this.tail?(this.tail.next=c,c.previous=this.tail,c.next=null,this.tail=c):b?(c.next=b.next,c.previous=b,b.next.previous=c,b.next=c):(c.next=this.head,c.previous=null,this.head=this.head.previous=c)}else this.head=this.tail=c,c.next=c.previous=null};d.prototype.remove=function(c){this.head===
c&&(this.head=this.head.next);this.tail===c&&(this.tail=this.tail.previous);c.previous&&(c.previous.next=c.next);c.next&&(c.next.previous=c.previous)};d.prototype.removeAll=function(){for(var c;this.head;)c=this.head,this.head=this.head.next,c.previous=null,c.next=null;this.tail=null};d.prototype.get=function(c){var b;for(b=this.head;b;){if(b.constructor===c)return b;b=b.next}return null};return d}()}).call(this);(function(){ash.core.Family=function(){function d(){Object.defineProperties(this,{nodeList:{get:function(){return this.nodes}}})}d.prototype.nodes=null;d.prototype.newEntity=function(c){throw Error("Method must be overriden");};d.prototype.removeEntity=function(c){throw Error("Method must be overriden");};d.prototype.componentAddedToEntity=function(c,b){throw Error("Method must be overriden");};d.prototype.componentRemovedFromEntity=function(c,b){throw Error("Method must be overriden");};d.prototype.cleanUp=
function(){throw Error("Method must be overriden");};return d}()}).call(this);(function(){var d,c,b,a,f=function(a,b){return function(){return a.apply(b,arguments)}};d=ash.ext.Dictionary;c=ash.core.NodeList;b=ash.core.NodePool;a=ash.ext.getClassName;ash.core.ComponentMatchingFamily=function(){function g(a,b){this.nodeClass=a;this.engine=b;this.releaseNodePoolCache=f(this.releaseNodePoolCache,this);this.init()}g.prototype.nodes=null;g.prototype.entities=null;g.prototype.nodeClass=null;g.prototype.components=null;g.prototype.nodePool=null;g.prototype.engine=null;g.prototype.init=
function(){var f,g,k;this.nodes=new c;this.entities=new d;this.components=new d;this.nodePool=new b(this.nodeClass,this.nodeClass.components);g=this.nodeClass.components;for(f in g)k=g[f],this.components[a(k)]=k};Object.defineProperties(g.prototype,{nodeList:{get:function(){return this.nodes}}});g.prototype.newEntity=function(a){this.addIfMatch(a)};g.prototype.componentAddedToEntity=function(a,b){this.addIfMatch(a)};g.prototype.componentRemovedFromEntity=function(b,c){(null!=a(c)?a(c):c)in this.components&&
this.removeIfMatch(b)};g.prototype.removeEntity=function(a){this.removeIfMatch(a)};g.prototype.addIfMatch=function(a){var b,c,d,f;if(null==this.entities[a.name]){d=this.nodeClass.components;for(c in d)if(b=d[c],!a.has(b))return;d=this.nodePool.get();d.entity=a;f=this.nodeClass.components;for(c in f)b=f[c],d[c]=a.get(b);this.entities[a.name]=d;this.nodes.add(d)}};g.prototype.removeIfMatch=function(a){var b;a.name in this.entities&&(b=this.entities[a.name],delete this.entities[a.name],this.nodes.remove(b),
this.engine.updating?(this.nodePool.cache(b),this.engine.updateComplete.add(this.releaseNodePoolCache)):this.nodePool.dispose(b))};g.prototype.releaseNodePoolCache=function(){this.engine.updateComplete.remove(this.releaseNodePoolCache);this.nodePool.releaseCache()};g.prototype.cleanUp=function(){var a;for(a=this.nodes.head;a;)this.entities.remove(a.entity),a=a.next;this.nodes.removeAll()};return g}()}).call(this);(function(){var d,c,b,a,f,g=function(a,b){return function(){return a.apply(b,arguments)}};c=ash.core.EntityList;d=ash.ext.Dictionary;a=ash.core.SystemList;b=ash.signals.Signal0;f=ash.ext.getClassName;ash.core.Engine=function(){function e(){this.update=g(this.update,this);this.componentRemoved=g(this.componentRemoved,this);this.componentAdded=g(this.componentAdded,this);this.entityNameChanged=g(this.entityNameChanged,this);this.entityList=new c;this.entityNames=new d;this.systemList=new a;this.families=
new d;this.updateComplete=new b}e.prototype.entityNames=null;e.prototype.entityList=null;e.prototype.systemList=null;e.prototype.families=null;e.prototype.updating=!1;e.prototype.updateComplete=null;e.prototype.familyClass=ash.core.ComponentMatchingFamily;Object.defineProperties(e.prototype,{entities:{get:function(){var a;for(a=this.entityList.head;a;)this.entities.push(a),a=a.next;return[]}},systems:{get:function(){var a,b;b=[];for(a=this.systemList.head;a;)b.push(a),a=a.next;return b}}});e.prototype.addEntity=
function(a){var b,c,d;if(this.entityNames[a.name])throw"The entity name "+a.name+" is already in use by another entity.";this.entityList.add(a);this.entityNames[a.name]=a;a.componentAdded.add(this.componentAdded);a.componentRemoved.add(this.componentRemoved);a.nameChanged.add(this.entityNameChanged);d=this.families;for(b in d)c=d[b],c.newEntity(a)};e.prototype.removeEntity=function(a){var b,c,d;a.componentAdded.remove(this.componentAdded);a.componentRemoved.remove(this.componentRemoved);a.nameChanged.remove(this.entityNameChanged);
d=this.families;for(b in d)c=d[b],c.removeEntity(a);delete this.entityNames[a.name];this.entityList.remove(a)};e.prototype.entityNameChanged=function(a,b){this.entityNames[b]===a&&(delete this.entityNames[b],this.entityNames[a.name]=a)};e.prototype.getEntityByName=function(a){return this.entityNames[a]};e.prototype.removeAllEntities=function(){for(;null!==this.entityList.head;)this.removeEntity(this.entityList.head)};e.prototype.componentAdded=function(a,b){var c,d,f;f=this.families;for(c in f)d=
f[c],d.componentAddedToEntity(a,b)};e.prototype.componentRemoved=function(a,b){var c,d,f;f=this.families;for(c in f)d=f[c],d.componentRemovedFromEntity(a,b)};e.prototype.getNodeList=function(a){var b;if(f(a)in this.families)return this.families[f(a)].nodeList;b=new this.familyClass(a,this);this.families[f(a)]=b;for(a=this.entityList.head;a;)b.newEntity(a),a=a.next;return b.nodeList};e.prototype.releaseNodeList=function(a){f(a)in this.families&&(this.families[f(a)].cleanUp(),delete this.families[f(a)])};
e.prototype.addSystem=function(a,b){a.priority=b;a.addToEngine(this);this.systemList.add(a)};e.prototype.getSystem=function(a){return systemList.get(a)};e.prototype.removeSystem=function(a){this.systemList.remove(a);a.removeFromEngine(this)};e.prototype.removeAllSystems=function(){for(;null!==this.systemList.head;)this.removeSystem(this.systemList.head)};e.prototype.update=function(a){var b;this.updating=!0;for(b=this.systemList.head;b;)b.update(a),b=b.next;this.updating=!1;this.updateComplete.dispatch()};
return e}()}).call(this);(function(){var d={}.hasOwnProperty;ash.ext.Helper=function(){function c(b,a){var c,g,e,h,k;this.components={};this.nodes={};if(null!=b)for(g in b)c=b[g],this.components[g]=c;if(null!=a)for(g in a){c=a[g];if(null==c.components){c.components={};h=c.prototype;for(e in h)d.call(h,e)&&(k=h[e],c.components[e]=k,c.prototype[e]=null);c.prototype.entity=null;c.prototype.previous=null;c.prototype.next=null}null!=b&&(this.nodes[g]=c)}}c.prototype.components=null;c.prototype.nodes=null;return c}()}).call(this);(function(){ash.fsm.ComponentInstanceProvider=function(){function d(c){this.instance=c}d.prototype.instance=null;d.prototype.getComponent=function(){return this.instance};Object.defineProperties(d.prototype,{identifier:{get:function(){return this.instance}}});return d}()}).call(this);(function(){ash.fsm.ComponentSingletonProvider=function(){function d(c){this.componentType=c}d.prototype.componentType=null;d.prototype.instance=null;d.prototype.getComponent=function(){null==this.instance&&(this.instance=new this.componentType);return this.instance};Object.defineProperties(d.prototype,{identifier:{get:function(){return this.getComponent()}}});return d}()}).call(this);(function(){ash.fsm.ComponentTypeProvider=function(){function d(c){this.componentType=c}d.prototype.componentType=null;d.prototype.getComponent=function(){return new this.componentType};Object.defineProperties(d.prototype,{identifier:{get:function(){return this.componentType}}});return d}()}).call(this);(function(){ash.fsm.DynamicComponentProvider=function(){function d(c){this._closure=c}d.prototype._closure=null;d.prototype.getComponent=function(){return this._closure};Object.defineProperties(d.prototype,{identifier:{get:function(){return this._closure}}});return d}()}).call(this);(function(){ash.fsm.DynamicSystemProvider=function(){function d(c){this.method=c}d.prototype.method=function(){};d.prototype.systemPriority=0;d.prototype.getSystem=function(){return this.method()};Object.defineProperties(d.prototype,{identifier:{get:function(){return this.method}},priority:{get:function(){return this.systemPriority},set:function(c){return this.systemPriority=c}}});return d}()}).call(this);(function(){var d,c,b,a;b=ash.fsm.SystemInstanceProvider;a=ash.fsm.SystemSingletonProvider;d=ash.fsm.DynamicSystemProvider;c=ash.fsm.StateSystemMapping;ash.fsm.EngineState=function(){function f(){this.providers=[]}f.prototype.providers=null;f.prototype.addInstance=function(a){return this.addProvider(new b(a))};f.prototype.addSingleton=function(b){return this.addProvider(new a(b))};f.prototype.addMethod=function(a){return this.addProvider(new d(a))};f.prototype.addProvider=function(a){var b;b=new c(this,
a);this.providers.push(a);return b};return f}()}).call(this);(function(){var d,c,b,a;d=ash.fsm.ComponentInstanceProvider;b=ash.fsm.ComponentTypeProvider;c=ash.fsm.ComponentSingletonProvider;a=ash.fsm.DynamicComponentProvider;ash.fsm.StateComponentMapping=function(){function f(a,b){this.creatingState=a;this.componentType=b;this.withType(b)}f.prototype.componentType=null;f.prototype.creatingState=null;f.prototype.provider=null;f.prototype.withInstance=function(a){this.setProvider(new d(a));return this};f.prototype.withType=function(a){this.setProvider(new b(a));
return this};f.prototype.withSingleton=function(a){null==a&&(a=this.componentType);this.setProvider(new c(a));return this};f.prototype.withMethod=function(b){this.setProvider(new a(b));return this};f.prototype.withProvider=function(a){this.setProvider(a);return this};f.prototype.add=function(a){return this.creatingState.add(a)};f.prototype.setProvider=function(a){this.provider=a;return this.creatingState.providers[this.componentType]=a};return f}()}).call(this);(function(){var d,c;d=ash.ext.Dictionary;c=ash.fsm.EngineState;ash.fsm.EngineStateMachine=function(){function b(a){this.engine=a;this.states=new d}b.prototype.engine=null;b.prototype.states=null;b.prototype.currentState=null;b.prototype.addState=function(a,b){this.states[a]=b;return this};b.prototype.createState=function(a){var b;b=new c;this.states[a]=b;return this};b.prototype.changeState=function(a){var b,c,e,h,k,l;c=this.states[a];if(null==c)throw Error("Engine state "+a+" doesn't exist");if(c!==
this.currentState){l=new d;e=c.providers;for(b in e)h=e[b],a=h.identifier,l[a]=h;if(currentState)for(b in k=this.currentState.providers,k)h=k[b],a=h.identifier,(e=l[a])?delete l[a]:this.engine.removeSystem(h.getSystem());for(b in l)h=l[b],this.engine.addSystem(h.getSystem(),h.priority);return this.currentState=c}};return b}()}).call(this);(function(){var d,c,b;d=ash.ext.Dictionary;c=ash.fsm.StateComponentMapping;b=ash.ext.getClassName;ash.fsm.EntityState=function(){function a(){this.providers=new d}a.prototype.providers=null;a.prototype.add=function(a){return new c(this,b(a))};a.prototype.get=function(a){return this.providers[a]};a.prototype.has=function(a){return null!==this.providers[a]};return a}()}).call(this);(function(){var d,c;d=ash.ext.Dictionary;c=ash.fsm.EntityState;ash.fsm.EntityStateMachine=function(){function b(a){this.entity=a;this.states=new d}b.prototype.states=null;b.prototype.currentState=null;b.prototype.entity=null;b.prototype.addState=function(a,b){this.states[a]=b;return this};b.prototype.createState=function(a){var b;b=new c;return this.states[a]=b};b.prototype.changeState=function(a){var b,c,e;b=this.states[a];if(!b)throw Error("Entity state "+a+" doesn't exist");if(b!==this.currentState){if(this.currentState){c=
new d;for(e in b.providers)c[e]=b.providers[e];for(e in this.currentState.providers)(a=c[e])&&a.identifier===this.currentState.providers[e].identifier?delete c[e]:this.entity.remove(e)}else c=b.providers;for(e in c)this.entity.add(c[e].getComponent());return this.currentState=b}};return b}()}).call(this);(function(){ash.fsm.StateSystemMapping=function(){function d(c,b){this.creatingState=c;this.provider=b}d.prototype.creatingState=null;d.prototype.provider=null;d.prototype.withPriority=function(c){this.provider.priority=c;return this};d.prototype.addInstance=function(c){return creatingState.addInstance(c)};d.prototype.addSingleton=function(c){return creatingState.addSingleton(c)};d.prototype.addMethod=function(c){return creatingState.addMethod(c)};d.prototype.addProvider=function(c){return creatingState.addProvider(c)};
return d}()}).call(this);(function(){ash.fsm.SystemInstanceProvider=function(){function d(c){this.instance=c}d.prototype.instance=null;d.prototype.systemPriority=0;d.prototype.getSystem=function(){return this.instance};Object.defineProperties(d.prototype,{identifier:{get:function(){return this.instance}},priority:{get:function(){return this.systemPriority},set:function(c){return this.systemPriority=c}}});return d}()}).call(this);(function(){ash.fsm.SystemSingletonProvider=function(){function d(c){this.componentType=c}d.prototype.componentType=null;d.prototype.instance=null;d.prototype.systemPriority=0;d.prototype.getSystem=function(){this.instance||(this.instance=new this.componentType);return this.instance};Object.defineProperties(d.prototype,{identifier:{get:function(){return this.getSystem()}},priority:{get:function(){return this.systemPriority},set:function(c){return this.systemPriority=c}}});return d}()}).call(this);(function(){var d=function(a,b){return function(){return a.apply(b,arguments)}},c=function(a,c){function d(){this.constructor=a}for(var e in c)b.call(c,e)&&(a[e]=c[e]);d.prototype=c.prototype;a.prototype=new d;a.__super__=c.prototype;return a},b={}.hasOwnProperty;ash.tick.FrameTickProvider=function(a){function b(a,c){this.displayObject=a;this.maximumFrameTime=c;this.dispatchTick=d(this.dispatchTick,this);b.__super__.constructor.apply(this,arguments)}c(b,a);b.prototype.displayObject=null;b.prototype.previousTime=
0;b.prototype.maximumFrameTime=0;b.prototype.isPlaying=!1;b.prototype.request=null;b.prototype.timeAdjustment=1;Object.defineProperties(b.prototype,{playing:{get:function(){return this.isPlaying}}});b.prototype.start=function(){this.request=requestAnimationFrame(this.dispatchTick);this.isPlaying=!0};b.prototype.stop=function(){cancelRequestAnimationFrame(this.request);this.isPlaying=!1};b.prototype.dispatchTick=function(a){var b;null==a&&(a=Date.now());this.displayObject&&this.displayObject.begin();
b=this.previousTime||a;this.previousTime=a;this.dispatch(.001*(a-b));requestAnimationFrame(this.dispatchTick);this.displayObject&&this.displayObject.end()};return b}(ash.signals.Signal1)}).call(this);(function(){var d,c=[].indexOf||function(b){for(var a=0,c=this.length;a<c;a++)if(a in this&&this[a]===b)return a;return-1};d=ash.ext.Dictionary;ash.tools.ComponentPool=function(){function b(){}var a,f;f=new d;a=function(a){var b;return(b=a.className,0<=c.call(f,b))?f[a.className]:f[a.className]=[]};b.get=function(b){var c;c=a(b);return 0<c.length?c.pop():new b};b.dispose=function(b){var c;b&&(c=b.constructor,c=a(c),c.push(b))};b.empty=function(){return f=new d};return b}()}).call(this);(function(){var d=function(b,a){function d(){this.constructor=b}for(var g in a)c.call(a,g)&&(b[g]=a[g]);d.prototype=a.prototype;b.prototype=new d;b.__super__=a.prototype;return b},c={}.hasOwnProperty;ash.tools.ListIteratingSystem=function(b){function a(a,b,c,d){null==c&&(c=null);null==d&&(d=null);this.nodeClass=a;this.nodeUpdateFunction=b;this.nodeAddedFunction=c;this.nodeRemovedFunction=d}d(a,b);a.prototype.nodeList=null;a.prototype.nodeClass=null;a.prototype.nodeUpdateFunction=null;a.prototype.nodeAddedFunction=
null;a.prototype.nodeRemovedFunction=null;a.prototype.addToEngine=function(a){this.nodeList=a.getNodeList(this.nodeClass);if(null!==this.nodeAddedFunction){for(a=this.nodeList.head;a;)this.nodeAddedFunction(a),a=a.next;this.nodeList.nodeAdded.add(this.nodeAddedFunction)}null!==this.nodeRemovedFunction&&this.nodeList.nodeRemoved.add(this.nodeRemovedFunction)};a.prototype.removeFromEngine=function(a){null!==this.nodeAddedFunction&&this.nodeList.nodeAdded.remove(this.nodeAddedFunction);null!==this.nodeRemovedFunction&&
this.nodeList.nodeRemoved.remove(this.nodeRemovedFunction);this.nodeList=null};a.prototype.update=function(a){var b;for(b=this.nodeList.head;b;)this.nodeUpdateFunction(b,a),b=b.next};return a}(ash.core.System)}).call(this);