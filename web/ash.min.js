var c;function aa(a,b,d){return a.call.apply(a.bind,arguments)}function ba(a,b,d){if(!a)throw Error();if(2<arguments.length){var e=Array.prototype.slice.call(arguments,2);return function(){var d=Array.prototype.slice.call(arguments);Array.prototype.unshift.apply(d,e);return a.apply(b,d)}}return function(){return a.apply(b,arguments)}}function h(a,b,d){h=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?aa:ba;return h.apply(null,arguments)}
function k(a,b){function d(){}d.prototype=b.prototype;a.l=b.prototype;a.prototype=new d;a.prototype.constructor=a;a.Nb=function(a,d,g){for(var w=Array(arguments.length-2),J=2;J<arguments.length;J++)w[J-2]=arguments[J];return b.prototype[d].apply(a,w)}};function l(){this.update=h(this.update,this)}c=l.prototype;c.c=null;c.next=null;c.Va=0;c.S=function(){};c.update=function(){};function m(a,b,d,e){null==d&&(d=null);null==e&&(e=null);this.A=a;this.wb=b;this.xa=d;this.Ta=e}k(m,l);c=m.prototype;c.ea=null;c.A=null;c.wb=null;c.xa=null;c.Ta=null;c.S=function(a){this.ea=n(a,this.A);if(null!==this.xa){for(a=this.ea.head;a;)this.xa(a),a=a.next;this.ea.Ra.add(this.xa)}null!==this.Ta&&this.ea.Sa.add(this.Ta)};c.update=function(a){var b;for(b=this.ea.head;b;)this.wb(b,a),b=b.next};function p(a,b){this.x=null!=a?a:0;this.y=null!=b?b:0}p.prototype.x=0;p.prototype.y=0;function ca(a,b){var d,e;d=a.x-b.x;e=a.y-b.y;return Math.sqrt(d*d+e*e)}function da(a,b){var d,e;d=a.x-b.x;e=a.y-b.y;return Math.sqrt(d*d+e*e)};function q(a,b,d){this.rotation=d;this.position=new p(a,b)}q.className="Position";q.prototype.position=null;q.prototype.rotation=0;function r(){}r.prototype.B=null;r.prototype.c=null;r.prototype.next=null;function t(a,b,d,e){this.kb=d;this.qa=e;this.m=new p(a,b)}t.className="Motion";t.prototype.m=null;t.prototype.kb=0;t.prototype.qa=0;function u(){return u.l.constructor.apply(this,arguments)}k(u,r);u.className="MovementNode";u.g={position:q,da:t};u.prototype.position=null;u.prototype.da=null;function ea(a){this.o=a;this.i=h(this.i,this);ea.l.constructor.call(this,u,this.i)}k(ea,m);ea.prototype.o=null;
ea.prototype.i=function(a,b){var d,e,f;e=a.position;d=a.da;e.position.x+=d.m.x*b;e.position.y+=d.m.y*b;0>e.position.x&&(e.position.x+=this.o.width);e.position.x>this.o.width&&(e.position.x-=this.o.width);0>e.position.y&&(e.position.y+=this.o.height);e.position.y>this.o.height&&(e.position.y-=this.o.height);e.rotation+=d.kb*b;0<d.qa&&(f=Math.abs(Math.cos(e.rotation)*d.qa*b),e=Math.abs(Math.sin(e.rotation)*d.qa*b),d.m.x>f?d.m.x-=f:d.m.x<-f?d.m.x+=f:d.m.x=0,d.m.y>e?d.m.y-=e:d.m.y<-e?d.m.y+=e:d.m.y=0)};function v(a){this.s=a}v.className="Collision";v.prototype.s=0;function x(){this.Ca=[]}x.className="Audio";x.prototype.Ca=null;x.prototype.play=function(a){return this.Ca.push(a)};function fa(a){this.$=a}fa.className="Asteroid";fa.prototype.$=null;function y(){return y.l.constructor.apply(this,arguments)}k(y,r);y.className="AsteroidCollisionNode";y.g={mb:fa,position:q,w:v,audio:x};y.prototype.mb=null;y.prototype.position=null;y.prototype.w=null;y.prototype.audio=null;function ga(a){this.a=a;this.Za=h(this.Za,this);this.Ya=h(this.Ya,this);this.v=h(this.v,this);this.qb=this.Jb;this.pb=this.Ib}c=ga.prototype;c.x=0;c.y=0;c.width=4;c.height=4;c.rotation=0;c.a=null;c.Ab=0;c.N=3;c.qb=null;c.pb=null;c.v=function(){this.qb();this.pb()};c.Ya=function(a){return this.N=a};c.Za=function(a){return this.Ab=a};
c.Ib=function(){var a;this.a.save();this.a.beginPath();this.a.font="bold 18px Helvetica";this.a.fillStyle="#FFFFFF";this.a.textAlign="center";a="LIVES: "+this.N;this.a.fillText(a,this.a.measureText(a).width,20);this.a.fill();this.a.restore()};
c.Jb=function(){var a;this.a.save();this.a.beginPath();this.a.font="bold 18px Helvetica";this.a.fillStyle="#FFFFFF";this.a.textAlign="center";a="SCORE: "+this.Ab;this.a.fillText(a,window.window.innerWidth*window.devicePixelRatio-this.a.measureText(a).width,20);this.a.fill();this.a.restore()};function z(){return z.l.constructor.apply(this,arguments)}k(z,r);z.className="AudioNode";z.g={audio:x};z.prototype.audio=null;function ha(){this.i=h(this.i,this);ha.l.constructor.call(this,z,this.i)}k(ha,m);ha.prototype.i=function(a){var b,d,e;e=a.audio.Ca;for(b in e)d=e[b],d=new d,d.play(0,1);a.audio.Ca.length=0};function A(a){this.pa=a}A.className="DeathThroes";A.prototype.pa=0;function B(){return B.l.constructor.apply(this,arguments)}k(B,r);B.className="DeathThroesNode";B.g={ra:A};B.prototype.ra=null;function ia(a){this.a=a}c=ia.prototype;c.x=0;c.y=0;c.width=20;c.height=20;c.rotation=0;c.a=null;c.v=function(){var a;a=this.a;a.save();a.beginPath();a.translate(this.x,this.y);a.rotate(this.rotation);a.fillStyle="#FFFFFF";a.moveTo(10,0);a.lineTo(-7,7);a.lineTo(-4,0);a.lineTo(-7,-7);a.lineTo(10,0);a.fill();a.restore()};function C(){}C.className="GameState";C.prototype.N=3;C.prototype.level=0;C.prototype.Ma=0;C.prototype.Ua=!1;function D(){return D.l.constructor.apply(this,arguments)}k(D,r);D.className="GameNode";D.g={state:C};D.prototype.state=null;function E(a){this.Cb=a;this.$a=h(this.$a,this);this.Cb.click.add(this.$a)}E.className="WaitForStart";E.prototype.Cb=null;E.prototype.Ba=!1;E.prototype.$a=function(){this.Ba=!0};function ja(a){this.wa=a}ja.className="Bullet";ja.prototype.wa=0;function F(){return F.l.constructor.apply(this,arguments)}k(F,r);F.className="BulletCollisionNode";F.g={oa:ja,position:q,w:v};F.prototype.oa=null;F.prototype.position=null;F.prototype.w=null;function G(a,b,d,e){this.Lb=d;this.Eb=e;this.ab=!1;this.O=null;this.ga=0;this.O=new p(a,b)}G.className="Gun";G.prototype.ab=!1;G.prototype.O=null;G.prototype.ga=0;G.prototype.O=null;function ka(a,b,d,e,f){this.left=a;this.right=b;this.jb=d;this.Fa=e;this.rotationRate=f}ka.className="MotionControls";c=ka.prototype;c.left=0;c.right=0;c.jb=0;c.Fa=0;c.rotationRate=0;function la(a,b){this.a=a;this.s=b;this.ta=[]}c=la.prototype;c.ta=null;c.x=0;c.y=0;c.width=0;c.height=0;c.rotation=0;c.a=null;c.s=0;c.V=null;c.first=!0;c.Ga=function(a){var b,d,e,f;if(this.first)for(this.first=!1,d=0;8>d;++d)b=new ma(this.a,this.s),this.ta.push(b);f=this.ta;d=0;for(e=f.length;d<e;d++)b=f[d],b.x+=b.m.x*a,b.y+=b.m.y*a;return this.v()};c.v=function(){var a,b,d,e,f;e=this.ta;f=[];b=0;for(d=e.length;b<d;b++)a=e[b],f.push(a.v(this.x,this.y));return f};
function ma(a,b){var d,e;this.a=a;d=2*Math.random()*Math.PI;e=Math.random()*b;this.x=Math.cos(d)*e;this.y=Math.sin(d)*e;e=10*Math.random()+10;this.m=new p(Math.cos(d)*e,Math.sin(d)*e)}c=ma.prototype;c.m=null;c.a=null;c.ha=0;c.ia=0;c.x=0;c.y=0;c.v=function(a,b){var d;d=this.a;d.save();d.beginPath();d.translate(a,b);d.rotate(this.rotation);d.fillStyle="#FFFFFF";d.arc(this.x,this.y,2,0,2*Math.PI,!1);d.fill();d.restore()};function na(a){this.a=a}c=na.prototype;c.x=0;c.y=0;c.width=4;c.height=4;c.rotation=0;c.a=null;c.v=function(){var a;a=this.a;a.save();a.beginPath();a.rotate(this.rotation);a.fillStyle="#FFFFFF";a.arc(this.x,this.y,2,0,2*Math.PI,!1);a.fill();a.restore()};function oa(a){this.$=a}oa.className="Spaceship";oa.prototype.$=null;function pa(a){this.Bb=a}pa.className="GunControls";pa.prototype.Bb=0;function qa(a){this.a=a}c=qa.prototype;c.x=0;c.y=0;c.width=20;c.height=20;c.rotation=0;c.a=null;c.fb=null;c.gb=null;c.yb=null;c.zb=null;c.ha=0;c.ja=0;c.ia=0;c.ja=0;c.first=!0;
c.Ga=function(a){this.first&&(this.first=!1,this.fb=new p(10*Math.random()-5,10*Math.random()+10),this.gb=new p(10*Math.random()-5,-(10*Math.random()+10)),this.yb=300*Math.random()-150,this.zb=300*Math.random()-150,this.ha=this.ib=this.x,this.ia=this.ja=this.y,this.Wa=this.Xa=this.rotation);this.ha+=this.fb.x*a;this.ia+=this.fb.y*a;this.Wa+=this.yb*a;this.ib+=this.gb.x*a;this.ja+=this.gb.y*a;this.Xa+=this.zb*a;return this.v()};
c.v=function(){var a;a=this.a;a.save();a.beginPath();a.translate(this.x+this.ha,this.y+this.ia);a.rotate(this.Wa);a.fillStyle="#FFFFFF";a.moveTo(10,0);a.lineTo(-7,7);a.lineTo(-4,0);a.lineTo(10,0);a.fill();a.restore();a.save();a.beginPath();a.translate(this.x+this.ib,this.y+this.ja);a.rotate(this.Xa);a.fillStyle="#FFFFFF";a.moveTo(10,0);a.lineTo(-7,7);a.lineTo(-4,0);a.lineTo(10,0);a.fill();a.restore()};function H(a){this.a=a}H.className="Display";H.prototype.a=0;function I(){return I.l.constructor.apply(this,arguments)}k(I,r);I.className="SpaceshipCollisionNode";I.g={Aa:oa,position:q,w:v,audio:x};I.prototype.Aa=0;I.prototype.position=0;I.prototype.w=null;I.prototype.audio=null;function ra(a,b){var d,e,f;this.a=a;this.height=this.width=this.s=b;this.V=[];for(d=0;d<2*Math.PI;)e=(.75+.25*Math.random())*this.s,f=Math.cos(d)*e,e*=Math.sin(d),this.V.push({x:f,y:e}),d+=.5*Math.random()}c=ra.prototype;c.x=0;c.y=0;c.width=0;c.height=0;c.rotation=0;c.a=null;c.s=0;c.V=null;
c.v=function(){var a,b;a=this.a;a.save();a.beginPath();a.translate(this.x,this.y);a.rotate(this.rotation);a.fillStyle="#FFFFFF";a.moveTo(this.s,0);for(b=0;b<this.V.length;)a.lineTo(this.V[b].x,this.V[b].y),++b;a.lineTo(this.s,0);a.fill();a.restore()};function K(a){this.W=a}K.className="Animation";K.prototype.W=null;function sa(a){this.view=a}sa.className="Hud";sa.prototype.view=null;function ta(a){this.h=a;this.update=h(this.update,this)}k(ta,l);c=ta.prototype;c.h=null;c.ba=null;c.R=null;c.D=null;c.Z=null;c.S=function(a){this.ba=n(a,D);this.R=n(a,I);this.D=n(a,y);this.Z=n(a,F)};
c.update=function(){var a,b;for(b=this.Z.head;b;){for(a=this.D.head;a;){if(da(a.position.position,b.position.position)<=a.w.s){this.h.f.P(b.B);10<a.w.s&&(ua(this.h,a.w.s-10,a.position.position.x+10*Math.random()-5,a.position.position.y+10*Math.random()-5),ua(this.h,a.w.s-10,a.position.position.x+10*Math.random()-5,a.position.position.y+10*Math.random()-5));va(a.mb.$,"destroyed");this.ba.head&&this.ba.head.state.Ma++;break}a=a.next}b=b.next}for(b=this.R.head;b;){for(a=this.D.head;a;){if(da(a.position.position,
b.position.position)<=a.w.s+b.w.s){va(b.Aa.$,"destroyed");this.ba.head&&this.ba.head.state.N++;break}a=a.next}b=b.next}};function L(){return L.l.constructor.apply(this,arguments)}k(L,r);L.className="HudNode";L.g={state:C,Na:sa};L.prototype.state=null;L.prototype.Na=null;function wa(){this.i=h(this.i,this);wa.l.constructor.call(this,L,this.i)}k(wa,m);wa.prototype.i=function(a){a.Na.view.Ya(a.state.N);a.Na.view.Za(a.state.Ma)};function xa(){}xa.prototype.c=null;xa.prototype.next=null;xa.prototype.listener=null;xa.prototype.ya=!1;function ya(){}ya.prototype.b=null;ya.prototype.j=null;ya.prototype.get=function(){var a;return null!==this.b?(a=this.b,this.b=this.b.c,a.c=null,a):new xa};function za(){this.u=[];this.Y=[];this.ca=new ya}c=za.prototype;c.head=null;c.b=null;c.Y=null;c.u=null;c.ca=null;c.G=null;c.J=null;c.T=!1;function Aa(a){a.T=!1;a.G&&(a.head?(a.b.next=a.G,a.G.c=a.b):a.head=a.G,a.b=a.J,a.G=null,a.J=null);a=a.ca;for(var b;null!==a.j;)b=a.j,a.j=b.c,b.next=null,b.c=a.b,a.b=b}
c.add=function(a){var b;-1===this.Y.indexOf(a)&&(b=this.ca.get(),b.listener=a,this.u.push(b),this.Y.push(a),this.T?null===this.G?this.G=this.J=b:(this.J.next=b,b.c=this.J,this.J=b):null===this.head?this.head=this.b=b:(this.b.next=b,b.c=this.b,this.b=b))};
c.remove=function(a){var b;b=this.Y.indexOf(a);if(a=this.u[b])this.head===a&&(this.head=this.head.next),this.b===a&&(this.b=this.b.c),this.G===a&&(this.G=this.G.next),this.J===a&&(this.J=this.J.c),a.c&&(a.c.next=a.next),a.next&&(a.next.c=a.c),this.u.splice(b,1),this.Y.splice(b,1),this.T?(b=this.ca,a.listener=null,a.c=b.j,b.j=a):(b=this.ca,a.listener=null,a.ya=!1,a.next=null,a.c=b.b,b.b=a)};function Ba(){return Ba.l.constructor.apply(this,arguments)}k(Ba,za);Ba.prototype.H=function(){var a;this.T=!0;for(a=this.head;null!==a;)a.listener(),a.ya&&this.remove(a.listener),a=a.next;return Aa(this)};function Ca(a){this.a=a;this.click=new Ba;this.rb=this.Gb;this.ub=this.Hb;this.ob=this.Fb;this.a.canvas.addEventListener("click",function(a){return function(){return a.click.H()}}(this))}c=Ca.prototype;c.x=0;c.y=0;c.width=4;c.height=4;c.rotation=0;c.a=null;c.rb=null;c.ob=null;c.ub=null;c.click=null;
c.Gb=function(){this.a.save();this.a.beginPath();this.a.font="bold 32px Helvetica";this.a.fillStyle="#FFFFFF";this.a.fillText("ASTEROIDS",Math.floor((window.innerWidth*window.devicePixelRatio-this.a.measureText("ASTEROIDS").width)/2),175);this.a.fill();this.a.restore()};
c.Fb=function(){this.a.save();this.a.beginPath();this.a.font="bold 18px Helvetica";this.a.fillStyle="#FFFFFF";this.a.fillText("CLICK TO START",Math.floor((window.innerWidth*window.devicePixelRatio-this.a.measureText("CLICK TO START").width)/2),225);this.a.fill();this.a.restore()};
c.Hb=function(){this.a.save();this.a.beginPath();this.a.font="bold 14px Helvetica";this.a.fillStyle="#FFFFFF";this.a.fillText("CTRL-Z to Fire  ~  Arrow Keys to Move",10,window.innerHeight*window.devicePixelRatio-20);this.a.fill();this.a.restore()};c.v=function(){this.rb();this.ob();this.ub()};function M(){return M.l.constructor.apply(this,arguments)}k(M,r);M.className="GunControlNode";M.g={audio:x,control:pa,tb:G,position:q};M.prototype.control=null;M.prototype.tb=null;M.prototype.position=null;M.prototype.audio=null;function N(a,b){this.C=a;this.h=b;this.i=h(this.i,this);N.l.constructor.call(this,M,this.i)}k(N,m);N.prototype.C=null;N.prototype.h=null;
N.prototype.i=function(a,b){var d,e,f;d=a.control;f=a.position;e=a.tb;e.ab=this.C.U(d.Bb);e.ga+=b;if(e.ab&&e.ga>=e.Lb){d=this.h;var g,w,J;g=Math.cos(f.rotation);w=Math.sin(f.rotation);J=g*e.O.x-w*e.O.y+f.position.x;f=w*e.O.x+g*e.O.y+f.position.y;f=(new O).add(new ja(e.Eb)).add(new q(J,f,0)).add(new v(0)).add(new t(150*g,150*w,0,0)).add(new H(new na(d.a)));Da(d.f,f);e.ga=0}};function P(){return P.l.constructor.apply(this,arguments)}k(P,r);P.className="RenderNode";P.g={position:q,display:H};P.prototype.position=null;P.prototype.display=null;function Q(a){this.a=a;this.update=h(this.update,this)}k(Q,l);Q.prototype.a=null;Q.prototype.u=null;Q.prototype.S=function(a){this.u=n(a,P);for(a=this.u.head;a;)a=a.next};Q.prototype.update=function(){var a,b,d;this.a.save();this.a.translate(0,0);this.a.rotate(0);this.a.clearRect(0,0,this.a.canvas.width,this.a.canvas.height);for(b=this.u.head;b;)a=b.display,a=a.a,d=b.position,a.x=d.position.x,a.y=d.position.y,a.rotation=d.rotation,a.v(),b=b.next;this.a.restore()};function R(){return R.l.constructor.apply(this,arguments)}k(R,r);R.j="BulletAgeNode";R.g={oa:ja};R.prototype.oa=null;function Ea(a){this.h=a;this.i=h(this.i,this);Ea.l.constructor.call(this,B,this.i)}k(Ea,m);Ea.prototype.h=null;Ea.prototype.i=function(a,b){a.ra.pa-=b;0>=a.ra.pa&&this.h.f.P(a.B)};function S(){return S.l.constructor.apply(this,arguments)}k(S,r);S.className="SpaceshipNode";S.g={Aa:oa,position:q};S.prototype.Aa=0;S.prototype.position=0;function Fa(a,b){this.h=a;this.o=b;this.update=h(this.update,this)}k(Fa,l);c=Fa.prototype;c.o=null;c.h=null;c.aa=null;c.R=null;c.D=null;c.Z=null;c.S=function(a){this.aa=n(a,D);this.R=n(a,S);this.D=n(a,y);this.Z=n(a,F)};
c.update=function(){var a,b,d,e;if((b=this.aa.head)&&b.state.Ua){if(null===this.R.head)if(0<b.state.N){e=new p(.5*this.o.width,.5*this.o.height);d=!0;for(a=this.D.head;a;){if(ca(a.position.position,e)<=a.w.s+50){d=!1;break}a=a.next}if(d){a=this.h;var f;f=new O;e=new Ga(f);T(T(T(T(T(T(Ha(e,"playing").add(t),new t(0,0,0,15)).add(ka),new ka(37,39,38,100,3)).add(G),new G(8,0,.3,2)).add(pa),new pa(90)).add(v),new v(9)).add(H),new H(new ia(a.a)));d=new qa(a.a);T(T(T(Ha(e,"destroyed").add(A),new A(5)).add(H),
new H(d)).add(K),new K(d));f.add(new oa(e)).add(new q(300,225,0)).add(new x);va(e,"playing");Da(a.f,f)}}else b.state.Ua=!1,Ia(this.h);if(null===this.D.head&&null===this.Z.head&&null!==this.R.head)for(a=this.R.head,b.state.level++,b=2+b.state.level,d=0;d<b;){for(;e=new p(Math.random()*this.o.width,Math.random()*this.o.height),80>=ca(e,a.position.position););ua(this.h,30,e.x,e.y);++d}}};function U(){return U.l.constructor.apply(this,arguments)}k(U,r);U.className="WaitForStartNode";U.g={hb:E};U.prototype.hb=null;function Ja(a){this.h=a;this.update=h(this.update,this)}k(Ja,l);c=Ja.prototype;c.f=null;c.h=null;c.aa=null;c.Db=null;c.D=null;c.S=function(a){this.f=a;this.Db=n(a,U);this.aa=n(a,D);this.D=n(a,y)};c.update=function(){var a,b,d;d=this.Db.head;b=this.aa.head;if(d&&d.hb.Ba&&b){for(a=this.D.head;a;)this.h.f.P(a.B),a=a.next;a=b.state;a.N=3;a.level=0;a.Ma=0;a.Ua=!0;d.hb.Ba=!1;this.f.P(d.B)}};function Ka(){}Ka.prototype.width=0;Ka.prototype.height=0;function La(a){this.h=a;this.i=h(this.i,this);La.l.constructor.call(this,R,this.i)}k(La,m);La.prototype.h=null;La.prototype.i=function(a,b){var d;d=a.oa;d.wa-=b;0>=d.wa&&this.h.f.P(a.B)};function V(){return V.l.constructor.apply(this,arguments)}k(V,za);V.prototype.H=function(a){var b;this.T=!0;for(b=this.head;null!==b;)b.listener(a),b.ya&&this.remove(b.listener),b=b.next;return Aa(this)};function Ma(a,b){this.K=a;this.sa=h(this.sa,this);Ma.l.constructor.apply(this,arguments);null!=this.K&&"function"===typeof this.K.begin&&"function"===typeof this.K.end&&(this.bb=!0,this.nb=this.K.begin.bind(this.K),this.lb=this.K.end.bind(this.K))}k(Ma,V);c=Ma.prototype;c.bb=!1;c.nb=null;c.lb=null;c.K=null;c.xb=0;c.start=function(){requestAnimationFrame(this.sa)};
c.sa=function(a){var b;null==a&&(a=Date.now());this.bb&&this.nb();b=this.xb||a;this.xb=a;this.H(.001*(a-b));requestAnimationFrame(this.sa);this.bb&&this.lb()};function Na(){return Na.l.constructor.apply(this,arguments)}k(Na,r);Na.className="AnimationNode";Na.g={W:K};Na.prototype.W=null;function Oa(){this.i=h(this.i,this);Oa.l.constructor.call(this,Na,this.i)}k(Oa,m);Oa.prototype.i=function(a,b){a.W.W.Ga(b)};function W(){return W.l.constructor.apply(this,arguments)}k(W,r);W.className="MotionControlNode";W.g={control:ka,position:q,da:t};W.prototype.control=null;W.prototype.position=null;W.prototype.da=null;function Pa(a){this.C=a;this.i=h(this.i,this);Pa.l.constructor.call(this,W,this.i)}k(Pa,m);Pa.prototype.C=null;Pa.prototype.i=function(a,b){var d,e,f,g,w;d=a.control;g=a.position;f=a.da;e=this.C.U(d.left);w=this.C.U(d.right);e&&(g.rotation-=d.rotationRate*b);w&&(g.rotation+=d.rotationRate*b);this.C.U(d.jb)&&(f.m.x+=Math.cos(g.rotation)*d.Fa*b,f.m.y+=Math.sin(g.rotation)*d.Fa*b)};function Qa(){}Qa.prototype.head=null;Qa.prototype.b=null;Qa.prototype.add=function(a){this.head?(this.b.next=a,a.c=this.b,a.next=null,this.b=a):(this.head=this.b=a,a.next=a.c=null)};Qa.prototype.remove=function(a){this.head===a&&(this.head=this.head.next);this.b===a&&(this.b=this.b.c);a.c&&(a.c.next=a.next);a.next&&(a.next.c=a.c)};function X(a){var b;return null!=(b=a.className)?b:a.name};function Ra(a,b){this.A=a;this.g=b}c=Ra.prototype;c.b=null;c.A=null;c.X=null;c.g=null;c.get=function(){var a;return this.b?(a=this.b,this.b=this.b.c,a.c=null,a):a=new this.A};function Sa(a,b){for(var d in a.g)b[d]=null;b.B=null;b.next=null;b.c=a.b;a.b=b};function Ta(){this.Ra=new V;this.Sa=new V}c=Ta.prototype;c.head=null;c.b=null;c.Ra=null;c.Sa=null;c.add=function(a){this.head?(this.b.next=a,a.c=this.b,a.next=null,this.b=a):(this.head=this.b=a,a.next=a.c=null);this.Ra.H(a)};c.remove=function(a){this.head===a&&(this.head=this.head.next);this.b===a&&(this.b=this.b.c);a.c&&(a.c.next=a.next);a.next&&(a.next.c=a.c);this.Sa.H(a)};function Y(){};function Ua(a,b){this.A=a;this.f=b;this.za=h(this.za,this);var d,e,f;this.u=new Ta;this.entities=new Y;this.g=new Y;this.fa=new Ra(this.A,this.A.g);f=this.A.g;for(d in f)e=f[d],this.g[X(e)]=e}c=Ua.prototype;c.u=null;c.entities=null;c.A=null;c.g=null;c.fa=null;c.f=null;c.P=function(a){Va(this,a)};function Wa(a,b){var d,e,f,g;if(null==a.entities[b.name]){f=a.A.g;for(e in f)if(d=f[e],!(X(d)in b.g))return;f=a.fa.get();f.B=b;g=a.A.g;for(e in g)d=g[e],f[e]=b.get(d);a.entities[b.name]=f;a.u.add(f)}}
function Va(a,b){var d;if(b.name in a.entities)if(d=a.entities[b.name],delete a.entities[b.name],a.u.remove(d),a.f.Ha){var e=a.fa;d.c=e.X;e.X=d;a.f.Da.add(a.za)}else Sa(a.fa,d)}c.za=function(){this.f.Da.remove(this.za);for(var a=this.fa,b;a.X;)b=a.X,a.X=b.c,Sa(a,b)};function Xa(){}c=Xa.prototype;c.head=null;c.b=null;c.add=function(a){var b;if(this.head){for(b=this.b;b&&!(b.Va<=a.Va);)b=b.c;b===this.b?(this.b.next=a,a.c=this.b,a.next=null,this.b=a):b?(a.next=b.next,a.c=b,b.next.c=a,b.next=a):(a.next=this.head,a.c=null,this.head=this.head.c=a)}else this.head=this.b=a,a.next=a.c=null};c.remove=function(a){this.head===a&&(this.head=this.head.next);this.b===a&&(this.b=this.b.c);a.c&&(a.c.next=a.next);a.next&&(a.next.c=a.c)};
c.get=function(a){var b;for(b=this.head;b;){if(b.constructor===a)return b;b=b.next}return null};function Ya(){this.update=h(this.update,this);this.la=h(this.la,this);this.ka=h(this.ka,this);this.va=h(this.va,this);this.ua=new Qa;this.M=new Y;this.cb=new Xa;this.L=new Y;this.Da=new Ba}c=Ya.prototype;c.M=null;c.ua=null;c.cb=null;c.L=null;c.Ha=!1;c.Da=null;c.Kb=Ua;function Da(a,b){var d,e,f;if(a.M[b.name])throw"The entity name "+b.name+" is already in use by another entity.";a.ua.add(b);a.M[b.name]=b;b.ma.add(a.ka);b.na.add(a.la);b.Qa.add(a.va);f=a.L;for(d in f)e=f[d],Wa(e,b)}
c.P=function(a){var b,d,e;a.ma.remove(this.ka);a.na.remove(this.la);a.Qa.remove(this.va);e=this.L;for(b in e)d=e[b],d.P(a);delete this.M[a.name];this.ua.remove(a)};c.va=function(a,b){this.M[b]===a&&(delete this.M[b],this.M[a.name]=a)};c.ka=function(a){var b,d,e;e=this.L;for(b in e)d=e[b],Wa(d,a)};c.la=function(a,b){var d,e,f;f=this.L;for(d in f)e=f[d],(null!=X(b)?X(b):b)in e.g&&Va(e,a)};
function n(a,b){var d,e;if(X(b)in a.L)return a.L[X(b)].u;e=new a.Kb(b,a);a.L[X(b)]=e;for(d=a.ua.head;d;)Wa(e,d),d=d.next;return e.u}function Z(a,b,d){b.Va=d;b.S(a);a.cb.add(b)}c.update=function(a){var b;this.Ha=!0;for(b=this.cb.head;b;)b.update(a),b=b.next;this.Ha=!1;this.Da.H()};function Za(){return Za.l.constructor.apply(this,arguments)}k(Za,za);Za.prototype.H=function(a,b){var d;this.T=!0;for(d=this.head;d;)d.listener(a,b),d.ya&&this.remove(d.listener),d=d.next;return Aa(this)};function O(a){null==a&&(a="");this.ma=new Za;this.na=new Za;this.Qa=new Za;this.g=new Y;""!==a?(null==$a[a]&&($a[a]=0),this.name=a+ ++$a[a]):this.name="_entity"+ ++ab}var ab,$a={};ab=0;c=O.prototype;c.name="";c.ma=null;c.na=null;c.Qa=null;c.c=null;c.next=null;c.g=null;c.add=function(a,b){null==b&&(b=a.constructor);X(b)in this.g&&this.remove(b);this.g[X(b)]=a;this.ma.H(this,b);return this};c.remove=function(a){var b;b=null!=X(a)?X(a):a;return(a=this.g[b])?(delete this.g[b],this.na.H(this,b),a):null};
c.get=function(a){return this.g[X(a)]};function bb(a){this.j=a}bb.prototype.j=null;bb.prototype.sb=function(){return this.j};bb.prototype.La=function(){return this.j};function cb(a){this.j=a}cb.prototype.j=null;cb.prototype.sb=function(){return new this.j};cb.prototype.La=function(){return this.j};function db(a,b){this.j=a;this.Ia=b;this.j.I[this.Ia]=new cb(b)}db.prototype.Ia=null;db.prototype.j=null;function T(a,b){a.j.I[a.Ia]=new bb(b);return a}db.prototype.add=function(a){return this.j.add(a)};function eb(){this.I=new Y}eb.prototype.I=null;eb.prototype.add=function(a){return new db(this,X(a))};eb.prototype.get=function(a){return this.I[a]};function Ga(a){this.B=a;this.F=new Y}Ga.prototype.F=null;Ga.prototype.j=null;Ga.prototype.B=null;function Ha(a,b){var d;d=new eb;return a.F[b]=d}function va(a,b){var d,e,f,g;d=a.F[b];if(!d)throw Error("Entity state "+b+" doesn't exist");if(d!==a.j){if(a.j){f=new Y;for(g in d.I)f[g]=d.I[g];for(g in a.j.I)(e=f[g])&&e.La()===a.j.I[g].La()?delete f[g]:a.B.remove(g)}else f=d.I;for(g in f)a.B.add(f[g].sb());a.j=d}};function fb(a,b,d){this.f=a;this.a=b;this.Mb=d}fb.prototype.f=null;fb.prototype.Ea=null;fb.prototype.a=null;function Ia(a){var b;a.Ea||(b=new Ca(a.a),a.Ea=(new O("wait")).add(new E(b)).add(new H(b)).add(new q(0,0,0)));a.Ea.get(E).Ba=!1;Da(a.f,a.Ea)}
function ua(a,b,d,e){var f,g;f=new O;g=new Ga(f);T(T(T(Ha(g,"alive").add(t),new t(4*(Math.random()-.5)*(50-b),4*(Math.random()-.5)*(50-b),2*Math.random()-1,0)).add(v),new v(b)).add(H),new H(new ra(a.a,b)));b=new la(a.a,b);T(T(T(Ha(g,"destroyed").add(A),new A(3)).add(H),new H(b)).add(K),new K(b));f.add(new fa(g)).add(new q(d,e,0)).add(new x);va(g,"alive");Da(a.f,f)};function gb(a){this.Ka=a;this.vb=h(this.vb,this);this.U=h(this.U,this);this.Pa=h(this.Pa,this);this.Oa=h(this.Oa,this);this.F={};this.Ka.addEventListener("keydown",this.Oa);this.Ka.addEventListener("keyup",this.Pa)}c=gb.prototype;c.F=null;c.Ka=null;c.Oa=function(a){this.F[a.keyCode]=!0};c.Pa=function(a){this.F[a.keyCode]&&(this.F[a.keyCode]=!1)};c.U=function(a){return this.F[a]};c.vb=function(a){return!this.F[a]};function hb(a,b,d){this.Ja=a;this.f=new Ya;this.h=new fb(this.f,this.Ja,this.Mb);this.C=new gb(window);this.o=new Ka;this.o.height=d;this.o.width=b;SystemPriorities={Ob:1,update:2,move:3,Qb:4,Rb:5,Ga:6,Pb:7};Z(this.f,new Ja(this.h),1);Z(this.f,new Fa(this.h,this.o),1);Z(this.f,new Pa(this.C),2);Z(this.f,new N(this.C,this.h),2);Z(this.f,new La(this.h),2);Z(this.f,new Ea(this.h),2);Z(this.f,new ea(this.o),3);Z(this.f,new ta(this.h),4);Z(this.f,new Oa,6);Z(this.f,new wa,6);Z(this.f,new Q(this.Ja),7);
Z(this.f,new ha,7);Ia(this.h);a=this.h;b=new ga(a.a);b=(new O("game")).add(new C).add(new sa(b)).add(new H(b)).add(new q(0,0,0));Da(a.f,b)}c=hb.prototype;c.Ja=null;c.f=null;c.eb=null;c.h=null;c.C=null;c.o=null;c.start=function(){var a,b;navigator.j?a=null:(b=Math.floor(this.o.width/2)-40,a=new Stats,a.setMode(0),a.domElement.style.position="absolute",a.domElement.style.left=b+"px",a.domElement.style.top="0px",document.body.appendChild(a.domElement));this.eb=new Ma(a);this.eb.add(this.f.update);this.eb.start()};function ib(){var a;a=this.canvas();(new hb(a.getContext("2d"),a.width,a.height)).start()}ib.prototype.canvas=function(){var a;a=document.createElement(navigator.j?"screencanvas":"canvas");a.width=window.innerWidth*window.devicePixelRatio;a.height=window.innerHeight*window.devicePixelRatio;a.style.width="100%";a.style.height="100%";a.style.backgroundColor="#000000";document.body.appendChild(a);return a};new ib;
