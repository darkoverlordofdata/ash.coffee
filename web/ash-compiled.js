var c;function aa(a,b,d){return a.call.apply(a.bind,arguments)}function ba(a,b,d){if(!a)throw Error();if(2<arguments.length){var e=Array.prototype.slice.call(arguments,2);return function(){var d=Array.prototype.slice.call(arguments);Array.prototype.unshift.apply(d,e);return a.apply(b,d)}}return function(){return a.apply(b,arguments)}}function h(a,b,d){h=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?aa:ba;return h.apply(null,arguments)}
function k(a,b){function d(){}d.prototype=b.prototype;a.l=b.prototype;a.prototype=new d;a.prototype.constructor=a;a.Ib=function(a,d,g){for(var w=Array(arguments.length-2),J=2;J<arguments.length;J++)w[J-2]=arguments[J];return b.prototype[d].apply(a,w)}};function l(){this.update=h(this.update,this)}c=l.prototype;c.c=null;c.next=null;c.Ta=0;c.S=function(){};c.update=function(){};function m(a,b,d,e){null==d&&(d=null);null==e&&(e=null);this.A=a;this.sb=b;this.wa=d;this.Ra=e}k(m,l);c=m.prototype;c.ea=null;c.A=null;c.sb=null;c.wa=null;c.Ra=null;c.S=function(a){this.ea=n(a,this.A);if(null!==this.wa){for(a=this.ea.head;a;)this.wa(a),a=a.next;this.ea.Pa.add(this.wa)}null!==this.Ra&&this.ea.Qa.add(this.Ra)};c.update=function(a){var b;for(b=this.ea.head;b;)this.sb(b,a),b=b.next};function p(a,b){this.x=null!=a?a:0;this.y=null!=b?b:0}p.prototype.x=0;p.prototype.y=0;function ca(a,b){var d,e;d=a.x-b.x;e=a.y-b.y;return Math.sqrt(d*d+e*e)}function da(a,b){var d,e;d=a.x-b.x;e=a.y-b.y;return Math.sqrt(d*d+e*e)};function q(a,b,d){this.rotation=d;this.position=new p(a,b)}q.className="Position";q.prototype.position=null;q.prototype.rotation=0;function r(){}r.prototype.B=null;r.prototype.c=null;r.prototype.next=null;function t(a,b,d,e){this.hb=d;this.qa=e;this.m=new p(a,b)}t.className="Motion";t.prototype.m=null;t.prototype.hb=0;t.prototype.qa=0;function u(){return u.l.constructor.apply(this,arguments)}k(u,r);u.className="MovementNode";u.g={position:q,da:t};u.prototype.position=null;u.prototype.da=null;function ea(a){this.o=a;this.j=h(this.j,this);ea.l.constructor.call(this,u,this.j)}k(ea,m);ea.prototype.o=null;
ea.prototype.j=function(a,b){var d,e,f;e=a.position;d=a.da;e.position.x+=d.m.x*b;e.position.y+=d.m.y*b;0>e.position.x&&(e.position.x+=this.o.width);e.position.x>this.o.width&&(e.position.x-=this.o.width);0>e.position.y&&(e.position.y+=this.o.height);e.position.y>this.o.height&&(e.position.y-=this.o.height);e.rotation+=d.hb*b;0<d.qa&&(f=Math.abs(Math.cos(e.rotation)*d.qa*b),e=Math.abs(Math.sin(e.rotation)*d.qa*b),d.m.x>f?d.m.x-=f:d.m.x<-f?d.m.x+=f:d.m.x=0,d.m.y>e?d.m.y-=e:d.m.y<-e?d.m.y+=e:d.m.y=0)};function v(a){this.s=a}v.className="Collision";v.prototype.s=0;function x(){this.Ba=[]}x.className="Audio";x.prototype.Ba=null;x.prototype.play=function(a){return this.Ba.push(a)};function fa(a){this.$=a}fa.className="Asteroid";fa.prototype.$=null;function y(){return y.l.constructor.apply(this,arguments)}k(y,r);y.className="AsteroidCollisionNode";y.g={ib:fa,position:q,w:v,audio:x};y.prototype.ib=null;y.prototype.position=null;y.prototype.w=null;y.prototype.audio=null;function ga(a){this.a=a;this.Xa=h(this.Xa,this);this.Wa=h(this.Wa,this);this.v=h(this.v,this);this.mb=this.Eb;this.lb=this.Db}c=ga.prototype;c.x=0;c.y=0;c.width=4;c.height=4;c.rotation=0;c.a=null;c.vb=0;c.N=3;c.mb=null;c.lb=null;c.v=function(){this.mb();this.lb()};c.Wa=function(a){return this.N=a};c.Xa=function(a){return this.vb=a};
c.Db=function(){var a;this.a.save();this.a.beginPath();this.a.font="bold 18px Helvetica";this.a.fillStyle="#FFFFFF";this.a.textAlign="center";a="LIVES: "+this.N;this.a.fillText(a,this.a.measureText(a).width,20);this.a.fill();this.a.restore()};
c.Eb=function(){var a;this.a.save();this.a.beginPath();this.a.font="bold 18px Helvetica";this.a.fillStyle="#FFFFFF";this.a.textAlign="center";a="SCORE: "+this.vb;this.a.fillText(a,window.window.innerWidth*window.devicePixelRatio-this.a.measureText(a).width,20);this.a.fill();this.a.restore()};function z(){return z.l.constructor.apply(this,arguments)}k(z,r);z.className="AudioNode";z.g={audio:x};z.prototype.audio=null;function ha(){this.j=h(this.j,this);ha.l.constructor.call(this,z,this.j)}k(ha,m);ha.prototype.j=function(a){var b,d,e;e=a.audio.Ba;for(b in e)d=e[b],d=new d,d.play(0,1);a.audio.Ba.length=0};function A(a){this.pa=a}A.className="DeathThroes";A.prototype.pa=0;function B(){return B.l.constructor.apply(this,arguments)}k(B,r);B.className="DeathThroesNode";B.g={ra:A};B.prototype.ra=null;function ia(a){this.a=a}c=ia.prototype;c.x=0;c.y=0;c.width=20;c.height=20;c.rotation=0;c.a=null;c.v=function(){var a;a=this.a;a.save();a.beginPath();a.translate(this.x,this.y);a.rotate(this.rotation);a.fillStyle="#FFFFFF";a.moveTo(10,0);a.lineTo(-7,7);a.lineTo(-4,0);a.lineTo(-7,-7);a.lineTo(10,0);a.fill();a.restore()};function C(){}C.className="GameState";C.prototype.N=3;C.prototype.level=0;C.prototype.Ka=0;C.prototype.Sa=!1;function D(){return D.l.constructor.apply(this,arguments)}k(D,r);D.className="GameNode";D.g={state:C};D.prototype.state=null;function E(a){this.xb=a;this.Ya=h(this.Ya,this);this.xb.click.add(this.Ya)}E.className="WaitForStart";E.prototype.xb=null;E.prototype.Aa=!1;E.prototype.Ya=function(){this.Aa=!0};function ja(a){this.va=a}ja.className="Bullet";ja.prototype.va=0;function F(){return F.l.constructor.apply(this,arguments)}k(F,r);F.className="BulletCollisionNode";F.g={oa:ja,position:q,w:v};F.prototype.oa=null;F.prototype.position=null;F.prototype.w=null;function G(a,b,d,e){this.Gb=d;this.zb=e;this.Za=!1;this.O=null;this.ga=0;this.O=new p(a,b)}G.className="Gun";G.prototype.Za=!1;G.prototype.O=null;G.prototype.ga=0;G.prototype.O=null;function ka(a,b,d,e,f){this.left=a;this.right=b;this.gb=d;this.Ea=e;this.rotationRate=f}ka.className="MotionControls";c=ka.prototype;c.left=0;c.right=0;c.gb=0;c.Ea=0;c.rotationRate=0;function la(a,b){this.a=a;this.s=b;this.sa=[]}c=la.prototype;c.sa=null;c.x=0;c.y=0;c.width=0;c.height=0;c.rotation=0;c.a=null;c.s=0;c.V=null;c.first=!0;c.Fa=function(a){var b,d,e,f;if(this.first)for(this.first=!1,d=0;8>d;++d)b=new ma(this.a,this.s),this.sa.push(b);f=this.sa;d=0;for(e=f.length;d<e;d++)b=f[d],b.x+=b.m.x*a,b.y+=b.m.y*a;return this.v()};c.v=function(){var a,b,d,e,f;e=this.sa;f=[];b=0;for(d=e.length;b<d;b++)a=e[b],f.push(a.v(this.x,this.y));return f};
function ma(a,b){var d,e;this.a=a;d=2*Math.random()*Math.PI;e=Math.random()*b;this.x=Math.cos(d)*e;this.y=Math.sin(d)*e;e=10*Math.random()+10;this.m=new p(Math.cos(d)*e,Math.sin(d)*e)}c=ma.prototype;c.m=null;c.a=null;c.ha=0;c.ia=0;c.x=0;c.y=0;c.v=function(a,b){var d;d=this.a;d.save();d.beginPath();d.translate(a,b);d.rotate(this.rotation);d.fillStyle="#FFFFFF";d.arc(this.x,this.y,2,0,2*Math.PI,!1);d.fill();d.restore()};function na(a){this.a=a}c=na.prototype;c.x=0;c.y=0;c.width=4;c.height=4;c.rotation=0;c.a=null;c.v=function(){var a;a=this.a;a.save();a.beginPath();a.rotate(this.rotation);a.fillStyle="#FFFFFF";a.arc(this.x,this.y,2,0,2*Math.PI,!1);a.fill();a.restore()};function oa(a){this.$=a}oa.className="Spaceship";oa.prototype.$=null;function pa(a){this.wb=a}pa.className="GunControls";pa.prototype.wb=0;function qa(a){this.a=a}c=qa.prototype;c.x=0;c.y=0;c.width=20;c.height=20;c.rotation=0;c.a=null;c.bb=null;c.cb=null;c.tb=null;c.ub=null;c.ha=0;c.ja=0;c.ia=0;c.ja=0;c.first=!0;
c.Fa=function(a){this.first&&(this.first=!1,this.bb=new p(10*Math.random()-5,10*Math.random()+10),this.cb=new p(10*Math.random()-5,-(10*Math.random()+10)),this.tb=300*Math.random()-150,this.ub=300*Math.random()-150,this.ha=this.fb=this.x,this.ia=this.ja=this.y,this.Ua=this.Va=this.rotation);this.ha+=this.bb.x*a;this.ia+=this.bb.y*a;this.Ua+=this.tb*a;this.fb+=this.cb.x*a;this.ja+=this.cb.y*a;this.Va+=this.ub*a;return this.v()};
c.v=function(){var a;a=this.a;a.save();a.beginPath();a.translate(this.x+this.ha,this.y+this.ia);a.rotate(this.Ua);a.fillStyle="#FFFFFF";a.moveTo(10,0);a.lineTo(-7,7);a.lineTo(-4,0);a.lineTo(10,0);a.fill();a.restore();a.save();a.beginPath();a.translate(this.x+this.fb,this.y+this.ja);a.rotate(this.Va);a.fillStyle="#FFFFFF";a.moveTo(10,0);a.lineTo(-7,7);a.lineTo(-4,0);a.lineTo(10,0);a.fill();a.restore()};function H(a){this.a=a}H.className="Display";H.prototype.a=0;function I(){return I.l.constructor.apply(this,arguments)}k(I,r);I.className="SpaceshipCollisionNode";I.g={za:oa,position:q,w:v,audio:x};I.prototype.za=0;I.prototype.position=0;I.prototype.w=null;I.prototype.audio=null;function ra(a,b){var d,e,f;this.a=a;this.height=this.width=this.s=b;this.V=[];for(d=0;d<2*Math.PI;)e=(.75+.25*Math.random())*this.s,f=Math.cos(d)*e,e*=Math.sin(d),this.V.push({x:f,y:e}),d+=.5*Math.random()}c=ra.prototype;c.x=0;c.y=0;c.width=0;c.height=0;c.rotation=0;c.a=null;c.s=0;c.V=null;
c.v=function(){var a,b;a=this.a;a.save();a.beginPath();a.translate(this.x,this.y);a.rotate(this.rotation);a.fillStyle="#FFFFFF";a.moveTo(this.s,0);for(b=0;b<this.V.length;)a.lineTo(this.V[b].x,this.V[b].y),++b;a.lineTo(this.s,0);a.fill();a.restore()};function K(a){this.W=a}K.className="Animation";K.prototype.W=null;function sa(a){this.view=a}sa.className="Hud";sa.prototype.view=null;function ta(a){this.i=a;this.update=h(this.update,this)}k(ta,l);c=ta.prototype;c.i=null;c.ba=null;c.R=null;c.D=null;c.Z=null;c.S=function(a){this.ba=n(a,D);this.R=n(a,I);this.D=n(a,y);this.Z=n(a,F)};
c.update=function(){var a,b;for(b=this.Z.head;b;){for(a=this.D.head;a;){if(da(a.position.position,b.position.position)<=a.w.s){this.i.f.P(b.B);10<a.w.s&&(ua(this.i,a.w.s-10,a.position.position.x+10*Math.random()-5,a.position.position.y+10*Math.random()-5),ua(this.i,a.w.s-10,a.position.position.x+10*Math.random()-5,a.position.position.y+10*Math.random()-5));va(a.ib.$,"destroyed");this.ba.head&&this.ba.head.state.Ka++;break}a=a.next}b=b.next}for(b=this.R.head;b;){for(a=this.D.head;a;){if(da(a.position.position,
b.position.position)<=a.w.s+b.w.s){va(b.za.$,"destroyed");this.ba.head&&this.ba.head.state.N++;break}a=a.next}b=b.next}};function L(){return L.l.constructor.apply(this,arguments)}k(L,r);L.className="HudNode";L.g={state:C,La:sa};L.prototype.state=null;L.prototype.La=null;function wa(){this.j=h(this.j,this);wa.l.constructor.call(this,L,this.j)}k(wa,m);wa.prototype.j=function(a){a.La.view.Wa(a.state.N);a.La.view.Xa(a.state.Ka)};function xa(){}xa.prototype.c=null;xa.prototype.next=null;xa.prototype.listener=null;xa.prototype.xa=!1;function ya(){}ya.prototype.b=null;ya.prototype.h=null;ya.prototype.get=function(){var a;return null!==this.b?(a=this.b,this.b=this.b.c,a.c=null,a):new xa};function za(){this.u=[];this.Y=[];this.ca=new ya}c=za.prototype;c.head=null;c.b=null;c.Y=null;c.u=null;c.ca=null;c.G=null;c.J=null;c.T=!1;function Aa(a){a.T=!1;a.G&&(a.head?(a.b.next=a.G,a.G.c=a.b):a.head=a.G,a.b=a.J,a.G=null,a.J=null);a=a.ca;for(var b;null!==a.h;)b=a.h,a.h=b.c,b.next=null,b.c=a.b,a.b=b}
c.add=function(a){var b;-1===this.Y.indexOf(a)&&(b=this.ca.get(),b.listener=a,this.u.push(b),this.Y.push(a),this.T?null===this.G?this.G=this.J=b:(this.J.next=b,b.c=this.J,this.J=b):null===this.head?this.head=this.b=b:(this.b.next=b,b.c=this.b,this.b=b))};
c.remove=function(a){var b;b=this.Y.indexOf(a);if(a=this.u[b])this.head===a&&(this.head=this.head.next),this.b===a&&(this.b=this.b.c),this.G===a&&(this.G=this.G.next),this.J===a&&(this.J=this.J.c),a.c&&(a.c.next=a.next),a.next&&(a.next.c=a.c),this.u.splice(b,1),this.Y.splice(b,1),this.T?(b=this.ca,a.listener=null,a.c=b.h,b.h=a):(b=this.ca,a.listener=null,a.xa=!1,a.next=null,a.c=b.b,b.b=a)};function Ba(){return Ba.l.constructor.apply(this,arguments)}k(Ba,za);Ba.prototype.H=function(){var a;this.T=!0;for(a=this.head;null!==a;)a.listener(),a.xa&&this.remove(a.listener),a=a.next;return Aa(this)};function Ca(a){this.a=a;this.click=new Ba;this.nb=this.Bb;this.qb=this.Cb;this.kb=this.Ab;this.a.canvas.addEventListener("click",function(a){return function(){return a.click.H()}}(this))}c=Ca.prototype;c.x=0;c.y=0;c.width=4;c.height=4;c.rotation=0;c.a=null;c.nb=null;c.kb=null;c.qb=null;c.click=null;
c.Bb=function(){this.a.save();this.a.beginPath();this.a.font="bold 32px Helvetica";this.a.fillStyle="#FFFFFF";this.a.fillText("ASTEROIDS",Math.floor((window.innerWidth*window.devicePixelRatio-this.a.measureText("ASTEROIDS").width)/2),175);this.a.fill();this.a.restore()};
c.Ab=function(){this.a.save();this.a.beginPath();this.a.font="bold 18px Helvetica";this.a.fillStyle="#FFFFFF";this.a.fillText("CLICK TO START",Math.floor((window.innerWidth*window.devicePixelRatio-this.a.measureText("CLICK TO START").width)/2),225);this.a.fill();this.a.restore()};
c.Cb=function(){this.a.save();this.a.beginPath();this.a.font="bold 14px Helvetica";this.a.fillStyle="#FFFFFF";this.a.fillText("CTRL-Z to Fire  ~  Arrow Keys to Move",10,window.innerHeight*window.devicePixelRatio-20);this.a.fill();this.a.restore()};c.v=function(){this.nb();this.kb();this.qb()};function M(){return M.l.constructor.apply(this,arguments)}k(M,r);M.className="GunControlNode";M.g={audio:x,control:pa,pb:G,position:q};M.prototype.control=null;M.prototype.pb=null;M.prototype.position=null;M.prototype.audio=null;function N(a,b){this.C=a;this.i=b;this.j=h(this.j,this);N.l.constructor.call(this,M,this.j)}k(N,m);N.prototype.C=null;N.prototype.i=null;
N.prototype.j=function(a,b){var d,e,f;d=a.control;f=a.position;e=a.pb;e.Za=this.C.U(d.wb);e.ga+=b;if(e.Za&&e.ga>=e.Gb){d=this.i;var g,w,J;g=Math.cos(f.rotation);w=Math.sin(f.rotation);J=g*e.O.x-w*e.O.y+f.position.x;f=w*e.O.x+g*e.O.y+f.position.y;f=(new O).add(new ja(e.zb)).add(new q(J,f,0)).add(new v(0)).add(new t(150*g,150*w,0,0)).add(new H(new na(d.a)));Da(d.f,f);e.ga=0}};function P(){return P.l.constructor.apply(this,arguments)}k(P,r);P.className="RenderNode";P.g={position:q,display:H};P.prototype.position=null;P.prototype.display=null;function Q(a){this.a=a;this.update=h(this.update,this)}k(Q,l);Q.prototype.a=null;Q.prototype.u=null;Q.prototype.S=function(a){this.u=n(a,P);for(a=this.u.head;a;)a=a.next};Q.prototype.update=function(){var a,b,d;this.a.save();this.a.translate(0,0);this.a.rotate(0);this.a.clearRect(0,0,this.a.canvas.width,this.a.canvas.height);for(b=this.u.head;b;)a=b.display,a=a.a,d=b.position,a.x=d.position.x,a.y=d.position.y,a.rotation=d.rotation,a.v(),b=b.next;this.a.restore()};function R(){return R.l.constructor.apply(this,arguments)}k(R,r);R.h="BulletAgeNode";R.g={oa:ja};R.prototype.oa=null;function Ea(a){this.i=a;this.j=h(this.j,this);Ea.l.constructor.call(this,B,this.j)}k(Ea,m);Ea.prototype.i=null;Ea.prototype.j=function(a,b){a.ra.pa-=b;0>=a.ra.pa&&this.i.f.P(a.B)};function S(){return S.l.constructor.apply(this,arguments)}k(S,r);S.className="SpaceshipNode";S.g={za:oa,position:q};S.prototype.za=0;S.prototype.position=0;function Fa(a,b){this.i=a;this.o=b;this.update=h(this.update,this)}k(Fa,l);c=Fa.prototype;c.o=null;c.i=null;c.aa=null;c.R=null;c.D=null;c.Z=null;c.S=function(a){this.aa=n(a,D);this.R=n(a,S);this.D=n(a,y);this.Z=n(a,F)};
c.update=function(){var a,b,d,e;if((b=this.aa.head)&&b.state.Sa){if(null===this.R.head)if(0<b.state.N){e=new p(.5*this.o.width,.5*this.o.height);d=!0;for(a=this.D.head;a;){if(ca(a.position.position,e)<=a.w.s+50){d=!1;break}a=a.next}if(d){a=this.i;var f;f=new O;e=new Ga(f);T(T(T(T(T(T(Ha(e,"playing").add(t),new t(0,0,0,15)).add(ka),new ka(37,39,38,100,3)).add(G),new G(8,0,.3,2)).add(pa),new pa(90)).add(v),new v(9)).add(H),new H(new ia(a.a)));d=new qa(a.a);T(T(T(Ha(e,"destroyed").add(A),new A(5)).add(H),
new H(d)).add(K),new K(d));f.add(new oa(e)).add(new q(300,225,0)).add(new x);va(e,"playing");Da(a.f,f)}}else b.state.Sa=!1,Ia(this.i);if(null===this.D.head&&null===this.Z.head&&null!==this.R.head)for(a=this.R.head,b.state.level++,b=2+b.state.level,d=0;d<b;){for(;e=new p(Math.random()*this.o.width,Math.random()*this.o.height),80>=ca(e,a.position.position););ua(this.i,30,e.x,e.y);++d}}};function U(){return U.l.constructor.apply(this,arguments)}k(U,r);U.className="WaitForStartNode";U.g={eb:E};U.prototype.eb=null;function Ja(a){this.i=a;this.update=h(this.update,this)}k(Ja,l);c=Ja.prototype;c.f=null;c.i=null;c.aa=null;c.yb=null;c.D=null;c.S=function(a){this.f=a;this.yb=n(a,U);this.aa=n(a,D);this.D=n(a,y)};c.update=function(){var a,b,d;d=this.yb.head;b=this.aa.head;if(d&&d.eb.Aa&&b){for(a=this.D.head;a;)this.i.f.P(a.B),a=a.next;a=b.state;a.N=3;a.level=0;a.Ka=0;a.Sa=!0;d.eb.Aa=!1;this.f.P(d.B)}};function Ka(){}Ka.prototype.width=0;Ka.prototype.height=0;function La(a){this.i=a;this.j=h(this.j,this);La.l.constructor.call(this,R,this.j)}k(La,m);La.prototype.i=null;La.prototype.j=function(a,b){var d;d=a.oa;d.va-=b;0>=d.va&&this.i.f.P(a.B)};function Ma(){return Ma.l.constructor.apply(this,arguments)}k(Ma,za);Ma.prototype.H=function(a){var b;this.T=!0;for(b=this.head;null!==b;)b.listener(a),b.xa&&this.remove(b.listener),b=b.next;return Aa(this)};function V(a,b){this.L=a;this.h=h(this.h,this);V.l.constructor.apply(this,arguments)}k(V,Ma);V.prototype.L=null;V.prototype.jb=0;V.prototype.start=function(){requestAnimationFrame(this.h)};V.prototype.h=function(a){var b,d;null==a&&(a=Date.now());null!=(b=this.L)&&"function"===typeof b.begin&&b.begin();b=this.jb||a;this.jb=a;this.H(.001*(a-b));requestAnimationFrame(this.h);null!=(d=this.L)&&"function"===typeof d.end&&d.end()};function Na(){return Na.l.constructor.apply(this,arguments)}k(Na,r);Na.className="AnimationNode";Na.g={W:K};Na.prototype.W=null;function Oa(){this.j=h(this.j,this);Oa.l.constructor.call(this,Na,this.j)}k(Oa,m);Oa.prototype.j=function(a,b){a.W.W.Fa(b)};function W(){return W.l.constructor.apply(this,arguments)}k(W,r);W.className="MotionControlNode";W.g={control:ka,position:q,da:t};W.prototype.control=null;W.prototype.position=null;W.prototype.da=null;function Pa(a){this.C=a;this.j=h(this.j,this);Pa.l.constructor.call(this,W,this.j)}k(Pa,m);Pa.prototype.C=null;Pa.prototype.j=function(a,b){var d,e,f,g,w;d=a.control;g=a.position;f=a.da;e=this.C.U(d.left);w=this.C.U(d.right);e&&(g.rotation-=d.rotationRate*b);w&&(g.rotation+=d.rotationRate*b);this.C.U(d.gb)&&(f.m.x+=Math.cos(g.rotation)*d.Ea*b,f.m.y+=Math.sin(g.rotation)*d.Ea*b)};function Qa(){}Qa.prototype.head=null;Qa.prototype.b=null;Qa.prototype.add=function(a){this.head?(this.b.next=a,a.c=this.b,a.next=null,this.b=a):(this.head=this.b=a,a.next=a.c=null)};Qa.prototype.remove=function(a){this.head===a&&(this.head=this.head.next);this.b===a&&(this.b=this.b.c);a.c&&(a.c.next=a.next);a.next&&(a.next.c=a.c)};function X(a){var b;return null!=(b=a.className)?b:a.name};function Ra(a,b){this.A=a;this.g=b}c=Ra.prototype;c.b=null;c.A=null;c.X=null;c.g=null;c.get=function(){var a;return this.b?(a=this.b,this.b=this.b.c,a.c=null,a):a=new this.A};function Sa(a,b){for(var d in a.g)b[d]=null;b.B=null;b.next=null;b.c=a.b;a.b=b};function Ta(){this.Pa=new Ma;this.Qa=new Ma}c=Ta.prototype;c.head=null;c.b=null;c.Pa=null;c.Qa=null;c.add=function(a){this.head?(this.b.next=a,a.c=this.b,a.next=null,this.b=a):(this.head=this.b=a,a.next=a.c=null);this.Pa.H(a)};c.remove=function(a){this.head===a&&(this.head=this.head.next);this.b===a&&(this.b=this.b.c);a.c&&(a.c.next=a.next);a.next&&(a.next.c=a.c);this.Qa.H(a)};function Y(){};function Ua(a,b){this.A=a;this.f=b;this.ya=h(this.ya,this);var d,e,f;this.u=new Ta;this.entities=new Y;this.g=new Y;this.fa=new Ra(this.A,this.A.g);f=this.A.g;for(d in f)e=f[d],this.g[X(e)]=e}c=Ua.prototype;c.u=null;c.entities=null;c.A=null;c.g=null;c.fa=null;c.f=null;c.P=function(a){Va(this,a)};function Wa(a,b){var d,e,f,g;if(null==a.entities[b.name]){f=a.A.g;for(e in f)if(d=f[e],!(X(d)in b.g))return;f=a.fa.get();f.B=b;g=a.A.g;for(e in g)d=g[e],f[e]=b.get(d);a.entities[b.name]=f;a.u.add(f)}}
function Va(a,b){var d;if(b.name in a.entities)if(d=a.entities[b.name],delete a.entities[b.name],a.u.remove(d),a.f.Ga){var e=a.fa;d.c=e.X;e.X=d;a.f.Ca.add(a.ya)}else Sa(a.fa,d)}c.ya=function(){this.f.Ca.remove(this.ya);for(var a=this.fa,b;a.X;)b=a.X,a.X=b.c,Sa(a,b)};function Xa(){}c=Xa.prototype;c.head=null;c.b=null;c.add=function(a){var b;if(this.head){for(b=this.b;b&&!(b.Ta<=a.Ta);)b=b.c;b===this.b?(this.b.next=a,a.c=this.b,a.next=null,this.b=a):b?(a.next=b.next,a.c=b,b.next.c=a,b.next=a):(a.next=this.head,a.c=null,this.head=this.head.c=a)}else this.head=this.b=a,a.next=a.c=null};c.remove=function(a){this.head===a&&(this.head=this.head.next);this.b===a&&(this.b=this.b.c);a.c&&(a.c.next=a.next);a.next&&(a.next.c=a.c)};
c.get=function(a){var b;for(b=this.head;b;){if(b.constructor===a)return b;b=b.next}return null};function Ya(){this.update=h(this.update,this);this.la=h(this.la,this);this.ka=h(this.ka,this);this.ua=h(this.ua,this);this.ta=new Qa;this.M=new Y;this.$a=new Xa;this.K=new Y;this.Ca=new Ba}c=Ya.prototype;c.M=null;c.ta=null;c.$a=null;c.K=null;c.Ga=!1;c.Ca=null;c.Fb=Ua;function Da(a,b){var d,e,f;if(a.M[b.name])throw"The entity name "+b.name+" is already in use by another entity.";a.ta.add(b);a.M[b.name]=b;b.ma.add(a.ka);b.na.add(a.la);b.Oa.add(a.ua);f=a.K;for(d in f)e=f[d],Wa(e,b)}
c.P=function(a){var b,d,e;a.ma.remove(this.ka);a.na.remove(this.la);a.Oa.remove(this.ua);e=this.K;for(b in e)d=e[b],d.P(a);delete this.M[a.name];this.ta.remove(a)};c.ua=function(a,b){this.M[b]===a&&(delete this.M[b],this.M[a.name]=a)};c.ka=function(a){var b,d,e;e=this.K;for(b in e)d=e[b],Wa(d,a)};c.la=function(a,b){var d,e,f;f=this.K;for(d in f)e=f[d],(null!=X(b)?X(b):b)in e.g&&Va(e,a)};
function n(a,b){var d,e;if(X(b)in a.K)return a.K[X(b)].u;e=new a.Fb(b,a);a.K[X(b)]=e;for(d=a.ta.head;d;)Wa(e,d),d=d.next;return e.u}function Z(a,b,d){b.Ta=d;b.S(a);a.$a.add(b)}c.update=function(a){var b;this.Ga=!0;for(b=this.$a.head;b;)b.update(a),b=b.next;this.Ga=!1;this.Ca.H()};function Za(){return Za.l.constructor.apply(this,arguments)}k(Za,za);Za.prototype.H=function(a,b){var d;this.T=!0;for(d=this.head;d;)d.listener(a,b),d.xa&&this.remove(d.listener),d=d.next;return Aa(this)};function O(a){null==a&&(a="");this.ma=new Za;this.na=new Za;this.Oa=new Za;this.g=new Y;""!==a?(null==$a[a]&&($a[a]=0),this.name=a+ ++$a[a]):this.name="_entity"+ ++ab}var ab,$a={};ab=0;c=O.prototype;c.name="";c.ma=null;c.na=null;c.Oa=null;c.c=null;c.next=null;c.g=null;c.add=function(a,b){null==b&&(b=a.constructor);X(b)in this.g&&this.remove(b);this.g[X(b)]=a;this.ma.H(this,b);return this};c.remove=function(a){var b;b=null!=X(a)?X(a):a;return(a=this.g[b])?(delete this.g[b],this.na.H(this,b),a):null};
c.get=function(a){return this.g[X(a)]};function bb(a){this.h=a}bb.prototype.h=null;bb.prototype.ob=function(){return this.h};bb.prototype.Ja=function(){return this.h};function cb(a){this.h=a}cb.prototype.h=null;cb.prototype.ob=function(){return new this.h};cb.prototype.Ja=function(){return this.h};function db(a,b){this.h=a;this.L=b;this.h.I[this.L]=new cb(b)}db.prototype.L=null;db.prototype.h=null;function T(a,b){a.h.I[a.L]=new bb(b);return a}db.prototype.add=function(a){return this.h.add(a)};function eb(){this.I=new Y}eb.prototype.I=null;eb.prototype.add=function(a){return new db(this,X(a))};eb.prototype.get=function(a){return this.I[a]};function Ga(a){this.B=a;this.F=new Y}Ga.prototype.F=null;Ga.prototype.h=null;Ga.prototype.B=null;function Ha(a,b){var d;d=new eb;return a.F[b]=d}function va(a,b){var d,e,f,g;d=a.F[b];if(!d)throw Error("Entity state "+b+" doesn't exist");if(d!==a.h){if(a.h){f=new Y;for(g in d.I)f[g]=d.I[g];for(g in a.h.I)(e=f[g])&&e.Ja()===a.h.I[g].Ja()?delete f[g]:a.B.remove(g)}else f=d.I;for(g in f)a.B.add(f[g].ob());a.h=d}};function fb(a,b,d){this.f=a;this.a=b;this.Hb=d}fb.prototype.f=null;fb.prototype.Da=null;fb.prototype.a=null;function Ia(a){var b;a.Da||(b=new Ca(a.a),a.Da=(new O("wait")).add(new E(b)).add(new H(b)).add(new q(0,0,0)));a.Da.get(E).Aa=!1;Da(a.f,a.Da)}
function ua(a,b,d,e){var f,g;f=new O;g=new Ga(f);T(T(T(Ha(g,"alive").add(t),new t(4*(Math.random()-.5)*(50-b),4*(Math.random()-.5)*(50-b),2*Math.random()-1,0)).add(v),new v(b)).add(H),new H(new ra(a.a,b)));b=new la(a.a,b);T(T(T(Ha(g,"destroyed").add(A),new A(3)).add(H),new H(b)).add(K),new K(b));f.add(new fa(g)).add(new q(d,e,0)).add(new x);va(g,"alive");Da(a.f,f)};function gb(a){this.Ia=a;this.rb=h(this.rb,this);this.U=h(this.U,this);this.Na=h(this.Na,this);this.Ma=h(this.Ma,this);this.F={};this.Ia.addEventListener("keydown",this.Ma);this.Ia.addEventListener("keyup",this.Na)}c=gb.prototype;c.F=null;c.Ia=null;c.Ma=function(a){this.F[a.keyCode]=!0};c.Na=function(a){this.F[a.keyCode]&&(this.F[a.keyCode]=!1)};c.U=function(a){return this.F[a]};c.rb=function(a){return!this.F[a]};function hb(a,b,d){this.Ha=a;this.f=new Ya;this.i=new fb(this.f,this.Ha,this.Hb);this.C=new gb(window);this.o=new Ka;this.o.height=d;this.o.width=b;SystemPriorities={Jb:1,update:2,move:3,Lb:4,Mb:5,Fa:6,Kb:7};Z(this.f,new Ja(this.i),1);Z(this.f,new Fa(this.i,this.o),1);Z(this.f,new Pa(this.C),2);Z(this.f,new N(this.C,this.i),2);Z(this.f,new La(this.i),2);Z(this.f,new Ea(this.i),2);Z(this.f,new ea(this.o),3);Z(this.f,new ta(this.i),4);Z(this.f,new Oa,6);Z(this.f,new wa,6);Z(this.f,new Q(this.Ha),7);
Z(this.f,new ha,7);Ia(this.i);a=this.i;b=new ga(a.a);b=(new O("game")).add(new C).add(new sa(b)).add(new H(b)).add(new q(0,0,0));Da(a.f,b)}c=hb.prototype;c.Ha=null;c.f=null;c.ab=null;c.i=null;c.C=null;c.o=null;c.start=function(){var a,b;navigator.h?a=null:(b=Math.floor(this.o.width/2)-40,a=new Stats,a.setMode(0),a.domElement.style.position="absolute",a.domElement.style.left=b+"px",a.domElement.style.top="0px",document.body.appendChild(a.domElement));this.ab=new V(a);this.ab.add(this.f.update);this.ab.start()};function ib(){var a;a=this.canvas();(new hb(a.getContext("2d"),a.width,a.height)).start()}ib.prototype.canvas=function(){var a;a=document.createElement(navigator.h?"screencanvas":"canvas");a.width=window.innerWidth*window.devicePixelRatio;a.height=window.innerHeight*window.devicePixelRatio;a.style.width="100%";a.style.height="100%";a.style.backgroundColor="#000000";document.body.appendChild(a);return a};new ib;
