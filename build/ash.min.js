(function(){"use strict";var Dictionary,ash;ash={signals:{},core:{},ext:{Dictionary:Dictionary=function(){function Dictionary(){}return Dictionary}(),getClassName:function(klass){var ref;return null!=(ref=klass.className)?ref:klass.name}},fsm:{},tick:{},tools:{}},"function"==typeof define&&null!=define.amd?define(function(){return ash}):this.ash=ash}).call(this),function(){"use strict";var Dictionary,EntityList,NodeList,NodePool,getClassName,bind=function(fn,me){return function(){return fn.apply(me,arguments)}};EntityList=ash.core.EntityList,Dictionary=ash.ext.Dictionary,NodeList=ash.core.NodeList,NodePool=ash.core.NodePool,getClassName=ash.ext.getClassName,ash.core.ComponentMatchingFamily=function(){function ComponentMatchingFamily(nodeClass,engine){this.nodeClass=nodeClass,this.engine=engine,this.releaseNodePoolCache=bind(this.releaseNodePoolCache,this),this.init()}return ComponentMatchingFamily.prototype.nodes=null,ComponentMatchingFamily.prototype.entities=null,ComponentMatchingFamily.prototype.nodeClass=null,ComponentMatchingFamily.prototype.components=null,ComponentMatchingFamily.prototype.nodePool=null,ComponentMatchingFamily.prototype.engine=null,ComponentMatchingFamily.prototype.init=function(){var name,ref,type;this.nodes=new NodeList,this.entities=new Dictionary,this.components=new Dictionary,this.nodePool=new NodePool(this.nodeClass,this.nodeClass.components),ref=this.nodeClass.components;for(name in ref)type=ref[name],this.components[getClassName(type)]=type},Object.defineProperties(ComponentMatchingFamily.prototype,{nodeList:{get:function(){return this.nodes}}}),ComponentMatchingFamily.prototype.newEntity=function(entity){this.addIfMatch(entity)},ComponentMatchingFamily.prototype.componentAddedToEntity=function(entity,componentClass){this.addIfMatch(entity)},ComponentMatchingFamily.prototype.componentRemovedFromEntity=function(entity,componentClass){var name;name=null!=getClassName(componentClass)?getClassName(componentClass):componentClass,name in this.components&&this.removeIfMatch(entity)},ComponentMatchingFamily.prototype.removeEntity=function(entity){this.removeIfMatch(entity)},ComponentMatchingFamily.prototype.addIfMatch=function(entity){var componentClass,name,node,ref,ref1;if(null==this.entities[entity.name]){ref=this.nodeClass.components;for(name in ref)if(componentClass=ref[name],!entity.has(componentClass))return;node=this.nodePool.get(),node.entity=entity,ref1=this.nodeClass.components;for(name in ref1)componentClass=ref1[name],node[name]=entity.get(componentClass);this.entities[entity.name]=node,this.nodes.add(node)}},ComponentMatchingFamily.prototype.removeIfMatch=function(entity){var node;entity.name in this.entities&&(node=this.entities[entity.name],delete this.entities[entity.name],this.nodes.remove(node),this.engine.updating?(this.nodePool.cache(node),this.engine.updateComplete.add(this.releaseNodePoolCache)):this.nodePool.dispose(node))},ComponentMatchingFamily.prototype.releaseNodePoolCache=function(){this.engine.updateComplete.remove(this.releaseNodePoolCache),this.nodePool.releaseCache()},ComponentMatchingFamily.prototype.cleanUp=function(){var node;for(node=this.nodes.head;node;)this.entities.remove(node.entity),node=node.next;this.nodes.removeAll()},ComponentMatchingFamily}()}.call(this),function(){"use strict";var Dictionary,EntityList,Signal0,SystemList,getClassName,bind=function(fn,me){return function(){return fn.apply(me,arguments)}};EntityList=ash.core.EntityList,Dictionary=ash.ext.Dictionary,SystemList=ash.core.SystemList,Signal0=ash.signals.Signal0,getClassName=ash.ext.getClassName,ash.core.Engine=function(){function Engine(){this.update=bind(this.update,this),this.componentRemoved=bind(this.componentRemoved,this),this.componentAdded=bind(this.componentAdded,this),this.entityNameChanged=bind(this.entityNameChanged,this),this.entityList=new EntityList,this.entityNames=new Dictionary,this.systemList=new SystemList,this.families=new Dictionary,this.updateComplete=new Signal0}return Engine.prototype.entityNames=null,Engine.prototype.entityList=null,Engine.prototype.systemList=null,Engine.prototype.families=null,Engine.prototype.updating=!1,Engine.prototype.updateComplete=null,Engine.prototype.familyClass=ash.core.ComponentMatchingFamily,Object.defineProperties(Engine.prototype,{entities:{get:function(){var entities,entity;for(entities=[],entity=this.entityList.head;entity;)this.entities.push(entity),entity=entity.next;return entities}},systems:{get:function(){var system,systems;for(systems=[],system=this.systemList.head;system;)systems.push(system),system=system.next;return systems}}}),Engine.prototype.addEntity=function(entity){var each,family,ref;if(this.entityNames[entity.name])throw"The entity name "+entity.name+" is already in use by another entity.";this.entityList.add(entity),this.entityNames[entity.name]=entity,entity.componentAdded.add(this.componentAdded),entity.componentRemoved.add(this.componentRemoved),entity.nameChanged.add(this.entityNameChanged),ref=this.families;for(each in ref)family=ref[each],family.newEntity(entity)},Engine.prototype.removeEntity=function(entity){var each,family,ref;entity.componentAdded.remove(this.componentAdded),entity.componentRemoved.remove(this.componentRemoved),entity.nameChanged.remove(this.entityNameChanged),ref=this.families;for(each in ref)family=ref[each],family.removeEntity(entity);delete this.entityNames[entity.name],this.entityList.remove(entity)},Engine.prototype.entityNameChanged=function(entity,oldName){this.entityNames[oldName]===entity&&(delete this.entityNames[oldName],this.entityNames[entity.name]=entity)},Engine.prototype.getEntityByName=function(name){return this.entityNames[name]},Engine.prototype.removeAllEntities=function(){for(;null!==this.entityList.head;)this.removeEntity(this.entityList.head)},Engine.prototype.componentAdded=function(entity,componentClass){var each,family,ref;ref=this.families;for(each in ref)family=ref[each],family.componentAddedToEntity(entity,componentClass)},Engine.prototype.componentRemoved=function(entity,componentClass){var each,family,ref;ref=this.families;for(each in ref)family=ref[each],family.componentRemovedFromEntity(entity,componentClass)},Engine.prototype.getNodeList=function(nodeClass){var entity,family;if(getClassName(nodeClass)in this.families)return this.families[getClassName(nodeClass)].nodeList;for(family=new this.familyClass(nodeClass,this),this.families[getClassName(nodeClass)]=family,entity=this.entityList.head;entity;)family.newEntity(entity),entity=entity.next;return family.nodeList},Engine.prototype.releaseNodeList=function(nodeClass){getClassName(nodeClass)in this.families&&(this.families[getClassName(nodeClass)].cleanUp(),delete this.families[getClassName(nodeClass)])},Engine.prototype.addSystem=function(system,priority){system.priority=priority,system.addToEngine(this),this.systemList.add(system)},Engine.prototype.getSystem=function(type){return systemList.get(type)},Engine.prototype.removeSystem=function(system){this.systemList.remove(system),system.removeFromEngine(this)},Engine.prototype.removeAllSystems=function(){for(;null!==this.systemList.head;)this.removeSystem(this.systemList.head)},Engine.prototype.update=function(time){var system;for(this.updating=!0,system=this.systemList.head;system;)system.update(time),system=system.next;this.updating=!1,this.updateComplete.dispatch()},Engine}()}.call(this),function(){"use strict";var Dictionary,Signal2,getClassName;Signal2=ash.signals.Signal2,Dictionary=ash.ext.Dictionary,getClassName=ash.ext.getClassName,ash.core.Entity=function(){function Entity(name){null==name&&(name=""),Object.defineProperties(this,{name:{get:function(){return this._name},set:function(value){var previous;return this._name!==value?(previous=this._name,this._name=value,this.nameChanged.dispatch(this,previous)):void 0}}}),this.componentAdded=new Signal2,this.componentRemoved=new Signal2,this.nameChanged=new Signal2,this.components=new Dictionary,""!==name?(null==Entity.nameCount[name]&&(Entity.nameCount[name]=0),this._name=name+ ++Entity.nameCount[name]):this._name="_entity"+ ++nameCount}var nameCount;return Entity.nameCount={},nameCount=0,Entity.prototype._name="",Entity.prototype.componentAdded=null,Entity.prototype.componentRemoved=null,Entity.prototype.nameChanged=null,Entity.prototype.previous=null,Entity.prototype.next=null,Entity.prototype.components=null,Entity.prototype.add=function(component,componentClass){return null==componentClass&&(componentClass=component.constructor),getClassName(componentClass)in this.components&&this.remove(componentClass),this.components[getClassName(componentClass)]=component,this.componentAdded.dispatch(this,componentClass),this},Entity.prototype.remove=function(componentClass){var component,name;return name=null!=getClassName(componentClass)?getClassName(componentClass):componentClass,component=this.components[name],component?(delete this.components[name],this.componentRemoved.dispatch(this,name),component):null},Entity.prototype.get=function(componentClass){return this.components[getClassName(componentClass)]},Entity.prototype.getAll=function(){var component,componentArray,i,len,ref;for(componentArray=[],ref=this.components,i=0,len=ref.length;len>i;i++)component=ref[i],componentArray.push(component);return componentArray},Entity.prototype.has=function(componentClass){return getClassName(componentClass)in this.components},Entity}()}.call(this),function(){"use strict";ash.core.EntityList=function(){function EntityList(){}return EntityList.prototype.head=null,EntityList.prototype.tail=null,EntityList.prototype.add=function(entity){this.head?(this.tail.next=entity,entity.previous=this.tail,entity.next=null,this.tail=entity):(this.head=this.tail=entity,entity.next=entity.previous=null)},EntityList.prototype.remove=function(entity){this.head===entity&&(this.head=this.head.next),this.tail===entity&&(this.tail=this.tail.previous),entity.previous&&(entity.previous.next=entity.next),entity.next&&(entity.next.previous=entity.previous)},EntityList.prototype.removeAll=function(){for(var entity;this.head;)entity=this.head,this.head=this.head.next,entity.previous=null,entity.next=null;this.tail=null},EntityList}()}.call(this),function(){"use strict";ash.core.Family=function(){function Family(){Object.defineProperties(this,{nodeList:{get:function(){return this.nodes}}})}return Family.prototype.nodes=null,Family.prototype.newEntity=function(entity){throw new Error("Method must be overriden")},Family.prototype.removeEntity=function(entity){throw new Error("Method must be overriden")},Family.prototype.componentAddedToEntity=function(entity,componentClass){throw new Error("Method must be overriden")},Family.prototype.componentRemovedFromEntity=function(entity,componentClass){throw new Error("Method must be overriden")},Family.prototype.cleanUp=function(){throw new Error("Method must be overriden")},Family}()}.call(this),function(){"use strict";ash.core.Node=function(){function Node(){}return Node.prototype.entity=null,Node.prototype.previous=null,Node.prototype.next=null,Node}()}.call(this),function(){"use strict";var Signal1;Signal1=ash.signals.Signal1,ash.core.NodeList=function(){function NodeList(){this.nodeAdded=new Signal1,this.nodeRemoved=new Signal1}return NodeList.prototype.head=null,NodeList.prototype.tail=null,NodeList.prototype.nodeAdded=null,NodeList.prototype.nodeRemoved=null,NodeList.prototype.add=function(node){this.head?(this.tail.next=node,node.previous=this.tail,node.next=null,this.tail=node):(this.head=this.tail=node,node.next=node.previous=null),this.nodeAdded.dispatch(node)},NodeList.prototype.remove=function(node){this.head===node&&(this.head=this.head.next),this.tail===node&&(this.tail=this.tail.previous),node.previous&&(node.previous.next=node.next),node.next&&(node.next.previous=node.previous),this.nodeRemoved.dispatch(node)},NodeList.prototype.removeAll=function(){for(var node;this.head;)node=this.head,this.head=this.head.next,node.previous=null,node.next=null,this.nodeRemoved.dispatch(node);this.tail=null},Object.defineProperties(NodeList.prototype,{empty:{get:function(){return null===this.head}}}),NodeList.prototype.swap=function(node1,node2){var temp;node1.previous===node2?(node1.previous=node2.previous,node2.previous=node1,node2.next=node1.next,node1.next=node2):node2.previous===node1?(node2.previous=node1.previous,node1.previous=node2,node1.next=node2.next,node2.next=node1):(temp=node1.previous,node1.previous=node2.previous,node2.previous=temp,temp=node1.next,node1.next=node2.next,node2.next=temp),this.head===node1?this.head=node2:this.head===node2&&(this.head=node1),this.tail===node1?this.tail=node2:this.tail===node2&&(this.tail=node1),null!==node1.previous&&(node1.previous.next=node1),null!==node2.previous&&(node2.previous.next=node2),null!==node1.next&&(node1.next.previous=node1),null!==node2.next&&(node2.next.previous=node2)},NodeList.prototype.insertionSort=function(sortFunction){var node,other,remains;if(this.head!==this.tail)for(remains=this.head.next,node=remains;null!==node;){for(remains=node.next,other=node.previous;null!==other;){if(sortFunction(node,other)>=0){node!==other.next&&(this.tail===node&&(this.tail=node.previous),node.previous.next=node.next,null!==node.next&&(node.next.previous=node.previous),node.next=other.next,node.previous=other,node.next.previous=node,other.next=node);break}other=other.previous}null===other&&(this.tail===node&&(this.tail=node.previous),node.previous.next=node.next,null!==node.next&&(node.next.previous=node.previous),node.next=this.head,this.head.previous=node,node.previous=null,this.head=node),node=remains}},NodeList.prototype.mergeSort=function(sortFunction){var end,lists,next,start;if(this.head!==this.tail){for(lists=[],start=this.head;null!==start;){for(end=start;null!==end.next&&sortFunction(end,end.next)<=0;)end=end.next;next=end.next,start.previous=end.next=null,lists.push(start),start=next}for(;lists.length>1;)lists.push(this.merge(lists.shift(),lists.shift(),sortFunction));for(this.tail=this.head=lists[0];null!==this.tail.next;)this.tail=this.tail.next}},NodeList.prototype.merge=function(head1,head2,sortFunction){var head,node;for(sortFunction(head1,head2)<=0?(head=node=head1,head1=head1.next):(head=node=head2,head2=head2.next);null!==head1&&null!==head2;)sortFunction(head1,head2)<=0?(node.next=head1,head1.previous=node,node=head1,head1=head1.next):(node.next=head2,head2.previous=node,node=head2,head2=head2.next);return null!==head1?(node.next=head1,head1.previous=node):(node.next=head2,head2.previous=node),head},NodeList}()}.call(this),function(){"use strict";ash.core.NodePool=function(){function NodePool(nodeClass,components){this.nodeClass=nodeClass,this.components=components}return NodePool.prototype.tail=null,NodePool.prototype.nodeClass=null,NodePool.prototype.cacheTail=null,NodePool.prototype.components=null,NodePool.prototype.get=function(){var node;return this.tail?(node=this.tail,this.tail=this.tail.previous,node.previous=null,node):node=new this.nodeClass},NodePool.prototype.dispose=function(node){var componentName;for(componentName in this.components)node[componentName]=null;node.entity=null,node.next=null,node.previous=this.tail,this.tail=node},NodePool.prototype.cache=function(node){node.previous=this.cacheTail,this.cacheTail=node},NodePool.prototype.releaseCache=function(){for(var node;this.cacheTail;)node=this.cacheTail,this.cacheTail=node.previous,this.dispose(node)},NodePool}()}.call(this),function(){"use strict";var bind=function(fn,me){return function(){return fn.apply(me,arguments)}};ash.core.System=function(){function System(){this.update=bind(this.update,this)}return System.prototype.previous=null,System.prototype.next=null,System.prototype.priority=0,System.prototype.addToEngine=function(engine){},System.prototype.removeFromEngine=function(engine){},System.prototype.update=function(time){},System}()}.call(this),function(){"use strict";ash.core.SystemList=function(){function SystemList(){}return SystemList.prototype.head=null,SystemList.prototype.tail=null,SystemList.prototype.add=function(system){var node;if(this.head){for(node=this.tail;node&&!(node.priority<=system.priority);)node=node.previous;node===this.tail?(this.tail.next=system,system.previous=this.tail,system.next=null,this.tail=system):node?(system.next=node.next,system.previous=node,node.next.previous=system,node.next=system):(system.next=this.head,system.previous=null,this.head.previous=system,this.head=system)}else this.head=this.tail=system,system.next=system.previous=null},SystemList.prototype.remove=function(system){this.head===system&&(this.head=this.head.next),this.tail===system&&(this.tail=this.tail.previous),system.previous&&(system.previous.next=system.next),system.next&&(system.next.previous=system.previous)},SystemList.prototype.removeAll=function(){for(var system;this.head;)system=this.head,this.head=this.head.next,system.previous=null,system.next=null;this.tail=null},SystemList.prototype.get=function(type){var system;for(system=this.head;system;){if(system.constructor===type)return system;system=system.next}return null},SystemList}()}.call(this),function(){"use strict";var hasProp={}.hasOwnProperty;ash.ext.Helper=function(){function Helper(components,nodes){var klass,name,property,ref,type;if(this.components={},this.nodes={},null!=components)for(name in components)klass=components[name],this.components[name]=klass;if(null!=nodes)for(name in nodes){if(klass=nodes[name],null==klass.components){klass.components={},ref=klass.prototype;for(property in ref)hasProp.call(ref,property)&&(type=ref[property],klass.components[property]=type,klass.prototype[property]=null);klass.prototype.entity=null,klass.prototype.previous=null,klass.prototype.next=null}null!=components&&(this.nodes[name]=klass)}}return Helper.prototype.components=null,Helper.prototype.nodes=null,Helper}()}.call(this),function(){var PhaserEngine,bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;"undefined"!=typeof Phaser&&null!==Phaser&&(ash.ext.PhaserEngine=PhaserEngine=function(superClass){function PhaserEngine(game,parent){this.postRender=bind(this.postRender,this),this.removeAllSystems=bind(this.removeAllSystems,this),this.removeSystem=bind(this.removeSystem,this),this.getSystem=bind(this.getSystem,this),this.addSystem=bind(this.addSystem,this),this.releaseNodeList=bind(this.releaseNodeList,this),this.getNodeList=bind(this.getNodeList,this),this.componentRemoved=bind(this.componentRemoved,this),this.componentAdded=bind(this.componentAdded,this),this.removeAllEntities=bind(this.removeAllEntities,this),this.getEntityByName=bind(this.getEntityByName,this),this.entityNameChanged=bind(this.entityNameChanged,this),this.removeEntity=bind(this.removeEntity,this),this.addEntity=bind(this.addEntity,this),this.init=bind(this.init,this),PhaserEngine.__super__.constructor.call(this,game,parent),this.nodes={},this.components={},this.entityList=new EntityList,this.entityNames=new Dictionary,this.systemList=new SystemList,this.families=new Dictionary,this.updateComplete=new Signal0}return extend(PhaserEngine,superClass),PhaserEngine.prototype.entityNames=null,PhaserEngine.prototype.entityList=null,PhaserEngine.prototype.systemList=null,PhaserEngine.prototype.families=null,PhaserEngine.prototype.nodes=null,PhaserEngine.prototype.components=null,PhaserEngine.prototype.game=null,PhaserEngine.prototype.parent=null,PhaserEngine.prototype.active=!0,PhaserEngine.prototype.visible=!0,PhaserEngine.prototype.hasPostRender=!0,PhaserEngine.prototype.updating=!1,PhaserEngine.prototype.updateComplete=null,PhaserEngine.prototype.familyClass=ComponentMatchingFamily,PhaserEngine.prototype.addNode=function(name,def){var property,ref,type;if(null==def.components){def.components={},ref=def.prototype;for(property in ref)hasProp.call(ref,property)&&(type=ref[property],def.components[property]=type,def.prototype[property]=null);def.prototype.entity=null,def.prototype.previous=null,def.prototype.next=null}return this.nodes[name]=def},PhaserEngine.prototype.init=function(nodes,components){var klass,name,property,ref,results,type;if(null!=components)for(name in components)klass=components[name],this.components[name]=klass;if(null!=nodes){results=[];for(name in nodes){if(klass=nodes[name],null==klass.components){klass.components={},ref=klass.prototype;for(property in ref)hasProp.call(ref,property)&&(type=ref[property],klass.components[property]=type,klass.prototype[property]=null);klass.prototype.entity=null,klass.prototype.previous=null,klass.prototype.next=null}results.push(null!=components?this.nodes[name]=klass:void 0)}return results}},Object.defineProperties(PhaserEngine.prototype,{entities:{get:function(){var entities,entity;for(entities=[],entity=this.entityList.head;entity;)this.entities.push(entity),entity=entity.next;return entities}},systems:{get:function(){var system,systems;for(systems=[],system=this.systemList.head;system;)systems.push(system),system=system.next;return systems}}}),PhaserEngine.prototype.addEntity=function(entity){var each,family,ref;if(this.entityNames[entity.name])throw"The entity name "+entity.name+" is already in use by another entity.";this.entityList.add(entity),this.entityNames[entity.name]=entity,entity.componentAdded.add(this.componentAdded),entity.componentRemoved.add(this.componentRemoved),entity.nameChanged.add(this.entityNameChanged),ref=this.families;for(each in ref)family=ref[each],family.newEntity(entity)},PhaserEngine.prototype.removeEntity=function(entity){var each,family,ref;entity.componentAdded.remove(this.componentAdded),entity.componentRemoved.remove(this.componentRemoved),entity.nameChanged.remove(this.entityNameChanged),ref=this.families;for(each in ref)family=ref[each],family.removeEntity(entity);delete this.entityNames[entity.name],this.entityList.remove(entity)},PhaserEngine.prototype.entityNameChanged=function(entity,oldName){this.entityNames[oldName]===entity&&(delete this.entityNames[oldName],this.entityNames[entity.name]=entity)},PhaserEngine.prototype.getEntityByName=function(name){return this.entityNames[name]},PhaserEngine.prototype.removeAllEntities=function(){for(;null!==this.entityList.head;)this.removeEntity(this.entityList.head)},PhaserEngine.prototype.componentAdded=function(entity,componentClass){var each,family,ref;ref=this.families;for(each in ref)family=ref[each],family.componentAddedToEntity(entity,componentClass)},PhaserEngine.prototype.componentRemoved=function(entity,componentClass){var each,family,ref;ref=this.families;for(each in ref)family=ref[each],family.componentRemovedFromEntity(entity,componentClass)},PhaserEngine.prototype.getNodeList=function(nodeClass){var entity,family;if(nodeClass.name in this.families)return this.families[nodeClass.name].nodeList;for(family=new this.familyClass(nodeClass,this),this.families[nodeClass.name]=family,entity=this.entityList.head;entity;)family.newEntity(entity),entity=entity.next;return family.nodeList},PhaserEngine.prototype.releaseNodeList=function(nodeClass){nodeClass.name in this.families&&(this.families[nodeClass.name].cleanUp(),delete this.families[nodeClass.name])},PhaserEngine.prototype.addSystem=function(system,priority){system.priority=priority,system.addToEngine(this),this.systemList.add(system)},PhaserEngine.prototype.getSystem=function(type){return systemList.get(type)},PhaserEngine.prototype.removeSystem=function(system){this.systemList.remove(system),system.removeFromEngine(this)},PhaserEngine.prototype.removeAllSystems=function(){for(;null!==this.systemList.head;)this.removeSystem(this.systemList.head)},PhaserEngine.prototype.postRender=function(){var system,time;for(time=.001*this.game.time.elapsed,this.updating=!0,system=this.systemList.head;system;)system.update(time),system=system.next;this.updating=!1,this.updateComplete.dispatch()},PhaserEngine}(Phaser.Plugin))}.call(this),function(){var PhaserEntity,extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;"undefined"!=typeof Phaser&&null!==Phaser&&(ash.ext.PhaserEntity=PhaserEntity=function(superClass){function PhaserEntity(game,key,name){null==name&&(name=""),PhaserEntity.__super__.constructor.call(this,game,0,0,key),Object.defineProperties(this,{name:{get:function(){return this._name},set:function(value){var previous;return this._name!==value?(previous=this._name,this._name=value,this.nameChanged.dispatch(this,previous)):void 0}}}),this.componentAdded=new Signal2,this.componentRemoved=new Signal2,this.nameChanged=new Signal2,this.components=new Dictionary,this._name=""!==name?name:"_entity"+ ++nameCount}var nameCount;return extend(PhaserEntity,superClass),nameCount=0,PhaserEntity.prototype._name="",PhaserEntity.prototype.componentAdded=null,PhaserEntity.prototype.componentRemoved=null,PhaserEntity.prototype.nameChanged=null,PhaserEntity.prototype.previous=null,PhaserEntity.prototype.next=null,PhaserEntity.prototype.components=null,PhaserEntity.prototype.add=function(component,componentClass){return null==componentClass&&(componentClass=component.constructor),componentClass.className in this.components&&this.remove(componentClass),this.components[componentClass.className]=component,this.componentAdded.dispatch(this,componentClass),this},PhaserEntity.prototype.remove=function(componentClass){var component,name;return name=null!=componentClass.className?componentClass.className:componentClass,component=this.components[name],component?(delete this.components[name],this.componentRemoved.dispatch(this,name),component):null},PhaserEntity.prototype.get=function(componentClass){return this.components[componentClass.className]},PhaserEntity.prototype.getAll=function(){var component,componentArray,i,len,ref;for(componentArray=[],ref=this.components,i=0,len=ref.length;len>i;i++)component=ref[i],componentArray.push(component);return componentArray},PhaserEntity.prototype.has=function(componentClass){return componentClass.className in this.components},PhaserEntity}(Phaser.Sprite))}.call(this),function(){var PhaserPlugin,bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;"undefined"!=typeof Phaser&&null!==Phaser&&(ash.ext.PhaserPlugin=PhaserPlugin=function(superClass){function PhaserPlugin(game,parent){this.update=bind(this.update,this),this.removeAllSystems=bind(this.removeAllSystems,this),this.removeSystem=bind(this.removeSystem,this),this.getSystem=bind(this.getSystem,this),this.addSystem=bind(this.addSystem,this),this.releaseNodeList=bind(this.releaseNodeList,this),this.getNodeList=bind(this.getNodeList,this),this.componentRemoved=bind(this.componentRemoved,this),this.componentAdded=bind(this.componentAdded,this),this.removeAllEntities=bind(this.removeAllEntities,this),this.getEntityByName=bind(this.getEntityByName,this),this.entityNameChanged=bind(this.entityNameChanged,this),this.removeEntity=bind(this.removeEntity,this),this.addEntity=bind(this.addEntity,this),this.init=bind(this.init,this),PhaserPlugin.__super__.constructor.call(this,game,parent),this.nodes={},this.components={},this.entityList=new EntityList,this.entityNames=new Dictionary,this.systemList=new SystemList,this.families=new Dictionary,this.updateComplete=new Signal0}return extend(PhaserPlugin,superClass),PhaserPlugin.prototype.entityNames=null,PhaserPlugin.prototype.entityList=null,PhaserPlugin.prototype.systemList=null,PhaserPlugin.prototype.families=null,PhaserPlugin.prototype.nodes=null,PhaserPlugin.prototype.components=null,PhaserPlugin.prototype.game=null,PhaserPlugin.prototype.parent=null,PhaserPlugin.prototype.active=!0,PhaserPlugin.prototype.visible=!0,PhaserPlugin.prototype.hasPostRender=!0,PhaserPlugin.prototype.updating=!1,PhaserPlugin.prototype.updateComplete=null,PhaserPlugin.prototype.familyClass=ComponentMatchingFamily,PhaserPlugin.prototype.addNode=function(name,def){var property,ref,type;if(null==def.components){def.components={},ref=def.prototype;for(property in ref)hasProp.call(ref,property)&&(type=ref[property],def.components[property]=type,def.prototype[property]=null);def.prototype.entity=null,def.prototype.previous=null,def.prototype.next=null}return this.nodes[name]=def},PhaserPlugin.prototype.init=function(nodes,components){var klass,name,property,ref,results,type;if(null!=components)for(name in components)klass=components[name],this.components[name]=klass;if(null!=nodes){results=[];for(name in nodes){if(klass=nodes[name],null==klass.components){klass.components={},ref=klass.prototype;for(property in ref)hasProp.call(ref,property)&&(type=ref[property],klass.components[property]=type,klass.prototype[property]=null);klass.prototype.entity=null,klass.prototype.previous=null,klass.prototype.next=null}results.push(null!=components?this.nodes[name]=klass:void 0)}return results}},Object.defineProperties(PhaserPlugin.prototype,{entities:{get:function(){var entities,entity;for(entities=[],entity=this.entityList.head;entity;)this.entities.push(entity),entity=entity.next;return entities}},systems:{get:function(){var system,systems;for(systems=[],system=this.systemList.head;system;)systems.push(system),system=system.next;return systems}}}),PhaserPlugin.prototype.addEntity=function(entity){var each,family,ref;if(this.entityNames[entity.name])throw"The entity name "+entity.name+" is already in use by another entity.";this.entityList.add(entity),this.entityNames[entity.name]=entity,entity.componentAdded.add(this.componentAdded),entity.componentRemoved.add(this.componentRemoved),entity.nameChanged.add(this.entityNameChanged),ref=this.families;for(each in ref)family=ref[each],family.newEntity(entity)},PhaserPlugin.prototype.removeEntity=function(entity){var each,family,ref;entity.componentAdded.remove(this.componentAdded),entity.componentRemoved.remove(this.componentRemoved),entity.nameChanged.remove(this.entityNameChanged),ref=this.families;for(each in ref)family=ref[each],family.removeEntity(entity);delete this.entityNames[entity.name],this.entityList.remove(entity)},PhaserPlugin.prototype.entityNameChanged=function(entity,oldName){this.entityNames[oldName]===entity&&(delete this.entityNames[oldName],this.entityNames[entity.name]=entity)},PhaserPlugin.prototype.getEntityByName=function(name){return this.entityNames[name]},PhaserPlugin.prototype.removeAllEntities=function(){for(;null!==this.entityList.head;)this.removeEntity(this.entityList.head)},PhaserPlugin.prototype.componentAdded=function(entity,componentClass){var each,family,ref;ref=this.families;for(each in ref)family=ref[each],family.componentAddedToEntity(entity,componentClass)},PhaserPlugin.prototype.componentRemoved=function(entity,componentClass){var each,family,ref;ref=this.families;for(each in ref)family=ref[each],family.componentRemovedFromEntity(entity,componentClass)},PhaserPlugin.prototype.getNodeList=function(nodeClass){var entity,family;if(nodeClass.name in this.families)return this.families[nodeClass.name].nodeList;for(family=new this.familyClass(nodeClass,this),this.families[nodeClass.name]=family,entity=this.entityList.head;entity;)family.newEntity(entity),entity=entity.next;return family.nodeList},PhaserPlugin.prototype.releaseNodeList=function(nodeClass){nodeClass.name in this.families&&(this.families[nodeClass.name].cleanUp(),delete this.families[nodeClass.name])},PhaserPlugin.prototype.addSystem=function(system,priority){
system.priority=priority,system.addToEngine(this),this.systemList.add(system)},PhaserPlugin.prototype.getSystem=function(type){return systemList.get(type)},PhaserPlugin.prototype.removeSystem=function(system){this.systemList.remove(system),system.removeFromEngine(this)},PhaserPlugin.prototype.removeAllSystems=function(){for(;null!==this.systemList.head;)this.removeSystem(this.systemList.head)},PhaserPlugin.prototype.update=function(){var system,time;for(time=.001*this.game.time.elapsed,this.updating=!0,system=this.systemList.head;system;)system.update(time),system=system.next;this.updating=!1,this.updateComplete.dispatch()},PhaserPlugin}(Phaser.Plugin))}.call(this),function(){"use strict";ash.fsm.ComponentInstanceProvider=function(){function ComponentInstanceProvider(instance){this.instance=instance}return ComponentInstanceProvider.prototype.instance=null,ComponentInstanceProvider.prototype.getComponent=function(){return this.instance},Object.defineProperties(ComponentInstanceProvider.prototype,{identifier:{get:function(){return this.instance}}}),ComponentInstanceProvider}()}.call(this),function(){"use strict";ash.fsm.ComponentSingletonProvider=function(){function ComponentSingletonProvider(type){this.componentType=type}return ComponentSingletonProvider.prototype.componentType=null,ComponentSingletonProvider.prototype.instance=null,ComponentSingletonProvider.prototype.getComponent=function(){return null==this.instance&&(this.instance=new this.componentType),this.instance},Object.defineProperties(ComponentSingletonProvider.prototype,{identifier:{get:function(){return this.getComponent()}}}),ComponentSingletonProvider}()}.call(this),function(){"use strict";ash.fsm.ComponentTypeProvider=function(){function ComponentTypeProvider(type){this.componentType=type}return ComponentTypeProvider.prototype.componentType=null,ComponentTypeProvider.prototype.getComponent=function(){return new this.componentType},Object.defineProperties(ComponentTypeProvider.prototype,{identifier:{get:function(){return this.componentType}}}),ComponentTypeProvider}()}.call(this),function(){"use strict";ash.fsm.DynamicComponentProvider=function(){function DynamicComponentProvider(closure){this._closure=closure}return DynamicComponentProvider.prototype._closure=null,DynamicComponentProvider.prototype.getComponent=function(){return this._closure},Object.defineProperties(DynamicComponentProvider.prototype,{identifier:{get:function(){return this._closure}}}),DynamicComponentProvider}()}.call(this),function(){"use strict";ash.fsm.DynamicSystemProvider=function(){function DynamicSystemProvider(method){this.method=method}return DynamicSystemProvider.prototype.method=function(){},DynamicSystemProvider.prototype.systemPriority=0,DynamicSystemProvider.prototype.getSystem=function(){return this.method()},Object.defineProperties(DynamicSystemProvider.prototype,{identifier:{get:function(){return this.method}},priority:{get:function(){return this.systemPriority},set:function(value){return this.systemPriority=value}}}),DynamicSystemProvider}()}.call(this),function(){"use strict";var DynamicSystemProvider,StateSystemMapping,SystemInstanceProvider,SystemSingletonProvider;SystemInstanceProvider=ash.fsm.SystemInstanceProvider,SystemSingletonProvider=ash.fsm.SystemSingletonProvider,DynamicSystemProvider=ash.fsm.DynamicSystemProvider,StateSystemMapping=ash.fsm.StateSystemMapping,ash.fsm.EngineState=function(){function EngineState(){this.providers=[]}return EngineState.prototype.providers=null,EngineState.prototype.addInstance=function(system){return this.addProvider(new SystemInstanceProvider(system))},EngineState.prototype.addSingleton=function(type){return this.addProvider(new SystemSingletonProvider(type))},EngineState.prototype.addMethod=function(method){return this.addProvider(new DynamicSystemProvider(method))},EngineState.prototype.addProvider=function(provider){var mapping;return mapping=new StateSystemMapping(this,provider),this.providers.push(provider),mapping},EngineState}()}.call(this),function(){"use strict";var Dictionary,EngineState;Dictionary=ash.ext.Dictionary,EngineState=ash.fsm.EngineState,ash.fsm.EngineStateMachine=function(){function EngineStateMachine(engine){this.engine=engine,this.states=new Dictionary}return EngineStateMachine.prototype.engine=null,EngineStateMachine.prototype.states=null,EngineStateMachine.prototype.currentState=null,EngineStateMachine.prototype.addState=function(name,state){return this.states[name]=state,this},EngineStateMachine.prototype.createState=function(name){var state;return state=new EngineState,this.states[name]=state,this},EngineStateMachine.prototype.changeState=function(name){var each,id,newState,other,provider,ref,ref1,toAdd;if(newState=this.states[name],null==newState)throw new Error("Engine state "+name+" doesn't exist");if(newState===this.currentState)return void(newState=null);toAdd=new Dictionary,ref=newState.providers;for(each in ref)provider=ref[each],id=provider.identifier,toAdd[id]=provider;if(currentState){ref1=this.currentState.providers;for(each in ref1)provider=ref1[each],id=provider.identifier,other=toAdd[id],other?delete toAdd[id]:this.engine.removeSystem(provider.getSystem())}for(each in toAdd)provider=toAdd[each],this.engine.addSystem(provider.getSystem(),provider.priority);return this.currentState=newState},EngineStateMachine}()}.call(this),function(){"use strict";var Dictionary,StateComponentMapping,getClassName;Dictionary=ash.ext.Dictionary,StateComponentMapping=ash.fsm.StateComponentMapping,getClassName=ash.ext.getClassName,ash.fsm.EntityState=function(){function EntityState(){this.providers=new Dictionary}return EntityState.prototype.providers=null,EntityState.prototype.add=function(type){return new StateComponentMapping(this,getClassName(type))},EntityState.prototype.get=function(type){return this.providers[type]},EntityState.prototype.has=function(type){return null!==this.providers[type]},EntityState}()}.call(this),function(){"use strict";var Dictionary,EntityState;Dictionary=ash.ext.Dictionary,EntityState=ash.fsm.EntityState,ash.fsm.EntityStateMachine=function(){function EntityStateMachine(entity){this.entity=entity,this.states=new Dictionary}return EntityStateMachine.prototype.states=null,EntityStateMachine.prototype.currentState=null,EntityStateMachine.prototype.entity=null,EntityStateMachine.prototype.addState=function(name,state){return this.states[name]=state,this},EntityStateMachine.prototype.createState=function(name){var state;return state=new EntityState,this.states[name]=state,state},EntityStateMachine.prototype.changeState=function(name){var newState,other,toAdd,type;if(newState=this.states[name],!newState)throw new Error("Entity state "+name+" doesn't exist");if(newState===this.currentState)return void(newState=null);if(this.currentState){toAdd=new Dictionary;for(type in newState.providers)toAdd[type]=newState.providers[type];for(type in this.currentState.providers)other=toAdd[type],other&&other.identifier===this.currentState.providers[type].identifier?delete toAdd[type]:this.entity.remove(type)}else toAdd=newState.providers;for(type in toAdd)this.entity.add(toAdd[type].getComponent());return this.currentState=newState},EntityStateMachine}()}.call(this),function(){"use strict";var ComponentInstanceProvider,ComponentSingletonProvider,ComponentTypeProvider,DynamicComponentProvider;ComponentInstanceProvider=ash.fsm.ComponentInstanceProvider,ComponentTypeProvider=ash.fsm.ComponentTypeProvider,ComponentSingletonProvider=ash.fsm.ComponentSingletonProvider,DynamicComponentProvider=ash.fsm.DynamicComponentProvider,ash.fsm.StateComponentMapping=function(){function StateComponentMapping(creatingState,type){this.creatingState=creatingState,this.componentType=type,this.withType(type)}return StateComponentMapping.prototype.componentType=null,StateComponentMapping.prototype.creatingState=null,StateComponentMapping.prototype.provider=null,StateComponentMapping.prototype.withInstance=function(component){return this.setProvider(new ComponentInstanceProvider(component)),this},StateComponentMapping.prototype.withType=function(type){return this.setProvider(new ComponentTypeProvider(type)),this},StateComponentMapping.prototype.withSingleton=function(type){return null==type&&(type=this.componentType),this.setProvider(new ComponentSingletonProvider(type)),this},StateComponentMapping.prototype.withMethod=function(method){return this.setProvider(new DynamicComponentProvider(method)),this},StateComponentMapping.prototype.withProvider=function(provider){return this.setProvider(provider),this},StateComponentMapping.prototype.add=function(type){return this.creatingState.add(type)},StateComponentMapping.prototype.setProvider=function(provider){return this.provider=provider,this.creatingState.providers[this.componentType]=provider},StateComponentMapping}()}.call(this),function(){"use strict";ash.fsm.StateSystemMapping=function(){function StateSystemMapping(creatingState1,provider1){this.creatingState=creatingState1,this.provider=provider1}return StateSystemMapping.prototype.creatingState=null,StateSystemMapping.prototype.provider=null,StateSystemMapping.prototype.withPriority=function(priority){return this.provider.priority=priority,this},StateSystemMapping.prototype.addInstance=function(system){return creatingState.addInstance(system)},StateSystemMapping.prototype.addSingleton=function(type){return creatingState.addSingleton(type)},StateSystemMapping.prototype.addMethod=function(method){return creatingState.addMethod(method)},StateSystemMapping.prototype.addProvider=function(provider){return creatingState.addProvider(provider)},StateSystemMapping}()}.call(this),function(){"use strict";ash.fsm.SystemInstanceProvider=function(){function SystemInstanceProvider(instance){this.instance=instance}return SystemInstanceProvider.prototype.instance=null,SystemInstanceProvider.prototype.systemPriority=0,SystemInstanceProvider.prototype.getSystem=function(){return this.instance},Object.defineProperties(SystemInstanceProvider.prototype,{identifier:{get:function(){return this.instance}},priority:{get:function(){return this.systemPriority},set:function(value){return this.systemPriority=value}}}),SystemInstanceProvider}()}.call(this),function(){"use strict";ash.fsm.SystemSingletonProvider=function(){function SystemSingletonProvider(type){this.componentType=type}return SystemSingletonProvider.prototype.componentType=null,SystemSingletonProvider.prototype.instance=null,SystemSingletonProvider.prototype.systemPriority=0,SystemSingletonProvider.prototype.getSystem=function(){return this.instance||(this.instance=new this.componentType),this.instance},Object.defineProperties(SystemSingletonProvider.prototype,{identifier:{get:function(){return this.getSystem()}},priority:{get:function(){return this.systemPriority},set:function(value){return this.systemPriority=value}}}),SystemSingletonProvider}()}.call(this),function(){"use strict";ash.signals.ListenerNode=function(){function ListenerNode(){}return ListenerNode.prototype.previous=null,ListenerNode.prototype.next=null,ListenerNode.prototype.listener=null,ListenerNode.prototype.once=!1,ListenerNode}()}.call(this),function(){"use strict";var ListenerNode;ListenerNode=ash.signals.ListenerNode,ash.signals.ListenerNodePool=function(){function ListenerNodePool(){}return ListenerNodePool.prototype.tail=null,ListenerNodePool.prototype.cacheTail=null,ListenerNodePool.prototype.get=function(){var node;return null!==this.tail?(node=this.tail,this.tail=this.tail.previous,node.previous=null,node):new ListenerNode},ListenerNodePool.prototype.dispose=function(node){node.listener=null,node.once=!1,node.next=null,node.previous=this.tail,this.tail=node},ListenerNodePool.prototype.cache=function(node){node.listener=null,node.previous=this.cacheTail,this.cacheTail=node},ListenerNodePool.prototype.releaseCache=function(){for(var node;null!==this.cacheTail;)node=this.cacheTail,this.cacheTail=node.previous,node.next=null,node.previous=this.tail,this.tail=node},ListenerNodePool}()}.call(this),function(){"use strict";var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;ash.signals.Signal0=function(superClass){function Signal0(){return Signal0.__super__.constructor.apply(this,arguments)}return extend(Signal0,superClass),Signal0.prototype.dispatch=function(){var node;for(this.startDispatch(),node=this.head;null!==node;)node.listener(),node.once&&this.remove(node.listener),node=node.next;return this.endDispatch()},Signal0}(ash.signals.SignalBase)}.call(this),function(){"use strict";var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;ash.signals.Signal1=function(superClass){function Signal1(){return Signal1.__super__.constructor.apply(this,arguments)}return extend(Signal1,superClass),Signal1.prototype.dispatch=function($1){var node;for(this.startDispatch(),node=this.head;null!==node;)node.listener($1),node.once&&this.remove(node.listener),node=node.next;return this.endDispatch()},Signal1}(ash.signals.SignalBase)}.call(this),function(){"use strict";var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;ash.signals.Signal2=function(superClass){function Signal2(){return Signal2.__super__.constructor.apply(this,arguments)}return extend(Signal2,superClass),Signal2.prototype.dispatch=function($1,$2){var node;for(this.startDispatch(),node=this.head;node;)node.listener($1,$2),node.once&&this.remove(node.listener),node=node.next;return this.endDispatch()},Signal2}(ash.signals.SignalBase)}.call(this),function(){"use strict";var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;ash.signals.Signal3=function(superClass){function Signal3(){return Signal3.__super__.constructor.apply(this,arguments)}return extend(Signal3,superClass),Signal3.prototype.dispatch=function($1,$2,$3){var node;for(this.startDispatch(),node=this.head;null!==node;)node.listener($1,$2,$3),node.once&&this.remove(node.listener),node=node.next;return this.endDispatch()},Signal3}(ash.signals.SignalBase)}.call(this),function(){"use strict";var ListenerNodePool;ListenerNodePool=ash.signals.ListenerNodePool,ash.signals.SignalBase=function(){function SignalBase(){this.nodes=[],this.keys=[],this.listenerNodePool=new ListenerNodePool,this.numListeners=0}return SignalBase.prototype.head=null,SignalBase.prototype.tail=null,SignalBase.prototype.numListeners=0,SignalBase.prototype.keys=null,SignalBase.prototype.nodes=null,SignalBase.prototype.listenerNodePool=null,SignalBase.prototype.toAddHead=null,SignalBase.prototype.toAddTail=null,SignalBase.prototype.dispatching=!1,SignalBase.prototype.startDispatch=function(){this.dispatching=!0},SignalBase.prototype.endDispatch=function(){this.dispatching=!1,this.toAddHead&&(this.head?(this.tail.next=this.toAddHead,this.toAddHead.previous=this.tail,this.tail=this.toAddTail):(this.head=this.toAddHead,this.tail=this.toAddTail),this.toAddHead=null,this.toAddTail=null),this.listenerNodePool.releaseCache()},SignalBase.prototype.getNode=function(listener){var node;for(node=this.head;null!==node&&node.listener!==listener;)node=node.next;if(null===node)for(node=this.toAddHead;null!==node&&node.listener!==listener;)node=node.next;return node},SignalBase.prototype.add=function(listener){var node;-1===this.keys.indexOf(listener)&&(node=this.listenerNodePool.get(),node.listener=listener,this.nodes.push(node),this.keys.push(listener),this.addNode(node))},SignalBase.prototype.addOnce=function(listener){var node;-1===this.keys.indexOf(listener)&&(node=this.listenerNodePool.get(),node.listener=listener,node.once=!0,this.nodes.push(node),this.keys.push(listener),this.addNode(node))},SignalBase.prototype.addNode=function(node){this.dispatching?null===this.toAddHead?this.toAddHead=this.toAddTail=node:(this.toAddTail.next=node,node.previous=this.toAddTail,this.toAddTail=node):null===this.head?this.head=this.tail=node:(this.tail.next=node,node.previous=this.tail,this.tail=node),this.numListeners++},SignalBase.prototype.remove=function(listener){var index,node;index=this.keys.indexOf(listener),node=this.nodes[index],node&&(this.head===node&&(this.head=this.head.next),this.tail===node&&(this.tail=this.tail.previous),this.toAddHead===node&&(this.toAddHead=this.toAddHead.next),this.toAddTail===node&&(this.toAddTail=this.toAddTail.previous),node.previous&&(node.previous.next=node.next),node.next&&(node.next.previous=node.previous),this.nodes.splice(index,1),this.keys.splice(index,1),this.dispatching?this.listenerNodePool.cache(node):this.listenerNodePool.dispose(node),this.numListeners--)},SignalBase.prototype.removeAll=function(){for(var index,node;this.head;)node=this.head,this.head=this.head.next,index=this.keys.indexOf(node.listener),this.nodes.splice(index,1),this.listenerNodePool.dispose(node);this.nodes=[],this.keys=[],this.tail=null,this.toAddHead=null,this.toAddTail=null,this.numListeners=0},SignalBase}()}.call(this),function(){"use strict";var bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;ash.tick.FrameTickProvider=function(superClass){function FrameTickProvider(displayObject,maximumFrameTime){this.displayObject=displayObject,this.maximumFrameTime=maximumFrameTime,this.dispatchTick=bind(this.dispatchTick,this),FrameTickProvider.__super__.constructor.apply(this,arguments)}return extend(FrameTickProvider,superClass),FrameTickProvider.prototype.displayObject=null,FrameTickProvider.prototype.previousTime=0,FrameTickProvider.prototype.maximumFrameTime=0,FrameTickProvider.prototype.isPlaying=!1,FrameTickProvider.prototype.request=null,FrameTickProvider.prototype.timeAdjustment=1,Object.defineProperties(FrameTickProvider.prototype,{playing:{get:function(){return this.isPlaying}}}),FrameTickProvider.prototype.start=function(){this.request=requestAnimationFrame(this.dispatchTick),this.isPlaying=!0},FrameTickProvider.prototype.stop=function(){cancelRequestAnimationFrame(this.request),this.isPlaying=!1},FrameTickProvider.prototype.dispatchTick=function(timestamp){var frameTime,temp;null==timestamp&&(timestamp=Date.now()),this.displayObject&&this.displayObject.begin(),temp=this.previousTime||timestamp,this.previousTime=timestamp,frameTime=.001*(timestamp-temp),this.dispatch(frameTime),requestAnimationFrame(this.dispatchTick),this.displayObject&&this.displayObject.end()},FrameTickProvider}(ash.signals.Signal1)}.call(this),function(){"use strict";var Dictionary,indexOf=[].indexOf||function(item){for(var i=0,l=this.length;l>i;i++)if(i in this&&this[i]===item)return i;return-1};Dictionary=ash.ext.Dictionary,ash.tools.ComponentPool=function(){function ComponentPool(){}var getPool,pools;return pools=new Dictionary,getPool=function(componentClass){var ref;return ref=componentClass.className,indexOf.call(pools,ref)>=0?pools[componentClass.className]:pools[componentClass.className]=[]},ComponentPool.get=function(componentClass){var pool;return pool=getPool(componentClass),pool.length>0?pool.pop():new componentClass},ComponentPool.dispose=function(component){var pool,type;component&&(type=component.constructor,pool=getPool(type),pool.push(component))},ComponentPool.empty=function(){return pools=new Dictionary},ComponentPool}()}.call(this),function(){"use strict";var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;ash.tools.ListIteratingSystem=function(superClass){function ListIteratingSystem(nodeClass,nodeUpdateFunction,nodeAddedFunction,nodeRemovedFunction){null==nodeAddedFunction&&(nodeAddedFunction=null),null==nodeRemovedFunction&&(nodeRemovedFunction=null),this.nodeClass=nodeClass,this.nodeUpdateFunction=nodeUpdateFunction,this.nodeAddedFunction=nodeAddedFunction,this.nodeRemovedFunction=nodeRemovedFunction}return extend(ListIteratingSystem,superClass),ListIteratingSystem.prototype.nodeList=null,ListIteratingSystem.prototype.nodeClass=null,ListIteratingSystem.prototype.nodeUpdateFunction=null,ListIteratingSystem.prototype.nodeAddedFunction=null,ListIteratingSystem.prototype.nodeRemovedFunction=null,ListIteratingSystem.prototype.addToEngine=function(engine){var node;if(this.nodeList=engine.getNodeList(this.nodeClass),null!==this.nodeAddedFunction){for(node=this.nodeList.head;node;)this.nodeAddedFunction(node),node=node.next;this.nodeList.nodeAdded.add(this.nodeAddedFunction)}null!==this.nodeRemovedFunction&&this.nodeList.nodeRemoved.add(this.nodeRemovedFunction)},ListIteratingSystem.prototype.removeFromEngine=function(engine){null!==this.nodeAddedFunction&&this.nodeList.nodeAdded.remove(this.nodeAddedFunction),null!==this.nodeRemovedFunction&&this.nodeList.nodeRemoved.remove(this.nodeRemovedFunction),this.nodeList=null},ListIteratingSystem.prototype.update=function(time){var node;for(node=this.nodeList.head;node;)this.nodeUpdateFunction(node,time),node=node.next},ListIteratingSystem}(ash.core.System)}.call(this);