(function(){"use strict";var Dictionary,ash;ash={signals:{},core:{},ext:{Dictionary:Dictionary=function(){function Dictionary(){}return Dictionary}(),getClassName:function(klass){var ref;return null!=(ref=klass.className)?ref:klass.name}},fsm:{},tick:{},tools:{}},"function"==typeof define&&null!=define.amd?define(function(){return ash}):this.ash=ash}).call(this),function(){var PhaserEngine,bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;"undefined"!=typeof Phaser&&null!==Phaser&&(ash.ext.PhaserEngine=PhaserEngine=function(superClass){function PhaserEngine(game,parent){this.postRender=bind(this.postRender,this),this.removeAllSystems=bind(this.removeAllSystems,this),this.removeSystem=bind(this.removeSystem,this),this.getSystem=bind(this.getSystem,this),this.addSystem=bind(this.addSystem,this),this.releaseNodeList=bind(this.releaseNodeList,this),this.getNodeList=bind(this.getNodeList,this),this.componentRemoved=bind(this.componentRemoved,this),this.componentAdded=bind(this.componentAdded,this),this.removeAllEntities=bind(this.removeAllEntities,this),this.getEntityByName=bind(this.getEntityByName,this),this.entityNameChanged=bind(this.entityNameChanged,this),this.removeEntity=bind(this.removeEntity,this),this.addEntity=bind(this.addEntity,this),this.init=bind(this.init,this),PhaserEngine.__super__.constructor.call(this,game,parent),this.nodes={},this.components={},this.entityList=new EntityList,this.entityNames=new Dictionary,this.systemList=new SystemList,this.families=new Dictionary,this.updateComplete=new Signal0}return extend(PhaserEngine,superClass),PhaserEngine.prototype.entityNames=null,PhaserEngine.prototype.entityList=null,PhaserEngine.prototype.systemList=null,PhaserEngine.prototype.families=null,PhaserEngine.prototype.nodes=null,PhaserEngine.prototype.components=null,PhaserEngine.prototype.game=null,PhaserEngine.prototype.parent=null,PhaserEngine.prototype.active=!0,PhaserEngine.prototype.visible=!0,PhaserEngine.prototype.hasPostRender=!0,PhaserEngine.prototype.updating=!1,PhaserEngine.prototype.updateComplete=null,PhaserEngine.prototype.familyClass=ComponentMatchingFamily,PhaserEngine.prototype.addNode=function(name,def){var property,ref,type;if(null==def.components){def.components={},ref=def.prototype;for(property in ref)hasProp.call(ref,property)&&(type=ref[property],def.components[property]=type,def.prototype[property]=null);def.prototype.entity=null,def.prototype.previous=null,def.prototype.next=null}return this.nodes[name]=def},PhaserEngine.prototype.init=function(nodes,components){var klass,name,property,ref,results,type;if(null!=components)for(name in components)klass=components[name],this.components[name]=klass;if(null!=nodes){results=[];for(name in nodes){if(klass=nodes[name],null==klass.components){klass.components={},ref=klass.prototype;for(property in ref)hasProp.call(ref,property)&&(type=ref[property],klass.components[property]=type,klass.prototype[property]=null);klass.prototype.entity=null,klass.prototype.previous=null,klass.prototype.next=null}results.push(null!=components?this.nodes[name]=klass:void 0)}return results}},Object.defineProperties(PhaserEngine.prototype,{entities:{get:function(){var entities,entity;for(entities=[],entity=this.entityList.head;entity;)this.entities.push(entity),entity=entity.next;return entities}},systems:{get:function(){var system,systems;for(systems=[],system=this.systemList.head;system;)systems.push(system),system=system.next;return systems}}}),PhaserEngine.prototype.addEntity=function(entity){var each,family,ref;if(this.entityNames[entity.name])throw"The entity name "+entity.name+" is already in use by another entity.";this.entityList.add(entity),this.entityNames[entity.name]=entity,entity.componentAdded.add(this.componentAdded),entity.componentRemoved.add(this.componentRemoved),entity.nameChanged.add(this.entityNameChanged),ref=this.families;for(each in ref)family=ref[each],family.newEntity(entity)},PhaserEngine.prototype.removeEntity=function(entity){var each,family,ref;entity.componentAdded.remove(this.componentAdded),entity.componentRemoved.remove(this.componentRemoved),entity.nameChanged.remove(this.entityNameChanged),ref=this.families;for(each in ref)family=ref[each],family.removeEntity(entity);delete this.entityNames[entity.name],this.entityList.remove(entity)},PhaserEngine.prototype.entityNameChanged=function(entity,oldName){this.entityNames[oldName]===entity&&(delete this.entityNames[oldName],this.entityNames[entity.name]=entity)},PhaserEngine.prototype.getEntityByName=function(name){return this.entityNames[name]},PhaserEngine.prototype.removeAllEntities=function(){for(;null!==this.entityList.head;)this.removeEntity(this.entityList.head)},PhaserEngine.prototype.componentAdded=function(entity,componentClass){var each,family,ref;ref=this.families;for(each in ref)family=ref[each],family.componentAddedToEntity(entity,componentClass)},PhaserEngine.prototype.componentRemoved=function(entity,componentClass){var each,family,ref;ref=this.families;for(each in ref)family=ref[each],family.componentRemovedFromEntity(entity,componentClass)},PhaserEngine.prototype.getNodeList=function(nodeClass){var entity,family;if(nodeClass.name in this.families)return this.families[nodeClass.name].nodeList;for(family=new this.familyClass(nodeClass,this),this.families[nodeClass.name]=family,entity=this.entityList.head;entity;)family.newEntity(entity),entity=entity.next;return family.nodeList},PhaserEngine.prototype.releaseNodeList=function(nodeClass){nodeClass.name in this.families&&(this.families[nodeClass.name].cleanUp(),delete this.families[nodeClass.name])},PhaserEngine.prototype.addSystem=function(system,priority){system.priority=priority,system.addToEngine(this),this.systemList.add(system)},PhaserEngine.prototype.getSystem=function(type){return systemList.get(type)},PhaserEngine.prototype.removeSystem=function(system){this.systemList.remove(system),system.removeFromEngine(this)},PhaserEngine.prototype.removeAllSystems=function(){for(;null!==this.systemList.head;)this.removeSystem(this.systemList.head)},PhaserEngine.prototype.postRender=function(){var system,time;for(time=.001*this.game.time.elapsed,this.updating=!0,system=this.systemList.head;system;)system.update(time),system=system.next;this.updating=!1,this.updateComplete.dispatch()},PhaserEngine}(Phaser.Plugin))}.call(this),function(){var PhaserEntity,extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;"undefined"!=typeof Phaser&&null!==Phaser&&(ash.ext.PhaserEntity=PhaserEntity=function(superClass){function PhaserEntity(game,key,name){null==name&&(name=""),PhaserEntity.__super__.constructor.call(this,game,0,0,key),Object.defineProperties(this,{name:{get:function(){return this._name},set:function(value){var previous;return this._name!==value?(previous=this._name,this._name=value,this.nameChanged.dispatch(this,previous)):void 0}}}),this.componentAdded=new Signal2,this.componentRemoved=new Signal2,this.nameChanged=new Signal2,this.components=new Dictionary,this._name=""!==name?name:"_entity"+ ++nameCount}var nameCount;return extend(PhaserEntity,superClass),nameCount=0,PhaserEntity.prototype._name="",PhaserEntity.prototype.componentAdded=null,PhaserEntity.prototype.componentRemoved=null,PhaserEntity.prototype.nameChanged=null,PhaserEntity.prototype.previous=null,PhaserEntity.prototype.next=null,PhaserEntity.prototype.components=null,PhaserEntity.prototype.add=function(component,componentClass){return null==componentClass&&(componentClass=component.constructor),componentClass.className in this.components&&this.remove(componentClass),this.components[componentClass.className]=component,this.componentAdded.dispatch(this,componentClass),this},PhaserEntity.prototype.remove=function(componentClass){var component,name;return name=null!=componentClass.className?componentClass.className:componentClass,component=this.components[name],component?(delete this.components[name],this.componentRemoved.dispatch(this,name),component):null},PhaserEntity.prototype.get=function(componentClass){return this.components[componentClass.className]},PhaserEntity.prototype.getAll=function(){var component,componentArray,i,len,ref;for(componentArray=[],ref=this.components,i=0,len=ref.length;len>i;i++)component=ref[i],componentArray.push(component);return componentArray},PhaserEntity.prototype.has=function(componentClass){return componentClass.className in this.components},PhaserEntity}(Phaser.Sprite))}.call(this),function(){var PhaserPlugin,bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;"undefined"!=typeof Phaser&&null!==Phaser&&(ash.ext.PhaserPlugin=PhaserPlugin=function(superClass){function PhaserPlugin(game,parent){this.update=bind(this.update,this),this.removeAllSystems=bind(this.removeAllSystems,this),this.removeSystem=bind(this.removeSystem,this),this.getSystem=bind(this.getSystem,this),this.addSystem=bind(this.addSystem,this),this.releaseNodeList=bind(this.releaseNodeList,this),this.getNodeList=bind(this.getNodeList,this),this.componentRemoved=bind(this.componentRemoved,this),this.componentAdded=bind(this.componentAdded,this),this.removeAllEntities=bind(this.removeAllEntities,this),this.getEntityByName=bind(this.getEntityByName,this),this.entityNameChanged=bind(this.entityNameChanged,this),this.removeEntity=bind(this.removeEntity,this),this.addEntity=bind(this.addEntity,this),this.init=bind(this.init,this),PhaserPlugin.__super__.constructor.call(this,game,parent),this.nodes={},this.components={},this.entityList=new EntityList,this.entityNames=new Dictionary,this.systemList=new SystemList,this.families=new Dictionary,this.updateComplete=new Signal0}return extend(PhaserPlugin,superClass),PhaserPlugin.prototype.entityNames=null,PhaserPlugin.prototype.entityList=null,PhaserPlugin.prototype.systemList=null,PhaserPlugin.prototype.families=null,PhaserPlugin.prototype.nodes=null,PhaserPlugin.prototype.components=null,PhaserPlugin.prototype.game=null,PhaserPlugin.prototype.parent=null,PhaserPlugin.prototype.active=!0,PhaserPlugin.prototype.visible=!0,PhaserPlugin.prototype.hasPostRender=!0,PhaserPlugin.prototype.updating=!1,PhaserPlugin.prototype.updateComplete=null,PhaserPlugin.prototype.familyClass=ComponentMatchingFamily,PhaserPlugin.prototype.addNode=function(name,def){var property,ref,type;if(null==def.components){def.components={},ref=def.prototype;for(property in ref)hasProp.call(ref,property)&&(type=ref[property],def.components[property]=type,def.prototype[property]=null);def.prototype.entity=null,def.prototype.previous=null,def.prototype.next=null}return this.nodes[name]=def},PhaserPlugin.prototype.init=function(nodes,components){var klass,name,property,ref,results,type;if(null!=components)for(name in components)klass=components[name],this.components[name]=klass;if(null!=nodes){results=[];for(name in nodes){if(klass=nodes[name],null==klass.components){klass.components={},ref=klass.prototype;for(property in ref)hasProp.call(ref,property)&&(type=ref[property],klass.components[property]=type,klass.prototype[property]=null);klass.prototype.entity=null,klass.prototype.previous=null,klass.prototype.next=null}results.push(null!=components?this.nodes[name]=klass:void 0)}return results}},Object.defineProperties(PhaserPlugin.prototype,{entities:{get:function(){var entities,entity;for(entities=[],entity=this.entityList.head;entity;)this.entities.push(entity),entity=entity.next;return entities}},systems:{get:function(){var system,systems;for(systems=[],system=this.systemList.head;system;)systems.push(system),system=system.next;return systems}}}),PhaserPlugin.prototype.addEntity=function(entity){var each,family,ref;if(this.entityNames[entity.name])throw"The entity name "+entity.name+" is already in use by another entity.";this.entityList.add(entity),this.entityNames[entity.name]=entity,entity.componentAdded.add(this.componentAdded),entity.componentRemoved.add(this.componentRemoved),entity.nameChanged.add(this.entityNameChanged),ref=this.families;for(each in ref)family=ref[each],family.newEntity(entity)},PhaserPlugin.prototype.removeEntity=function(entity){var each,family,ref;entity.componentAdded.remove(this.componentAdded),entity.componentRemoved.remove(this.componentRemoved),entity.nameChanged.remove(this.entityNameChanged),ref=this.families;for(each in ref)family=ref[each],family.removeEntity(entity);delete this.entityNames[entity.name],this.entityList.remove(entity)},PhaserPlugin.prototype.entityNameChanged=function(entity,oldName){this.entityNames[oldName]===entity&&(delete this.entityNames[oldName],this.entityNames[entity.name]=entity)},PhaserPlugin.prototype.getEntityByName=function(name){return this.entityNames[name]},PhaserPlugin.prototype.removeAllEntities=function(){for(;null!==this.entityList.head;)this.removeEntity(this.entityList.head)},PhaserPlugin.prototype.componentAdded=function(entity,componentClass){var each,family,ref;ref=this.families;for(each in ref)family=ref[each],family.componentAddedToEntity(entity,componentClass)},PhaserPlugin.prototype.componentRemoved=function(entity,componentClass){var each,family,ref;ref=this.families;for(each in ref)family=ref[each],family.componentRemovedFromEntity(entity,componentClass)},PhaserPlugin.prototype.getNodeList=function(nodeClass){var entity,family;if(nodeClass.name in this.families)return this.families[nodeClass.name].nodeList;for(family=new this.familyClass(nodeClass,this),this.families[nodeClass.name]=family,entity=this.entityList.head;entity;)family.newEntity(entity),entity=entity.next;return family.nodeList},PhaserPlugin.prototype.releaseNodeList=function(nodeClass){nodeClass.name in this.families&&(this.families[nodeClass.name].cleanUp(),delete this.families[nodeClass.name])},PhaserPlugin.prototype.addSystem=function(system,priority){system.priority=priority,system.addToEngine(this),this.systemList.add(system)},PhaserPlugin.prototype.getSystem=function(type){return systemList.get(type)},PhaserPlugin.prototype.removeSystem=function(system){this.systemList.remove(system),system.removeFromEngine(this)},PhaserPlugin.prototype.removeAllSystems=function(){for(;null!==this.systemList.head;)this.removeSystem(this.systemList.head)},PhaserPlugin.prototype.update=function(){var system,time;for(time=.001*this.game.time.elapsed,this.updating=!0,system=this.systemList.head;system;)system.update(time),system=system.next;this.updating=!1,this.updateComplete.dispatch()},PhaserPlugin}(Phaser.Plugin))}.call(this);