(function(){var ComponentInstanceProvider,ComponentMatchingFamily,ComponentSingletonProvider,ComponentTypeProvider,Dictionary,DynamicComponentProvider,DynamicSystemProvider,EngineState,EntityList,EntityState,ListenerNode,ListenerNodePool,NodeList,NodePool,Signal0,Signal1,Signal2,StateComponentMapping,StateSystemMapping,SystemInstanceProvider,SystemList,SystemSingletonProvider,Util,ash,__extends=function(child,parent){for(var key in parent)if(__hasProp.call(parent,key))child[key]=parent[key];function ctor(){this.constructor=
child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},__hasProp={}.hasOwnProperty,__bind=function(fn,me){return function(){return fn.apply(me,arguments)}},__indexOf=[].indexOf||function(item){for(var i=0,l=this.length;i<l;i++)if(i in this&&this[i]===item)return i;return-1};ash={core:{},ext:{},fsm:{},signals:{},tick:{},tools:{}};(function(root,factory){if("function"===typeof define&&define.amd)define(factory);else if("object"===typeof exports)module.exports=
factory();else root["ash"]=factory()})(this,function(){return ash});"use strict";ash.signals.ListenerNode=function(){function ListenerNode(){}ListenerNode.prototype.previous=null;ListenerNode.prototype.next=null;ListenerNode.prototype.listener=null;ListenerNode.prototype.once=false;return ListenerNode}();"use strict";ListenerNode=ash.signals.ListenerNode;ash.signals.ListenerNodePool=function(){function ListenerNodePool(){}ListenerNodePool.prototype.tail=null;ListenerNodePool.prototype.cacheTail=null;
ListenerNodePool.prototype.get=function(){var node;if(this.tail!==null){node=this.tail;this.tail=this.tail.previous;node.previous=null;return node}else return new ListenerNode};ListenerNodePool.prototype.dispose=function(node){node.listener=null;node.once=false;node.next=null;node.previous=this.tail;this.tail=node};ListenerNodePool.prototype.cache=function(node){node.listener=null;node.previous=this.cacheTail;this.cacheTail=node};ListenerNodePool.prototype.releaseCache=function(){var node;while(this.cacheTail!==
null){node=this.cacheTail;this.cacheTail=node.previous;node.next=null;node.previous=this.tail;this.tail=node}};return ListenerNodePool}();"use strict";ListenerNodePool=ash.signals.ListenerNodePool;ash.signals.SignalBase=function(){SignalBase.prototype.head=null;SignalBase.prototype.tail=null;SignalBase.prototype.numListeners=0;SignalBase.prototype.keys=null;SignalBase.prototype.nodes=null;SignalBase.prototype.listenerNodePool=null;SignalBase.prototype.toAddHead=null;SignalBase.prototype.toAddTail=
null;SignalBase.prototype.dispatching=false;function SignalBase(){this.nodes=[];this.keys=[];this.listenerNodePool=new ListenerNodePool;this.numListeners=0}SignalBase.prototype.startDispatch=function(){this.dispatching=true};SignalBase.prototype.endDispatch=function(){this.dispatching=false;if(this.toAddHead){if(!this.head){this.head=this.toAddHead;this.tail=this.toAddTail}else{this.tail.next=this.toAddHead;this.toAddHead.previous=this.tail;this.tail=this.toAddTail}this.toAddHead=null;this.toAddTail=
null}this.listenerNodePool.releaseCache()};SignalBase.prototype.getNode=function(listener){var node;node=this.head;while(node!==null){if(node.listener===listener)break;node=node.next}if(node===null){node=this.toAddHead;while(node!==null){if(node.listener===listener)break;node=node.next}}return node};SignalBase.prototype.add=function(listener){var node;if(this.keys.indexOf(listener)!==-1)return;node=this.listenerNodePool.get();node.listener=listener;this.nodes.push(node);this.keys.push(listener);this.addNode(node)};
SignalBase.prototype.addOnce=function(listener){var node;if(this.keys.indexOf(listener)!==-1)return;node=this.listenerNodePool.get();node.listener=listener;node.once=true;this.nodes.push(node);this.keys.push(listener);this.addNode(node)};SignalBase.prototype.addNode=function(node){if(this.dispatching)if(this.toAddHead===null)this.toAddHead=this.toAddTail=node;else{this.toAddTail.next=node;node.previous=this.toAddTail;this.toAddTail=node}else if(this.head===null)this.head=this.tail=node;else{this.tail.next=
node;node.previous=this.tail;this.tail=node}this.numListeners++};SignalBase.prototype.remove=function(listener){var index,node;index=this.keys.indexOf(listener);node=this.nodes[index];if(node){if(this.head===node)this.head=this.head.next;if(this.tail===node)this.tail=this.tail.previous;if(this.toAddHead===node)this.toAddHead=this.toAddHead.next;if(this.toAddTail===node)this.toAddTail=this.toAddTail.previous;if(node.previous)node.previous.next=node.next;if(node.next)node.next.previous=node.previous;
this.nodes.splice(index,1);this.keys.splice(index,1);if(this.dispatching)this.listenerNodePool.cache(node);else this.listenerNodePool.dispose(node);this.numListeners--}};SignalBase.prototype.removeAll=function(){var index,node;while(this.head){node=this.head;this.head=this.head.next;index=this.keys.indexOf(node.listener);this.nodes.splice(index,1);this.listenerNodePool.dispose(node)}this.nodes=[];this.keys=[];this.tail=null;this.toAddHead=null;this.toAddTail=null;this.numListeners=0};return SignalBase}();
"use strict";ash.signals.Signal0=function(_super){__extends(Signal0,_super);function Signal0(){return Signal0.__super__.constructor.apply(this,arguments)}Signal0.prototype.dispatch=function(){var node;this.startDispatch();node=this.head;while(node!==null){node.listener();if(node.once)this.remove(node.listener);node=node.next}return this.endDispatch()};return Signal0}(ash.signals.SignalBase);"use strict";ash.signals.Signal1=function(_super){__extends(Signal1,_super);function Signal1(){return Signal1.__super__.constructor.apply(this,
arguments)}Signal1.prototype.dispatch=function($1){var node;this.startDispatch();node=this.head;while(node!==null){node.listener($1);if(node.once)this.remove(node.listener);node=node.next}return this.endDispatch()};return Signal1}(ash.signals.SignalBase);"use strict";ash.signals.Signal2=function(_super){__extends(Signal2,_super);function Signal2(){return Signal2.__super__.constructor.apply(this,arguments)}Signal2.prototype.dispatch=function($1,$2){var node;this.startDispatch();node=this.head;while(node){node.listener($1,
$2);if(node.once)this.remove(node.listener);node=node.next}return this.endDispatch()};return Signal2}(ash.signals.SignalBase);"use strict";ash.signals.Signal3=function(_super){__extends(Signal3,_super);function Signal3(){return Signal3.__super__.constructor.apply(this,arguments)}Signal3.prototype.dispatch=function($1,$2,$3){var node;this.startDispatch();node=this.head;while(node!==null){node.listener($1,$2,$3);if(node.once)this.remove(node.listener);node=node.next}return this.endDispatch()};return Signal3}(ash.signals.SignalBase);
"use strict";Signal2=ash.signals.Signal2;Dictionary=ash.ext.Dictionary;Util=ash.ext.Util;ash.core.Entity=function(){var nameCount;Entity.nameCount={};nameCount=0;Entity.prototype.name="";Entity.prototype.componentAdded=null;Entity.prototype.componentRemoved=null;Entity.prototype.nameChanged=null;Entity.prototype.previous=null;Entity.prototype.next=null;Entity.prototype.components=null;function Entity(name){if(name==null)name="";this.componentAdded=new Signal2;this.componentRemoved=new Signal2;this.nameChanged=
new Signal2;this.components=new Dictionary;if(name!==""){if(Entity.nameCount[name]==null)Entity.nameCount[name]=0;this.name=name+ ++Entity.nameCount[name]}else this.name="_entity"+ ++nameCount}Entity.prototype.setName=function(value){var previous;if(this.name!==value){previous=this.name;this.name=value;this.nameChanged.dispatch(this,previous)}};Entity.prototype.add=function(component,componentClass){if(componentClass==null)componentClass=component.constructor;if(Util.getClassName(componentClass)in
this.components)this.remove(componentClass);this.components[Util.getClassName(componentClass)]=component;this.componentAdded.dispatch(this,componentClass);return this};Entity.prototype.remove=function(componentClass){var component,name;name=Util.getClassName(componentClass)!=null?Util.getClassName(componentClass):componentClass;component=this.components[name];if(component){delete this.components[name];this.componentRemoved.dispatch(this,name);return component}return null};Entity.prototype.get=function(componentClass){return this.components[Util.getClassName(componentClass)]};
Entity.prototype.getAll=function(){var component,componentArray,_i,_len,_ref;componentArray=[];_ref=this.components;for(_i=0,_len=_ref.length;_i<_len;_i++){component=_ref[_i];componentArray.push(component)}return componentArray};Entity.prototype.has=function(componentClass){return Util.getClassName(componentClass)in this.components};return Entity}();"use strict";ash.core.EntityList=function(){function EntityList(){}EntityList.prototype.head=null;EntityList.prototype.tail=null;EntityList.prototype.add=
function(entity){if(!this.head){this.head=this.tail=entity;entity.next=entity.previous=null}else{this.tail.next=entity;entity.previous=this.tail;entity.next=null;this.tail=entity}};EntityList.prototype.remove=function(entity){if(this.head===entity)this.head=this.head.next;if(this.tail===entity)this.tail=this.tail.previous;if(entity.previous)entity.previous.next=entity.next;if(entity.next)entity.next.previous=entity.previous};EntityList.prototype.removeAll=function(){var entity;while(this.head){entity=
this.head;this.head=this.head.next;entity.previous=null;entity.next=null}this.tail=null};return EntityList}();"use strict";ash.core.Node=function(){function Node(){}Node.prototype.entity=null;Node.prototype.previous=null;Node.prototype.next=null;return Node}();"use strict";Signal1=ash.signals.Signal1;ash.core.NodeList=function(){NodeList.prototype.head=null;NodeList.prototype.tail=null;NodeList.prototype.nodeAdded=null;NodeList.prototype.nodeRemoved=null;function NodeList(){this.nodeAdded=new Signal1;
this.nodeRemoved=new Signal1}NodeList.prototype.add=function(node){if(!this.head){this.head=this.tail=node;node.next=node.previous=null}else{this.tail.next=node;node.previous=this.tail;node.next=null;this.tail=node}this.nodeAdded.dispatch(node)};NodeList.prototype.remove=function(node){if(this.head===node)this.head=this.head.next;if(this.tail===node)this.tail=this.tail.previous;if(node.previous)node.previous.next=node.next;if(node.next)node.next.previous=node.previous;this.nodeRemoved.dispatch(node)};
NodeList.prototype.removeAll=function(){var node;while(this.head){node=this.head;this.head=this.head.next;node.previous=null;node.next=null;this.nodeRemoved.dispatch(node)}this.tail=null};NodeList.prototype.isEmpty=function(){return this.head===null};NodeList.prototype.swap=function(node1,node2){var temp;if(node1.previous===node2){node1.previous=node2.previous;node2.previous=node1;node2.next=node1.next;node1.next=node2}else if(node2.previous===node1){node2.previous=node1.previous;node1.previous=node2;
node1.next=node2.next;node2.next=node1}else{temp=node1.previous;node1.previous=node2.previous;node2.previous=temp;temp=node1.next;node1.next=node2.next;node2.next=temp}if(this.head===node1)this.head=node2;else if(this.head===node2)this.head=node1;if(this.tail===node1)this.tail=node2;else if(this.tail===node2)this.tail=node1;if(node1.previous!==null)node1.previous.next=node1;if(node2.previous!==null)node2.previous.next=node2;if(node1.next!==null)node1.next.previous=node1;if(node2.next!==null)node2.next.previous=
node2};NodeList.prototype.insertionSort=function(sortFunction){var node,other,remains;if(this.head===this.tail)return;remains=this.head.next;node=remains;while(node!==null){remains=node.next;other=node.previous;while(other!==null){if(sortFunction(node,other)>=0){if(node!==other.next){if(this.tail===node)this.tail=node.previous;node.previous.next=node.next;if(node.next!==null)node.next.previous=node.previous;node.next=other.next;node.previous=other;node.next.previous=node;other.next=node}break}other=
other.previous}if(other===null){if(this.tail===node)this.tail=node.previous;node.previous.next=node.next;if(node.next!==null)node.next.previous=node.previous;node.next=this.head;this.head.previous=node;node.previous=null;this.head=node}node=remains}};NodeList.prototype.mergeSort=function(sortFunction){var end,lists,next,start;if(this.head===this.tail)return;lists=[];start=this.head;while(start!==null){end=start;while(end.next!==null&&sortFunction(end,end.next)<=0)end=end.next;next=end.next;start.previous=
end.next=null;lists.push(start);start=next}while(lists.length>1)lists.push(this.merge(lists.shift(),lists.shift(),sortFunction));this.tail=this.head=lists[0];while(this.tail.next!==null)this.tail=this.tail.next};NodeList.prototype.merge=function(head1,head2,sortFunction){var head,node;if(sortFunction(head1,head2)<=0){head=node=head1;head1=head1.next}else{head=node=head2;head2=head2.next}while(head1!==null&&head2!==null)if(sortFunction(head1,head2)<=0){node.next=head1;head1.previous=node;node=head1;
head1=head1.next}else{node.next=head2;head2.previous=node;node=head2;head2=head2.next}if(head1!==null){node.next=head1;head1.previous=node}else{node.next=head2;head2.previous=node}return head};return NodeList}();"use strict";ash.core.NodePool=function(){NodePool.prototype.tail=null;NodePool.prototype.nodeClass=null;NodePool.prototype.cacheTail=null;NodePool.prototype.components=null;function NodePool(_at_nodeClass,_at_components){this.nodeClass=_at_nodeClass;this.components=_at_components}NodePool.prototype.get=
function(){var node;if(this.tail){node=this.tail;this.tail=this.tail.previous;node.previous=null;return node}else{node=new this.nodeClass;return node}};NodePool.prototype.dispose=function(node){var componentName;for(componentName in this.components)node[componentName]=null;node.entity=null;node.next=null;node.previous=this.tail;this.tail=node};NodePool.prototype.cache=function(node){node.previous=this.cacheTail;this.cacheTail=node};NodePool.prototype.releaseCache=function(){var node;while(this.cacheTail){node=
this.cacheTail;this.cacheTail=node.previous;this.dispose(node)}};return NodePool}();"use strict";ash.core.System=function(){function System(){this.update=__bind(this.update,this)}System.prototype.previous=null;System.prototype.next=null;System.prototype.priority=0;System.prototype.addToEngine=function(engine){};System.prototype.removeFromEngine=function(engine){};System.prototype.update=function(time){};return System}();"use strict";ash.core.SystemList=function(){function SystemList(){}SystemList.prototype.head=
null;SystemList.prototype.tail=null;SystemList.prototype.add=function(system){var node;if(!this.head){this.head=this.tail=system;system.next=system.previous=null}else{node=this.tail;while(node){if(node.priority<=system.priority)break;node=node.previous}if(node===this.tail){this.tail.next=system;system.previous=this.tail;system.next=null;this.tail=system}else if(!node){system.next=this.head;system.previous=null;this.head.previous=system;this.head=system}else{system.next=node.next;system.previous=node;
node.next.previous=system;node.next=system}}};SystemList.prototype.remove=function(system){if(this.head===system)this.head=this.head.next;if(this.tail===system)this.tail=this.tail.previous;if(system.previous)system.previous.next=system.next;if(system.next)system.next.previous=system.previous};SystemList.prototype.removeAll=function(){var system;while(this.head){system=this.head;this.head=this.head.next;system.previous=null;system.next=null}this.tail=null};SystemList.prototype.get=function(type){var system;
system=this.head;while(system){if(system.constructor===type)return system;system=system.next}return null};return SystemList}();"use strict";ash.core.Family=function(){function Family(){}Family.prototype.nodes=null;Family.prototype.newEntity=function(entity){throw new Error("Method must be overriden");};Family.prototype.removeEntity=function(entity){throw new Error("Method must be overriden");};Family.prototype.componentAddedToEntity=function(entity,componentClass){throw new Error("Method must be overriden");
};Family.prototype.componentRemovedFromEntity=function(entity,componentClass){throw new Error("Method must be overriden");};Family.prototype.cleanUp=function(){throw new Error("Method must be overriden");};return Family}();"use strict";EntityList=ash.core.EntityList;Dictionary=ash.ext.Dictionary;NodeList=ash.core.NodeList;NodePool=ash.core.NodePool;Util=ash.ext.Util;ash.core.ComponentMatchingFamily=function(){ComponentMatchingFamily.prototype.nodes=null;ComponentMatchingFamily.prototype.entities=
null;ComponentMatchingFamily.prototype.nodeClass=null;ComponentMatchingFamily.prototype.components=null;ComponentMatchingFamily.prototype.nodePool=null;ComponentMatchingFamily.prototype.engine=null;function ComponentMatchingFamily(_at_nodeClass,_at_engine){this.nodeClass=_at_nodeClass;this.engine=_at_engine;this.releaseNodePoolCache=__bind(this.releaseNodePoolCache,this);this.init()}ComponentMatchingFamily.prototype.init=function(){var name,type,_ref;this.nodes=new NodeList;this.entities=new Dictionary;
this.components=new Dictionary;this.nodePool=new NodePool(this.nodeClass,this.nodeClass.components);_ref=this.nodeClass.components;for(name in _ref){type=_ref[name];this.components[Util.getClassName(type)]=type}};ComponentMatchingFamily.prototype.newEntity=function(entity){this.addIfMatch(entity)};ComponentMatchingFamily.prototype.componentAddedToEntity=function(entity,componentClass){this.addIfMatch(entity)};ComponentMatchingFamily.prototype.componentRemovedFromEntity=function(entity,componentClass){var name;
name=Util.getClassName(componentClass)!=null?Util.getClassName(componentClass):componentClass;if(name in this.components)this.removeIfMatch(entity)};ComponentMatchingFamily.prototype.removeEntity=function(entity){this.removeIfMatch(entity)};ComponentMatchingFamily.prototype.addIfMatch=function(entity){var componentClass,name,node,_ref,_ref1;if(this.entities[entity.name]==null){_ref=this.nodeClass.components;for(name in _ref){componentClass=_ref[name];if(!entity.has(componentClass))return}node=this.nodePool.get();
node.entity=entity;_ref1=this.nodeClass.components;for(name in _ref1){componentClass=_ref1[name];node[name]=entity.get(componentClass)}this.entities[entity.name]=node;this.nodes.add(node)}};ComponentMatchingFamily.prototype.removeIfMatch=function(entity){var node;if(entity.name in this.entities){node=this.entities[entity.name];delete this.entities[entity.name];this.nodes.remove(node);if(this.engine.updating){this.nodePool.cache(node);this.engine.updateComplete.add(this.releaseNodePoolCache)}else this.nodePool.dispose(node)}};
ComponentMatchingFamily.prototype.releaseNodePoolCache=function(){this.engine.updateComplete.remove(this.releaseNodePoolCache);this.nodePool.releaseCache()};ComponentMatchingFamily.prototype.cleanUp=function(){var node;node=this.nodes.head;while(node){this.entities.remove(node.entity);node=node.next}this.nodes.removeAll()};return ComponentMatchingFamily}();"use strict";EntityList=ash.core.EntityList;Dictionary=ash.ext.Dictionary;SystemList=ash.core.SystemList;Signal0=ash.signals.Signal0;Util=ash.ext.Util;
ComponentMatchingFamily=ash.core.ComponentMatchingFamily;ash.core.Engine=function(){Engine.prototype.entityNames=null;Engine.prototype.entityList=null;Engine.prototype.systemList=null;Engine.prototype.families=null;Engine.prototype.updating=false;Engine.prototype.updateComplete=null;Engine.prototype.familyClass=ash.core.ComponentMatchingFamily;function Engine(){this.update=__bind(this.update,this);this.componentRemoved=__bind(this.componentRemoved,this);this.componentAdded=__bind(this.componentAdded,
this);this.entityNameChanged=__bind(this.entityNameChanged,this);this.entityList=new EntityList;this.entityNames=new Dictionary;this.systemList=new SystemList;this.families=new Dictionary;this.updateComplete=new Signal0}Engine.prototype.getEntities=function(){var entities,entity;entities=[];entity=this.entityList.head;while(entity){this.entities.push(entity);entity=entity.next}return entities};Engine.prototype.getSystems=function(){var system,systems;systems=[];system=this.systemList.head;while(system){systems.push(system);
system=system.next}return systems};Engine.prototype.addEntity=function(entity){var each,family,_ref;if(this.entityNames[entity.name])throw"The entity name "+entity.name+" is already in use by another entity.";this.entityList.add(entity);this.entityNames[entity.name]=entity;entity.componentAdded.add(this.componentAdded);entity.componentRemoved.add(this.componentRemoved);entity.nameChanged.add(this.entityNameChanged);_ref=this.families;for(each in _ref){family=_ref[each];family.newEntity(entity)}};
Engine.prototype.removeEntity=function(entity){var each,family,_ref;entity.componentAdded.remove(this.componentAdded);entity.componentRemoved.remove(this.componentRemoved);entity.nameChanged.remove(this.entityNameChanged);_ref=this.families;for(each in _ref){family=_ref[each];family.removeEntity(entity)}delete this.entityNames[entity.name];this.entityList.remove(entity)};Engine.prototype.entityNameChanged=function(entity,oldName){if(this.entityNames[oldName]===entity){delete this.entityNames[oldName];
this.entityNames[entity.name]=entity}};Engine.prototype.getEntityByName=function(name){return this.entityNames[name]};Engine.prototype.removeAllEntities=function(){while(this.entityList.head!==null)this.removeEntity(this.entityList.head)};Engine.prototype.componentAdded=function(entity,componentClass){var each,family,_ref;_ref=this.families;for(each in _ref){family=_ref[each];family.componentAddedToEntity(entity,componentClass)}};Engine.prototype.componentRemoved=function(entity,componentClass){var each,
family,_ref;_ref=this.families;for(each in _ref){family=_ref[each];family.componentRemovedFromEntity(entity,componentClass)}};Engine.prototype.getNodeList=function(nodeClass){var entity,family;if(Util.getClassName(nodeClass)in this.families)return this.families[Util.getClassName(nodeClass)].nodes;family=new this.familyClass(nodeClass,this);this.families[Util.getClassName(nodeClass)]=family;entity=this.entityList.head;while(entity){family.newEntity(entity);entity=entity.next}return family.nodes};Engine.prototype.releaseNodeList=
function(nodeClass){if(Util.getClassName(nodeClass)in this.families){this.families[Util.getClassName(nodeClass)].cleanUp();delete this.families[Util.getClassName(nodeClass)]}};Engine.prototype.addSystem=function(system,priority){system.priority=priority;system.addToEngine(this);this.systemList.add(system)};Engine.prototype.getSystem=function(type){return systemList.get(type)};Engine.prototype.removeSystem=function(system){this.systemList.remove(system);system.removeFromEngine(this)};Engine.prototype.removeAllSystems=
function(){while(this.systemList.head!==null)this.removeSystem(this.systemList.head)};Engine.prototype.update=function(time){var system;this.updating=true;system=this.systemList.head;while(system){system.update(time);system=system.next}this.updating=false;this.updateComplete.dispatch()};return Engine}();"use strict";ash.ext.Dictionary=function(){function Dictionary(){}return Dictionary}();"use strict";ash.ext.Helper=function(){Helper.prototype.components=null;Helper.prototype.nodes=null;function Helper(components,
nodes){var klass,name,property,type,_ref;this.components={};this.nodes={};if(components!=null)for(name in components){klass=components[name];this.components[name]=klass}if(nodes!=null)for(name in nodes){klass=nodes[name];if(klass.components==null){klass.components={};_ref=klass.prototype;for(property in _ref){if(!__hasProp.call(_ref,property))continue;type=_ref[property];klass.components[property]=type;klass.prototype[property]=null}klass.prototype.entity=null;klass.prototype.previous=null;klass.prototype.next=
null}if(components!=null)this.nodes[name]=klass}}return Helper}();ash.ext.Util=function(){function Util(){}Util.getClassName=function(klass){var _ref;return(_ref=klass.className)!=null?_ref:klass.name};return Util}();"use strict";ash.fsm.ComponentInstanceProvider=function(){ComponentInstanceProvider.prototype.instance=null;function ComponentInstanceProvider(_at_instance){this.instance=_at_instance}ComponentInstanceProvider.prototype.getComponent=function(){return this.instance};ComponentInstanceProvider.prototype.getIdentifier=
function(){return this.instance};return ComponentInstanceProvider}();"use strict";ash.fsm.ComponentSingletonProvider=function(){ComponentSingletonProvider.prototype.componentType=null;ComponentSingletonProvider.prototype.instance=null;function ComponentSingletonProvider(type){this.componentType=type}ComponentSingletonProvider.prototype.getComponent=function(){if(this.instance==null)this.instance=new this.componentType;return this.instance};ComponentSingletonProvider.prototype.getIdentifier=function(){return this.getComponent()};
return ComponentSingletonProvider}();"use strict";ash.fsm.ComponentTypeProvider=function(){ComponentTypeProvider.prototype.componentType=null;function ComponentTypeProvider(type){this.componentType=type}ComponentTypeProvider.prototype.getComponent=function(){return new this.componentType};ComponentTypeProvider.prototype.getIdentifier=function(){return this.componentType};return ComponentTypeProvider}();"use strict";ash.fsm.DynamicComponentProvider=function(){DynamicComponentProvider.prototype._closure=
null;function DynamicComponentProvider(closure){this._closure=closure}DynamicComponentProvider.prototype.getComponent=function(){return this._closure};DynamicComponentProvider.prototype.getIdentifier=function(){return this._closure};return DynamicComponentProvider}();"use strict";ash.fsm.DynamicSystemProvider=function(){DynamicSystemProvider.prototype.method=function(){};DynamicSystemProvider.prototype.priority=0;function DynamicSystemProvider(_at_method){this.method=_at_method}DynamicSystemProvider.prototype.getSystem=
function(){return this.method()};DynamicSystemProvider.prototype.getIdentifier=function(){return this.method};return DynamicSystemProvider}();"use strict";SystemInstanceProvider=ash.fsm.SystemInstanceProvider;SystemSingletonProvider=ash.fsm.SystemSingletonProvider;DynamicSystemProvider=ash.fsm.DynamicSystemProvider;StateSystemMapping=ash.fsm.StateSystemMapping;ash.fsm.EngineState=function(){EngineState.prototype.providers=null;function EngineState(){this.providers=[]}EngineState.prototype.addInstance=
function(system){return this.addProvider(new SystemInstanceProvider(system))};EngineState.prototype.addSingleton=function(type){return this.addProvider(new SystemSingletonProvider(type))};EngineState.prototype.addMethod=function(method){return this.addProvider(new DynamicSystemProvider(method))};EngineState.prototype.addProvider=function(provider){var mapping;mapping=new StateSystemMapping(this,provider);this.providers.push(provider);return mapping};return EngineState}();"use strict";ComponentInstanceProvider=
ash.fsm.ComponentInstanceProvider;ComponentTypeProvider=ash.fsm.ComponentTypeProvider;ComponentSingletonProvider=ash.fsm.ComponentSingletonProvider;DynamicComponentProvider=ash.fsm.DynamicComponentProvider;ash.fsm.StateComponentMapping=function(){StateComponentMapping.prototype.componentType=null;StateComponentMapping.prototype.creatingState=null;StateComponentMapping.prototype.provider=null;function StateComponentMapping(_at_creatingState,type){this.creatingState=_at_creatingState;this.componentType=
type;this.withType(type)}StateComponentMapping.prototype.withInstance=function(component){this.setProvider(new ComponentInstanceProvider(component));return this};StateComponentMapping.prototype.withType=function(type){this.setProvider(new ComponentTypeProvider(type));return this};StateComponentMapping.prototype.withSingleton=function(type){if(type==null)type=this.componentType;this.setProvider(new ComponentSingletonProvider(type));return this};StateComponentMapping.prototype.withMethod=function(method){this.setProvider(new DynamicComponentProvider(method));
return this};StateComponentMapping.prototype.withProvider=function(provider){this.setProvider(provider);return this};StateComponentMapping.prototype.add=function(type){return this.creatingState.add(type)};StateComponentMapping.prototype.setProvider=function(provider){this.provider=provider;return this.creatingState.providers[this.componentType]=provider};return StateComponentMapping}();"use strict";Dictionary=ash.ext.Dictionary;EngineState=ash.fsm.EngineState;ash.fsm.EngineStateMachine=function(){EngineStateMachine.prototype.engine=
null;EngineStateMachine.prototype.states=null;EngineStateMachine.prototype.currentState=null;function EngineStateMachine(_at_engine){this.engine=_at_engine;this.states=new Dictionary}EngineStateMachine.prototype.addState=function(name,state){this.states[name]=state;return this};EngineStateMachine.prototype.createState=function(name){var state;state=new EngineState;this.states[name]=state;return this};EngineStateMachine.prototype.changeState=function(name){var each,id,newState,other,provider,toAdd,
_ref,_ref1;newState=this.states[name];if(newState==null)throw new Error("Engine state "+name+" doesn't exist");if(newState===this.currentState){newState=null;return}toAdd=new Dictionary;_ref=newState.providers;for(each in _ref){provider=_ref[each];id=provider.getIdentifier();toAdd[id]=provider}if(currentState){_ref1=this.currentState.providers;for(each in _ref1){provider=_ref1[each];id=provider.getIdentifier();other=toAdd[id];if(other)delete toAdd[id];else this.engine.removeSystem(provider.getSystem())}}for(each in toAdd){provider=
toAdd[each];this.engine.addSystem(provider.getSystem(),provider.priority)}return this.currentState=newState};return EngineStateMachine}();"use strict";Dictionary=ash.ext.Dictionary;StateComponentMapping=ash.fsm.StateComponentMapping;Util=ash.ext.Util;ash.fsm.EntityState=function(){EntityState.prototype.providers=null;function EntityState(){this.providers=new Dictionary}EntityState.prototype.add=function(type){return new StateComponentMapping(this,Util.getClassName(type))};EntityState.prototype.get=
function(type){return this.providers[type]};EntityState.prototype.has=function(type){return this.providers[type]!==null};return EntityState}();"use strict";Dictionary=ash.ext.Dictionary;EntityState=ash.fsm.EntityState;ash.fsm.EntityStateMachine=function(){EntityStateMachine.prototype.states=null;EntityStateMachine.prototype.currentState=null;EntityStateMachine.prototype.entity=null;function EntityStateMachine(_at_entity){this.entity=_at_entity;this.states=new Dictionary}EntityStateMachine.prototype.addState=
function(name,state){this.states[name]=state;return this};EntityStateMachine.prototype.createState=function(name){var state;state=new EntityState;this.states[name]=state;return state};EntityStateMachine.prototype.changeState=function(name){var newState,other,toAdd,type;newState=this.states[name];if(!newState)throw new Error("Entity state "+name+" doesn't exist");if(newState===this.currentState){newState=null;return}if(this.currentState){toAdd=new Dictionary;for(type in newState.providers)toAdd[type]=
newState.providers[type];for(type in this.currentState.providers){other=toAdd[type];if(other&&other.getIdentifier()===this.currentState.providers[type].getIdentifier())delete toAdd[type];else this.entity.remove(type)}}else toAdd=newState.providers;for(type in toAdd)this.entity.add(toAdd[type].getComponent());return this.currentState=newState};return EntityStateMachine}();"use strict";ash.fsm.StateSystemMapping=function(){StateSystemMapping.prototype.creatingState=null;StateSystemMapping.prototype.provider=
null;function StateSystemMapping(_at_creatingState,_at_provider){this.creatingState=_at_creatingState;this.provider=_at_provider}StateSystemMapping.prototype.withPriority=function(priority){this.provider.priority=priority;return this};StateSystemMapping.prototype.addInstance=function(system){return creatingState.addInstance(system)};StateSystemMapping.prototype.addSingleton=function(type){return creatingState.addSingleton(type)};StateSystemMapping.prototype.addMethod=function(method){return creatingState.addMethod(method)};
StateSystemMapping.prototype.addProvider=function(provider){return creatingState.addProvider(provider)};return StateSystemMapping}();"use strict";ash.fsm.SystemInstanceProvider=function(){SystemInstanceProvider.prototype.instance=null;SystemInstanceProvider.prototype.priority=0;function SystemInstanceProvider(_at_instance){this.instance=_at_instance}SystemInstanceProvider.prototype.getSystem=function(){return this.instance};SystemInstanceProvider.prototype.getIdentifier=function(){return this.instance};
return SystemInstanceProvider}();"use strict";ash.fsm.SystemSingletonProvider=function(){SystemSingletonProvider.prototype.componentType=null;SystemSingletonProvider.prototype.instance=null;SystemSingletonProvider.prototype.priority=0;function SystemSingletonProvider(type){this.componentType=type}SystemSingletonProvider.prototype.getSystem=function(){if(!this.instance)this.instance=new this.componentType;return this.instance};SystemSingletonProvider.prototype.getIdentifier=function(){return this.getSystem()};
return SystemSingletonProvider}();"use strict";ash.tick.FrameTickProvider=function(_super){__extends(FrameTickProvider,_super);FrameTickProvider.prototype.showStats=false;FrameTickProvider.prototype.begin=null;FrameTickProvider.prototype.end=null;FrameTickProvider.prototype.displayObject=null;FrameTickProvider.prototype.previousTime=0;FrameTickProvider.prototype.maximumFrameTime=0;FrameTickProvider.prototype.isPlaying=false;FrameTickProvider.prototype.request=null;FrameTickProvider.prototype.timeAdjustment=
1;function FrameTickProvider(_at_displayObject,_at_maximumFrameTime){this.displayObject=_at_displayObject;this.maximumFrameTime=_at_maximumFrameTime;this.dispatchTick=__bind(this.dispatchTick,this);FrameTickProvider.__super__.constructor.apply(this,arguments);if(this.displayObject!=null)if(typeof this.displayObject["begin"]==="function"&&typeof this.displayObject["end"]==="function"){this.showStats=true;this.begin=this.displayObject["begin"].bind(this.displayObject);this.end=this.displayObject["end"].bind(this.displayObject)}}
FrameTickProvider.prototype.start=function(){this.request=requestAnimationFrame(this.dispatchTick);this.isPlaying=true};FrameTickProvider.prototype.stop=function(){cancelRequestAnimationFrame(this.request);this.isPlaying=false};FrameTickProvider.prototype.dispatchTick=function(timestamp){var frameTime,temp;if(timestamp==null)timestamp=Date.now();if(this.showStats)this.begin();temp=this.previousTime||timestamp;this.previousTime=timestamp;frameTime=(timestamp-temp)*.001;this.dispatch(frameTime);requestAnimationFrame(this.dispatchTick);
if(this.showStats)this.end()};return FrameTickProvider}(ash.signals.Signal1);"use strict";Dictionary=ash.ext.Dictionary;ash.tools.ComponentPool=function(){var getPool,pools;function ComponentPool(){}pools=new Dictionary;getPool=function(componentClass){var _ref;if(_ref=componentClass.className,__indexOf.call(pools,_ref)>=0)return pools[componentClass.className];else return pools[componentClass.className]=[]};ComponentPool.get=function(componentClass){var pool;pool=getPool(componentClass);if(pool.length>
0)return pool.pop();else return new componentClass};ComponentPool.dispose=function(component){var pool,type;if(component){type=component.constructor;pool=getPool(type);pool.push(component)}};ComponentPool.empty=function(){return pools=new Dictionary};return ComponentPool}();"use strict";ash.tools.ListIteratingSystem=function(_super){__extends(ListIteratingSystem,_super);ListIteratingSystem.prototype.nodeList=null;ListIteratingSystem.prototype.nodeClass=null;ListIteratingSystem.prototype.nodeUpdateFunction=
null;ListIteratingSystem.prototype.nodeAddedFunction=null;ListIteratingSystem.prototype.nodeRemovedFunction=null;function ListIteratingSystem(nodeClass,nodeUpdateFunction,nodeAddedFunction,nodeRemovedFunction){if(nodeAddedFunction==null)nodeAddedFunction=null;if(nodeRemovedFunction==null)nodeRemovedFunction=null;this.nodeClass=nodeClass;this.nodeUpdateFunction=nodeUpdateFunction;this.nodeAddedFunction=nodeAddedFunction;this.nodeRemovedFunction=nodeRemovedFunction}ListIteratingSystem.prototype.addToEngine=
function(engine){var node;this.nodeList=engine.getNodeList(this.nodeClass);if(this.nodeAddedFunction!==null){node=this.nodeList.head;while(node){this.nodeAddedFunction(node);node=node.next}this.nodeList.nodeAdded.add(this.nodeAddedFunction)}if(this.nodeRemovedFunction!==null)this.nodeList.nodeRemoved.add(this.nodeRemovedFunction)};ListIteratingSystem.prototype.removeFromEngine=function(engine){if(this.nodeAddedFunction!==null)this.nodeList.nodeAdded.remove(this.nodeAddedFunction);if(this.nodeRemovedFunction!==
null)this.nodeList.nodeRemoved.remove(this.nodeRemovedFunction);this.nodeList=null};ListIteratingSystem.prototype.update=function(time){var node;node=this.nodeList.head;while(node){this.nodeUpdateFunction(node,time);node=node.next}};return ListIteratingSystem}(ash.core.System)}).call(this);
