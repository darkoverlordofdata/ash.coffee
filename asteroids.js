if(!navigator.isCocoonJS){window.location.href="example.html"}!function(){Cocoon=window.Cocoon?window.Cocoon:{},Cocoon.version="3.0.5",Cocoon.nativeAvailable=!!window.ext,Cocoon.extend=function(subc,superc){var subcp=subc.prototype,CocoonJSExtendHierarchyChainClass=function(){};CocoonJSExtendHierarchyChainClass.prototype=superc.prototype,subc.prototype=new CocoonJSExtendHierarchyChainClass,subc.superclass=superc.prototype,subc.prototype.constructor=subc,superc.prototype.constructor===Object.prototype.constructor&&(superc.prototype.constructor=superc);for(var method in subcp)subcp.hasOwnProperty(method)&&(subc.prototype[method]=subcp[method])},Cocoon.clone=function(obj,copy){if(null==obj||"object"!=typeof obj)return obj;var arr=[];for(var attr in obj)arr.push(copy.hasOwnProperty(attr)?copy[attr]:obj[attr]);return arr},Cocoon.callNative=function(nativeExtensionObjectName,nativeFunctionName,args,async){if(Cocoon.nativeAvailable){var argumentsArray=Array.prototype.slice.call(args);argumentsArray.unshift(nativeFunctionName);var nativeExtensionObject=ext[nativeExtensionObjectName],makeCallFunction=async?nativeExtensionObject.makeCallAsync:nativeExtensionObject.makeCall,ret=makeCallFunction.apply(nativeExtensionObject,argumentsArray),finalRet=ret;if("string"==typeof ret)try{finalRet=JSON.parse(ret)}catch(error){console.log(error)}return finalRet}},Cocoon.getObjectFromPath=function(baseObject,objectPath){for(var parts=objectPath.split("."),obj=baseObject,i=0,len=parts.length;len>i;++i)obj[parts[i]]=obj[parts[i]]||void 0,obj=obj[parts[i]];return obj},Cocoon.EventHandler=function(nativeExtensionObjectName,CocoonExtensionObjectName,nativeEventName,chainFunction){return this.listeners=[],this.listenersOnce=[],this.chainFunction=chainFunction,this.addEventListener=function(listener){if(chainFunction){var f=function(){chainFunction.call(this,arguments.callee.sourceListener,Array.prototype.slice.call(arguments))};listener.CocoonEventHandlerChainFunction=f,f.sourceListener=listener,listener=f}var CocoonExtensionObject=Cocoon.getObjectFromPath(Cocoon,CocoonExtensionObjectName);if(CocoonExtensionObject&&CocoonExtensionObject.nativeAvailable)ext[nativeExtensionObjectName].addEventListener(nativeEventName,listener);else{var indexOfListener=this.listeners.indexOf(listener);0>indexOfListener&&this.listeners.push(listener)}},this.addEventListenerOnce=function(listener){if(chainFunction){var f=function(){chainFunction(arguments.callee.sourceListener,Array.prototype.slice.call(arguments))};f.sourceListener=listener,listener=f}var CocoonExtensionObject=Cocoon.getObjectFromPath(Cocoon,CocoonExtensionObjectName);if(CocoonExtensionObject.nativeAvailable)ext[nativeExtensionObjectName].addEventListenerOnce(nativeEventName,listener);else{var indexOfListener=this.listeners.indexOf(listener);0>indexOfListener&&this.listenersOnce.push(listener)}},this.removeEventListener=function(listener){chainFunction&&(listener=listener.CocoonEventHandlerChainFunction,delete listener.CocoonEventHandlerChainFunction);var CocoonExtensionObject=Cocoon.getObjectFromPath(Cocoon,CocoonExtensionObjectName);if(CocoonExtensionObject.nativeAvailable)ext[nativeExtensionObjectName].removeEventListener(nativeEventName,listener);else{var indexOfListener=this.listeners.indexOf(listener);indexOfListener>=0&&this.listeners.splice(indexOfListener,1)}},this.removeEventListenerOnce=function(listener){chainFunction&&(listener=listener.CocoonEventHandlerChainFunction,delete listener.CocoonEventHandlerChainFunction);var CocoonExtensionObject=Cocoon.getObjectFromPath(Cocoon,CocoonExtensionObjectName);if(CocoonExtensionObject.nativeAvailable)ext[nativeExtensionObjectName].removeEventListenerOnce(nativeEventName,listener);else{var indexOfListener=this.listenersOnce.indexOf(listener);indexOfListener>=0&&this.listenersOnce.splice(indexOfListener,1)}},this.notifyEventListeners=function(){var CocoonExtensionObject=Cocoon.getObjectFromPath(Cocoon,CocoonExtensionObjectName);if(CocoonExtensionObject&&CocoonExtensionObject.nativeAvailable)ext[nativeExtensionObjectName].notifyEventListeners(nativeEventName);else{var argumentsArray=Array.prototype.slice.call(arguments),listeners=Array.prototype.slice.call(this.listeners),listenersOnce=Array.prototype.slice.call(this.listenersOnce),_this=this;setTimeout(function(){for(var i=0;i<listeners.length;i++)listeners[i].apply(_this,argumentsArray);for(var i=0;i<listenersOnce.length;i++)listenersOnce[i].apply(_this,argumentsArray)},0),_this.listenersOnce=[]}},this},Cocoon.define=function(extName,ext){for(var namespace="Cocoon."==extName.substring(0,7)?extName.substr(7):extName,base=window.Cocoon,parts=namespace.split("."),object=base,i=0;i<parts.length;i++){var part=parts[i];if(console.log(object[part]?"Updated namespace: - "+extName:"Created namespace: "+extName),object=object[part]=i==parts.length-1?ext(object[part]||{}):{},!object)throw"Unable to create class "+extName}return!0},console.log("Created namespace: Cocoon")}(),Cocoon.define("Cocoon.Signal",function(extension){"use strict";return extension.createSignal=function(){this.handle=null,this.signals={},this.register=function(namespace,handle){if(!namespace&&!handle)throw new Error("Can't create signal "+(namespace||""));if(handle.addEventListener)return this.signals[namespace]=handle,!0;if(!handle.addEventListener){this.signals[namespace]={};for(var prop in handle)handle.hasOwnProperty(prop)&&(this.signals[namespace][prop]=handle[prop]);return!0}throw new Error("Can't create handler for "+namespace+" signal.")},this.expose=function(){return function(signal,callback,params){var once=!1;if(1===arguments.length){var that=this,fnc=function(signal){this.signal=signal};return fnc.prototype.remove=function(functionListener){var handle=that.signals[this.signal];handle&&handle.removeEventListener&&(handle.removeEventListener.apply(that,[functionListener]),that.signals[this.signal]=void 0)},new fnc(signal)}if(params&&params.once&&(once=!0),!this.signals[signal])throw new Error("The signal "+signal+" does not exists.");var handle=this.signals[signal];if(handle.addEventListener&&(once?handle.addEventListenerOnce(function(){callback.apply(this||window,arguments)}):handle.addEventListener(function(){callback.apply(this||window,arguments)})),!this.signals[signal].addEventListener)for(var prop in this.signals[signal])if(this.signals[signal].hasOwnProperty(prop)){var handle=this.signals[signal][prop];once?handle.addEventListenerOnce(function(){this.clbk[this.name].apply(this||window,arguments)}.bind({name:prop,clbk:callback})):handle.addEventListener(function(){this.clbk[this.name].apply(this||window,arguments)}.bind({name:prop,clbk:callback}))}}.bind(this)}},extension}),Cocoon.define("Cocoon.App",function(extension){extension.nativeAvailable=!!window.ext&&!!window.ext.IDTK_APP,extension.isBridgeAvailable=function(){if("boolean"===Cocoon.App.forward.nativeAvailable)return Cocoon.App.forward.nativeAvailable;var available=Cocoon.callNative("IDTK_APP","forwardAvailable",arguments);return available=!!available,Cocoon.App.forward.nativeAvailable=available,available},extension.forward=function(javaScriptCode){return Cocoon.App.nativeAvailable&&Cocoon.App.isBridgeAvailable()?Cocoon.callNative("IDTK_APP","forward",arguments):navigator.isCocoonJS?void 0:"CocoonJS_App_ForCocoonJS_WebViewIFrame"==window.name?window.parent.eval(javaScriptCode):window.frames.CocoonJS_App_ForCocoonJS_WebViewIFrame.window.eval(javaScriptCode)},extension.forwardAsync=function(javaScriptCode,returnCallback){return Cocoon.App.nativeAvailable&&Cocoon.App.isBridgeAvailable()?"undefined"!=typeof returnCallback?ext.IDTK_APP.makeCallAsync("forward",javaScriptCode,returnCallback):ext.IDTK_APP.makeCallAsync("forward",javaScriptCode):void setTimeout(function(){var res;"CocoonJS_App_ForCocoonJS_WebViewIFrame"==window.name?(res=window.parent.eval(javaScriptCode),"function"==typeof returnCallback&&returnCallback(res)):(res=window.parent.frames.CocoonJS_App_ForCocoonJS_WebViewIFrame.window.eval(javaScriptCode),"function"==typeof returnCallback&&returnCallback(res))},1)},extension.load=function(path){if(Cocoon.App.nativeAvailable)return Cocoon.callNative("IDTK_APP","loadPath",arguments);if(!navigator.isCocoonJS){var xhr=new XMLHttpRequest;xhr.onreadystatechange=function(){if(4===xhr.readyState)if(200===xhr.status){var jsCode;jsCode=Cocoon.App.EmulatedWebViewIFrame?"window.Cocoon && window.Cocoon.App.onLoadInCocoonJSSucceed.notifyEventListeners('"+path+"');":"window.Cocoon && window.Cocoon.App.onLoadInTheWebViewSucceed.notifyEventListeners('"+path+"');",Cocoon.App.forwardAsync(jsCode),window.location.href=path}else if(404===xhr.status){this.onreadystatechange=null;var jsCode;jsCode=Cocoon.App.EmulatedWebViewIFrame?"Cocoon && Cocoon.App.onLoadInCocoonJSFailed.notifyEventListeners('"+path+"');":"Cocoon && Cocoon.App.onLoadInTheWebViewFailed.notifyEventListeners('"+path+"');",Cocoon.App.forwardAsync(jsCode)}},xhr.open("GET",path,!0),xhr.send()}},extension.reload=function(){return Cocoon.App.nativeAvailable?Cocoon.callNative("IDTK_APP","reload",arguments):navigator.isCocoonJS?void 0:"CocoonJS_App_ForCocoonJS_WebViewIFrame"==window.name?window.parent.location.reload():window.parent.frames.CocoonJS_App_ForCocoonJS_WebViewIFrame.window.location.reload()},extension.openURL=function(url){return Cocoon.App.nativeAvailable?Cocoon.callNative("IDTK_APP","openURL",arguments,!0):void(navigator.isCocoonJS||window.open(url,"_blank"))},extension.exit=function(){return Cocoon.App.nativeAvailable?Cocoon.callNative("IDTK_APP","forceToFinish",arguments):void(navigator.isCocoonJS||window.close())},extension.StorageType={APP_STORAGE:"APP_STORAGE",INTERNAL_STORAGE:"INTERNAL_STORAGE",EXTERNAL_STORAGE:"EXTERNAL_STORAGE",TEMPORARY_STORAGE:"TEMPORARY_STORAGE"},extension.onSuspended=new Cocoon.EventHandler("IDTK_APP","App","onsuspended"),extension.onActivated=new Cocoon.EventHandler("IDTK_APP","App","onactivated"),extension.onSuspending=new Cocoon.EventHandler("IDTK_APP","App","onsuspending"),extension.onMemoryWarning=new Cocoon.EventHandler("IDTK_APP","App","onmemorywarning");var signal=new Cocoon.Signal.createSignal;return signal.register("suspended",extension.onSuspended),signal.register("activated",extension.onActivated),signal.register("suspending",extension.onSuspending),signal.register("memorywarning",extension.onMemoryWarning),extension.on=signal.expose(),extension}),Cocoon.define("Cocoon.App",function(extension){function checkEmulatedWebViewReady(){var emulatedWB=Cocoon.App.EmulatedWebView;if(!emulatedWB){emulatedWB=document.createElement("div"),emulatedWB.setAttribute("id","CocoonJS_App_ForCocoonJS_WebViewDiv"),emulatedWB.style.width=0,emulatedWB.style.height=0,emulatedWB.style.position="absolute",emulatedWB.style.left=0,emulatedWB.style.top=0,emulatedWB.style.backgroundColor="transparent",emulatedWB.style.border="0px solid #000";var frame=document.createElement("IFRAME");frame.setAttribute("id","CocoonJS_App_ForCocoonJS_WebViewIFrame"),frame.setAttribute("name","CocoonJS_App_ForCocoonJS_WebViewIFrame"),frame.style.width=0,frame.style.height=0,frame.frameBorder=0,frame.allowtransparency=!0,emulatedWB.appendChild(frame),Cocoon.App.EmulatedWebView=emulatedWB,Cocoon.App.EmulatedWebViewIFrame=frame,document.body||(document.body=document.createElement("body")),document.body.appendChild(Cocoon.App.EmulatedWebView)}}extension.pause=function(){return Cocoon.App.nativeAvailable?Cocoon.callNative("IDTK_APP","pause",arguments):void 0},extension.resume=function(){return Cocoon.App.nativeAvailable?Cocoon.callNative("IDTK_APP","resume",arguments):void 0},extension.loadInTheWebView=function(path){if(navigator.isCocoonJS&&Cocoon.App.nativeAvailable)Cocoon.callNative("IDTK_APP","loadInTheWebView",arguments);else{var xhr=new XMLHttpRequest;xhr.onreadystatechange=function(){if(4===xhr.readyState)if(xhr.status>=200&&xhr.status<=299||0===xhr.status){checkEmulatedWebViewReady();var callback=function(){Cocoon.App.onLoadInTheWebViewSucceed.notifyEventListeners(path),Cocoon.App.EmulatedWebViewIFrame.removeEventListener("load",callback)};Cocoon.App.EmulatedWebViewIFrame.addEventListener("load",callback),Cocoon.App.EmulatedWebViewIFrame.contentWindow.location.href=path}else this.onreadystatechange=null,Cocoon.App.onLoadInTheWebViewFailed.notifyEventListeners(path)},xhr.open("GET",path,!0),xhr.send()}},extension.reloadWebView=function(){Cocoon.App.nativeAvailable&&navigator.isCocoonJS?Cocoon.callNative("IDTK_APP","reloadWebView",arguments):(checkEmulatedWebViewReady(),Cocoon.App.EmulatedWebViewIFrame.contentWindow.location.reload())},extension.showTheWebView=function(x,y,width,height){Cocoon.App.nativeAvailable&&navigator.isCocoonJS?Cocoon.callNative("IDTK_APP","showTheWebView",arguments):(checkEmulatedWebViewReady(),Cocoon.App.EmulatedWebViewIFrame.style.width=(width?width/window.devicePixelRatio:window.innerWidth)+"px",Cocoon.App.EmulatedWebViewIFrame.style.height=(height?height/window.devicePixelRatio:window.innerHeight)+"px",Cocoon.App.EmulatedWebView.style.left=(x?x:0)+"px",Cocoon.App.EmulatedWebView.style.top=(y?y:0)+"px",Cocoon.App.EmulatedWebView.style.width=(width?width/window.devicePixelRatio:window.innerWidth)+"px",Cocoon.App.EmulatedWebView.style.height=(height?height/window.devicePixelRatio:window.innerHeight)+"px",Cocoon.App.EmulatedWebView.style.display="block")},extension.hideTheWebView=function(){if(Cocoon.App.nativeAvailable&&navigator.isCocoonJS){var javaScriptCodeToForward="ext.IDTK_APP.makeCall('hide');";return Cocoon.App.forwardAsync(javaScriptCodeToForward)}checkEmulatedWebViewReady(),Cocoon.App.EmulatedWebView.style.display="none"},extension.exitCallback=function(appShouldFinishCallback){navigator.isCocoonJS&&Cocoon.App.nativeAvailable&&(window.onidtkappfinish=appShouldFinishCallback)},extension.forwardedEventFromTheWebView=function(eventName,eventDataString){var eventData=JSON.parse(eventDataString);eventData.target=window;var event=new Event(eventName);for(var att in eventData)event[att]=eventData[att];event.target=window,window.dispatchEvent(event);for(var canvases=document.getElementsByTagName("canvas"),i=0;i<canvases.length;i++)event.target=canvases[i],canvases[i].dispatchEvent(event)},extension.onLoadInTheWebViewSucceed=new Cocoon.EventHandler("IDTK_APP","App","forwardpageload"),extension.onLoadInTheWebViewFailed=new Cocoon.EventHandler("IDTK_APP","App","forwardpagefail");var signal=new Cocoon.Signal.createSignal;return signal.register("load",{success:extension.onLoadInTheWebViewSucceed,error:extension.onLoadInTheWebViewFailed}),extension.WebView=Cocoon.WebView||{},extension.WebView.on=signal.expose(),extension}),Cocoon.define("Cocoon.Utils",function(extension){"use strict";return extension.logMemoryInfo=function(){return Cocoon.nativeAvailable&&navigator.isCocoonJS?Cocoon.callNative("IDTK_APP","logMemoryInfo",arguments):void 0},extension.textureReduction=function(){return Cocoon.nativeAvailable&&navigator.isCocoonJS?Cocoon.callNative("IDTK_APP","setDefaultTextureReducerThreshold",arguments):void 0},extension.markAsMusic=function(){return Cocoon.nativeAvailable?Cocoon.callNative("IDTK_APP","addForceMusic",arguments):void 0},extension.captureScreen=function(){return Cocoon.nativeAvailable?Cocoon.callNative("IDTK_APP","captureScreen",arguments):void 0},extension.captureScreenAsync=function(){Cocoon.nativeAvailable&&Cocoon.callNative("IDTK_APP","captureScreen",arguments,!0)},extension.setAntialias=function(){return Cocoon.nativeAvailable&&navigator.isCocoonJS?Cocoon.callNative("IDTK_APP","setDefaultAntialias",arguments):void 0},extension.setWebGLEnabled=function(){return Cocoon.nativeAvailable?Cocoon.callNative("IDTK_APP","setDefaultAntialias",arguments):void 0},extension.setNPOTEnabled=function(enabled){return Cocoon.nativeAvailable&&navigator.isCocoonJS?window.ext.IDTK_APP.makeCall("setNPOTEnabled",enabled):void 0},extension.setMaxMemory=function(memoryInMBs){return Cocoon.nativeAvailable&&navigator.isCocoonJS?window.ext.IDTK_APP.makeCall("setMaxMemory",memoryInMBs):void 0},extension.CaptureType={EVERYTHING:0,COCOONJS_GL_SURFACE:1,JUST_SYSTEM_VIEWS:2},extension.existsPath=function(){return Cocoon.nativeAvailable?Cocoon.callNative("IDTK_APP","existsPath",arguments):!1},extension.setTextCacheSize=function(){return Cocoon.nativeAvailable&&navigator.isCocoonJS?Cocoon.callNative("IDTK_APP","setTextCacheSize",arguments):void 0},extension}),Cocoon.define("Cocoon.Dialog",function(extension){"use strict";return extension.keyboardType={TEXT:"text",NUMBER:"num",PHONE:"phone",EMAIL:"email",URL:"url"},extension.prompt=function(params,callbacks){if(!callbacks)throw"Callback missing for Cocoon.Dialog.prompt();";var defaultKeyboard=Cocoon.Dialog.keyboardType.TEXT;switch(params.type){case Cocoon.Dialog.keyboardType.TEXT:defaultKeyboard=Cocoon.Dialog.keyboardType.TEXT;break;case Cocoon.Dialog.keyboardType.NUMBER:defaultKeyboard=Cocoon.Dialog.keyboardType.NUMBER;break;case Cocoon.Dialog.keyboardType.PHONE:defaultKeyboard=Cocoon.Dialog.keyboardType.PHONE;break;case Cocoon.Dialog.keyboardType.EMAIL:defaultKeyboard=Cocoon.Dialog.keyboardType.EMAIL;break;case Cocoon.Dialog.keyboardType.URL:defaultKeyboard=Cocoon.Dialog.keyboardType.URL}var properties={title:"",message:"",text:"",type:defaultKeyboard,cancelText:"Cancel",confirmText:"Ok"},args=Cocoon.clone(properties,params),succedListener=function(){Cocoon.Dialog.onTextDialogCancelled.removeEventListener(errorListener),Cocoon.Dialog.onTextDialogFinished.removeEventListener(succedListener),callbacks.success.apply(window,Array.prototype.slice.call(arguments))},errorListener=function(){Cocoon.Dialog.onTextDialogCancelled.removeEventListener(errorListener),Cocoon.Dialog.onTextDialogFinished.removeEventListener(succedListener),callbacks.cancel.apply(window,Array.prototype.slice.call(arguments))};return Cocoon.Dialog.onTextDialogCancelled.addEventListener(errorListener),Cocoon.Dialog.onTextDialogFinished.addEventListener(succedListener),Cocoon.App.nativeAvailable?Cocoon.callNative("IDTK_APP","showTextDialog",args,!0):void setTimeout(function(){var result=prompt(properties.message,properties.text),eventObject=result?Cocoon.Dialog.onTextDialogFinished:Cocoon.Dialog.onTextDialogCancelled;eventObject.notifyEventListeners(result)},0)},extension.confirm=function(params,callback){if(!callback)throw"Callback missing for Cocoon.Dialog.confirm();";var properties={title:"",message:"",cancelText:"Cancel",confirmText:"Ok"},args=Cocoon.clone(properties,params),succedListener=function(){Cocoon.Dialog.onMessageBoxDenied.removeEventListenerOnce(errorListener),callback(!0)},errorListener=function(){Cocoon.Dialog.onMessageBoxConfirmed.removeEventListenerOnce(succedListener),callback(!1)};return Cocoon.Dialog.onMessageBoxDenied.addEventListenerOnce(errorListener),Cocoon.Dialog.onMessageBoxConfirmed.addEventListenerOnce(succedListener),Cocoon.nativeAvailable?Cocoon.callNative("IDTK_APP","showMessageBox",args,!0):void setTimeout(function(){var result=confirm(properties.message),eventObject=result?Cocoon.Dialog.onMessageBoxConfirmed:Cocoon.Dialog.onMessageBoxDenied;eventObject.notifyEventListeners()},0)},extension.showKeyboard=function(params,callbacks){params=params||{},params.type=params.type||Cocoon.Dialog.keyboardType.TEXT;var insertCallback=callbacks&&callbacks.insertText,deleteCallback=callbacks&&callbacks.deleteBackward,doneCallback=callbacks&&callbacks.done,cancelCallback=callbacks&&callbacks.cancel;Cocoon.nativeAvailable&&Cocoon.callNative("IDTK_APP","showKeyboard",[params,insertCallback,deleteCallback,doneCallback,cancelCallback],!0)},extension.dismissKeyboard=function(){Cocoon.nativeAvailable&&Cocoon.callNative("IDTK_APP","dismissKeyboard",[],!0)},extension.onTextDialogFinished=new Cocoon.EventHandler("IDTK_APP","App","ontextdialogfinish"),extension.onTextDialogCancelled=new Cocoon.EventHandler("IDTK_APP","App","ontextdialogcancel"),extension.onMessageBoxConfirmed=new Cocoon.EventHandler("IDTK_APP","App","onmessageboxconfirmed"),extension.onMessageBoxDenied=new Cocoon.EventHandler("IDTK_APP","App","onmessageboxdenied"),extension}),Cocoon.define("Cocoon.WebView",function(extension){return"undefined"==typeof Cocoon||null===Cocoon?extension:"undefined"==typeof Cocoon.App||null===Cocoon.App?extension:navigator.isCocoonJS?extension:(extension.show=function(x,y,width,height){if(Cocoon.App.nativeAvailable)return Cocoon.callNative("IDTK_APP","show",arguments);var div=window.parent.document.getElementById("CocoonJS_App_ForCocoonJS_WebViewDiv");div.style.left=(x?x:div.style.left)+"px",div.style.top=(y?y:div.style.top)+"px",div.style.width=(width?width/window.devicePixelRatio:window.parent.innerWidth)+"px",div.style.height=(height?height/window.devicePixelRatio:window.parent.innerHeight)+"px",div.style.display="block";var iframe=window.parent.document.getElementById("CocoonJS_App_ForCocoonJS_WebViewIFrame");iframe.style.width=(width?width/window.devicePixelRatio:window.parent.innerWidth)+"px",iframe.style.height=(height?height/window.devicePixelRatio:window.parent.innerHeight)+"px"},extension.hide=function(){return Cocoon.App.nativeAvailable?Cocoon.callNative("IDTK_APP","hide",arguments):void(window.parent.document.getElementById("CocoonJS_App_ForCocoonJS_WebViewDiv").style.display="none")},extension.loadInCocoon=function(path,callbacks,storageType){if(Cocoon.App.nativeAvailable){var javaScriptCodeToForward="ext.IDTK_APP.makeCall('loadPath'";return"undefined"!=typeof path&&(javaScriptCodeToForward+=", '"+path+"'","undefined"!=typeof storageType&&(javaScriptCodeToForward+=", '"+storageType+"'")),javaScriptCodeToForward+=");",Cocoon.App.forwardAsync(javaScriptCodeToForward)}Cocoon.App.forwardAsync("Cocoon.App.load('"+path+"');")},extension.reloadCocoonJS=function(){return Cocoon.App.nativeAvailable?Cocoon.App.forwardAsync("ext.IDTK_APP.makeCall('reload');"):void(navigator.isCocoonJS||window.parent.location.reload())},window.addEventListener("load",function(){function forwardEventToCocoonJS(eventName,event){var att,i,eventData={};for(var att in event)i=EVENT_ATTRIBUTES.indexOf(att),i>=0&&(eventData[att]=event[att]);var jsCode="Cocoon && Cocoon.App && Cocoon.App.forwardedEventFromTheWebView && Cocoon.App.forwardedEventFromTheWebView("+JSON.stringify(eventName)+", '"+JSON.stringify(eventData)+"');";Cocoon.App.forward(jsCode)}if(!Cocoon.App.nativeAvailable&&"CocoonJS_App_ForCocoonJS_WebViewIFrame"==window.name){Cocoon.App.forwardEventsToCocoonJSEnabled=!1;var EVENT_ATTRIBUTES=["timeStamp","button","type","x","y","pageX","pageY","clientX","clientY","offsetX","offsetY"],EVENTS=["dblclick","touchmove","mousemove","touchend","touchcancel","mouseup","touchstart","mousedown","release","dragleft","dragright","swipeleft","swiperight"];for(i=0;i<EVENTS.length;i++)window.addEventListener(EVENTS[i],function(eventName){return function(event){Cocoon.App.forwardEventsToCocoonJSEnabled&&forwardEventToCocoonJS(eventName,event)}}(EVENTS[i]))}}),extension.onLoadInCocoonJSSucceed=new Cocoon.EventHandler("IDTK_APP","App","forwardpageload"),extension.onLoadInCocoonJSFailed=new Cocoon.EventHandler("IDTK_APP","App","forwardpagefail"),extension)}),Cocoon.define("Cocoon.Proxify",function(extension){"use strict";return extension.getKeyForValueInDictionary=function(dictionary,value){var finalKey=null;for(var key in dictionary)if(dictionary[key]===value){finalKey=key;break}return finalKey},extension.setupOriginProxyType=function(typeName,attributeNames,functionNames,eventHandlerNames){if(Cocoon.nativeAvailable){if(!typeName)throw"The given typeName must be valid.";if(!attributeNames&&!functionNames&&!eventHandlerNames)throw"There is no point on setting up a proxy for no attributes, functions nor eventHandlers.";attributeNames=attributeNames?attributeNames:[],functionNames=functionNames?functionNames:[],eventHandlerNames=eventHandlerNames?eventHandlerNames:[];var parentObject=window,jsCode="Cocoon.Proxify.setupDestinationProxyType("+JSON.stringify(typeName)+", "+JSON.stringify(eventHandlerNames)+");";Cocoon.App.forward(jsCode);var originalType=parentObject[typeName];parentObject[typeName]=function(){var _this=this;this._cocoonjs_proxy_object_data={};var jsCode="Cocoon.Proxify.newDestinationProxyObject("+JSON.stringify(typeName)+");";this._cocoonjs_proxy_object_data.id=Cocoon.App.forward(jsCode),this._cocoonjs_proxy_object_data.eventHandlers={},this._cocoonjs_proxy_object_data.typeName=typeName,this._cocoonjs_proxy_object_data.eventListeners={},parentObject[typeName]._cocoonjs_proxy_type_data.proxyObjects[this._cocoonjs_proxy_object_data.id]=this;for(var i=0;i<attributeNames.length;i++)!function(attributeName){_this.__defineSetter__(attributeName,function(value){var jsCode="Cocoon.Proxify.setDestinationProxyObjectAttribute("+JSON.stringify(typeName)+", "+_this._cocoonjs_proxy_object_data.id+", "+JSON.stringify(attributeName)+", "+JSON.stringify(value)+");";return Cocoon.App.forward(jsCode)}),_this.__defineGetter__(attributeName,function(){var jsCode="Cocoon.Proxify.getDestinationProxyObjectAttribute("+JSON.stringify(typeName)+", "+_this._cocoonjs_proxy_object_data.id+", "+JSON.stringify(attributeName)+");";return Cocoon.App.forward(jsCode)})}(attributeNames[i]);for(var i=0;i<functionNames.length;i++)!function(functionName){_this[functionName]=function(){var argumentsArray=Array.prototype.slice.call(arguments);argumentsArray.unshift(functionName),argumentsArray.unshift(this._cocoonjs_proxy_object_data.id),argumentsArray.unshift(typeName);for(var jsCode="Cocoon.Proxify.callDestinationProxyObjectFunction(",i=0;i<argumentsArray.length;i++)jsCode+=(1!==i?JSON.stringify(argumentsArray[i]):argumentsArray[i])+(i<argumentsArray.length-1?", ":"");jsCode+=");";var ret=Cocoon.App.forwardAsync(jsCode);return ret}}(functionNames[i]);for(var i=0;i<eventHandlerNames.length;i++)!function(eventHandlerName){_this.__defineSetter__(eventHandlerName,function(value){_this._cocoonjs_proxy_object_data.eventHandlers[eventHandlerName]=value}),_this.__defineGetter__(eventHandlerName,function(){return _this._cocoonjs_proxy_object_data.eventHandlers[eventHandlerName]})}(eventHandlerNames[i]);return _this.addEventListener=function(eventTypeName,eventCallback){var addEventCallback=!0,eventListeners=_this._cocoonjs_proxy_object_data.eventListeners[eventTypeName];if(eventListeners)addEventCallback=eventListeners.indexOf(eventCallback)<0;else{eventListeners=[],_this._cocoonjs_proxy_object_data.eventListeners[eventTypeName]=eventListeners;var jsCode="Cocoon.Proxify.addDestinationProxyObjectEventListener("+JSON.stringify(_this._cocoonjs_proxy_object_data.typeName)+", "+_this._cocoonjs_proxy_object_data.id+", "+JSON.stringify(eventTypeName)+");";Cocoon.App.forwardAsync(jsCode)}addEventCallback&&eventListeners.push(eventCallback)},_this.removeEventListener=function(eventTypeName,eventCallback){var eventListeners=_this._cocoonjs_proxy_object_data.eventListeners[eventTypeName];if(eventListeners){var eventCallbackIndex=eventListeners.indexOf(eventCallback);eventCallbackIndex>=0&&eventListeners.splice(eventCallbackIndex,1)}},this},parentObject[typeName]._cocoonjs_proxy_type_data={originalType:originalType,proxyObjects:[]},parentObject[typeName]._cocoonjs_proxy_type_data.deleteProxyObject=function(object){var proxyObjectKey=extension.getKeyForValueInDictionary(this.proxyObjects,object);if(proxyObjectKey){var jsCode="Cocoon.Proxify.deleteDestinationProxyObject("+JSON.stringify(typeName)+", "+object._cocoonjs_proxy_object_data.id+");";Cocoon.App.forwardAsync(jsCode),object._cocoonjs_proxy_object_data=null,delete this.proxyObjects[proxyObjectKey]}},parentObject[typeName]._cocoonjs_proxy_type_data.callProxyObjectEventHandler=function(id,eventHandlerName){var object=this.proxyObjects[id],eventHandler=object._cocoonjs_proxy_object_data.eventHandlers[eventHandlerName];eventHandler&&eventHandler({target:object})},parentObject[typeName]._cocoonjs_proxy_type_data.callProxyObjectEventListeners=function(id,eventTypeName){for(var object=this.proxyObjects[id],eventListeners=object._cocoonjs_proxy_object_data.eventListeners[eventTypeName].slice(),i=0;i<eventListeners.length;i++)eventListeners[i]({target:object})}}},extension.takedownOriginProxyType=function(typeName){if(Cocoon.App.nativeAvailable){var parentObject=window;parentObject[typeName]&&parentObject[typeName]._cocoonjs_proxy_type_data&&(parentObject[typeName]=parentObject[typeName]._cocoonjs_proxy_type_data.originalType)}},extension.deleteOriginProxyObject=function(object){if(Cocoon.App.nativeAvailable){var parentObject=window;object&&object._cocoonjs_proxy_object_data&&parentObject[object._cocoonjs_proxy_object_data.typeName]._cocoonjs_proxy_type_data.deleteProxyObject(object)}},extension.callOriginProxyObjectEventHandler=function(typeName,id,eventHandlerName){if(Cocoon.App.nativeAvailable){var parentObject=window;parentObject[typeName]._cocoonjs_proxy_type_data.callProxyObjectEventHandler(id,eventHandlerName)}},extension.callOriginProxyObjectEventListeners=function(typeName,id,eventTypeName){if(Cocoon.App.nativeAvailable){var parentObject=window;parentObject[typeName]._cocoonjs_proxy_type_data.callProxyObjectEventListeners(id,eventTypeName)}},extension.setupDestinationProxyType=function(typeName,eventHandlerNames){if(Cocoon.App.nativeAvailable){var parentObject=window;parentObject[typeName]._cocoonjs_proxy_type_data={nextId:0,proxyObjects:{},eventHandlerNames:eventHandlerNames}}},extension.takedownDestinationProxyType=function(typeName){if(Cocoon.App.nativeAvailable){var parentObject=window;parent[typeName]&&parentObject[typeName]._cocoonjs_proxy_type_data&&delete parentObject[typeName]._cocoonjs_proxy_type_data}},extension.newDestinationProxyObject=function(typeName){if(Cocoon.App.nativeAvailable){var parentObject=window,proxyObject=new parentObject[typeName];proxyObject._cocoonjs_proxy_object_data={},proxyObject._cocoonjs_proxy_object_data.typeName=typeName;var proxyObjectId=parentObject[typeName]._cocoonjs_proxy_type_data.nextId;parentObject[typeName]._cocoonjs_proxy_type_data.proxyObjects[proxyObjectId]=proxyObject,proxyObject._cocoonjs_proxy_object_data.id=proxyObjectId,parentObject[typeName]._cocoonjs_proxy_type_data.nextId++;for(var i=0;i<parentObject[typeName]._cocoonjs_proxy_type_data.eventHandlerNames.length;i++)!function(eventHandlerName){proxyObject[eventHandlerName]=function(){var proxyObject=this,jsCode="Cocoon.App.callOriginProxyObjectEventHandler("+JSON.stringify(proxyObject._cocoonjs_proxy_object_data.typeName)+", "+proxyObject._cocoonjs_proxy_object_data.id+", "+JSON.stringify(eventHandlerName)+");";Cocoon.App.forwardAsync(jsCode)}}(parentObject[typeName]._cocoonjs_proxy_type_data.eventHandlerNames[i]);return proxyObject._cocoonjs_proxy_object_data.eventListeners={},proxyObjectId}},extension.callDestinationProxyObjectFunction=function(typeName,id,functionName){if(Cocoon.App.nativeAvailable){var parentObject=window,argumentsArray=Array.prototype.slice.call(arguments);argumentsArray.splice(0,3);var proxyObject=parentObject[typeName]._cocoonjs_proxy_type_data.proxyObjects[id],result=proxyObject[functionName].apply(proxyObject,argumentsArray);return result}},extension.setDestinationProxyObjectAttribute=function(typeName,id,attributeName,attributeValue){if(Cocoon.App.nativeAvailable){var parentObject=window,proxyObject=parentObject[typeName]._cocoonjs_proxy_type_data.proxyObjects[id];proxyObject[attributeName]=attributeValue}},extension.getDestinationProxyObjectAttribute=function(typeName,id,attributeName){if(Cocoon.App.nativeAvailable){var parentObject=window,proxyObject=parentObject[typeName]._cocoonjs_proxy_type_data.proxyObjects[id];return proxyObject[attributeName]}},extension.deleteDestinationProxyObject=function(typeName,id){if(Cocoon.App.nativeAvailable){var parentObject=window;delete parentObject[typeName]._cocoonjs_proxy_type_data.proxyObjects[id]}},extension.addDestinationProxyObjectEventListener=function(typeName,id,eventTypeName){if(Cocoon.App.nativeAvailable){var parentObject=window,proxyObject=parentObject[typeName]._cocoonjs_proxy_type_data.proxyObjects[id],callback=function(){var proxyObject=this,jsCode="Cocoon.Proxify.callOriginProxyObjectEventListeners("+JSON.stringify(proxyObject._cocoonjs_proxy_object_data.typeName)+", "+proxyObject._cocoonjs_proxy_object_data.id+", "+JSON.stringify(eventTypeName)+");";
Cocoon.App.forwardAsync(jsCode)};proxyObject._cocoonjs_proxy_object_data.eventListeners[eventTypeName]=callback,proxyObject.addEventListener(eventTypeName,callback)}},extension.xhr=function(){var ATTRIBUTE_NAMES=["timeout","withCredentials","upload","status","statusText","responseType","response","responseText","responseXML","readyState"],FUNCTION_NAMES=["open","setRequestHeader","send","abort","getResponseHeader","getAllResponseHeaders","overrideMimeType"],EVENT_HANDLER_NAMES=["onloadstart","onprogress","onabort","onerror","onload","ontimeout","onloadend","onreadystatechange"];Cocoon.Proxify.setupOriginProxyType("XMLHttpRequest",ATTRIBUTE_NAMES,FUNCTION_NAMES,EVENT_HANDLER_NAMES)},extension.audio=function(){var ATTRIBUTE_NAMES=["src","loop","volume","preload"],FUNCTION_NAMES=["play","pause","load","canPlayType"],EVENT_HANDLER_NAMES=["onended","oncanplay","oncanplaythrough","onerror"];Cocoon.Proxify.setupOriginProxyType("Audio",ATTRIBUTE_NAMES,FUNCTION_NAMES,EVENT_HANDLER_NAMES)},extension.console=function(){if(Cocoon.nativeAvailable){"undefined"==typeof Cocoon.originalConsole&&(Cocoon.originalConsole=window.console);for(var functions=["log","error","info","debug","warn"],newConsole={},i=0;i<functions.length;i++)newConsole[functions[i]]=function(){return function(message){try{var jsCode="Proxified log: "+JSON.stringify(message);Cocoon.originalConsole.log(jsCode),ext.IDTK_APP.makeCallAsync("forward",jsCode)}catch(e){console.log("Proxified log: "+e)}}}(functions[i]);newConsole.assert||(newConsole.assert=function(){if(arguments.length>0&&!arguments[0]){var str="Assertion failed: "+(arguments.length>1?arguments[1]:"");newConsole.error(str)}}),window.console=newConsole}},extension.deproxifyConsole=function(){!window.navigator.isCocoonJS&&Cocoon.nativeAvailable&&"undefined"!=typeof Cocoon.originalConsole&&(window.console=Cocoon.originalConsole,Cocoon.originalConsole=void 0)},extension}),Cocoon.define("Cocoon.Device",function(extension){"use strict";return extension.DeviceInfo={os:null,version:null,dpi:null,brand:null,model:null,imei:null,platformId:null,odin:null,openudid:null},extension.getDeviceId=function(){return Cocoon.nativeAvailable?window.ext.IDTK_APP.makeCall("getDeviceId"):void 0},extension.getDeviceInfo=function(){return Cocoon.nativeAvailable?window.ext.IDTK_APP.makeCall("getDeviceInfo"):void 0},extension.getOrientation=function(){return Cocoon.nativeAvailable?window.ext.IDTK_APP.makeCall("getPreferredOrientation"):0},extension.setOrientation=function(preferredOrientation){Cocoon.nativeAvailable&&window.ext.IDTK_APP.makeCall("setPreferredOrientation",preferredOrientation)},extension.Orientations={PORTRAIT:1,PORTRAIT_UPSIDE_DOWN:2,LANDSCAPE_LEFT:4,LANDSCAPE_RIGHT:8,LANDSCAPE:12,BOTH:15},extension.autoLock=function(){return Cocoon.nativeAvailable?Cocoon.callNative("IDTK_APP","setAutoLockEnabled",arguments):void 0},extension}),Cocoon.define("Cocoon.Motion",function(extension){"use strict";return extension.nativeAvailable=Cocoon.nativeAvailable,extension.setAccelerometerInterval=function(updateIntervalInSeconds){return Cocoon.Motion.nativeAvailable?window.ext.IDTK_APP.makeCall("setAccelerometerUpdateIntervalInSeconds",updateIntervalInSeconds):void 0},extension.getAccelerometerInterval=function(){return Cocoon.Motion.nativeAvailable?window.ext.IDTK_APP.makeCall("getAccelerometerUpdateIntervalInSeconds"):void 0},extension.setGyroscopeInterval=function(updateIntervalInSeconds){return Cocoon.Motion.nativeAvailable?window.ext.IDTK_APP.makeCall("setGyroscopeUpdateIntervalInSeconds",updateIntervalInSeconds):void 0},extension.getGyroscopeInterval=function(){Cocoon.Motion.nativeAvailable&&window.ext.IDTK_APP.makeCall("getGyroscopeUpdateIntervalInSeconds")},extension}),Cocoon.define("Cocoon.Touch",function(extension){return extension.addADivToDisableInput=function(){var div=document.createElement("div");div.id="CocoonJSInputBlockingDiv",div.style.left=0,div.style.top=0,div.style.width="100%",div.style.height="100%",div.style.position="absolute",div.style.backgroundColor="transparent",div.style.border="0px solid #000",div.style.zIndex=999999999,document.body.appendChild(div)},extension.removeTheDivToEnableInput=function(){var div=document.getElementById("CocoonJSInputBlockingDiv");div&&document.body.removeChild(div)},extension.disable=function(){Cocoon.nativeAvailable?window.ext.IDTK_APP.makeCall("disableTouchLayer","CocoonJSView"):navigator.isCocoonJS||Cocoon.App.EmulatedWebViewIFrame||(Cocoon.App.forwardEventsToCocoonJSEnabled=!1,Cocoon.App.forwardAsync("Cocoon && Cocoon.Touch && Cocoon.Touch.disable();"))},extension.enable=function(){Cocoon.nativeAvailable?window.ext.IDTK_APP.makeCall("enableTouchLayer","CocoonJSView"):navigator.isCocoonJS||Cocoon.App.EmulatedWebViewIFrame||(Cocoon.App.forwardEventsToCocoonJSEnabled=!0,Cocoon.App.forwardAsync("Cocoon && Cocoon.Touch && Cocoon.Touch.enable();"))},extension.disableInWebView=function(){Cocoon.nativeAvailable?window.ext.IDTK_APP.makeCall("disableTouchLayer","WebView"):navigator.isCocoonJS||(Cocoon.App.EmulatedWebViewIFrame?Cocoon.App.forwardAsync("Cocoon && Cocoon.Touch && Cocoon.Touch.disableInWebView();"):Cocoon.Touch.addADivToDisableInput())},extension.enableInWebView=function(){Cocoon.nativeAvailable?window.ext.IDTK_APP.makeCall("enableTouchLayer","WebView"):navigator.isCocoonJS||(Cocoon.App.EmulatedWebViewIFrame?Cocoon.Touch.forwardAsync("Cocoon && Cocoon.Touch && Cocoon.Touch.enableInWebView();"):Cocoon.Touch.removeTheDivToEnableInput())},extension}),Cocoon.define("Cocoon.Widget",function(extension){"use strict";return extension.WebDialog=function(){if(Cocoon.App.nativeAvailable)this.webDialogID=window.ext.IDTK_APP.makeCall("createWebDialog");else{var iframe=document.createElement("iframe");iframe.id="CocoonJSWebDialogIFrame",iframe.name="CocoonJSWebDialogIFrame",iframe.style.cssText="position:fixed;left:0;top:0;bottom:0;right:0; width:100%; height:100%;margin:0;padding:0;";var me=this;iframe.onload=function(){me.iframeloaded=!0;var js="Cocoon = {}; Cocoon.Widget = {}; Cocoon.Widget.WebDialog = {} Cocoon.Widget.WebDialog.close = function(){   window.parent.CocoonJSCloseWebDialog();};";me.evalIframe(js);for(var i=0;i<me.pendingEvals.length;++i)me.evalIframe(me.pendingEvals[i]);me.pendingEvals=[]},iframe.onerror=function(){me.close()},this.iframe=iframe,this.pendingEvals=[],window.CocoonJSCloseWebDialog=function(){me.close()}}},extension.WebDialog.prototype={show:function(url,callback){return this.closeCallback=function(){Cocoon.Touch.enable(),callback&&callback()},Cocoon.App.nativeAvailable?(Cocoon.Touch.disable(),window.ext.IDTK_APP.makeCallAsync("showWebDialog",this.webDialogID,url,this.closeCallback)):(this.iframe.src=url,void document.body.appendChild(this.iframe))},close:function(){return Cocoon.App.nativeAvailable?window.ext.IDTK_APP.makeCallAsync("closeWebDialog",this.webDialogID):(this.iframe.parentNode&&this.iframe.parentNode.removeChild(this.iframe),void(this.closeCallback&&this.closeCallback()))},evalIframe:function(js){window.frames.CocoonJSWebDialogIFrame.eval(js)},eval:function(js){return Cocoon.App.nativeAvailable?window.ext.IDTK_APP.makeCallAsync("evalWebDialog",this.webDialogID,js):void(this.iframeloaded?this.evalIframe(js):this.pendingEvals.push(js))}},extension}),Cocoon.define("Cocoon.Camera",function(extension){return navigator.getUserMedia_=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,extension.CameraType={FRONT:"FRONT",BACK:"BACK"},extension.CaptureFormatType={JPEG:"JPEG",RGB_565:"RGB_565",NV21:"NV21",NV16:"NV16",YUY2:"YUY2",YV12:"YV12",BGRA32:"32BGRA"},extension.CameraInfo={cameraIndex:0,cameraType:extension.CameraType.BACK,supportedVideoSizes:[],supportedVideoFrameRates:[],supportedVideoCaptureImageFormats:[]},extension.getNumberOfCameras=function(){return Cocoon.nativeAvailable&&navigator.isCocoonJS?Cocoon.callNative("IDTK_SRV_CAMERA","getNumberOfCameras",arguments):navigator.getUserMedia_?1:0},extension.getAllCamerasInfo=function(){return Cocoon.nativeAvailable&&navigator.isCocoonJS?Cocoon.callNative("IDTK_SRV_CAMERA","getAllCamerasInfo",arguments):void 0},extension.getCameraInfoByIndex=function(){return Cocoon.nativeAvailable&&navigator.isCocoonJS?Cocoon.callNative("IDTK_SRV_CAMERA","getCameraInfoByIndex",arguments):void 0},extension.getCameraInfoByType=function(){return Cocoon.nativeAvailable&&navigator.isCocoonJS?Cocoon.callNative("IDTK_SRV_CAMERA","getCameraInfoByType",arguments):void 0},extension.start=function(params){if(!Boolean(params.success)||!Boolean(params.error))throw new Error("Missing callbacks for Cocoon.Camera.start();");if(Cocoon.nativeAvailable){var properties={cameraIndex:0,width:50,height:50,frameRate:25},args=Cocoon.clone(properties,params),img=Cocoon.callNative("IDTK_SRV_CAMERA","startCapturing",args);Boolean(img)?params.success(img):params.error(!1)}else navigator.getUserMedia_({video:!0,audio:!1},function(stream){params.success(stream)},function(error){params.error(error)})},extension.stop=function(){return Cocoon.nativeAvailable&&navigator.isCocoonJS?Cocoon.callNative("IDTK_SRV_CAMERA","stopCapturing",arguments):void 0},extension.isCapturing=function(){return Cocoon.nativeAvailable&&navigator.isCocoonJS?Cocoon.callNative("IDTK_SRV_CAMERA","isCapturing",arguments):void 0},extension}),Cocoon.define("Cocoon.Ad",function(extension){"use strict";extension.nativeAvailable=!!Cocoon.nativeAvailable&&!!window.ext.IDTK_SRV_AD,extension.BannerLayout={TOP_CENTER:"TOP_CENTER",BOTTOM_CENTER:"BOTTOM_CENTER"},extension.Rectangle=function(x,y,width,height){this.x=x,this.y=y,this.width=width,this.height=height},extension.Banner=function(id){if("number"!=typeof id)throw"The given ad ID is not a number.";this.id=id;var me=this;this.onBannerShown=new Cocoon.EventHandler("IDTK_SRV_AD","Ad","onbannershow",function(sourceListener,args){me.id===args[0]&&sourceListener()}),this.onBannerHidden=new Cocoon.EventHandler("IDTK_SRV_AD","Ad","onbannerhide",function(sourceListener,args){me.id===args[0]&&sourceListener()}),this.onBannerReady=new Cocoon.EventHandler("IDTK_SRV_AD","Ad","onbannerready",function(sourceListener,args){me.id===args[0]&&sourceListener(args[1],args[2])});var signal=new Cocoon.Signal.createSignal;signal.register("ready",this.onBannerReady),signal.register("shown",this.onBannerShown),signal.register("hidden",this.onBannerHidden),this.on=signal.expose()},extension.Banner.prototype={showBanner:function(){Cocoon.Ad.nativeAvailable&&Cocoon.callNative("IDTK_SRV_AD","showBanner",[this.id],!0)},hideBanner:function(){Cocoon.Ad.nativeAvailable&&Cocoon.callNative("IDTK_SRV_AD","hideBanner",[this.id],!0)},load:function(){Cocoon.Ad.nativeAvailable&&Cocoon.callNative("IDTK_SRV_AD","refreshBanner",[this.id],!0)},getRectangle:function(){return Cocoon.Ad.nativeAvailable?Cocoon.callNative("IDTK_SRV_AD","getRectangle",[this.id]):void 0},setRectangle:function(rect){return Cocoon.Ad.nativeAvailable?Cocoon.callNative("IDTK_SRV_AD","setRectangle",[this.id,rect]):void 0},setBannerLayout:function(bannerLayout){return Cocoon.Ad.nativeAvailable?Cocoon.callNative("IDTK_SRV_AD","setBannerLayout",[this.id,bannerLayout]):void 0}},extension.Interstitial=function(id){if("number"!=typeof id)throw"The given ad ID is not a number.";this.id=id;var me=this;this.onFullScreenShown=new Cocoon.EventHandler("IDTK_SRV_AD","Ad","onfullscreenshow",function(sourceListener,args){me.id===args[0]&&sourceListener()}),this.onFullScreenHidden=new Cocoon.EventHandler("IDTK_SRV_AD","Ad","onfullscreenhide",function(sourceListener,args){me.id===args[0]&&sourceListener()}),this.onFullScreenReady=new Cocoon.EventHandler("IDTK_SRV_AD","Ad","onfullscreenready",function(sourceListener,args){me.id===args[0]&&sourceListener()});var signal=new Cocoon.Signal.createSignal;signal.register("ready",this.onFullScreenReady),signal.register("shown",this.onFullScreenShown),signal.register("hidden",this.onFullScreenHidden),this.on=signal.expose()},extension.Interstitial.prototype={showInterstitial:function(){return Cocoon.Ad.nativeAvailable?Cocoon.callNative("IDTK_SRV_AD","showFullScreen",[this.id],!0):void 0},refreshInterstitial:function(){return Cocoon.Ad.nativeAvailable?Cocoon.callNative("IDTK_SRV_AD","refreshFullScreen",[this.id],!0):void 0}},extension.configure=function(parameters){return"undefined"==typeof parameters&&(parameters={}),Cocoon.Ad.nativeAvailable?Cocoon.callNative("IDTK_SRV_AD","requestInitialization",arguments,!0):void 0},extension.createBanner=function(parameters){if("undefined"==typeof parameters&&(parameters={}),Cocoon.Ad.nativeAvailable){var adId=Cocoon.callNative("IDTK_SRV_AD","createBanner",[parameters]),banner=new extension.Banner(adId);return banner}},extension.releaseBanner=function(banner){if("undefined"==typeof banner)throw"The banner ad object to be released is undefined";Cocoon.Ad.nativeAvailable&&Cocoon.callNative("IDTK_SRV_AD","releaseBanner",[banner.id])},extension.createInterstitial=function(parameters){if("undefined"==typeof parameters&&(parameters={}),Cocoon.Ad.nativeAvailable){var adId=Cocoon.callNative("IDTK_SRV_AD","createFullscreen",[parameters]),fullscreen=new Cocoon.Ad.Interstitial(adId);return fullscreen}},extension.releaseInterstitial=function(fullscreen){if(!fullscreen)throw"The fullscreen ad object to be released is undefined";Cocoon.Ad.nativeAvailable&&Cocoon.callNative("IDTK_SRV_AD","releaseFullscreen",[fullscreen.id])},extension.showBanner=function(){return Cocoon.Ad.nativeAvailable?Cocoon.callNative("IDTK_SRV_AD","showBanner",arguments,!0):void 0},extension.hideBanner=function(){return Cocoon.Ad.nativeAvailable?Cocoon.callNative("IDTK_SRV_AD","hideBanner",arguments,!0):void 0},extension.refreshBanner=function(){return Cocoon.Ad.nativeAvailable?Cocoon.callNative("IDTK_SRV_AD","refreshBanner",arguments,!0):void 0},extension.showInterstitial=function(){return Cocoon.Ad.nativeAvailable?Cocoon.callNative("IDTK_SRV_AD","showFullScreen",arguments,!0):void 0},extension.refreshInterstitial=function(){return Cocoon.Ad.nativeAvailable?Cocoon.callNative("IDTK_SRV_AD","refreshFullScreen",arguments,!0):void 0},extension.preloadedBanner=!1,extension.loadBanner=function(){return Cocoon.Ad.nativeAvailable?Cocoon.Ad.preloadedBanner?Cocoon.Ad.refreshBanner():(Cocoon.Ad.preloadedBanner=!0,Cocoon.callNative("IDTK_SRV_AD","preloadBanner",arguments,!0)):void 0},extension.preloadedInterstitial=!1,extension.loadInterstitial=function(){return Cocoon.Ad.nativeAvailable?Cocoon.Ad.preloadedInterstitial?Cocoon.Ad.refreshInterstitial():(Cocoon.Ad.preloadedInterstitial=!0,Cocoon.callNative("IDTK_SRV_AD","preloadFullScreen",arguments,!0)):void 0},extension.setRectangle=function(){return Cocoon.Ad.nativeAvailable?Cocoon.callNative("IDTK_SRV_AD","setRectangle",arguments):void 0},extension.getRectangle=function(){return Cocoon.Ad.nativeAvailable?Cocoon.callNative("IDTK_SRV_AD","getRectangle",arguments):void 0},extension.setBannerLayout=function(){return Cocoon.Ad.nativeAvailable?Cocoon.callNative("IDTK_SRV_AD","setBannerLayout",arguments):void 0},extension.onBannerShown=new Cocoon.EventHandler("IDTK_SRV_AD","Ad","onbannershow"),extension.onBannerHidden=new Cocoon.EventHandler("IDTK_SRV_AD","Ad","onbannerhide"),extension.onBannerReady=new Cocoon.EventHandler("IDTK_SRV_AD","Ad","onbannerready"),extension.onFullScreenShown=new Cocoon.EventHandler("IDTK_SRV_AD","Ad","onfullscreenshow"),extension.onFullScreenHidden=new Cocoon.EventHandler("IDTK_SRV_AD","Ad","onfullscreenhide"),extension.onFullScreenReady=new Cocoon.EventHandler("IDTK_SRV_AD","Ad","onfullscreenready");var signal=new Cocoon.Signal.createSignal;signal.register("ready",extension.onBannerReady),signal.register("shown",extension.onBannerShown),signal.register("hidden",extension.onBannerHidden),extension.banner={},extension.banner.on=signal.expose();var signal=new Cocoon.Signal.createSignal;return signal.register("ready",extension.onFullScreenReady),signal.register("shown",extension.onFullScreenShown),signal.register("hidden",extension.onFullScreenHidden),extension.interstitial={},extension.interstitial.on=signal.expose(),extension}),Cocoon.define("Cocoon.Store",function(extension){"use strict";extension.nativeAvailable=!!Cocoon.nativeAvailable&&!!window.ext.IDTK_SRV_STORE,extension.ProductInfo={productId:"productId",productAlias:"productAlias",productType:"productType",title:"title",description:"description",price:"price",localizedPrice:"localizedPrice",downloadURL:"downloadURL"},extension.ProductType={CONSUMABLE:0,NON_CONSUMABLE:1,AUTO_RENEWABLE_SUBSCRIPTION:2,FREE_SUBSCRIPTION:3,NON_RENEWABLE_SUBSCRIPTION:4},extension.StoreType={APP_STORE:0,PLAY_STORE:1,MOCK_STORE:2,CHROME_STORE:3,AMAZON_STORE:4,NOOK_STORE:5},extension.PurchaseInfo=function(transactionId,purchaseTime,purchaseState,productId,quantity){return this.transactionId=transactionId,this.purchaseTime=purchaseTime,this.purchaseState=purchaseState,this.productId=productId,this.quantity=quantity,this},extension.PurchaseState={PURCHASED:0,CANCELED:1,REFUNDED:2,EXPIRED:3},extension.getStoreType=function(){return Cocoon.Store.nativeAvailable?Cocoon.callNative("IDTK_SRV_STORE","getStoreType",arguments):!1},extension.initialize=function(params){params=params||{};var properties={sandbox:!1,managed:!0},args=Cocoon.clone(properties,params);Cocoon.Store.requestInitialization({sandbox:args[0],managed:args[1]}),Cocoon.Store.start()},extension.requestInitialization=function(parameters){return"undefined"==typeof parameters?parameters={}:(void 0!==parameters.managed&&(parameters.remote=parameters.managed),void 0!==parameters.sandbox&&(parameters.debug=parameters.sandbox)),Cocoon.Store.nativeAvailable?Cocoon.callNative("IDTK_SRV_STORE","requestInitialization",arguments,!0):void 0},extension.start=function(){return Cocoon.Store.nativeAvailable?Cocoon.callNative("IDTK_SRV_STORE","start",arguments):void 0},extension.canPurchase=function(){return Cocoon.Store.nativeAvailable?Cocoon.callNative("IDTK_SRV_STORE","canPurchase",arguments):!1},extension.fetchProductsFromServer=function(){return Cocoon.Store.nativeAvailable?Cocoon.callNative("IDTK_SRV_STORE","fetchProductsFromServer",arguments,!0):void 0},extension.loadProducts=function(){return Cocoon.Store.nativeAvailable?Cocoon.callNative("IDTK_SRV_STORE","fetchProductsFromStore",arguments,!0):void 0},extension.finish=function(){return Cocoon.Store.nativeAvailable?Cocoon.callNative("IDTK_SRV_STORE","finishPurchase",arguments,!0):void 0},extension.consume=function(){return Cocoon.Store.nativeAvailable?Cocoon.callNative("IDTK_SRV_STORE","consumePurchase",arguments,!0):void 0},extension.purchase=function(){return Cocoon.Store.nativeAvailable?Cocoon.callNative("IDTK_SRV_STORE","purchaseFeature",arguments,!0):void 0},extension.puchaseProductModal=function(){return Cocoon.Store.nativeAvailable?Cocoon.callNative("IDTK_SRV_STORE","purchaseFeatureModal",arguments,!0):void 0},extension.purchaseProductModalWithPreview=function(){return Cocoon.Store.nativeAvailable?Cocoon.callNative("IDTK_SRV_STORE","purchaseFeatureModalWithPreview",arguments,!0):void 0},extension.isProductPurchased=function(){return Cocoon.Store.nativeAvailable?Cocoon.callNative("IDTK_SRV_STORE","isFeaturePurchased",arguments):void 0},extension.restore=function(){return Cocoon.Store.nativeAvailable?Cocoon.callNative("IDTK_SRV_STORE","restorePurchases",arguments,!0):void 0},extension.restorePurchasesModal=function(){return Cocoon.Store.nativeAvailable?Cocoon.callNative("IDTK_SRV_STORE","restorePurchasesModal",arguments,!0):void 0},extension.getProducts=function(){return Cocoon.Store.nativeAvailable?Cocoon.callNative("IDTK_SRV_STORE","getProducts",arguments):void 0},extension.addProduct=function(){return Cocoon.Store.nativeAvailable?Cocoon.callNative("IDTK_SRV_STORE","addProduct",arguments):void 0},extension.removeProduct=function(){return Cocoon.Store.nativeAvailable?Cocoon.callNative("IDTK_SRV_STORE","removeProduct",arguments):void 0},extension.getPurchases=function(){return Cocoon.Store.nativeAvailable?Cocoon.callNative("IDTK_SRV_STORE","getPurchases",arguments):void 0},extension.addPurchase=function(){return Cocoon.Store.nativeAvailable?Cocoon.callNative("IDTK_SRV_STORE","addPurchase",arguments):void 0},extension.removePurchase=function(){return Cocoon.Store.nativeAvailable?Cocoon.callNative("IDTK_SRV_STORE","removePurchase",arguments):void 0},extension.cancelPurchase=function(){return Cocoon.Store.nativeAvailable?Cocoon.callNative("IDTK_SRV_STORE","cancelPurchase",arguments):void 0},extension.refundPurchase=function(){return Cocoon.Store.nativeAvailable?Cocoon.callNative("IDTK_SRV_STORE","refundPurchase",arguments):void 0},extension.expirePurchase=function(){return Cocoon.Store.nativeAvailable?Cocoon.callNative("IDTK_SRV_STORE","expirePurchase",arguments):void 0},extension.onProductsFetchStarted=new Cocoon.EventHandler("IDTK_SRV_STORE","Store","onProductsFetchStarted"),extension.onProductsFetchCompleted=new Cocoon.EventHandler("IDTK_SRV_STORE","Store","onProductsFetchCompleted"),extension.onProductsFetchFailed=new Cocoon.EventHandler("IDTK_SRV_STORE","Store","onProductsFetchFailed"),extension.onProductPurchaseStarted=new Cocoon.EventHandler("IDTK_SRV_STORE","Store","onProductPurchaseStarted"),extension.onProductPurchaseVerificationRequestReceived=new Cocoon.EventHandler("IDTK_SRV_STORE","Store","onProductPurchaseVerificationRequestReceived"),extension.onProductPurchaseCompleted=new Cocoon.EventHandler("IDTK_SRV_STORE","Store","onProductPurchaseCompleted"),extension.onProductPurchaseFailed=new Cocoon.EventHandler("IDTK_SRV_STORE","Store","onProductPurchaseFailed"),extension.onRestorePurchasesStarted=new Cocoon.EventHandler("IDTK_SRV_STORE","Store","onRestorePurchasesStarted"),extension.onRestorePurchasesCompleted=new Cocoon.EventHandler("IDTK_SRV_STORE","Store","onRestorePurchasesCompleted"),extension.onRestorePurchasesFailed=new Cocoon.EventHandler("IDTK_SRV_STORE","Store","onRestorePurchasesFailed"),extension.onConsumePurchaseStarted=new Cocoon.EventHandler("IDTK_SRV_STORE","Store","onConsumePurchaseStarted"),extension.onConsumePurchaseCompleted=new Cocoon.EventHandler("IDTK_SRV_STORE","Store","onConsumePurchaseCompleted"),extension.onConsumePurchaseFailed=new Cocoon.EventHandler("IDTK_SRV_STORE","Store","onConsumePurchaseFailed");var signal=new Cocoon.Signal.createSignal;return signal.register("load",{started:extension.onProductsFetchStarted,success:extension.onProductsFetchCompleted,error:extension.onProductsFetchFailed}),signal.register("purchase",{started:extension.onProductPurchaseStarted,success:extension.onProductPurchaseCompleted,verification:extension.onProductPurchaseVerificationRequestReceived,error:extension.onProductPurchaseFailed}),signal.register("consume",{started:extension.onConsumePurchaseStarted,success:extension.onConsumePurchaseCompleted,error:extension.onConsumePurchaseFailed}),signal.register("restore",{started:extension.onRestorePurchasesStarted,success:extension.onRestorePurchasesCompleted,error:extension.onRestorePurchasesFailed}),extension.on=signal.expose(),extension}),Cocoon.define("Cocoon.Notification",function(extension){extension.nativeAvailable=!!window.ext&&!!window.ext.IDTK_SRV_NOTIFICATION,extension.Local={},extension.Push={},extension.Local.create=function(params){var properties={message:"",soundEnabled:!0,badgeNumber:0,userData:{},contentBody:"",contentTitle:"",date:(new Date).valueOf()+1e3},args=Cocoon.clone(properties,params);return Cocoon.Notification.nativeAvailable?Cocoon.callNative("IDTK_SRV_NOTIFICATION","createLocalNotification",args):void 0},extension.Push.create=function(params){var properties={message:"",soundEnabled:!0,badgeNumber:0,userData:{},channels:[],expirationTime:0,expirationTimeInterval:0};for(var prop in properties)params[prop]||(params[prop]=properties[prop]);return params},extension.start=function(){return Cocoon.Notification.nativeAvailable?Cocoon.callNative("IDTK_SRV_NOTIFICATION","start",arguments):void 0},extension.Push.register=function(){return Cocoon.Notification.nativeAvailable?Cocoon.callNative("IDTK_SRV_NOTIFICATION","registerForPushNotifications",arguments,!0):void 0},extension.Push.unregister=function(){return Cocoon.Notification.nativeAvailable?Cocoon.callNative("IDTK_SRV_NOTIFICATION","unregisterForPushNotifications",arguments,!0):void 0},extension.Local.cancel=function(){return Cocoon.Notification.nativeAvailable?Cocoon.callNative("IDTK_SRV_NOTIFICATION","cancelLocalNotification",arguments):void 0},extension.Local.cancelLast=function(){return Cocoon.Notification.nativeAvailable?Cocoon.callNative("IDTK_SRV_NOTIFICATION","cancelLocalNotification",arguments,!0):void 0},extension.Local.cancelAllNotifications=function(){return Cocoon.Notification.nativeAvailable?Cocoon.callNative("IDTK_SRV_NOTIFICATION","cancelAllLocalNotifications",arguments):void 0},extension.Local.send=function(){return Cocoon.Notification.nativeAvailable?Cocoon.callNative("IDTK_SRV_NOTIFICATION","sendLocalNotification",arguments,!0):void 0},extension.subscribe=function(){return Cocoon.Notification.nativeAvailable?Cocoon.callNative("IDTK_SRV_NOTIFICATION","subscribe",arguments,!0):void 0},extension.unsubscribe=function(){return Cocoon.Notification.nativeAvailable?Cocoon.callNative("IDTK_SRV_NOTIFICATION","unsubscribe",arguments,!0):void 0},extension.Push.send=function(){return Cocoon.Notification.nativeAvailable?Cocoon.callNative("IDTK_SRV_NOTIFICATION","sendPushNotification",arguments,!0):void 0},extension.setBadgeNumber=function(){return Cocoon.Notification.nativeAvailable?Cocoon.callNative("IDTK_SRV_NOTIFICATION","setBadgeNumber",arguments):void 0},extension.getBadgeNumber=function(){return Cocoon.Notification.nativeAvailable?Cocoon.callNative("IDTK_SRV_NOTIFICATION","getBadgeNumber",arguments):void 0},extension.Local.getLastNotificationData=function(){return Cocoon.Notification.nativeAvailable?Cocoon.callNative("IDTK_SRV_NOTIFICATION","getLastReceivedLocalNotificationData",arguments):void 0},extension.Push.getLastNotificationData=function(){return Cocoon.Notification.nativeAvailable?Cocoon.callNative("IDTK_SRV_NOTIFICATION","getLastReceivedPushNotificationData",arguments):void 0},extension.onRegisterForPushNotificationsSucceed=new Cocoon.EventHandler("IDTK_SRV_NOTIFICATION","Notification","pushNotificationServiceRegistered"),extension.onUnregisterForPushNotificationsSucceed=new Cocoon.EventHandler("IDTK_SRV_NOTIFICATION","Notification","pushNotificationServiceUnregistered"),extension.onRegisterForPushNotificationsFailed=new Cocoon.EventHandler("IDTK_SRV_NOTIFICATION","Notification","pushNotificationServiceFailedToRegister"),extension.onPushNotificationReceived=new Cocoon.EventHandler("IDTK_SRV_NOTIFICATION","Notification","pushNotificationReceived"),extension.onLocalNotificationReceived=new Cocoon.EventHandler("IDTK_SRV_NOTIFICATION","Notification","localNotificationReceived"),extension.onPushNotificationDeliverySucceed=new Cocoon.EventHandler("IDTK_SRV_NOTIFICATION","Notification","pushNotificationSuccessfullyDelivered"),extension.onPushNotificationDeliveryFailed=new Cocoon.EventHandler("IDTK_SRV_NOTIFICATION","Notification","pushNotificationDeliveryError");var signal=new Cocoon.Signal.createSignal;signal.register("notification",{received:extension.onLocalNotificationReceived}),extension.Local.on=signal.expose();var signal=new Cocoon.Signal.createSignal;return signal.register("register",{success:extension.onRegisterForPushNotificationsSucceed,unregister:extension.onUnregisterForPushNotificationsSucceed,error:extension.onRegisterForPushNotificationsFailed}),signal.register("notification",{received:extension.onPushNotificationReceived}),signal.register("deliver",{success:extension.onPushNotificationDeliverySucceed,error:extension.onPushNotificationDeliveryFailed}),extension.Push.on=signal.expose(),extension}),Cocoon.define("Cocoon.Social",function(extension){return extension.Interface=function(){this.onLoginStatusChanged=new Cocoon.EventHandler("","dummy","onLoginStatusChanged");var signal=new Cocoon.Signal.createSignal;return signal.register("loginStatusChanged",this.onLoginStatusChanged),this.on=signal.expose(),this},extension.Interface.prototype={isLoggedIn:function(){return!1},login:function(callback){callback&&callback(!1,{message:"Not implemented!"})},logout:function(callback){callback&&callback({message:"Not implemented!"})},getLoggedInUser:function(){return null},hasPublishPermissions:function(callback){callback(!0)},requestPublishPermissions:function(callback){callback&&callback(!0,null)},requestUser:function(callback){callback(null,{message:"Not implemented!"})},requestUserImage:function(callback){callback("",{message:"Not implemented!"})},requestFriends:function(callback){callback([],{message:"Not implemented!"})},publishMessage:function(message,callback){callback({message:"Not implemented!"})},publishMessageWithDialog:function(message,callback){callback({message:"Not implemented!"})}},extension.SocialGamingService=function(){return Cocoon.Social.SocialGamingService.superclass.constructor.call(this),this},extension.SocialGamingService.prototype={_cachedAchievements:null,_achievementsMap:null,_leaderboardsTemplate:null,_achievementsTemplate:null,requestScore:function(callback){callback(null,{message:"Not implemented!"})},submitScore:function(score,callback){callback&&callback({message:"Not implemented!"})},showLeaderboard:function(callback){callback&&callback({message:"Not implemented!"})},requestAllAchievements:function(callback){callback([],{message:"Not implemented!"})},requestAchievements:function(callback){callback([],{message:"Not implemented!"})},submitAchievement:function(achievementID,callback){callback&&callback({message:"Not implemented!"})},resetAchievements:function(callback){callback&&callback([],{message:"Not implemented!"})},showAchievements:function(callback){if(!this._achievementsTemplate)throw"Please, provide a html template for achievements with the setTemplates method";var dialog=new Cocoon.Widget.WebDialog,callbackSent=!1;dialog.show(this._achievementsTemplate,function(error){dialog.closed=!0,!callbackSent&&callback&&callback(error)});var me=this;this.requestAchievements(function(achievements,error){if(!dialog.closed){if(error)return callbackSent=!0,void(callback&&callback(error));var achs=[];if(me._cachedAchievements)for(var i=0;i<me._cachedAchievements.length;++i){var ach=me._cachedAchievements[i];if(achs.push(ach),achievements&&achievements.length)for(var j=0;j<achievements.length;++j)if(achievements[j].achievementID===ach.achievementID){ach.achieved=!0;break}}var js="addAchievements("+JSON.stringify(achs)+");";dialog.eval(js)}})},setAchievementsMap:function(map){this._achievementsMap=map,this._cachedAchievements&&this.syncAchievementsMap(this._cachedAchievements)},setTemplates:function(leaderboardsTemplate,achievementsTemplate){this._leaderboardsTemplate=leaderboardsTemplate,this._achievementsTemplate=achievementsTemplate},setCachedAchievements:function(achievements){this._cachedAchievements=achievements,achievements&&this._achievementsMap&&this.syncAchievementsMap(this._cachedAchievements)},findAchievement:function(id){if(!this._cachedAchievements)return null;for(var i=0;i<this._cachedAchievements.length;++i)if(id===this._cachedAchievements[i].achievementID)return this._cachedAchievements[i];return null},translateAchievementID:function(id){if(this._achievementsMap)for(var customID in this._achievementsMap)if(customID==id)return this._achievementsMap[customID];return id},syncAchievementsMap:function(achievements){if(this._achievementsMap)for(var i=0;i<achievements.length;++i)for(var customID in this._achievementsMap)this._achievementsMap[customID]===achievements[i].achievementID&&(achievements[i].customID=customID)}},Cocoon.extend(extension.SocialGamingService,extension.Interface),extension.ImageSize={THUMB:"thumb",SMALL:"small",MEDIUM:"medium",LARGE:"large"},extension.User=function(userID,userName,userImage){return this.userID=userID,this.userName=userName,this.userImage=userImage,this},extension.Message=function(message,mediaURL,linkURL,linkText,linkCaption){return this.message=message,this.mediaURL=mediaURL,this.linkURL=linkURL,this.linkText=linkText,this.linkCaption=linkCaption,this
},extension.Score=function(userID,score,userName,imageURL,leaderboardID){return this.userID=userID,this.score=score||0,this.userName=userName,this.imageURL=imageURL,this.leaderboardID=leaderboardID,this},extension.ScoreParams=function(userID,leaderboardID,friends,timeScope){this.userID=userID,this.leaderboardID=leaderboardID,this.friends=!!friends,this.timeScope=timeScope||2},extension.TimeScope={ALL_TIME:0,WEEK:1,TODAY:2},extension.Achievement=function(achievementID,title,description,imageURL,points){return this.achievementID=achievementID,this.customID=achievementID,this.title=title,this.description=description,this.imageURL=imageURL,this.points=points||0,this},extension.share=function(){return Cocoon.nativeAvailable?Cocoon.callNative("IDTK_APP","share",arguments,!0):void 0},extension}),Cocoon.define("Cocoon.Social",function(extension){return extension.ManagerService=function(){this.services=[]},extension.ManagerService.prototype={services:null,registerSocialService:function(service){this.services.push(service)},submitAchievement:function(achievementID){for(var i=0;i<this.services.length;++i){var service=this.services[i];!service.readOnlyHint&&service.isLoggedIn()&&service.submitAchievement(achievementID,function(error){error&&console.error("Error submitting achievement: "+error.message)})}},submitScore:function(score,params){for(var i=0;i<this.services.length;++i){var service=this.services[i];!service.readOnlyHint&&service.isLoggedIn()&&service.submitScore(score,function(error){error&&console.error("Error submitting score: "+error.message)},params)}},getLoggedInServices:function(){for(var result=[],i=0;i<this.services.length;++i){var service=this.services[i];!service.fakeSocialService&&service.isLoggedIn()&&result.push(service)}return result},isLoggedInAnySocialService:function(){return this.getLoggedInServices().length>0}},extension.Manager=new extension.ManagerService,extension}),Cocoon.define("Cocoon.Social",function(extension){return extension.LocalStorageService=function(){Cocoon.Social.LocalStorageService.superclass.constructor.call(this),this.fakeSocialService=!0},extension.LocalStorageService.prototype={loggedIn:!1,keys:{score:"Cocoon.Social.LocalStorageService.score",earnedAchievements:"Cocoon.Social.LocalStorageService.earned"},isLoggedIn:function(){return this.loggedIn},login:function(callback){this.loggedIn||this.onLoginStatusChanged.notifyEventListeners(!0),this.loggedIn=!0,callback&&setTimeout(function(){callback(!0)},0)},logout:function(callback){this.loggedIn&&this.onLoginStatusChanged.notifyEventListeners(!0),this.loggedIn=!1,callback&&setTimeout(function(){callback()},0)},getLoggedInUser:function(){return new Cocoon.Social.User("me","LocalStorage")},requestUser:function(callback,userID){var user=new Cocoon.Social.User(userID||"me","LocalStorage");callback&&setTimeout(function(){callback(user)},0)},requestScore:function(callback){var scoreItem=localStorage.getItem(this.keys.score),score=parseInt(scoreItem)||0;setTimeout(function(){callback(new Cocoon.Social.Score("me",score))},0)},submitScore:function(score,callback){var scoreItem=localStorage.getItem(this.keys.score),topScore=parseInt(scoreItem)||0;score>topScore&&localStorage.setItem(this.keys.score,score),callback&&setTimeout(function(){callback()},0)},getLocalStorageEarnedAchievements:function(){var achievementsItem=localStorage.getItem(this.keys.earnedAchievements),earned=[];if(achievementsItem){var array=JSON.stringify(achievementsItem);array&&array.length&&(earned=array)}return earned},requestAchievements:function(callback){var earned=this.getLocalStorageEarnedAchievements();setTimeout(function(){callback(earned)},0)},submitAchievement:function(achievementID,callback){if(null===achievementID||"undefined"==typeof achievementID)throw"No achievementID specified";for(var earned=this.getLocalStorageEarnedAchievements(),exists=!1,i=0;i<earned.length;++i)if(earned[i]===achievementID){exists=!0;break}exists||(earned.push(achievementID),localStorage.setItem(this.keys.earnedAchievements,JSON.stringify(earned))),callback&&setTimeout(function(){callback()},0)},resetAchievements:function(callback){localStorage.removeItem(this.keys.earnedAchievements),callback&&setTimeout(function(){callback()},0)}},Cocoon.extend(extension.LocalStorageService,extension.SocialGamingService),extension.LocalStorage=new extension.LocalStorageService,extension}),Cocoon.define("Cocoon.Social",function(extension){function fromSessionToAuthTokenObject(response,error){return{access_token:response.access_token,state:response.state,error:error,expires_in:response.expirationDate?response.expirationDate-Date.now():0,player_id:response.playerId}}function fromGPPlayerToCocoonUser(gpPlayer){return new Cocoon.Social.User(gpPlayer.playerId,gpPlayer.displayName,gpPlayer.avatarImageUrl)}function fromGPPersonToCocoonUser(gpUser){var avatar=gpUser.image?gpUser.image.url:"";return avatar=avatar.replace(/sz=\d+/g,"sz=100"),new Cocoon.Social.User(gpUser.id,gpUser.displayName,avatar)}function fromImageSizeToGPSize(imageSize){return imageSize===Cocoon.Social.ImageSize.THUMB?100:imageSize===Cocoon.Social.ImageSize.MEDIUM?200:imageSize===Cocoon.Social.ImageSize.LARGE?512:void 0}function fromGPAchievementToCocoonAchievement(gpItem){var result=new Cocoon.Social.Achievement(gpItem.id,gpItem.name,gpItem.description,gpItem.revealedIconUrl,0);return result.gpAchievementData=gpItem,result}function fromGPScoreToCocoonScore(gpItem,leaderboardID){return new Cocoon.Social.Score(gpItem.player.playerId,gpItem.scoreValue,gpItem.player.displayName,gpItem.player.avatarImageUrl,leaderboardID)}return extension.GooglePlayGamesExtension=function(){this.nativeExtensionName="IDTK_SRV_GOOGLE_PLAY_GAMES",this.extensionName="Social.GooglePlayGames",this.nativeAvailable=Cocoon.nativeAvailable&&"undefined"!=typeof window.ext[this.nativeExtensionName],this.auth=new Cocoon.Social.GooglePlayGamesAuthExtension(this),this.client=new Cocoon.Social.GooglePlayGamesClientExtension(this),this.defaultScopes=["https://www.googleapis.com/auth/games","https://www.googleapis.com/auth/plus.login"],this.gamesAPI="/games/v1",this.plusAPI="/plus/v1",this.onSessionChanged=new Cocoon.EventHandler(this.nativeExtensionName,this.extensionName,"onSessionChanged"),Cocoon.Social.GooglePlayGames=this;var me=this;return this.onSessionChanged.addEventListener(function(session,error){me.token=fromSessionToAuthTokenObject(session,error),session&&session.access_token&&me.client.request({path:me.gamesAPI+"/players/me",callback:function(response){me.currentPlayer=response}})}),this},extension.GooglePlayGamesExtension.prototype={token:null,settings:{},socialService:null,currentPlayer:null,initialized:!1,auth:null,client:null,init:function(params){if(!params||"object"!=typeof params)throw"Invalid params argument";if(this.settings=params,this.initialized=!0,this.nativeAvailable)Cocoon.callNative(this.nativeExtensionName,"init",[this.settings.clientId],!0);else{var me=this,initWebAPi=function(){gapi.auth.authorize({immediate:!0,scope:me.defaultScopes,client_id:me.settings.clientId},function(response){me.token=response,response&&response.access_token&&me.onSessionChanged.notifyEventListeners(response)})};if(window.gapi)initWebAPi();else{window.onGapiLoadCallback=function(){window.setTimeout(initWebAPi,1)};var script=document.createElement("script");script.src="https://apis.google.com/js/client.js?onload=onGapiLoadCallback",document.getElementsByTagName("head")[0].appendChild(script)}}},getSocialInterface:function(){if(!this.initialized)throw"You must call init() before getting the Social Interface";return this.socialService||(this.socialService=new Cocoon.Social.SocialGamingServiceGooglePlayGames(this)),this.socialService},getMultiplayerInterface:function(){return Cocoon.Multiplayer.GooglePlayGames},share:function(){return window.open(this.href,"","menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600"),!1}},extension.GooglePlayGamesAuthExtension=function(extension){return this.extension=extension,this},extension.GooglePlayGamesAuthExtension.prototype={authorize:function(params,callback){var me=this;this.extension.nativeAvailable?Cocoon.callNative(this.extension.nativeExtensionName,"authorize",[params,function(response,error){me.extension.token=fromSessionToAuthTokenObject(response,error),callback&&callback(me.extension.token)}],!0):gapi.auth.authorize(params,function(response){me.extension.token=response,me.extension.onSessionChanged.notifyEventListeners(response,response?response.error:null),callback&&callback(response)})},disconnect:function(callback){this.extension.nativeAvailable?Cocoon.callNative(this.extension.nativeExtensionName,"disconnect",[callback],!0):callback&&callback({error:"Not implemented yet"})},init:function(callback){this.extension.nativeAvailable?callback():gapi.auth.init(callback)},getToken:function(){return this.extension.nativeAvailable?this.extension.token:gapi.auth.getToken()},setToken:function(token){this.extension.nativeAvailable?this.extension.token=token:gapi.auth.setToken(token)}},extension.GooglePlayGamesClientExtension=function(extension){return this.extension=extension,this},extension.GooglePlayGamesClientExtension.prototype={setApiKey:function(apiKey){this.extension.nativeAvailable?Cocoon.callNative(this.extension.nativeExtensionName,"setApiKey",[apiKey],!0):gapi.client.setApiKey(apiKey)},request:function(args){if(this.extension.nativeAvailable){if(args.callback)return Cocoon.callNative(this.extension.nativeExtensionName,"request",[args,function(response,error){var result=response;error&&(result=response||{},result.error=error),args.callback(result)}],!0),null;var me=this,httpRequest={execute:function(callback){Cocoon.callNative(me.extension.nativeExtensionName,"request",[args,function(response,error){var result=response;error&&(result=response||{},result.error=error),callback(result)}],!0)}};return httpRequest}return gapi.client.request(args)}},extension.GooglePlayGames=new Cocoon.Social.GooglePlayGamesExtension,extension.SocialGamingServiceGooglePlayGames=function(apiObject){Cocoon.Social.SocialGamingServiceGooglePlayGames.superclass.constructor.call(this),this.gapi=apiObject;var me=this;return this.gapi.onSessionChanged.addEventListener(function(session){var obj=session||{};me.onLoginStatusChanged.notifyEventListeners(!!obj.access_token,obj.error)}),this},extension.SocialGamingServiceGooglePlayGames.prototype={isLoggedIn:function(){return this.gapi.token&&this.gapi.token.access_token?!0:!1},login:function(callback){var me=this;this.gapi.auth.authorize({client_id:this.gapi.settings.clientId,scope:this.gapi.defaultScopes},function(response){callback&&callback(me.isLoggedIn(),response.error)})},logout:function(callback){this.gapi.auth.disconnect(callback)},getLoggedInUser:function(){return this.gapi.currentPlayer?fromGPUserToCocoonUser(this.gapi.currentPlayer):null},requestUser:function(callback,userId){var playerId=userId||"me";this.gapi.client.request({path:this.gapi.gamesAPI+"/players/"+playerId,callback:function(response){var user=response&&!response.error?fromGPPlayerToCocoonUser(response):null;callback(user,response.error)}})},requestUserImage:function(callback,userID,imageSize){this.requestUser(function(user,error){if(user&&user.userImage){var pixelSize=fromImageSizeToGPSize(imageSize||Cocoon.Social.ImageSize.MEDIUM);-1===user.userImage.indexOf("sz=")?user.userImage+="?sz="+pixelSize:user.userImage=user.userImage.replace(/sz=\d+/g,"sz="+pixelSize)}callback(user?user.userImage:null,error)},userID)},requestFriends:function(callback,userId){var params={orderBy:"best"},playerId=userId||"me";this.gapi.client.request({path:this.gapi.plusAPI+"/people/"+playerId+"/people/visible",params:params,callback:function(response){if(response&&!response.error){for(var friends=[],i=0;i<response.items.length;++i)friends.push(fromGPPersonToCocoonUser(response.items[i]));callback(friends)}else callback([],response?response.error:null)}})},publishMessage:function(message,callback){callback&&callback("Not supported... use publishMessageWithDialog method instead")},publishMessageWithDialog:function(message,callback){if(this.gapi.nativeAvailable){var params={prefilledText:message.message,mediaUrl:message.mediaURL,mediaTitle:message.linkCaption,mediaDescription:message.linkText,url:message.linkURL};Cocoon.callNative(this.gapi.nativeExtensionName,"shareMessage",[params,callback],!0)}else{var me=this,share=function(){var options={contenturl:"https://plus.google.com/pages/",contentdeeplinkid:"/pages",clientid:me.gapi.settings.clientId,cookiepolicy:"single_host_origin",prefilltext:message.message,calltoactionlabel:"CREATE",calltoactionurl:"http://plus.google.com/pages/create",calltoactiondeeplinkid:"/pages/create"};gapi.interactivepost.render("sharePost",options)};if(gapi.interactivepost)share();else{var script=document.createElement("script");script.type="text/javascript",script.async=!0,script.src="https://apis.google.com/js/plusone.js",script.onload=function(){share()},document.getElementsByTagName("head")[0].appendChild(script)}}},requestScore:function(callback,params){params=params||{};var playerId=params.userID||"me",leaderboardID=params.leaderboardID||this.gapi.settings.defaultLeaderboard;if(!leaderboardID)throw"leaderboardID not provided in the params. You can also set the default leaderboard in the init method";this.gapi.client.request({path:this.gapi.gamesAPI+"/players/"+playerId+"/leaderboards/"+leaderboardID+"/scores/ALL_TIME",callback:function(response){if(response&&response.error)callback(null,response.error);else if(response&&response.items&&response.items.length>0){var item=response.items[0],data=new Cocoon.Social.Score(playerId,item.scoreValue,"","",item.leaderboard_id);callback(data,null)}else callback(null,null)}})},submitScore:function(score,callback,params){params=params||{};var leaderboardID=params.leaderboardID||this.gapi.settings.defaultLeaderboard;if(!leaderboardID)throw"leaderboardID not provided in the params. You can also set the default leaderboard in the init method";this.gapi.client.request({path:this.gapi.gamesAPI+"/leaderboards/"+leaderboardID+"/scores",method:"POST",params:{score:score},callback:function(response){callback&&callback(response?response.error:null)}})},showLeaderboard:function(callback,params){params=params||{};var leaderboardID=params.leaderboardID||this.gapi.settings.defaultLeaderboard;if(!leaderboardID)throw"leaderboardID not provided in the params. You can also set the default leaderboard in the init method";var ios=/(iPad|iPhone|iPod)/gi.test(navigator.userAgent);if(!ios&&this.gapi.nativeAvailable){var timeScope=params.timeScope||0;Cocoon.callNative(this.gapi.nativeExtensionName,"showLeaderboard",[leaderboardID,timeScope,callback],!0)}else{if(!this._leaderboardsTemplate)throw"Please, provide a html template for leaderboards with the setTemplates method";var dialog=new Cocoon.Widget.WebDialog,callbackSent=!1;dialog.show(this._leaderboardsTemplate,function(error){dialog.closed=!0,!callbackSent&&callback&&callback(error)});var collection=params.friends?"SOCIAL":"PUBLIC",timeSpan="ALL_TIME";params.timeScope===Cocoon.Social.TimeScope.WEEK?timeSpan="WEEKLY":params.timeScope===Cocoon.Social.TimeScope.TODAY&&(timeSpan="DAILY"),this.gapi.client.request({path:this.gapi.gamesAPI+"/leaderboards/"+leaderboardID+"/window/"+collection,method:"GET",params:{timeSpan:timeSpan},callback:function(response){if(!dialog.closed){if(response.error)return void(callback&&(callbackSent=!0,callback(response.error),dialog.close()));var scores=[],items=[];response&&response.items&&(items=response.items.slice(0)),response&&response.playerScore&&items.push(response.playerScore);for(var i=0;i<items.length;++i){var item=items[i],score=fromGPScoreToCocoonScore(item,leaderboardID);score.imageURL+="?sz=50",score.position=item.scoreRank||i+1,score.me=!1,scores.push(score)}var js="addScores("+JSON.stringify(scores)+")";dialog.eval(js)}}})}},prepareAchievements:function(reload,callback){if(!this._cachedAchievements||reload){var me=this;this.gapi.client.request({path:this.gapi.gamesAPI+"/achievements",callback:function(response){if(response&&!response.error){var achievements=[];if(response&&response.items)for(var i=0;i<response.items.length;i++)achievements.push(fromGPAchievementToCocoonAchievement(response.items[i]));me.setCachedAchievements(achievements),callback(achievements,null)}else callback([],response?response.error:null)}})}else callback(this._cachedAchievements,null)},requestAllAchievements:function(callback){this.prepareAchievements(!0,callback)},requestAchievements:function(callback,userID){var me=this;this.prepareAchievements(!1,function(allAchievements,error){if(error)return void callback([],error);var playerID=userID||"me";me.gapi.client.request({path:me.gapi.gamesAPI+"/players/"+playerID+"/achievements",params:{state:"UNLOCKED"},callback:function(response){if(response&&!response.error){var achievements=[];if(response.items)for(var i=0;i<response.items.length;i++){var ach=me.findAchievement(response.items[i].id);ach&&achievements.push(ach)}callback(achievements,null)}else callback([],response?response.error:null)}})})},submitAchievement:function(achievementID,callback){if(null===achievementID||"undefined"==typeof achievementID)throw"No achievementID specified";var achID=this.translateAchievementID(achievementID);if(this.gapi.nativeAvailable){var showNotification=!!this.gapi.settings.showAchievementNotifications;Cocoon.callNative(this.gapi.nativeExtensionName,"unlockAchievement",[achID,showNotification,callback],!0)}else this.gapi.client.request({path:this.gapi.gamesAPI+"/achievements/"+achID+"/unlock",method:"POST",callback:function(response){callback&&callback(response?response.error:null)}})},resetAchievements:function(callback){this.gapi.client.request({path:"/games/v1management/achievements/reset",method:"POST",callback:function(response){callback&&callback(response?response.error:null)}})},showAchievements:function(callback){var ios=/(iPad|iPhone|iPod)/gi.test(navigator.userAgent);!ios&&this.gapi.nativeAvailable?Cocoon.callNative(this.gapi.nativeExtensionName,"showAchievements",[callback],!0):Cocoon.Social.SocialGamingServiceGooglePlayGames.superclass.showAchievements.call(this)}},Cocoon.extend(Cocoon.Social.SocialGamingServiceGooglePlayGames,Cocoon.Social.SocialGamingService),extension}),Cocoon.define("Cocoon.Social",function(extension){function fromGCPLayerToCocoonUser(player){return new Cocoon.Social.User(player.playerID,player.alias)}function fromGCAchievementDescriptionToCocoonAchievement(ach){return new Cocoon.Social.GameCenter.Achievement(ach.identifier,ach.title,ach.achievedDescription,"",ach.maximumPoints)}return extension.GameCenterExtension=function(){this.nativeExtensionName="IDTK_SRV_GAMECENTER",this.extensionName="Social.GameCenter",this.nativeAvailable=!!window.ext&&!!window.ext[this.nativeExtensionName];var me=this;return this.nativeAvailable&&(this.onGameCenterLoginStateChanged=new Cocoon.EventHandler(this.nativeExtensionName,this.extensionName,"onGameCenterLoginStateChanged"),this.onGameCenterLoginStateChanged.addEventListener(function(localPlayer){me._currentPlayer=localPlayer})),this},extension.GameCenterExtension.prototype={_currentPlayer:null,getSocialInterface:function(){return this._socialService||(this._socialService=new Cocoon.Social.SocialGamingServiceGameCenter(this)),this._socialService},getMultiplayerInterface:function(){return Cocoon.Multiplayer.GameCenter},isLoggedIn:function(){return this._currentPlayer&&this._currentPlayer.isAuthenticated},login:function(callback){var me=this;if(!this.nativeAvailable)throw"Game Center not available";Cocoon.callNative(this.nativeExtensionName,"login",[function(response,error){me._currentPlayer=response,callback&&callback(response,error)}],!0)},getLocalPlayer:function(){if(this._currentPlayer)return this._currentPlayer;if(this.nativeAvailable)return this._currentPlayer=Cocoon.callNative(this.nativeExtensionName,"getLocalPlayer",[]),this._currentPlayer;throw"Game Center not available"},loadPlayers:function(playerIDs,callback){if(!this.nativeAvailable)throw"Game Center not available";Cocoon.callNative(this.nativeExtensionName,"loadPlayers",[playerIDs,callback],!0)},loadFriends:function(callback){if(!this.nativeAvailable)throw"Game Center not available";Cocoon.callNative(this.nativeExtensionName,"loadFriends",[callback],!0)},loadAchievements:function(callback){if(!this.nativeAvailable)throw"Game Center not available";Cocoon.callNative(this.nativeExtensionName,"loadAchievements",[callback],!0)},loadAchievementDescriptions:function(callback){if(!this.nativeAvailable)throw"Game Center not available";Cocoon.callNative(this.nativeExtensionName,"loadAchievementDescriptions",[callback],!0)},loadScores:function(callback,query){if(!this.nativeAvailable)throw"Game Center not available";Cocoon.callNative(this.nativeExtensionName,"loadScores",[query,callback],!0)},submitScore:function(score,callback){if(!this.nativeAvailable)throw"Game Center not available";Cocoon.callNative(this.nativeExtensionName,"submitScore",[score,callback],!0)},submitAchievements:function(achievements,callback){if(!this.nativeAvailable)throw"Game Center not available";Cocoon.callNative(this.nativeExtensionName,"submitAchievements",[achievements,callback],!0)},resetAchievements:function(callback){if(!this.nativeAvailable)throw"Game Center not available";Cocoon.callNative(this.nativeExtensionName,"resetAchievements",[callback],!0)},showAchievements:function(callback){if(!this.nativeAvailable)throw"Game Center not available";Cocoon.callNative(this.nativeExtensionName,"showAchievements",[callback],!0)},showLeaderboards:function(callback,query){if(!this.nativeAvailable)throw"Game Center not available";Cocoon.callNative(this.nativeExtensionName,"showLeaderboards",[query,callback],!0)}},extension.GameCenter=new extension.GameCenterExtension,extension.GameCenter.Player=function(){this.playerID="",this.alias="",this.isFriend=!1},extension.GameCenter.LocalPlayer=function(){this.playerID="",this.alias="",this.isAuthenticated=!1},extension.GameCenter.Achievement=function(identifier,percentComplete){this.identifier=identifier,this.percentComplete=percentComplete,this.lastReportedDate=0},extension.GameCenter.AchievementDescription=function(){this.identifier="",this.title="",this.achievedDescription="",this.unachievedDescription="",this.maximumPoints=0},extension.GameCenter.Score=function(userID,score,userName,imageURL,leaderboardID,originalScoreObject){return this.userID=userID,this.score=score||0,this.userName=userName,this.imageURL=imageURL,this.leaderboardID=leaderboardID,this.rank=originalScoreObject.rank,this.originalScoreObject=originalScoreObject,this},extension.GameCenter.Leaderboard=function(category,playerIDs,timeScope,playerScope,rangeStart,rangeLength){this.category=category,this.playerIDs=playerIDs,this.timeScope=timeScope,this.playerScope=playerScope,this.rangeStart=rangeStart,this.rangeLength=rangeLength,this.scores=[],this.localPlayerScore=[],this.localizedTitle=localizedTitle},extension.GameCenter.TimeScope={TODAY:0,WEEK:1,ALL_TIME:2},extension.GameCenter.PlayerScope={GLOBAL:0,FRIENDS:1},extension.SocialGamingServiceGameCenter=function(gcExtension){Cocoon.Social.SocialGamingServiceGameCenter.superclass.constructor.call(this),this.gc=gcExtension;var me=this;return this.gc.onGameCenterLoginStateChanged.addEventListener(function(localPlayer,error){me.onLoginStatusChanged.notifyEventListeners(localPlayer.isAuthenticated,error)}),this},extension.SocialGamingServiceGameCenter.prototype={_cachedAchievements:null,isLoggedIn:function(){return this.gc.isLoggedIn()},login:function(callback){this.gc.login(function(localPlayer,error){callback&&callback(localPlayer.isAuthenticated,error)})},logout:function(callback){callback&&callback({message:"User has to logout from the Game Center APP"})},getLoggedInUser:function(){return fromGCPLayerToCocoonUser(this.gc._currentPlayer?this.gc._currentPlayer:this.gc.getLocalPlayer())},requestUser:function(callback,userId){if(userId)this.gc.loadPlayers([userId],function(response,error){var user=response&&response.length?fromGCPLayerToCocoonUser(response[0]):null;callback(user,error)});else{var me=this;setTimeout(function(){callback(me.getLoggedInUser())})}},requestFriends:function(callback){this.gc.loadFriends(function(friends,error){var users=[];if(friends&&friends.length)for(var i=0;i<friends.length;++i)users.push(fromGCPLayerToCocoonUser(friends[i]));callback(users,error)})},requestScore:function(callback,params){var query={},options=params||{};options.leaderboardID&&(query.category=options.leaderboardID),query.playerIDs=[options.userID||this.getLoggedInUser().userID],this.gc.loadScores(function(response,error){var gcScore=null;options.userID&&response&&response.scores&&response.scores.length?gcScore=response.scores[0]:response&&response.localPlayerScore&&(gcScore=response.localPlayerScore);var loadedScore=gcScore?new Cocoon.Social.GameCenter.Score(gcScore.playerID,gcScore.value,"","",gcScore.category,gcScore):null;callback(loadedScore,error)},query)},submitScore:function(score,callback,params){var options=params||{};this.gc.submitScore({value:score,category:options.leaderboardID||""},function(error){callback&&callback(error)})},showLeaderboard:function(callback,params){var options=params||{};this.gc.showLeaderboards(function(error){callback&&callback(error)},{category:options.leaderboardID||""})},prepareAchievements:function(reload,callback){if(!this._cachedAchievements||reload){var me=this;this.gc.loadAchievementDescriptions(function(response,error){if(error)callback([],error);else{var achievements=[];if(response&&response.length)for(var i=0;i<response.length;i++)achievements.push(fromGCAchievementDescriptionToCocoonAchievement(response[i]));me.setCachedAchievements(achievements),callback(achievements,null)}})}else callback(this._cachedAchievements,null)},requestAllAchievements:function(callback){this.prepareAchievements(!0,callback)},requestAchievements:function(callback){var me=this;this.prepareAchievements(!1,function(allAchievements,error){return error?void callback([],error):void me.gc.loadAchievements(function(response,error){if(error)callback([],response.error);else{var achievements=[];if(response&&response.length)for(var i=0;i<response.length;i++){var ach=me.findAchievement(response[i].identifier);ach&&achievements.push(ach)}callback(achievements,null)}})})},submitAchievement:function(achievementID,callback){if(null===achievementID||"undefined"==typeof achievementID)throw"No achievementID specified";var achID=this.translateAchievementID(achievementID);this.gc.submitAchievements([{identifier:achID,percentComplete:100}],callback)},resetAchievements:function(callback){this.gc.resetAchievements(callback)},showAchievements:function(callback){this.gc.showAchievements(function(error){callback&&callback(error)})}},Cocoon.extend(extension.SocialGamingServiceGameCenter,extension.SocialGamingService),extension}),Cocoon.define("Cocoon.Social",function(extension){function fromCocoonFBStatusToFBAPIState(state){return 0===state?"connected":1===state?"not_authorized":"unknown"}function fromCocoonFBSessionToFBAPISession(response,error){var authResponse=null;return 0===response.state&&(authResponse={accessToken:response.accessToken,expirationDate:response.expirationDate,userID:response.user?response.userID:null,permissions:response.permissions,user:response.user}),{status:fromCocoonFBStatusToFBAPIState(response.state),authResponse:authResponse,error:error}}function fromFBUserToCocoonUser(facebookUser){return new Cocoon.Social.User(facebookUser.id,facebookUser.username?facebookUser.username:facebookUser.first_name+" "+facebookUser.last_name)}function fromCocoonMessageToFBMessage(message){return{link:message.linkURL,description:message.message,name:message.linkText,caption:message.linkCaption,picture:message.mediaURL}}function fromFBScoreToCocoonScore(fbResponse,requestScoreParams){var result=new Cocoon.Social.Score(fbResponse.user.id,fbResponse.score,fbResponse.user.name);return requestScoreParams&&(result.leaderboardID=requestScoreParams.leaderboardID),result.imageURL="https://graph.facebook.com/"+fbResponse.user.id+"/picture",result}function fromFBAchievementToCocoonAchievement(fbResponse){var result=new Cocoon.Social.Achievement(fbResponse.id,fbResponse.title,fbResponse.description,fbResponse.image[0].url,fbResponse.data.points);return result.fbAchievementData=fbResponse,result}if(extension.FacebookExtension=function(){this.nativeExtensionName="IDTK_SRV_FACEBOOK",this.extensionName="Social.Facebook",this.nativeAvailable=!!window.ext&&!!window.ext[this.nativeExtensionName],this.Event=new Cocoon.Social.FacebookEvent(this.nativeAvailable);var me=this;return this.nativeAvailable&&(this.onFacebookSessionStateChanged=new Cocoon.EventHandler(this.nativeExtensionName,this.extensionName,"onFacebookSessionStateChanged"),Cocoon.Social.Facebook=this,this.onFacebookSessionStateChanged.addEventListener(function(session,error){var data=fromCocoonFBSessionToFBAPISession(session,error);0==session.state&&me.Event.notify("auth.login",data),me.Event.notify("auth.authResponseChange",data),me.Event.notify("auth.statusChange",data)})),this},extension.FacebookExtension.prototype={_currentSession:null,_appId:null,_socialService:null,init:function(options){if(!options||!options.appId)throw"appId must be specified!";this._appId=options.appId,this.nativeAvailable?Cocoon.callNative(this.nativeExtensionName,"init",[options],!0):FB.init(options);var me=this;this.Event.subscribe("auth.authResponseChange",function(session){me._currentSession=session,session.authResponse&&!session.authResponse.user&&me.api("me?fields=username",function(response){me._currentSession.authResponse.user=response})})},getSocialInterface:function(){if(!this._appId)throw"You must call init() before getting the Social Interface";return this._socialService||(this._socialService=new Cocoon.Social.SocialGamingServiceFacebook(this)),this._socialService},login:function(callback,options){var me=this;this.nativeAvailable?Cocoon.callNative(this.nativeExtensionName,"login",[options,function(response,error){me._currentSession=fromCocoonFBSessionToFBAPISession(response,error),callback&&callback(me._currentSession)}],!0):FB.login(function(response){me._currentSession=response,callback&&callback(response)},options)},logout:function(callback){this.nativeAvailable?Cocoon.callNative(this.nativeExtensionName,"logout",[function(response,error){callback&&callback(fromCocoonFBSessionToFBAPISession(response,error))}],!0):FB.logout(function(response){callback&&callback(response)})},getAuthResponse:function(){if(this.nativeAvailable){var response=Cocoon.callNative(this.nativeExtensionName,"getFacebookSession",[]);return fromCocoonFBSessionToFBAPISession(response)}return FB.getAuthResponse()},getLoginStatus:function(callback,force){if(this.nativeAvailable){var me=this;setTimeout(function(){var response=Cocoon.callNative(me.nativeExtensionName,"getFacebookSession",[]);callback&&callback(fromCocoonFBSessionToFBAPISession(response))},50)}else FB.getLoginStatus(callback,force)},api:function(path,method,params,cb){if(this.nativeAvailable){var openGraph=arguments[0],httpMethod=arguments.length>3?arguments[1]:"GET",options=null;3==arguments.length&&(options=arguments[1]),4==arguments.length&&(options=arguments[2]);var callback=arguments.length>1?arguments[arguments.length-1]:function(){};return Cocoon.callNative(this.nativeExtensionName,"api",[openGraph,httpMethod,options,callback],!0)}FB.api(path,method,params,cb)},ui:function(params,cb){if(this.nativeAvailable){var params=arguments[0],callback=arguments.length>1?arguments[1]:function(){};return Cocoon.callNative(this.nativeExtensionName,"ui",[params,callback],!0)}navigator.isCocoonJS||FB.ui(params,cb)},requestAdditionalPermissions:function(permissionsType,permissions,callback){if(this.nativeAvailable){var permsArray=permissions.split(",");Cocoon.callNative(this.nativeExtensionName,"requestAdditionalPermissions",[permissionsType,permsArray,function(session,error){callback&&callback(fromCocoonFBSessionToFBAPISession(session,error))
}],!0)}else FB.login(callback,{scope:permissions})},getPermissions:function(callback){this.api("me/permissions",function(response){callback(response.data&&response.data[0]?response.data[0]:{})})},showShareDialog:function(params,callback){this.nativeAvailable?Cocoon.callNative(this.nativeExtensionName,"showShareDialog",[params,callback],!0):(params.method="feed",FB.ui(params,callback))},uploadPhoto:function(file,callback){this.nativeAvailable?Cocoon.callNative(this.nativeExtensionName,"uploadPhoto",[file,callback],!0):callback({error:{message:"Not implemented"}})},showFriendPicker:function(callback){this.nativeAvailable?Cocoon.callNative(this.nativeExtensionName,"showFriendPicker",[callback],!0):callback({error:{message:"Not implemented"}})}},extension.FacebookEvent=function(nativeAvailable){return this.nativeAvailable=nativeAvailable,this},extension.FacebookEvent.prototype={subscribe:function(name,callback){if(this.nativeAvailable){var eventKey=name+"listeners";this[eventKey]=this[eventKey]||[],this[eventKey].push(callback)}else navigator.isCocoonJS||FB.Event.subscribe(name,callback)},unsubscribe:function(name,callback){if(this.nativeAvailable){var eventKey=name+"listeners",array=this[eventKey];if(array){var index=array.indexOf(callback);-1!==index&&array.splice(index,1)}}else navigator.isCocoonJS||FB.Event.unsubscribe(name,callback)},notify:function(name,param){var eventKey=name+"listeners",array=this[eventKey];if(array)for(var i=0;i<array.length;++i)array[i](param)}},extension.Facebook=new extension.FacebookExtension,extension.SocialGamingServiceFacebook=function(fbExtension){Cocoon.Social.SocialGamingServiceFacebook.superclass.constructor.call(this),this.fb=fbExtension;var me=this;return this.fb.Event.subscribe("auth.authResponseChange",function(session){me.onLoginStatusChanged.notifyEventListeners("connected"==session.status,session.error)}),this},extension.SocialGamingServiceFacebook.prototype={currentPermissions:null,isLoggedIn:function(){return this.fb._currentSession&&"connected"===this.fb._currentSession.status},login:function(callback){var me=this;this.fb.login(function(response){callback&&callback(me.isLoggedIn(),response.error)})},logout:function(callback){this.fb.logout(function(response){callback&&callback(response.error)})},getLoggedInUser:function(){var authResponse=this.fb._currentSession?this.fb._currentSession.authResponse:null;return authResponse&&authResponse.user?fromFBUserToCocoonUser(authResponse.user):authResponse&&authResponse.userID?new Cocoon.Social.Facebook.User(authResponse.userID,"Loading..."):null},hasPublishPermissions:function(callback){this.fb.getPermissions(function(perms,error){callback(perms.publish_actions,error)})},requestPublishPermissions:function(callback){var me=this;this.fb.requestAdditionalPermissions("publish","publish_actions",function(response){response.error?callback(!1,error):me.hasPublishPermissions(function(granted,error){callback(granted,error)})})},requestUser:function(calback,userId){var apiCall=userId||"me";this.fb.api(apiCall,function(response){var user=response.error?null:fromFBUserToCocoonUser(response);calback(user,response.error)})},requestUserImage:function(callback,userID,imageSize){!userID&&this.isLoggedIn()&&(userID=this.fb._currentSession.authResponse.userID);var fbPictureSize="small";imageSize===Cocoon.Social.ImageSize.THUMB?fbPictureSize="square":imageSize===Cocoon.Social.ImageSize.MEDIUM?fbPictureSize="normal":imageSize===Cocoon.Social.ImageSize.LARGE&&(fbPictureSize="large");var url="https://graph.facebook.com/"+userID+"/picture?type="+fbPictureSize;callback(url)},requestFriends:function(callback,userId){var apiCall=(userId||"me")+"/friends";this.fb.api(apiCall,function(response){var friends=[];if(!response.error)for(var i=0;i<response.data.length;i++)friends.push(fromFBUserToCocoonUser(response.data[i]));callback(friends,response.error)})},preparePublishAction:function(callback){if(this.currentPermissions)this.currentPermissions.publish_actions?callback(!0):(this.currentPermissions=null,this.fb.requestAdditionalPermissions("publish","publish_actions",function(response){callback(response.error?!1:!0)}));else{var me=this;this.fb.getPermissions(function(perms){me.currentPermissions=perms,perms&&me.preparePublishAction(callback)})}},publishMessage:function(message,callback){this.preparePublishAction(function(granted){if(granted){var params=fromCocoonMessageToFBMessage(message),apiCall="me/feed";this.fb.api(apiCall,params,function(response){callback&&callback(response.error)})}else callback&&callback({message:"No publish_actions permission granted"})})},publishMessageWithDialog:function(message,callback){this.fb.showShareDialog(fromCocoonMessageToFBMessage(message),function(response){callback&&callback(response.error)})},requestScore:function(callback,params){var apiCall=(params&&params.userID?params.userID:"me")+"/scores";this.fb.api(apiCall,function(response){if(response.error)callback(null,response.error);else if(response.data&&response.data.length>0){var data=fromFBScoreToCocoonScore(response.data[0]);callback(data,null)}else callback(null,null)})},submitScore:function(score,callback,params){var me=this;this.preparePublishAction(function(granted){granted?me.requestScore(function(currentScore,error){if(error)return void(callback&&callback(error));var topScore=currentScore?currentScore.score:0;if(topScore>=score)return void(callback&&callback(null));var apiCall="/"+(params&&params.userID?params.userID:"me")+"/scores";me.fb.api(apiCall,"POST",{score:score},function(response){callback&&callback(response.error)})},params):callback&&callback({message:"No publish_actions permission granted"})})},showLeaderboard:function(callback){if(!this._leaderboardsTemplate)throw"Please, provide a html template for leaderboards with the setTemplates method";var dialog=new Cocoon.Widget.WebDialog,callbackSent=!1;dialog.show(this._leaderboardsTemplate,function(error){dialog.closed=!0,!callbackSent&&callback&&callback(error)});var me=this;this.fb.api(me.fb._appId+"/scores",function(response){if(!dialog.closed){if(response.error)return void(callback&&(callbackSent=!0,callback(response.error),dialog.close()));var scores=[];if(response.data&&response.data.length)for(var i=0;i<response.data.length;++i){var score=fromFBScoreToCocoonScore(response.data[i]);score.position=i,score.imageURL="https://graph.facebook.com/"+score.userID+"/picture",score.me=score.userID===me.fb._currentSession.authResponse.userID,scores.push(score)}var js="addScores("+JSON.stringify(scores)+")";dialog.eval(js)}})},prepareAchievements:function(reload,callback){if(!this._cachedAchievements||reload){var me=this;this.fb.api(this.fb._appId+"/achievements",function(response){if(response.error)callback([],response.error);else{var achievements=[];if(response.data)for(var i=0;i<response.data.length;i++)achievements.push(fromFBAchievementToCocoonAchievement(response.data[i]));me.setCachedAchievements(achievements),callback(achievements,null)}})}else callback(this._cachedAchievements,null)},requestAllAchievements:function(callback){this.prepareAchievements(!0,callback)},requestAchievements:function(callback,userID){var me=this;this.prepareAchievements(!1,function(allAchievements,error){if(error)return void callback([],error);var apiCall=(userID||"me")+"/achievements";me.fb.api(apiCall,function(response){if(response.error)callback([],response.error);else{var achievements=[];if(response.data)for(var i=0;i<response.data.length;i++){var ach=me.findAchievement((response.data[i].achievement||response.data[i].data.achievement).id);ach&&achievements.push(ach)}callback(achievements,null)}})})},submitAchievement:function(achievementID,callback){if(null===achievementID||"undefined"==typeof achievementID)throw"No achievementID specified";var achID=this.translateAchievementID(achievementID),me=this;this.preparePublishAction(function(granted){granted?me.fb.api("me/achievements","POST",{achievement:achID},function(response){callback&&callback(response.error)}):callback&&callback({message:"No publish_actions permission granted"})})},resetAchievements:function(callback){var me=this;this.preparePublishAction(function(granted){granted?me.requestAchievements(function(achievements,error){if(error)return void(callback&&callback(error));for(var someError=null,remaining=achievements.length,i=0;i<achievements.length;++i)me.fb.api("me/achievements","DELETE",{achievement:achievements[i].fbAchievementData.url},function(response){response.error&&(someError=response.error),remaining--,0==remaining&&callback&&callback(someError)})}):callback&&callback({message:"No publish_actions permission granted"})})},showAchievements:function(callback){if(!this._achievementsTemplate)throw"Please, provide a html template for achievements with the setTemplates method";var dialog=new Cocoon.Widget.WebDialog,callbackSent=!1;dialog.show(this._achievementsTemplate,function(error){dialog.closed=!0,!callbackSent&&callback&&callback(error)});var me=this;this.requestAchievements(function(achievements,error){if(!dialog.closed){if(error)return callbackSent=!0,void(callback&&callback(error));var achs=[];if(me._cachedAchievements)for(var i=0;i<me._cachedAchievements.length;++i){var ach=me._cachedAchievements[i];if(achs.push(ach),achievements&&achievements.length)for(var j=0;j<achievements.length;++j)if(achievements[j].achievementID===ach.achievementID){ach.achieved=!0;break}}var js="addAchievements("+JSON.stringify(achs)+");";dialog.eval(js)}})}},Cocoon.extend(extension.SocialGamingServiceFacebook,extension.SocialGamingService),!(navigator.isCocoonJS||"undefined"!=typeof module&&module.exports)){var parent=document.getElementsByTagName("script")[0],script=document.createElement("script"),prot=location.protocol?location.protocol:"http:";script.src=prot+"//connect.facebook.net/en_US/all.js",parent.parentNode.insertBefore(script,parent)}return extension}),Cocoon.define("Cocoon.Multiplayer",function(extension){return extension.MultiplayerService=function(nativeExtensionName,extensionName){this.nativeExtensionName=nativeExtensionName,this.extensionName=extensionName,this.nativeAvailable=!!window.ext&&!!window.ext[this.nativeExtensionName];var me=this;this.onInvitationReceived=new Cocoon.EventHandler(this.nativeExtensionName,this.extensionName,"onInvitationReceived"),this.onInvitationLoaded=new Cocoon.EventHandler(this.nativeExtensionName,this.extensionName,"onInvitationLoaded",function(sourceListener,args){var matchID=args[0],error=args[1];matchID&&!error?(me.currentMatch=new Cocoon.Multiplayer.Match(me.nativeExtensionName,me.extensionName,matchID),sourceListener(me.currentMatch,null)):sourceListener(null,error)});var signal=new Cocoon.Signal.createSignal;return signal.register("invitation",{received:this.onInvitationReceived,loaded:this.onInvitationLoaded}),this.on=signal.expose(),this},extension.MultiplayerService.prototype={currentMatch:null,findMatch:function(matchRequest,callback){var me=this;this.nativeAvailable&&Cocoon.callNative(this.nativeExtensionName,"findMatch",[matchRequest,function(matchID,error){matchID&&!error?(me.currentMatch=new Cocoon.Multiplayer.Match(me.nativeExtensionName,me.extensionName,matchID),callback(me.currentMatch,null)):callback(null,error)}],!0)},findAutoMatch:function(matchRequest,callback){var me=this;this.nativeAvailable&&Cocoon.callNative(this.nativeExtensionName,"findAutoMatch",[matchRequest,function(matchID,error){matchID&&!error?(me.currentMatch=new Cocoon.Multiplayer.Match(me.nativeExtensionName,me.extensionName,matchID),callback(me.currentMatch,null)):callback(null,error)}],!0)},cancelAutoMatch:function(){this.nativeAvailable&&Cocoon.callNative(this.nativeExtensionName,"cancelAutoMatch",[],!0)},addPlayersToMatch:function(matchRequest,match,callback){this.nativeAvailable&&Cocoon.callNative(this.nativeExtensionName,"addPlayersToMatch",[matchRequest,match.matchID,callback],!0)},getMatch:function(){return this.currentMatch}},extension.Match=function(nativeExtensionName,extensionName,matchID){if("string"!=typeof nativeExtensionName)throw"The given native extension name '"+nativeExtensionName+"' is not a string.";if("string"!=typeof extensionName)throw"The given extension name '"+nativeExtensionName+"' is not a string.";this.nativeExtensionName=nativeExtensionName,this.extensionName=extensionName,this.nativeAvailable=Cocoon.nativeAvailable&&"undefined"!=typeof window.ext[nativeExtensionName],this.matchID=matchID;var me=this;this.onMatchDataReceived=new Cocoon.EventHandler(this.nativeExtensionName,this.extensionName,"onMatchDataReceived",function(sourceListener,args){me.matchID===args[0]&&sourceListener(me,args[1],args[2])}),this.onMatchStateChanged=new Cocoon.EventHandler(this.nativeExtensionName,this.extensionName,"onMatchStateChanged",function(sourceListener,args){me.matchID===args[0]&&sourceListener(me,args[1],args[2])}),this.onMatchConnectionWithPlayerFailed=new Cocoon.EventHandler(this.nativeExtensionName,this.extensionName,"onMatchConnectionWithPlayerFailed",function(sourceListener,args){me.matchID===args[0]&&sourceListener(me,args[1],args[2])}),this.onMatchFailed=new Cocoon.EventHandler(this.nativeExtensionName,this.extensionName,"onMatchFailed",function(sourceListener,args){me.matchID===args[0]&&sourceListener(me,args[1])});var signal=new Cocoon.Signal.createSignal;signal.register("match",{dataReceived:this.onMatchDataReceived,stateChanged:this.onMatchStateChanged,connectionWithPlayerFailed:this.onMatchConnectionWithPlayerFailed,failed:this.onMatchFailed}),this.on=signal.expose()},extension.Match.prototype={start:function(){this.nativeAvailable&&Cocoon.callNative(this.nativeExtensionName,"startMatch",[this.matchID],!0)},sendDataToAllPlayers:function(data,sendMode){return this.nativeAvailable?Cocoon.callNative(this.nativeExtensionName,"sendDataToAllPlayers",[this.matchID,data,sendMode]):void 0},sendData:function(data,playerIDs,sendMode){return this.nativeAvailable?Cocoon.callNative(this.nativeExtensionName,"sendData",[this.matchID,data,playerIDs,sendMode]):void 0},disconnect:function(){return this.nativeAvailable?Cocoon.callNative(this.nativeExtensionName,"disconnect",[this.matchID],!0):void 0},requestPlayersInfo:function(callback){return this.nativeAvailable?Cocoon.callNative(this.nativeExtensionName,"requestPlayersInfo",[this.matchID,callback],!0):void 0},getExpectedPlayerCount:function(){return this.nativeAvailable?Cocoon.callNative(this.nativeExtensionName,"getExpectedPlayerCount",[this.matchID]):void 0},getPlayerIDs:function(){return this.nativeAvailable?Cocoon.callNative(this.nativeExtensionName,"getPlayerIDs",[this.matchID]):void 0},getLocalPlayerID:function(){return this.nativeAvailable?Cocoon.callNative(this.nativeExtensionName,"getLocalPlayerID",[this.matchID]):""}},extension.SendDataMode={RELIABLE:0,UNRELIABLE:1},extension.ConnectionState={UNKNOWN:0,CONNECTED:1,DISCONNECTED:2},extension.PlayerInfo=function(userID,userName){this.userID=userID,this.userName=userName},extension.MatchRequest=function(minPlayers,maxPlayers,playersToInvite,playerGroup,playerAttributes){return this.minPlayers=minPlayers,this.maxPlayers=maxPlayers,this.playersToInvite=playersToInvite,this.playerGroup=playerGroup,this.playerAttributes=playerAttributes,this},extension}),Cocoon.define("Cocoon.Multiplayer",function(extension){var loopbackServices=[],indexCounter=0,matchServices=[],matchCounter=0;extension.LoopbackService=function(){Cocoon.Multiplayer.LoopbackService.superclass.constructor.call(this,"dummy","dummy"),loopbackServices.push(this),this.playerID=""+indexCounter,indexCounter++},extension.LoopbackService.prototype={findMatch:function(request,callback){this.findMatchCallback=callback;for(var exists=!1,i=0;i<matchServices.length;++i)if(matchServices[i]===this){exists=!0;break}if(exists||matchServices.push(this),matchServices.length>=request.minPlayers){for(var playerIDs=[],i=0;i<matchServices.length;++i)playerIDs.push(matchServices[i].getPlayerID());for(var i=0;i<matchServices.length;++i){var match=new LoopbackMatch(matchServices[i]);match.playerIDs=playerIDs.slice(),matchServices[i].currentMatch=match,matchServices[i].findMatchCallback(match,null)}matchServices=[]}},findAutoMatch:function(matchRequest,callback){this.findMatch(matchRequest,callback)},cancelAutoMatch:function(){},addPlayersToMatch:function(matchRequest,match,callback){callback({message:"Not implemmented"})},getPlayerID:function(){return this.playerID},getMatch:function(){return this.currentMatch}},Cocoon.extend(extension.LoopbackService,extension.MultiplayerService);var LoopbackMatch=function(service){matchCounter++,LoopbackMatch.superclass.constructor.call(this,"","",matchCounter),this.started=!1,this.disconnected=!1,this.pendingData=[],this.service=service};return LoopbackMatch.prototype={start:function(){var me=this;setTimeout(function(){me.started=!0;for(var i=0;i<me.pendingData.length;++i)me.onMatchDataReceived.notifyEventListeners(me.matchID,me.pendingData[i].data,me.pendingData[i].player)},0)},sendDataToAllPlayers:function(data,sendMode){this.sendData(data,this.playerIDs,sendMode)},sendData:function(data,playerIDs){var me=this;setTimeout(function(){for(var i=0;i<loopbackServices.length;++i){for(var destService=null,j=0;j<playerIDs.length;++j)playerIDs[j]===loopbackServices[i].getPlayerID()&&(destService=loopbackServices[i]);destService&&destService.getMatch().notifyDataReceived(data,me.service.getPlayerID())}},0)},disconnect:function(){this.disconnected=!0;for(var i=0;i<this.playerIDs.length;++i)for(var p=this.playerIDs[i],j=0;j<loopbackServices.length;++j)if(loopbackServices[j].getPlayerID()===p){var match=loopbackServices[i].getMatch();match.disconnected||match.onMatchStateChanged.notifyEventListeners(match,this.service.getPlayerID(),Cocoon.Multiplayer.ConnectionState.DISCONNECTED)}},requestPlayersInfo:function(callback){var me=this;setTimeout(function(){for(var playersInfo=[],i=0;i<me.playerIDs.length;++i)playersInfo[i]={userID:me.playerIDs[i],userName:"Player"+me.playerIDs[i]};callback(playersInfo)},1)},getExpectedPlayerCount:function(){return 0},getPlayerIDs:function(){return this.playerIDs},getLocalPlayerID:function(){return this.service.playerID},notifyDataReceived:function(data,fromPlayer){this.started?this.onMatchDataReceived.notifyEventListeners(this.matchID,data,fromPlayer):this.pendingData.push({data:data,player:fromPlayer})}},Cocoon.extend(LoopbackMatch,Cocoon.Multiplayer.Match),extension}),Cocoon.define("Cocoon.Multiplayer",function(extension){return extension.GooglePlayGames=new Cocoon.Multiplayer.MultiplayerService("IDTK_SRV_MULTIPLAYER_GPG","Multiplayer.GooglePlayGames"),extension}),Cocoon.define("Cocoon.Multiplayer",function(extension){return extension.GameCenter=new Cocoon.Multiplayer.MultiplayerService("IDTK_SRV_MULTIPLAYER_GAMECENTER","Multiplayer.GameCenter"),extension});window.ext&&"undefined"!=typeof window.ext.IDTK_SRV_BOX2D?(window.Box2D={},window.Box2D.Dynamics={},window.Box2D.Dynamics.Joints={},window.Box2D.Common={},window.Box2D.Common.Math={},window.Box2D.Collision={},window.Box2D.Collision.Shapes={},function(){"use strict";function b2Err(msg){console.error(msg)}var B2Vec2=function(x_,y_){void 0===x_&&(x_=0),void 0===y_&&(y_=0),this.x=x_,this.y=y_};window.Box2D.Common.Math.b2Vec2=B2Vec2,B2Vec2.prototype.SetZero=function(){this.x=0,this.y=0},B2Vec2.prototype.Set=function(x_,y_){void 0===x_&&(x_=0),void 0===y_&&(y_=0),this.x=x_,this.y=y_},B2Vec2.prototype.SetV=function(v){void 0===v&&b2Err("undefined 'v' in b2Vec2.SetV"),this.x=v.x,this.y=v.y},B2Vec2.Make=function(x_,y_){return void 0===x_&&(x_=0),void 0===y_&&(y_=0),new B2Vec2(x_,y_)},void 0===B2Vec2.Get&&(B2Vec2.Get=B2Vec2.Make,B2Vec2._freeCache=[],B2Vec2.Free=function(){}),B2Vec2.prototype.Copy=function(){return new B2Vec2(this.x,this.y)},B2Vec2.prototype.Add=function(v){void 0===v&&b2Err("undefined 'v' in b2Vec2.Add"),this.x+=v.x,this.y+=v.y},B2Vec2.prototype.Subtract=function(v){void 0===v&&b2Err("undefined 'v' in b2Vec2.Subtract"),this.x-=v.x,this.y-=v.y},B2Vec2.prototype.Multiply=function(a){void 0===a&&(a=0),this.x*=a,this.y*=a},B2Vec2.prototype.Length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},B2Vec2.prototype.LengthSquared=function(){return this.x*this.x+this.y*this.y},B2Vec2.prototype.Normalize=function(){var length=Math.sqrt(this.x*this.x+this.y*this.y);if(length<Number.MIN_VALUE)return 0;var invLength=1/length;return this.x*=invLength,this.y*=invLength,length},B2Vec2.prototype.NegativeSelf=function(){this.x=-this.x,this.y=-this.y};var B2Mat22=function(){this.col1=new B2Vec2,this.col2=new B2Vec2,this.SetIdentity()};window.Box2D.Common.Math.b2Mat22=B2Mat22,B2Mat22.FromAngle=function(angle){void 0===angle&&(angle=0);var mat=new B2Mat22;return mat.Set(angle),mat},B2Mat22.FromVV=function(c1,c2){var mat=new B2Mat22;return mat.SetVV(c1,c2),mat},B2Mat22.prototype.Set=function(angle){void 0===angle&&(angle=0);var c=Math.cos(angle),s=Math.sin(angle);this.col1.x=c,this.col2.x=-s,this.col1.y=s,this.col2.y=c},B2Mat22.prototype.SetVV=function(c1,c2){this.col1.SetV(c1),this.col2.SetV(c2)},B2Mat22.prototype.Copy=function(){var mat=new B2Mat22;return mat.SetM(this),mat},B2Mat22.prototype.SetM=function(m){this.col1.SetV(m.col1),this.col2.SetV(m.col2)},B2Mat22.prototype.AddM=function(m){this.col1.x+=m.col1.x,this.col1.y+=m.col1.y,this.col2.x+=m.col2.x,this.col2.y+=m.col2.y},B2Mat22.prototype.SetIdentity=function(){this.col1.x=1,this.col2.x=0,this.col1.y=0,this.col2.y=1},B2Mat22.prototype.SetZero=function(){this.col1.x=0,this.col2.x=0,this.col1.y=0,this.col2.y=0},B2Mat22.prototype.GetAngle=function(){return Math.atan2(this.col1.y,this.col1.x)},B2Mat22.prototype.GetInverse=function(out){var a=this.col1.x,b=this.col2.x,c=this.col1.y,d=this.col2.y,det=a*d-b*c;return 0!==det&&(det=1/det),out.col1.x=det*d,out.col2.x=-det*b,out.col1.y=-det*c,out.col2.y=det*a,out},B2Mat22.prototype.Solve=function(out,bX,bY){void 0===bX&&(bX=0),void 0===bY&&(bY=0);var a11=this.col1.x,a12=this.col2.x,a21=this.col1.y,a22=this.col2.y,det=a11*a22-a12*a21;return 0!==det&&(det=1/det),out.x=det*(a22*bX-a12*bY),out.y=det*(a11*bY-a21*bX),out},B2Mat22.prototype.Abs=function(){this.col1.Abs(),this.col2.Abs()};var B2Transform=function(pos,r){this.position=new B2Vec2,this.R=new B2Mat22,void 0===pos&&(pos=null),void 0===r&&(r=null),pos&&(this.position.SetV(pos),this.R.SetM(r))};window.Box2D.Common.Math.b2Transform=B2Transform,B2Transform.prototype.Initialize=function(pos,r){this.position.SetV(pos),this.R.SetM(r)},B2Transform.prototype.SetIdentity=function(){this.position.SetZero(),this.R.SetIdentity()},B2Transform.prototype.Set=function(x){this.position.SetV(x.position),this.R.SetM(x.R)},B2Transform.prototype.SetAngle=function(){return Math.atan2(this.R.col1.y,this.R.col1.x)};var b2Math=function(){};window.Box2D.Common.Math.b2Math=b2Math,b2Math.IsValid=function(x){return void 0===x&&(x=0),isFinite(x)},b2Math.Dot=function(a,b){return a.x*b.x+a.y*b.y},b2Math.CrossVV=function(a,b){return a.x*b.y-a.y*b.x},b2Math.CrossVF=function(a,s){void 0===s&&(s=0);var v=new B2Vec2(s*a.y,-s*a.x);return v},b2Math.CrossFV=function(s,a){void 0===s&&(s=0);var v=new B2Vec2(-s*a.y,s*a.x);return v},b2Math.MulMV=function(A,v){void 0===v&&b2Err("undefined 'v' in b2Math.MulMV");var u=new B2Vec2(A.col1.x*v.x+A.col2.x*v.y,A.col1.y*v.x+A.col2.y*v.y);return u},b2Math.MulTMV=function(A,v){var u=new B2Vec2(b2Math.Dot(v,A.col1),b2Math.Dot(v,A.col2));return u},b2Math.MulX=function(T,v){var a=b2Math.MulMV(T.R,v);return a.x+=T.position.x,a.y+=T.position.y,a},b2Math.MulXT=function(T,v){var a=b2Math.SubtractVV(v,T.position),tX=a.x*T.R.col1.x+a.y*T.R.col1.y;return a.y=a.x*T.R.col2.x+a.y*T.R.col2.y,a.x=tX,a},b2Math.AddVV=function(a,b){var v=new B2Vec2(a.x+b.x,a.y+b.y);return v},b2Math.SubtractVV=function(a,b){var v=new B2Vec2(a.x-b.x,a.y-b.y);return v},b2Math.Distance=function(a,b){var cX=a.x-b.x,cY=a.y-b.y;return Math.sqrt(cX*cX+cY*cY)},b2Math.DistanceSquared=function(a,b){var cX=a.x-b.x,cY=a.y-b.y;return cX*cX+cY*cY},b2Math.MulFV=function(s,a){void 0===s&&(s=0);var v=new B2Vec2(s*a.x,s*a.y);return v},b2Math.AddMM=function(A,B){var C=B2Mat22.FromVV(b2Math.AddVV(A.col1,B.col1),b2Math.AddVV(A.col2,B.col2));return C},b2Math.MulMM=function(A,B){var C=B2Mat22.FromVV(b2Math.MulMV(A,B.col1),b2Math.MulMV(A,B.col2));return C},b2Math.MulTMM=function(A,B){var c1=new B2Vec2(b2Math.Dot(A.col1,B.col1),b2Math.Dot(A.col2,B.col1)),c2=new B2Vec2(b2Math.Dot(A.col1,B.col2),b2Math.Dot(A.col2,B.col2)),C=B2Mat22.FromVV(c1,c2);return C},b2Math.Abs=function(a){return void 0===a&&(a=0),a>0?a:-a},b2Math.AbsV=function(a){var b=new B2Vec2(b2Math.Abs(a.x),b2Math.Abs(a.y));return b},b2Math.AbsM=function(A){var B=B2Mat22.FromVV(b2Math.AbsV(A.col1),b2Math.AbsV(A.col2));return B},b2Math.Min=function(a,b){return void 0===a&&(a=0),void 0===b&&(b=0),b>a?a:b},b2Math.MinV=function(a,b){var c=new B2Vec2(b2Math.Min(a.x,b.x),b2Math.Min(a.y,b.y));return c},b2Math.Max=function(a,b){return void 0===a&&(a=0),void 0===b&&(b=0),a>b?a:b},b2Math.MaxV=function(a,b){var c=new B2Vec2(b2Math.Max(a.x,b.x),b2Math.Max(a.y,b.y));return c},b2Math.Clamp=function(a,low,high){return void 0===a&&(a=0),void 0===low&&(low=0),void 0===high&&(high=0),low>a?low:a>high?high:a},b2Math.ClampV=function(a,low,high){return b2Math.MaxV(low,b2Math.MinV(a,high))},b2Math.Swap=function(a,b){var tmp=a[0];a[0]=b[0],b[0]=tmp},b2Math.Random=function(){return 2*Math.random()-1},b2Math.RandomRange=function(lo,hi){void 0===lo&&(lo=0),void 0===hi&&(hi=0);var r=Math.random();return r=(hi-lo)*r+lo},b2Math.NextPowerOfTwo=function(x){return void 0===x&&(x=0),x|=x>>1&2147483647,x|=x>>2&1073741823,x|=x>>4&268435455,x|=x>>8&16777215,x|=x>>16&65535,x+1},b2Math.IsPowerOfTwo=function(x){void 0===x&&(x=0);var result=x>0&&0===(x&x-1);return result},b2Math.b2Vec2_zero=new B2Vec2(0,0),b2Math.b2Mat22_identity=B2Mat22.FromVV(new B2Vec2(1,0),new B2Vec2(0,1)),b2Math.b2Transform_identity=new B2Transform(b2Math.b2Vec2_zero,b2Math.b2Mat22_identity);var B2DebugDraw=function(){this.e_aabbBit=4,this.e_centerOfMassBit=16,this.e_controllerBit=32,this.e_jointBit=2,this.e_pairBit=8,this.e_shapeBit=0};window.Box2D.Dynamics.b2DebugDraw=B2DebugDraw,B2DebugDraw.prototype.AppendFlags=function(){},B2DebugDraw.prototype.ClearFlags=function(){},B2DebugDraw.prototype.DrawCircle=function(){},B2DebugDraw.prototype.DrawPolygon=function(){},B2DebugDraw.prototype.DrawSegment=function(){},B2DebugDraw.prototype.DrawSolidCircle=function(){},B2DebugDraw.prototype.DrawSolidPolygon=function(){},B2DebugDraw.prototype.DrawTransform=function(){},B2DebugDraw.prototype.GetAlpha=function(){},B2DebugDraw.prototype.GetDrawScale=function(){},B2DebugDraw.prototype.GetFillAlpha=function(){},B2DebugDraw.prototype.GetFlags=function(){},B2DebugDraw.prototype.GetLineThickness=function(){},B2DebugDraw.prototype.GetSprite=function(){},B2DebugDraw.prototype.GetXFormScale=function(){},B2DebugDraw.prototype.SetAlpha=function(){},B2DebugDraw.prototype.SetDrawScale=function(){},B2DebugDraw.prototype.SetFillAlpha=function(){},B2DebugDraw.prototype.SetFlags=function(){},B2DebugDraw.prototype.SetLineThickness=function(){},B2DebugDraw.prototype.SetSprite=function(){},B2DebugDraw.prototype.SetXFormScale=function(){};var B2BodyDef=function(){this.position=new B2Vec2(0,0),this.linearVelocity=new B2Vec2,this.userData=null,this.angle=0,this.linearVelocity.Set(0,0),this.angularVelocity=0,this.linearDamping=0,this.angularDamping=0,this.allowSleep=!0,this.awake=!0,this.fixedRotation=!1,this.bullet=!1,this.type=B2Body.b2_staticBody,this.active=!0,this.inertiaScale=1};window.Box2D.Dynamics.b2BodyDef=B2BodyDef;var B2Fixture=function(body,userData,fixtureID,def){this.m_body=body,this.m_userData=userData,this.m_fixtureID=fixtureID,this.m_shape={},this.m_shape.m_centroid=new B2Vec2,this.m_isSensor=!1,this.m_density=def.density,this.m_friction=def.friction,this.m_restitution=def.restitution,this.m_isSensor=def.isSensor};window.Box2D.Dynamics.b2Fixture=B2Fixture,B2Fixture.prototype.GetBody=function(){return this.m_body},B2Fixture.prototype.GetShape=function(){return console.log("fixture.GetShape not yet supported in CocoonJS Box2D binding"),null},B2Fixture.prototype.GetUserData=function(){return this.m_userData},B2Fixture.prototype.SetSensor=function(isSensor){this.m_isSensor=isSensor,window.ext.IDTK_SRV_BOX2D.makeCall("setSensor",this.m_body.m_world.m_worldID,this.m_fixtureID,this.m_isSensor)},B2Fixture.prototype.IsSensor=function(){return this.m_isSensor},B2Fixture.prototype.SetDensity=function(density){window.ext.IDTK_SRV_BOX2D.makeCall("setDensity",this.m_body.m_world.m_worldID,this.m_fixtureID,density),this.m_density=density},B2Fixture.prototype.SetFriction=function(friction){window.ext.IDTK_SRV_BOX2D.makeCall("setFriction",this.m_body.m_world.m_worldID,this.m_fixtureID,friction),this.m_friction=friction},B2Fixture.prototype.SetRestitution=function(restitution){window.ext.IDTK_SRV_BOX2D.makeCall("setRestitution",this.m_body.m_world.m_worldID,this.m_fixtureID,restitution),this.m_restitution=restitution},B2Fixture.prototype.GetDensity=function(){return this.m_density},B2Fixture.prototype.GetFriction=function(){return this.m_friction},B2Fixture.prototype.GetRestitution=function(){return this.m_restitution};var B2Body=function(bd,world){var userData=bd.userData;bd.userData=null,this.m_world=world,this.m_xf=new B2Transform(bd.position,B2Mat22.FromAngle(bd.angle)),this.m_fixtures=[],this.m_active=bd.active,bd.type===B2Body.b2_staticBody&&(bd.density=0),this.m_bodyID=window.ext.IDTK_SRV_BOX2D.makeCall("createBody",world.m_worldID,bd),this.m_userData=userData,bd.userData=userData};window.Box2D.Dynamics.b2Body=B2Body,B2Body.prototype.CreateFixture=function(def){var userData=def.userData;def.userData=null;var fixtureID=window.ext.IDTK_SRV_BOX2D.makeCall("createFixture",this.m_world.m_worldID,this.m_bodyID,def);def.userData=userData;var fixture=new B2Fixture(this,userData,fixtureID,def);return this.m_world.m_fixturesList[fixtureID]=fixture,this.m_fixtures.push(fixture),fixture},B2Body.prototype.GetFixtureList=function(){return 0===this.m_fixtures.length?null:this.m_fixtures[0]},B2Body.prototype.DestroyFixture=function(fixture){window.ext.IDTK_SRV_BOX2D.makeCall("deleteFixture",this.m_world.m_worldID,fixture.m_fixtureID),delete this.m_world.m_fixturesList[fixture.m_fixtureID]},B2Body.prototype.SetPositionAndAngle=function(position,angle){window.ext.IDTK_SRV_BOX2D.makeCall("setBodyTransform",this.m_world.m_worldID,this.m_bodyID,position.x,position.y,angle),this.m_xf.R.Set(angle),this.m_xf.position.SetV(position)},B2Body.prototype.GetPosition=function(){return this.m_xf.position},B2Body.prototype.SetPosition=function(position){this.SetPositionAndAngle(position,this.GetAngle())},B2Body.prototype.GetLinearVelocity=function(){var v=window.ext.IDTK_SRV_BOX2D.makeCall("getLinearVelocity",this.m_world.m_worldID,this.m_bodyID);return new B2Vec2(v[0],v[1])},B2Body.prototype.GetWorldCenter=function(){var p=window.ext.IDTK_SRV_BOX2D.makeCall("getWorldCenter",this.m_world.m_worldID,this.m_bodyID);return new B2Vec2(p[0],p[1])},B2Body.prototype.GetLocalCenter=function(){var p=window.ext.IDTK_SRV_BOX2D.makeCall("getLocalCenter",this.m_world.m_worldID,this.m_bodyID);return new B2Vec2(p[0],p[1])},B2Body.prototype.GetLocalPoint=function(worldPoint){return b2Math.MulXT(this.m_xf,worldPoint)},B2Body.prototype.ApplyImpulse=function(impulse,point,wake){window.ext.IDTK_SRV_BOX2D.makeCall("applyImpulse",this.m_world.m_worldID,this.m_bodyID,impulse.x,impulse.y,point.x,point.y,wake)},B2Body.prototype.GetMass=function(){return window.ext.IDTK_SRV_BOX2D.makeCall("getMass",this.m_world.m_worldID,this.m_bodyID)},B2Body.prototype.IsAwake=function(){return window.ext.IDTK_SRV_BOX2D.makeCall("isAwake",this.m_world.m_worldID,this.m_bodyID)},B2Body.prototype.GetAngularVelocity=function(){return window.ext.IDTK_SRV_BOX2D.makeCall("getAngularVelocity",this.m_world.m_worldID,this.m_bodyID)},B2Body.prototype.SetFixedRotation=function(fixed){window.ext.IDTK_SRV_BOX2D.makeCall("setFixedRotation",this.m_world.m_worldID,this.m_bodyID,fixed)},B2Body.prototype.SetAwake=function(state){window.ext.IDTK_SRV_BOX2D.makeCall("setAwake",this.m_world.m_worldID,this.m_bodyID,state)
},B2Body.prototype.SetLinearVelocity=function(vel){window.ext.IDTK_SRV_BOX2D.makeCall("setLinearVelocity",this.m_world.m_worldID,this.m_bodyID,vel.x,vel.y)},B2Body.prototype.ApplyForceToCenter=function(force,wake){window.ext.IDTK_SRV_BOX2D.makeCall("applyForceToCenter",this.m_world.m_worldID,this.m_bodyID,force.x,force.y,wake)},B2Body.prototype.ApplyForce=function(force,point,wake){window.ext.IDTK_SRV_BOX2D.makeCall("applyForce",this.m_world.m_worldID,this.m_bodyID,force.x,force.y,point.x,point.y,wake)},B2Body.prototype.ApplyTorque=function(torque,wake){window.ext.IDTK_SRV_BOX2D.makeCall("applyTorque",this.m_world.m_worldID,this.m_bodyID,torque,wake)},B2Body.prototype.SetLinearDamping=function(damp){window.ext.IDTK_SRV_BOX2D.makeCall("setLinearDamping",this.m_world.m_worldID,this.m_bodyID,damp)},B2Body.prototype.SetAngularVelocity=function(angvel){window.ext.IDTK_SRV_BOX2D.makeCall("setAngularVelocity",this.m_world.m_worldID,this.m_bodyID,angvel)},B2Body.prototype.SetType=function(type){window.ext.IDTK_SRV_BOX2D.makeCall("setType",this.m_world.m_worldID,this.m_bodyID,type)},B2Body.prototype.SetActive=function(state){window.ext.IDTK_SRV_BOX2D.makeCall("setActive",this.m_world.m_worldID,this.m_bodyID,state),this.m_active=state},B2Body.prototype.IsActive=function(){return this.m_active},B2Body.prototype.GetAngle=function(){return this.m_xf.R.GetAngle()},B2Body.prototype.SetAngle=function(angle){void 0===angle&&(angle=0),this.SetPositionAndAngle(this.GetPosition(),angle)},B2Body.prototype.GetContactList=function(){for(var contacts=window.ext.IDTK_SRV_BOX2D.makeCall("getObjectContacts",this.m_world.m_worldID,this.m_bodyID),result=[],i=0;i<contacts.length;i++)result.push(this.m_world.m_bodyList[contacts[i]]);return result},B2Body.prototype.SetUserData=function(data){this.m_userData=data},B2Body.prototype.GetUserData=function(){return this.m_userData},B2Body.prototype.GetWorld=function(){return this.m_world},window.Box2D.Dynamics.b2Body.b2_staticBody=0,window.Box2D.Dynamics.b2Body.b2_kinematicBody=1,window.Box2D.Dynamics.b2Body.b2_dynamicBody=2;var B2Contact=function(fixtureA,fixtureB,touching){this.m_fixtureA=fixtureA,this.m_fixtureB=fixtureB,this.m_touching=touching};window.Box2D.Dynamics.b2Contact=B2Contact,B2Contact.prototype.GetFixtureA=function(){return this.m_fixtureA},B2Contact.prototype.GetFixtureB=function(){return this.m_fixtureB},B2Contact.prototype.IsTouching=function(){return this.m_touching};var B2ContactListener=function(){};window.Box2D.Dynamics.b2ContactListener=B2ContactListener,B2ContactListener.prototype.BeginContact=function(){},B2ContactListener.prototype.EndContact=function(){},B2ContactListener.prototype.PreSolve=function(){},B2ContactListener.prototype.PostSolve=function(){},window.Box2D.Dynamics.b2ContactListener.b2_defaultListener=new B2ContactListener;var B2ContactFilter=function(){};window.Box2D.Dynamics.b2ContactFilter=B2ContactFilter;var B2World=function(gravity,doSleep){this.m_bodyList=[],this.m_jointList=[],this.m_fixturesList=[],this.m_contactListener=null,this.m_jointsList=[],this.m_worldID=window.ext.IDTK_SRV_BOX2D.makeCall("createWorld",gravity.x,gravity.y,doSleep)};window.Box2D.Dynamics.b2World=B2World,B2World.prototype.SetContactListener=function(listener){this.m_contactListener=listener},B2World.prototype.SetContactFilter=function(filter){var _filter=filter,world=this,callbackFunc=function(a,b){var fa=world.m_fixturesList[a],fb=world.m_fixturesList[b];return _filter.ShouldCollide(fa,fb)};window.ext.IDTK_SRV_BOX2D.makeCall("setContactFilter",this.m_worldID,callbackFunc)},B2World.prototype.CreateBody=function(def){var b=new B2Body(def,this);return this.m_bodyList[b.m_bodyID]=b,b},B2World.prototype.DestroyBody=function(b){window.ext.IDTK_SRV_BOX2D.makeCall("deleteBody",this.m_worldID,b.m_bodyID),delete this.m_bodyList[b.m_bodyID];for(var i=0;i<b.m_fixtures.length;++i)delete this.m_fixturesList[b.m_fixtures[i].m_fixtureID]},B2World.prototype.CreateJoint=function(def){if(def.bodyA.m_bodyID!==def.bodyB.m_bodyID){var bodyA=def.bodyA,bodyB=def.bodyB;def.bodyA=bodyA.m_bodyID,def.bodyB=bodyB.m_bodyID;var jointFunc="createDistanceJoint";def.type===B2Joint.e_revoluteJoint&&(jointFunc="createRevoluteJoint");var joint=new B2Joint(def);return joint.m_jointID=window.ext.IDTK_SRV_BOX2D.makeCall(jointFunc,this.m_worldID,def),def.bodyA=bodyA,def.bodyB=bodyB,this.m_jointsList.push(joint),joint}},B2World.prototype.DestroyJoint=function(joint){window.ext.IDTK_SRV_BOX2D.makeCall("destroyJoint",this.m_worldID,joint.m_jointID)},B2World.prototype.GetJointList=function(){if(0===this.m_jointsList.length)return null;for(var i=0;i<this.m_jointsList.length-1;++i)this.m_jointsList[i].next=this.m_jointsList[i+1];return this.m_jointsList[this.m_jointsList.length-1].next=null,this.m_jointsList[0]},B2World.prototype.SetContinuousPhysics=function(continuous){window.ext.IDTK_SRV_BOX2D.makeCall("setContinuous",this.m_worldID,continuous)},B2World.prototype.SetGravity=function(gravity){window.ext.IDTK_SRV_BOX2D.makeCall("setGravity",this.m_worldID,gravity.x,gravity.y)},B2World.prototype.Step=function(dt,velocityIterations,positionIterations){var i,transforms=window.ext.IDTK_SRV_BOX2D.makeCall("step",this.m_worldID,dt,velocityIterations,positionIterations),count=transforms[0];for(i=1;4*count>=i;i+=4){var body=this.m_bodyList[transforms[i+0]];if(null===body)break;body.m_xf.position.Set(transforms[i+1],transforms[i+2]),body.m_xf.R.Set(transforms[i+3])}if(null!==this.m_contactListener){var contacts=window.ext.IDTK_SRV_BOX2D.makeCall("getLastContacts",this.m_worldID);for(count=contacts[0],i=1;3*count>=i;i+=3){var f1=contacts[i+0],f2=contacts[i+1],touching=contacts[i+2],fix1=this.m_fixturesList[f1],fix2=this.m_fixturesList[f2];"undefined"!=typeof fix1&&"undefined"!=typeof fix2?this.m_contactListener.BeginContact(new B2Contact(fix1,fix2,touching)):console.log("One of the fixtures in a contact DOESN'T EXIST!!")}}},B2World.prototype.ClearForces=function(){window.ext.IDTK_SRV_BOX2D.makeCall("clearForces",this.m_worldID)},B2World.prototype.SetDebugDraw=function(){},B2World.prototype.DrawDebugData=function(){},window.Box2D.Collision.Shapes.b2CircleShape=function(radius){this.radius=radius,this.type="circle"},window.Box2D.Collision.Shapes.b2PolygonShape=function(){this.SetAsBox=function(width,height){this.type="box",this.width=width,this.height=height},this.SetAsEdge=function(v1,v2){this.type="edge",this.p1x=v1.x,this.p1y=v1.y,this.p2x=v2.x,this.p2y=v2.y},this.SetAsArray=function(vec,length){this.type="polygon",this.vertices=[];for(var i=0;length>i;i++)this.vertices.push(vec[i].x),this.vertices.push(vec[i].y)}};var b2FixtureDef=function(){this.shape=null,this.userData=null,this.friction=.2,this.restitution=0,this.density=0,this.isSensor=!1,this.filter={categoryBits:1,maskBits:65535,groupIndex:0}};window.Box2D.Dynamics.b2FixtureDef=b2FixtureDef;var B2Joint=function(def){this.bodyA=def.bodyA,this.bodyB=def.bodyB,this.userData=def.userData,this.type=def.type,this.next=null};window.Box2D.Dynamics.Joints.b2Joint=B2Joint,B2Joint.prototype.GetBodyA=function(){return this.bodyA},B2Joint.prototype.GetBodyB=function(){return this.bodyB},B2Joint.prototype.GetUserData=function(){return this.userData},B2Joint.prototype.GetType=function(){return this.type},B2Joint.prototype.GetNext=function(){return this.next},B2Joint.e_distanceJoint=0,B2Joint.e_revoluteJoint=1;var B2DistanceJointDef=function(bA,bB,anchorA,anchorB){if(this.type=B2Joint.e_distanceJoint,this.localAnchorA=new B2Vec2,this.localAnchorB=new B2Vec2,this.userData=null,void 0!==bA&&(this.bodyA=bA),void 0!==bB&&(this.bodyB=bB),void 0!==anchorA&&this.localAnchorA.SetV(anchorA),void 0!==anchorB&&this.localAnchorB.SetV(anchorB),void 0!==anchorA&&void 0!==anchorB){var dX=anchorB.x-anchorA.x,dY=anchorB.y-anchorA.y;this.length=Math.sqrt(dX*dX+dY*dY)}this.frequencyHz=0,this.dampingRatio=0};window.Box2D.Dynamics.Joints.b2DistanceJointDef=B2DistanceJointDef;var B2RevoluteJointDef=function(bA,bB,anchorA,anchorB){this.type=B2Joint.e_revoluteJoint,this.localAnchorA=new B2Vec2,this.localAnchorB=new B2Vec2,this.userData=null,void 0!==bA&&(this.bodyA=bA),void 0!==bB&&(this.bodyB=bB),void 0!==anchorA&&this.localAnchorA.SetV(anchorA),void 0!==anchorB&&this.localAnchorB.SetV(anchorB),this.referenceAngle=0,this.lowerAngle=0,this.upperAngle=0,this.maxMotorTorque=0,this.motorSpeed=0,this.enableLimit=!1,this.enableMotor=!1};B2RevoluteJointDef.prototype.Initialize=function(bA,bB,anchor){this.bodyA=bA,this.bodyB=bB,this.localAnchorA=this.bodyA.GetLocalPoint(anchor),this.localAnchorB=this.bodyB.GetLocalPoint(anchor),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()},window.Box2D.Dynamics.Joints.b2RevoluteJointDef=B2RevoluteJointDef}()):console.log("The CocoonJS binding for Box2D has been ignored because ext.IDTK_SRV_BOX2D is not available");!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;"undefined"!=typeof window?b=window:"undefined"!=typeof global?b=global:"undefined"!=typeof self&&(b=self),b.ash=a()}}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a){"use strict";var b,c,d,e,f=function(a,b){return function(){return a.apply(b,arguments)}};e=a("../../../lib"),c=e.core.NodeList,d=e.core.NodePool,b=function(){function a(){}return a}(),e.core.ComponentMatchingFamily=function(){function a(a,b){this.nodeClass=a,this.engine=b,this.releaseNodePoolCache=f(this.releaseNodePoolCache,this),this.init()}return a.prototype.nodes=null,a.prototype.entities=null,a.prototype.nodeClass=null,a.prototype.components=null,a.prototype.nodePool=null,a.prototype.engine=null,a.prototype.init=function(){var a,e,f;this.nodes=new c,this.entities=new b,this.components=new b,this.nodePool=new d(this.nodeClass,this.nodeClass.components),f=this.nodeClass.components;for(a in f)e=f[a],this.components[e.name]=e},Object.defineProperties(a.prototype,{nodeList:{get:function(){return this.nodes}}}),a.prototype.newEntity=function(a){this.addIfMatch(a)},a.prototype.componentAddedToEntity=function(a){this.addIfMatch(a)},a.prototype.componentRemovedFromEntity=function(a,b){b.name in this.components&&this.removeIfMatch(a)},a.prototype.removeEntity=function(a){this.removeIfMatch(a)},a.prototype.addIfMatch=function(a){var b,c,d,e,f;if(null==this.entities[a.name]){e=this.nodeClass.components;for(c in e)if(b=e[c],!a.has(b))return;d=this.nodePool.get(),d.entity=a,f=this.nodeClass.components;for(c in f)b=f[c],d[c]=a.get(b);this.entities[a.name]=d,this.nodes.add(d)}},a.prototype.removeIfMatch=function(a){var b;a.name in this.entities&&(b=this.entities[a.name],delete this.entities[a.name],this.nodes.remove(b),this.engine.updating?(this.nodePool.cache(b),this.engine.updateComplete.add(this.releaseNodePoolCache)):this.nodePool.dispose(b))},a.prototype.releaseNodePoolCache=function(){this.engine.updateComplete.remove(this.releaseNodePoolCache),this.nodePool.releaseCache()},a.prototype.cleanUp=function(){var a;for(a=this.nodes.head;a;)this.entities.remove(a.entity),a=a.next;this.nodes.removeAll()},a}()},{"../../../lib":34}],2:[function(a){"use strict";var b,c,d,e,f,g,h=function(a,b){return function(){return a.apply(b,arguments)}};g=a("../../../lib"),b=g.core.ComponentMatchingFamily,d=g.core.EntityList,e=g.signals.Signal0,f=g.core.SystemList,c=function(){function a(){}return a}(),g.core.Engine=function(){function a(){this.update=h(this.update,this),this.entityList=new d,this.entityNames=new c,this.systemList=new f,this.families=new c,this.updateComplete=new e}return a.prototype.entityNames=null,a.prototype.entityList=null,a.prototype.systemList=null,a.prototype.families=null,a.prototype.updating=!1,a.prototype.updateComplete=null,a.prototype.familyClass=b,Object.defineProperties(a.prototype,{entities:{get:function(){var a,b;for(a=[],b=this.entityList.head;b;)this.entities.push(b),b=b.next;return a}},systems:{get:function(){var a,b;for(b=[],a=this.systemList.head;a;)b.push(a),a=a.next;return b}}}),a.prototype.addEntity=function(a){var b,c,d;if(this.entityNames[a.name])throw"The entity name "+a.name+" is already in use by another entity.";this.entityList.add(a),this.entityNames[a.name]=a,a.componentAdded.add(this.componentAdded),a.componentRemoved.add(this.componentRemoved),a.nameChanged.add(this.entityNameChanged),d=this.families;for(b in d)c=d[b],c.newEntity(a)},a.prototype.removeEntity=function(a){var b,c,d;a.componentAdded.remove(this.componentAdded),a.componentRemoved.remove(this.componentRemoved),a.nameChanged.remove(this.entityNameChanged),d=this.families;for(b in d)c=d[b],c.removeEntity(a);delete this.entityNames[a.name],this.entityList.remove(a)},a.prototype.entityNameChanged=function(a,b){this.entityNames[b]===a&&(delete this.entityNames[b],this.entityNames[a.name]=a)},a.prototype.getEntityByName=function(a){return this.entityNames[a]},a.prototype.removeAllEntities=function(){for(;null!==this.entityList.head;)this.removeEntity(this.entityList.head)},a.prototype.componentAdded=function(a,b){var c,d,e;e=this.families;for(c in e)d=e[c],d.componentAddedToEntity(a,b)},a.prototype.componentRemoved=function(a,b){var c,d,e;e=this.families;for(c in e)d=e[c],d.componentRemovedFromEntity(a,b)},a.prototype.getNodeList=function(a){var b,c;if(a.name in this.families)return this.families[a.name].nodeList;for(c=new this.familyClass(a,this),this.families[a.name]=c,b=this.entityList.head;b;)c.newEntity(b),b=b.next;return c.nodeList},a.prototype.releaseNodeList=function(a){a.name in this.families&&(this.families[a.name].cleanUp(),delete this.families[a.name])},a.prototype.addSystem=function(a,b){a.priority=b,a.addToEngine(this),this.systemList.add(a)},a.prototype.getSystem=function(a){return systemList.get(a)},a.prototype.removeSystem=function(a){this.systemList.remove(a),a.removeFromEngine(this)},a.prototype.removeAllSystems=function(){for(;null!==this.systemList.head;)this.removeSystem(this.systemList.head)},a.prototype.update=function(a){var b;for(this.updating=!0,b=this.systemList.head;b;)b.update(a),b=b.next;this.updating=!1,this.updateComplete.dispatch()},a}()},{"../../../lib":34}],3:[function(a){"use strict";var b,c,d;d=a("../../../lib"),c=d.signals.Signal2,b=function(){function a(){}return a}(),d.core.Entity=function(){function a(a){null==a&&(a=""),Object.defineProperties(this,{name:{get:function(){return this._name},set:function(a){var b;return this._name!==a?(b=this._name,this._name=a,this.nameChanged.dispatch(this,b)):void 0}}}),this.componentAdded=new c,this.componentRemoved=new c,this.nameChanged=new c,this.components=new b,this._name=""!==a?a:"_entity"+ ++d}var d;return d=0,a.prototype._name="",a.prototype.componentAdded=null,a.prototype.componentRemoved=null,a.prototype.nameChanged=null,a.prototype.previous=null,a.prototype.next=null,a.prototype.components=null,a.prototype.add=function(a,b){return null==b&&(b=a.constructor),b.name in this.components&&this.remove(b),this.components[b.name]=a,this.componentAdded.dispatch(this,b),this},a.prototype.remove=function(a){var b,c;return c="string"==typeof a?a:a.name,b=this.components[c],null!==b?(delete this.components[c],this.componentRemoved.dispatch(this,c),b):null},a.prototype.get=function(a){return this.components[a.name]},a.prototype.getAll=function(){var a,b,c,d,e;for(b=[],e=this.components,c=0,d=e.length;d>c;c++)a=e[c],b.push(a);return b},a.prototype.has=function(a){return a.name in this.components},a}()},{"../../../lib":34}],4:[function(a){"use strict";var b;b=a("../../../lib"),b.core.EntityList=function(){function a(){}return a.prototype.head=null,a.prototype.tail=null,a.prototype.add=function(a){null===this.head?(this.head=this.tail=a,a.next=a.previous=null):(this.tail.next=a,a.previous=this.tail,a.next=null,this.tail=a)},a.prototype.remove=function(a){},a.prototype.removeAll=function(){for(var a;null!==this.head;)a=this.head,this.head=this.head.next,a.previous=null,a.next=null;this.tail=null},a}()},{"../../../lib":34}],5:[function(a){"use strict";var b;b=a("../../../lib"),b.core.Family=function(){function a(){Object.defineProperties(this,{nodeList:{get:function(){return this.nodes}}})}return a.prototype.nodes=null,a.prototype.newEntity=function(){throw new Error("Method must be overriden")},a.prototype.removeEntity=function(){throw new Error("Method must be overriden")},a.prototype.componentAddedToEntity=function(){throw new Error("Method must be overriden")},a.prototype.componentRemovedFromEntity=function(){throw new Error("Method must be overriden")},a.prototype.cleanUp=function(){throw new Error("Method must be overriden")},a}()},{"../../../lib":34}],6:[function(a){"use strict";var b;b=a("../../../lib"),b.core.Node=function(){function a(){}return a.prototype.entity=null,a.prototype.previous=null,a.prototype.next=null,a}()},{"../../../lib":34}],7:[function(a){"use strict";var b,c;c=a("../../../lib"),b=c.signals.Signal1,c.core.NodeList=function(){function a(){this.nodeAdded=new b,this.nodeRemoved=new b}return a.prototype.head=null,a.prototype.tail=null,a.prototype.nodeAdded=null,a.prototype.nodeRemoved=null,a.prototype.add=function(a){null===this.head?(this.head=this.tail=a,a.next=a.previous=null):(this.tail.next=a,a.previous=this.tail,a.next=null,this.tail=a),this.nodeAdded.dispatch(a)},a.prototype.remove=function(a){this.head===a&&(this.head=this.head.next),this.tail===a&&(this.tail=this.tail.previous),null!==a.previous&&(a.previous.next=a.next),null!==a.next&&(a.next.previous=a.previous),this.nodeRemoved.dispatch(a)},a.prototype.removeAll=function(){for(var a;null!==this.head;)a=this.head,this.head=this.head.next,a.previous=null,a.next=null,this.nodeRemoved.dispatch(a);this.tail=null},Object.defineProperties(a.prototype,{empty:{get:function(){return null===this.head}}}),a.prototype.swap=function(a,b){var c;a.previous===b?(a.previous=b.previous,b.previous=a,b.next=a.next,a.next=b):b.previous===a?(b.previous=a.previous,a.previous=b,a.next=b.next,b.next=a):(c=a.previous,a.previous=b.previous,b.previous=c,c=a.next,a.next=b.next,b.next=c),this.head===a?this.head=b:this.head===b&&(this.head=a),this.tail===a?this.tail=b:this.tail===b&&(this.tail=a),null!==a.previous&&(a.previous.next=a),null!==b.previous&&(b.previous.next=b),null!==a.next&&(a.next.previous=a),null!==b.next&&(b.next.previous=b)},a.prototype.insertionSort=function(a){var b,c,d;if(this.head!==this.tail)for(d=this.head.next,b=d;null!==b;){for(d=b.next,c=b.previous;null!==c;){if(a(b,c)>=0){b!==c.next&&(this.tail===b&&(this.tail=b.previous),b.previous.next=b.next,null!==b.next&&(b.next.previous=b.previous),b.next=c.next,b.previous=c,b.next.previous=b,c.next=b);break}c=c.previous}null===c&&(this.tail===b&&(this.tail=b.previous),b.previous.next=b.next,null!==b.next&&(b.next.previous=b.previous),b.next=this.head,this.head.previous=b,b.previous=null,this.head=b),b=d}},a.prototype.mergeSort=function(a){var b,c,d,e;if(this.head!==this.tail){for(c=[],e=this.head;null!==e;){for(b=e;null!==b.next&&a(b,b.next)<=0;)b=b.next;d=b.next,e.previous=b.next=null,c.push(e),e=d}for(;c.length>1;)c.push(this.merge(c.shift(),c.shift(),a));for(this.tail=this.head=c[0];null!==this.tail.next;)this.tail=this.tail.next}},a.prototype.merge=function(a,b,c){var d,e;for(c(a,b)<=0?(d=e=a,a=a.next):(d=e=b,b=b.next);null!==a&&null!==b;)c(a,b)<=0?(e.next=a,a.previous=e,e=a,a=a.next):(e.next=b,b.previous=e,e=b,b=b.next);return null!==a?(e.next=a,a.previous=e):(e.next=b,b.previous=e),d},a}()},{"../../../lib":34}],8:[function(a){"use strict";var b;b=a("../../../lib"),b.core.NodePool=function(){function a(a,b){this.nodeClass=a,this.components=b}return a.prototype.tail=null,a.prototype.nodeClass=null,a.prototype.cacheTail=null,a.prototype.components=null,a.prototype.get=function(){var a;return null!==this.tail?(a=this.tail,this.tail=this.tail.previous,a.previous=null,a):new this.nodeClass.constructor},a.prototype.dispose=function(a){var b;for(b in this.components)a[b]=null;a.entity=null,a.next=null,a.previous=this.tail,this.tail=a},a.prototype.cache=function(a){a.previous=this.cacheTail,this.cacheTail=a},a.prototype.releaseCache=function(){for(var a;null!==this.cacheTail;)a=this.cacheTail,this.cacheTail=a.previous,a.next=null,a.previous=this.tail,this.tail=a},a}()},{"../../../lib":34}],9:[function(a){"use strict";var b,c=function(a,b){return function(){return a.apply(b,arguments)}};b=a("../../../lib"),b.core.System=function(){function a(){this.update=c(this.update,this)}return a.prototype.previous=null,a.prototype.next=null,a.prototype.priority=0,a.prototype.addToEngine=function(){},a.prototype.removeFromEngine=function(){},a.prototype.update=function(){},a}()},{"../../../lib":34}],10:[function(a){"use strict";var b;b=a("../../../lib"),b.core.SystemList=function(){function a(){}return a.prototype.head=null,a.prototype.tail=null,a.prototype.add=function(a){var b;if(null===this.head)this.head=this.tail=a,a.next=a.previous=null;else{for(b=this.tail;null!==b&&!(b.priority<=a.priority);)b=b.previous;b===this.tail?(this.tail.next=a,a.previous=this.tail,a.next=null,this.tail=a):null===b?(a.next=this.head,a.previous=null,this.head.previous=a,this.head=a):(a.next=b.next,a.previous=b,b.next.previous=a,b.next=a)}},a.prototype.remove=function(a){this.head===a&&(this.head=this.head.next),this.tail===a&&(this.tail=this.tail.previous),null!==a.previous&&(a.previous.next=a.next),null!==a.next&&(a.next.previous=a.previous)},a.prototype.removeAll=function(){for(var a;null!==this.head;)a=this.head,this.head=this.head.next,a.previous=null,a.next=null;this.tail=null},a.prototype.get=function(a){var b;for(b=this.systemList.head;b;){if(b.constructor===a)return b;b=b.next}return null},a}()},{"../../../lib":34}],11:[function(a){"use strict";var b;b=a("../../../lib"),b.fsm.ComponentInstanceProvider=function(){function a(a){this.instance=a}return a.prototype.instance=null,a.prototype.getComponent=function(){return this.instance},Object.defineProperties(a.prototype,{identifier:{get:function(){return this.instance}}}),a}()},{"../../../lib":34}],12:[function(a){"use strict";var b;b=a("../../../lib"),b.fsm.ComponentSingletonProvider=function(){function a(a){this.componentType=a}return a.prototype.componentType=null,a.prototype.instance=null,a.prototype.getComponent=function(){return null==this.instance&&(this.instance=new this.componentType),this.instance},Object.defineProperties(a.prototype,{identifier:{get:function(){return this.getComponent()}}}),a}()},{"../../../lib":34}],13:[function(a){"use strict";var b;b=a("../../../lib"),b.fsm.ComponentTypeProvider=function(){function a(a){this.componentType=a}return a.prototype.componentType=null,a.prototype.getComponent=function(){return new this.componentType},Object.defineProperties(a.prototype,{identifier:{get:function(){return this.componentType}}}),a}()},{"../../../lib":34}],14:[function(a){"use strict";var b;b=a("../../../lib"),b.fsm.DynamicComponentProvider=function(){function a(a){this._closure=a}return a.prototype._closure=null,a.prototype.getComponent=function(){return this._closure},Object.defineProperties(a.prototype,{identifier:{get:function(){return this._closure}}}),a}()},{"../../../lib":34}],15:[function(a){"use strict";var b;b=a("../../../lib"),b.fsm.DynamicSystemProvider=function(){function a(a){this.method=a}return a.prototype.method=function(){},a.prototype.systemPriority=0,a.prototype.getSystem=function(){return this.method()},Object.defineProperties(a.prototype,{identifier:{get:function(){return this.method}},priority:{get:function(){return this.systemPriority},set:function(a){return this.systemPriority=a}}}),a}()},{"../../../lib":34}],16:[function(a){"use strict";var b,c,d,e,f;f=a("../../../lib"),d=f.fsm.SystemInstanceProvider,e=f.fsm.SystemSingletonProvider,b=f.fsm.DynamicSystemProvider,c=f.fsm.StateSystemMapping,f.fsm.EngineState=function(){function a(){this.providers=[]}return a.prototype.providers=null,a.prototype.addInstance=function(a){return this.addProvider(new d(a))},a.prototype.addSingleton=function(a){return this.addProvider(new e(a))},a.prototype.addMethod=function(a){return this.addProvider(new b(a))},a.prototype.addProvider=function(a){var b;return b=new c(this,a),this.providers.push(a),b},a}()},{"../../../lib":34}],17:[function(a){"use strict";var b,c,d;d=a("../../../lib"),c=d.fsm.EngineState,b=function(){function a(){}return a}(),d.fsm.EngineStateMachine=function(){function a(a){this.engine=a,this.states=new b}return a.prototype.engine=null,a.prototype.states=null,a.prototype.currentState=null,a.prototype.addState=function(a,b){return this.states[a]=b,this},a.prototype.createState=function(a){var b;return b=new c,this.states[a]=b,this},a.prototype.changeState=function(a){var c,d,e,f,g,h,i,j;if(e=this.states[a],null==e)throw new Error("Engine state "+a+" doesn't exist");if(e===this.currentState)return void(e=null);h=new b,i=e.providers;for(c in i)g=i[c],d=g.identifier,h[d]=g;if(currentState){j=this.currentState.providers;for(c in j)g=j[c],d=g.identifier,f=h[d],f?delete h[d]:this.engine.removeSystem(g.getSystem())}for(c in h)g=h[c],this.engine.addSystem(g.getSystem(),g.priority);return this.currentState=e},a}()},{"../../../lib":34}],18:[function(a){"use strict";var b,c,d;d=a("../../../lib"),c=d.fsm.StateComponentMapping,b=function(){function a(){}return a}(),d.fsm.EntityState=function(){function a(){this.providers=new b}return a.prototype.providers=null,a.prototype.add=function(a){return new c(this,a)},a.prototype.get=function(a){return this.providers[a]},a.prototype.has=function(a){return null!==this.providers[a]},a}()},{"../../../lib":34}],19:[function(a){"use strict";var b,c,d;d=a("../../../lib"),c=d.fsm.EntityState,b=function(){function a(){}return a}(),d.fsm.EntityStateMachine=function(){function a(a){this.entity=a,this.states=new b}return a.prototype.states=null,a.prototype.currentState=null,a.prototype.entity=null,a.prototype.createState=function(){var a;return a=new c,this.states.push(a),a},a.prototype.changeState=function(a){var c,d,e,f,g;if(d=this.states[a],!d)throw new Error("Entity state "+a+" doesn't exist");if(d===this.currentState)return void(d=null);if(this.currentState){f=new b;for(g in d.providers)f[g]=d.providers[g];for(g in this.currentState.providers)e=f[g],e&&e.identifier===c.providers[g].identifier?delete f[g]:this.entity.remove(g)}else f=d.providers;for(g in f)this.entity.add(f[g].getComponent(),g);return c=d},a}()},{"../../../lib":34}],20:[function(a){"use strict";var b,c,d,e,f;f=a("../../../lib"),b=f.fsm.ComponentInstanceProvider,d=f.fsm.ComponentTypeProvider,c=f.fsm.ComponentSingletonProvider,e=f.fsm.DynamicComponentProvider,f.fsm.StateComponentMapping=function(){function a(a,b){this.creatingState=a,this.componentType=b,this.withType(b)}return a.prototype.componentType=null,a.prototype.creatingState=null,a.prototype.provider=null,a.prototype.withInstance=function(a){return this.setProvider(new b(a)),this},a.prototype.withType=function(a){return this.setProvider(new d(a)),this},a.prototype.withSingleton=function(a){return null==a&&(a=this.componentType),this.setProvider(new c(a)),this},a.prototype.withMethod=function(a){return this.setProvider(new e(a)),this},a.prototype.withProvider=function(a){return this.setProvider(a),this},a.prototype.add=function(a){return this.creatingState.add(a)},a.prototype.setProvider=function(a){return this.provider=a,this.creatingState.providers[this.componentType]=a},a}()},{"../../../lib":34}],21:[function(a){"use strict";var b;b=a("../../../lib"),b.fsm.StateSystemMapping=function(){function a(a,b){this.creatingState=a,this.provider=b}return a.prototype.creatingState=null,a.prototype.provider=null,a.prototype.withPriority=function(a){return this.provider.priority=a,this},a.prototype.addInstance=function(a){return creatingState.addInstance(a)},a.prototype.addSingleton=function(a){return creatingState.addSingleton(a)},a.prototype.addMethod=function(a){return creatingState.addMethod(a)},a.prototype.addProvider=function(a){return creatingState.addProvider(a)},a}()},{"../../../lib":34}],22:[function(a){"use strict";var b;b=a("../../../lib"),b.fsm.SystemInstanceProvider=function(){function a(a){this.instance=a}return a.prototype.instance=null,a.prototype.systemPriority=0,a.prototype.getSystem=function(){return this.instance},Object.defineProperties(a.prototype,{identifier:{get:function(){return this.instance}},priority:{get:function(){return this.systemPriority},set:function(a){return this.systemPriority=a}}}),a}()},{"../../../lib":34}],23:[function(a){"use strict";var b;b=a("../../../lib"),b.fsm.SystemSingletonProvider=function(){function a(a){this.componentType=a}return a.prototype.componentType=null,a.prototype.instance=null,a.prototype.systemPriority=0,a.prototype.getSystem=function(){return this.instance||(this.instance=new this.componentType),this.instance},Object.defineProperties(a.prototype,{identifier:{get:function(){return this.getSystem()}},priority:{get:function(){return this.systemPriority},set:function(a){return this.systemPriority=a}}}),a}()},{"../../../lib":34}],24:[function(a){"use strict";var b;b=a("../../../lib"),b.signals.ListenerNode=function(){function a(){}return a.prototype.previous=null,a.prototype.next=null,a.prototype.listener=null,a.prototype.once=!1,a}()},{"../../../lib":34}],25:[function(a){"use strict";var b,c;c=a("../../../lib"),b=c.signals.ListenerNode,c.signals.ListenerNodePool=function(){function a(){}return a.prototype.tail=null,a.prototype.cacheTail=null,a.prototype.get=function(){var a;return null!==this.tail?(a=this.tail,this.tail=this.tail.previous,a.previous=null,a):new b},a.prototype.dispose=function(a){a.listener=null,a.once=!1,a.next=null,a.previous=this.tail,this.tail=a},a.prototype.cache=function(a){a.listener=null,a.previous=this.cacheTail,this.cacheTail=a},a.prototype.releaseCache=function(){for(var a;null!==this.cacheTail;)a=this.cacheTail,this.cacheTail=a.previous,a.next=null,a.previous=this.tail,this.tail=a},a}()},{"../../../lib":34}],26:[function(a){"use strict";var b,c={}.hasOwnProperty,d=function(a,b){function d(){this.constructor=a}for(var e in b)c.call(b,e)&&(a[e]=b[e]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};b=a("../../../lib"),b.signals.Signal0=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return d(b,a),b.prototype.dispatch=function(){var a;for(this.startDispatch(),a=this.head;null!==a;)a.listener(),a.once&&this.remove(a.listener),a=a.next;return this.endDispatch()},b}(b.signals.SignalBase)},{"../../../lib":34}],27:[function(a){"use strict";var b,c={}.hasOwnProperty,d=function(a,b){function d(){this.constructor=a}for(var e in b)c.call(b,e)&&(a[e]=b[e]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};b=a("../../../lib"),b.signals.Signal1=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return d(b,a),b.prototype.dispatch=function(a){var b;for(this.startDispatch(),b=this.head;null!==b;)b.listener(a),b.once&&this.remove(b.listener),b=b.next;return this.endDispatch()},b}(b.signals.SignalBase)},{"../../../lib":34}],28:[function(a){"use strict";var b,c={}.hasOwnProperty,d=function(a,b){function d(){this.constructor=a}for(var e in b)c.call(b,e)&&(a[e]=b[e]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};b=a("../../../lib"),b.signals.Signal2=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return d(b,a),b.prototype.dispatch=function(a,b){var c;for(this.startDispatch(),c=this.head;null!==c;)c.listener(a,b),c.once&&this.remove(c.listener),c=c.next;return this.endDispatch()},b}(b.signals.SignalBase)},{"../../../lib":34}],29:[function(a){"use strict";
var b,c={}.hasOwnProperty,d=function(a,b){function d(){this.constructor=a}for(var e in b)c.call(b,e)&&(a[e]=b[e]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};b=a("../../../lib"),b.signals.Signal3=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return d(b,a),b.prototype.dispatch=function(a,b,c){var d;for(this.startDispatch(),d=this.head;null!==d;)d.listener(a,b,c),d.once&&this.remove(d.listener),d=d.next;return this.endDispatch()},b}(b.signals.SignalBase)},{"../../../lib":34}],30:[function(a){"use strict";var b,c;c=a("../../../lib"),b=c.signals.ListenerNodePool,c.signals.SignalBase=function(){function a(){this.listenerNodePool=new b,this.numListeners=0}return a.prototype.head=null,a.prototype.tail=null,a.prototype.numListeners=0,a.prototype.listenerNodePool=null,a.prototype.toAddHead=null,a.prototype.toAddTail=null,a.prototype.dispatching=!1,a.prototype.startDispatch=function(){this.dispatching=!0},a.prototype.endDispatch=function(){this.dispatching=!1,null!==this.toAddHead&&(null===this.head?(this.head=this.toAddHead,this.tail=this.toAddTail):(this.tail.next=this.toAddHead,this.toAddHead.previous=this.tail,this.tail=this.toAddTail),this.toAddHead=null,this.toAddTail=null),this.listenerNodePool.releaseCache()},a.prototype.getNode=function(a){var b;for(b=this.head;null!==b&&b.listener!==a;)b=b.next;if(null===b)for(b=this.toAddHead;null!==b&&b.listener!==a;)b=b.next;return b},a.prototype.nodeExists=function(a){return null!==this.getNode(a)},a.prototype.add=function(a){var b;this.nodeExists(a)||(b=this.listenerNodePool.get(),b.listener=a,this.addNode(b))},a.prototype.addOnce=function(a){var b;this.nodeExists(a)||(b=this.listenerNodePool.get(),b.listener=a,b.once=!0,this.addNode(b))},a.prototype.addNode=function(a){this.dispatching?null===this.toAddHead?this.toAddHead=this.toAddTail=a:(this.toAddTail.next=a,a.previous=this.toAddTail,this.toAddTail=a):null===this.head?this.head=this.tail=a:(this.tail.next=a,a.previous=this.tail,this.tail=a),this.numListeners++},a.prototype.remove=function(a){var b;b=this.getNode(a),null!==b&&(this.head===b&&(this.head=this.head.next),this.tail===b&&(this.tail=this.tail.previous),this.toAddHead===b&&(this.toAddHead=this.toAddHead.next),this.toAddTail===b&&(this.toAddTail=this.toAddTail.previous),null!==b.previous&&(b.previous.next=b.next),null!==b.next&&(b.next.previous=b.previous),this.dispatching?this.listenerNodePool.cache(b):this.listenerNodePool.dispose(b),this.numListeners--)},a.prototype.removeAll=function(){for(var a;null!==this.head;)a=this.head,this.head=this.head.next,this.listenerNodePool.dispose(a);this.tail=null,this.toAddHead=null,this.toAddTail=null,this.numListeners=0},a}()},{"../../../lib":34}],31:[function(a){"use strict";var b,c,d=function(a,b){return function(){return a.apply(b,arguments)}},e={}.hasOwnProperty,f=function(a,b){function c(){this.constructor=a}for(var d in b)e.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};c=a("../../../lib"),b=c.signals.Signal1,c.tick.FrameTickProvider=function(a){function b(a,c){this.displayObject=a,this.maximumFrameTime=c,this.dispatchTick=d(this.dispatchTick,this),b.__super__.constructor.apply(this,arguments)}return f(b,a),b.prototype.displayObject=null,b.prototype.previousTime=0,b.prototype.maximumFrameTime=0,b.prototype.isPlaying=!1,b.prototype.request=null,b.prototype.timeAdjustment=1,Object.defineProperties(b.prototype,{playing:{get:function(){return this.isPlaying}}}),b.prototype.start=function(){this.request=requestAnimationFrame(this.dispatchTick),this.isPlaying=!0},b.prototype.stop=function(){cancelRequestAnimationFrame(this.request),this.isPlaying=!1},b.prototype.dispatchTick=function(a){var b,c;null==a&&(a=Date.now()),this.displayObject&&this.displayObject.begin(),c=this.previousTime||a,this.previousTime=a,b=.001*(a-c),this.dispatch(b),requestAnimationFrame(this.dispatchTick),this.displayObject&&this.displayObject.end()},b}(b)},{"../../../lib":34}],32:[function(a){"use strict";var b,c,d=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};c=a("../../../lib"),b=function(){function a(){}return a}(),c.tools.ComponentPool=function(){function a(){}var c,e;return e=new b,c=function(a){var b;return b=a.name,d.call(e,b)>=0?e[a.name]:e[a.name]=[]},a.get=function(a){var b;return b=c(a),b.length>0?b.pop():new a},a.dispose=function(a){var b,d;a&&(d=a.constructor,b=c(d),b.push(a))},a.empty=function(){return e=new b},a}()},{"../../../lib":34}],33:[function(a){"use strict";var b,c,d,e,f,g={}.hasOwnProperty,h=function(a,b){function c(){this.constructor=a}for(var d in b)g.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};f=a("../../../lib"),b=f.core.Engine,c=f.core.Node,d=f.core.NodeList,e=f.core.System,f.tools.ListIteratingSystem=function(a){function b(a,b,c,d){null==c&&(c=null),null==d&&(d=null),this.nodeClass=a,this.nodeUpdateFunction=b,this.nodeAddedFunction=c,this.nodeRemovedFunction=d}return h(b,a),b.prototype.nodeList=null,b.prototype.nodeClass=null,b.prototype.nodeUpdateFunction=null,b.prototype.nodeAddedFunction=null,b.prototype.nodeRemovedFunction=null,b.prototype.addToEngine=function(a){if(this.nodeList=a.getNodeList(this.nodeClass),null!==this.nodeAddedFunction){for(var b=this.nodeList.head;b;b=b.next)this.nodeAddedFunction(b);this.nodeList.nodeAdded.add(this.nodeAddedFunction)}null!==this.nodeRemovedFunction&&this.nodeList.nodeRemoved.add(this.nodeRemovedFunction)},b.prototype.removeFromEngine=function(){null!==this.nodeAddedFunction&&this.nodeList.nodeAdded.remove(this.nodeAddedFunction),null!==this.nodeRemovedFunction&&this.nodeList.nodeRemoved.remove(this.nodeRemovedFunction),this.nodeList=null},b.prototype.update=function(a){for(var b=this.nodeList.head;b;b=b.next)this.nodeUpdateFunction(b,a)},b}(e)},{"../../../lib":34}],34:[function(a,b){"use strict";var c;b.exports=c=function(){function a(){}return a}(),c.signals=function(){function a(){}return a}(),a("./ash/signals/listener_node"),a("./ash/signals/listener_node_pool"),a("./ash/signals/signal_base"),a("./ash/signals/signal0"),a("./ash/signals/signal1"),a("./ash/signals/signal2"),a("./ash/signals/signal3"),c.core=function(){function a(){}return a}(),a("./ash/core/entity"),a("./ash/core/entity_list"),a("./ash/core/node"),a("./ash/core/node_list"),a("./ash/core/node_pool"),a("./ash/core/system"),a("./ash/core/system_list"),a("./ash/core/family"),a("./ash/core/component_matching_family"),a("./ash/core/engine"),c.fsm=function(){function a(){}return a}(),a("./ash/fsm/component_instance_provider"),a("./ash/fsm/component_singleton_provider"),a("./ash/fsm/component_type_provider"),a("./ash/fsm/dynamic_component_provider"),a("./ash/fsm/dynamic_system_provider"),a("./ash/fsm/engine_state"),a("./ash/fsm/engine_state_machine"),a("./ash/fsm/entity_state"),a("./ash/fsm/entity_state_machine"),a("./ash/fsm/state_component_mapping"),a("./ash/fsm/state_system_mapping"),a("./ash/fsm/system_instance_provider"),a("./ash/fsm/system_singleton_provider"),c.tick=function(){function a(){}return a}(),a("./ash/tick/frame_tick_provider"),c.tools=function(){function a(){}return a}(),a("./ash/tools/component_pool"),a("./ash/tools/list_iterating_system")},{"./ash/core/component_matching_family":1,"./ash/core/engine":2,"./ash/core/entity":3,"./ash/core/entity_list":4,"./ash/core/family":5,"./ash/core/node":6,"./ash/core/node_list":7,"./ash/core/node_pool":8,"./ash/core/system":9,"./ash/core/system_list":10,"./ash/fsm/component_instance_provider":11,"./ash/fsm/component_singleton_provider":12,"./ash/fsm/component_type_provider":13,"./ash/fsm/dynamic_component_provider":14,"./ash/fsm/dynamic_system_provider":15,"./ash/fsm/engine_state":16,"./ash/fsm/engine_state_machine":17,"./ash/fsm/entity_state":18,"./ash/fsm/entity_state_machine":19,"./ash/fsm/state_component_mapping":20,"./ash/fsm/state_system_mapping":21,"./ash/fsm/system_instance_provider":22,"./ash/fsm/system_singleton_provider":23,"./ash/signals/listener_node":24,"./ash/signals/listener_node_pool":25,"./ash/signals/signal0":26,"./ash/signals/signal1":27,"./ash/signals/signal2":28,"./ash/signals/signal3":29,"./ash/signals/signal_base":30,"./ash/tick/frame_tick_provider":31,"./ash/tools/component_pool":32,"./ash/tools/list_iterating_system":33}]},{},[34])(34)});!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var f;"undefined"!=typeof window?f=window:"undefined"!=typeof global?f=global:"undefined"!=typeof self&&(f=self),f.Example=e()}}(function(){var define,module,exports;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){"use strict";var example;module.exports=example=function(){function example(){}return example}();example.input=function(){function input(){}return input}();require("./src/input/key_poll");example.graphics=function(){function graphics(){}return graphics}();require("./src/graphics/point");require("./src/graphics/asteroid_view");require("./src/graphics/bullet_view");require("./src/graphics/spaceship_view");example.components=function(){function components(){}return components}();require("./src/components/animation");require("./src/components/asteroid");require("./src/components/audio");require("./src/components/bullet");require("./src/components/collision");require("./src/components/death_throes");require("./src/components/display");require("./src/components/game_state");require("./src/components/gun");require("./src/components/gun_controls");require("./src/components/hud");require("./src/components/motion");require("./src/components/motion_controls");require("./src/components/physics");require("./src/components/position");require("./src/components/spaceship");require("./src/components/wait_for_start");example.nodes=function(){function nodes(){}return nodes}();require("./src/nodes/asteroid_collision");require("./src/nodes/bullet_age");require("./src/nodes/bullet_collision");require("./src/nodes/gun_control");require("./src/nodes/motion_control");require("./src/nodes/movement");require("./src/nodes/physics");require("./src/nodes/render");require("./src/nodes/spaceship_collision");example.systems=function(){function systems(){}return systems}();require("./src/systems/bullet_age_system");require("./src/systems/collision_system");require("./src/systems/game_manager");require("./src/systems/gun_control_system");require("./src/systems/motion_control_system");require("./src/systems/movement_system");require("./src/systems/physics_system");require("./src/systems/render_system");require("./src/systems/system_priorities");require("./src/entity_creator");require("./src/asteroids");require("./src/main")},{"./src/asteroids":2,"./src/components/animation":3,"./src/components/asteroid":4,"./src/components/audio":5,"./src/components/bullet":6,"./src/components/collision":7,"./src/components/death_throes":8,"./src/components/display":9,"./src/components/game_state":10,"./src/components/gun":11,"./src/components/gun_controls":12,"./src/components/hud":13,"./src/components/motion":14,"./src/components/motion_controls":15,"./src/components/physics":16,"./src/components/position":17,"./src/components/spaceship":18,"./src/components/wait_for_start":19,"./src/entity_creator":20,"./src/graphics/asteroid_view":21,"./src/graphics/bullet_view":22,"./src/graphics/point":23,"./src/graphics/spaceship_view":24,"./src/input/key_poll":25,"./src/main":26,"./src/nodes/asteroid_collision":27,"./src/nodes/bullet_age":28,"./src/nodes/bullet_collision":29,"./src/nodes/gun_control":30,"./src/nodes/motion_control":31,"./src/nodes/movement":32,"./src/nodes/physics":33,"./src/nodes/render":34,"./src/nodes/spaceship_collision":35,"./src/systems/bullet_age_system":36,"./src/systems/collision_system":37,"./src/systems/game_manager":38,"./src/systems/gun_control_system":39,"./src/systems/motion_control_system":40,"./src/systems/movement_system":41,"./src/systems/physics_system":42,"./src/systems/render_system":43,"./src/systems/system_priorities":44}],2:[function(require,module,exports){"use strict";var BulletAgeSystem,CollisionSystem,EntityCreator,GameManager,GameState,GunControlSystem,KeyPoll,MotionControlSystem,MovementSystem,PhysicsSystem,RenderSystem,SystemPriorities,ash,b2Vec2,b2World,example;ash=require("../../lib");example=require("../../example");GameState=example.components.GameState;GameManager=example.systems.GameManager;MotionControlSystem=example.systems.MotionControlSystem;GunControlSystem=example.systems.GunControlSystem;BulletAgeSystem=example.systems.BulletAgeSystem;MovementSystem=example.systems.MovementSystem;CollisionSystem=example.systems.CollisionSystem;PhysicsSystem=example.systems.PhysicsSystem;RenderSystem=example.systems.RenderSystem;SystemPriorities=example.systems.SystemPriorities;EntityCreator=example.EntityCreator;KeyPoll=example.input.KeyPoll;b2Vec2=Box2D.Common.Math.b2Vec2;b2World=Box2D.Dynamics.b2World;example.Asteroids=function(){Asteroids.prototype.container=null;Asteroids.prototype.engine=null;Asteroids.prototype.tickProvider=null;Asteroids.prototype.creator=null;Asteroids.prototype.keyPoll=null;Asteroids.prototype.config=null;function Asteroids(container,width,height){this.container=container;this.prepare(width,height)}Asteroids.prototype.prepare=function(width,height){this.world=new b2World(new b2Vec2(0,0),true);this.engine=new ash.core.Engine;this.creator=new EntityCreator(this.engine,this.container,this.world);this.keyPoll=new KeyPoll(window);this.config=new GameState;this.config.height=height;this.config.width=width;this.engine.addSystem(new PhysicsSystem(this.world),SystemPriorities.preUpdate);this.engine.addSystem(new GameManager(this.config,this.creator),SystemPriorities.preUpdate);this.engine.addSystem(new MotionControlSystem(this.keyPoll),SystemPriorities.update);this.engine.addSystem(new GunControlSystem(this.keyPoll,this.creator),SystemPriorities.update);this.engine.addSystem(new BulletAgeSystem(this.creator),SystemPriorities.update);this.engine.addSystem(new MovementSystem(this.config),SystemPriorities.move);this.engine.addSystem(new CollisionSystem(this.creator),SystemPriorities.resolveCollisions);this.engine.addSystem(new RenderSystem(this.container),SystemPriorities.render)};Asteroids.prototype.start=function(){var stats;if(!navigator.isCocoonJS){stats=new Stats;stats.setMode(0);stats.domElement.style.position="absolute";stats.domElement.style.left="0px";stats.domElement.style.top="0px";document.body.appendChild(stats.domElement)}this.tickProvider=new ash.tick.FrameTickProvider(stats);this.tickProvider.add(this.engine.update);this.tickProvider.start()};return Asteroids}()},{"../../example":1,"../../lib":78}],3:[function(require,module,exports){"use strict";var example;example=require("../../../example");example.components.Animation=function(){Animation.prototype.animation=null;function Animation(animation){this.animation=animation}return Animation}()},{"../../../example":1}],4:[function(require,module,exports){"use strict";var example;example=require("../../../example");example.components.Asteroid=function(){function Asteroid(){}return Asteroid}()},{"../../../example":1}],5:[function(require,module,exports){"use strict";var example;example=require("../../../example");example.components.Audio=function(){Audio.prototype.toPlay=null;function Audio(){this.toPlay=[]}Audio.prototype.play=function(sound){return this.toPlay.push(sound)};return Audio}()},{"../../../example":1}],6:[function(require,module,exports){"use strict";var example;example=require("../../../example");example.components.Bullet=function(){Bullet.prototype.lifeRemaining=0;function Bullet(lifeRemaining){this.lifeRemaining=lifeRemaining}return Bullet}()},{"../../../example":1}],7:[function(require,module,exports){"use strict";var example;example=require("../../../example");example.components.Collision=function(){Collision.prototype.radius=0;function Collision(radius){this.radius=radius}return Collision}()},{"../../../example":1}],8:[function(require,module,exports){"use strict";var example;example=require("../../../example");example.components.DeathThroes=function(){DeathThroes.prototype.countdown=0;function DeathThroes(duration){this.countdown=duration}return DeathThroes}()},{"../../../example":1}],9:[function(require,module,exports){"use strict";var example;example=require("../../../example");example.components.Display=function(){Display.prototype.graphic=0;function Display(graphic){this.graphic=graphic}return Display}()},{"../../../example":1}],10:[function(require,module,exports){"use strict";var example;example=require("../../../example");example.components.GameState=function(){GameState.prototype.width=0;GameState.prototype.height=0;GameState.prototype.lives=3;GameState.prototype.level=0;GameState.prototype.points=0;GameState.prototype.playing=false;function GameState(width,height){this.width=width;this.height=height;this.lives=3;this.level=0;this.points=0;this.playing=true}return GameState}()},{"../../../example":1}],11:[function(require,module,exports){"use strict";var Point,example;example=require("../../../example");Point=example.graphics.Point;example.components.Gun=function(){Gun.prototype.shooting=false;Gun.prototype.offsetFromParent=null;Gun.prototype.timeSinceLastShot=0;Gun.prototype.offsetFromParent=null;function Gun(offsetX,offsetY,minimumShotInterval,bulletLifetime){this.minimumShotInterval=minimumShotInterval;this.bulletLifetime=bulletLifetime;this.shooting=false;this.offsetFromParent=null;this.timeSinceLastShot=0;this.offsetFromParent=new Point(offsetX,offsetY)}return Gun}()},{"../../../example":1}],12:[function(require,module,exports){"use strict";var example;example=require("../../../example");example.components.GunControls=function(){GunControls.prototype.trigger=0;function GunControls(trigger){this.trigger=trigger}return GunControls}()},{"../../../example":1}],13:[function(require,module,exports){"use strict";var example;example=require("../../../example");example.components.Hud=function(){Hud.prototype.view=null;function Hud(view){this.view=view}return Hud}()},{"../../../example":1}],14:[function(require,module,exports){"use strict";var Point,example;example=require("../../../example");Point=example.graphics.Point;example.components.Motion=function(){Motion.prototype.velocity=null;Motion.prototype.angularVelocity=0;Motion.prototype.damping=0;function Motion(velocityX,velocityY,angularVelocity,damping){this.angularVelocity=angularVelocity;this.damping=damping;this.velocity=new Point(velocityX,velocityY)}return Motion}()},{"../../../example":1}],15:[function(require,module,exports){"use strict";var example;example=require("../../../example");example.components.MotionControls=function(){MotionControls.prototype.left=0;MotionControls.prototype.right=0;MotionControls.prototype.accelerate=0;MotionControls.prototype.accelerationRate=0;MotionControls.prototype.rotationRate=0;function MotionControls(left,right,accelerate,accelerationRate,rotationRate){this.left=left;this.right=right;this.accelerate=accelerate;this.accelerationRate=accelerationRate;this.rotationRate=rotationRate}return MotionControls}()},{"../../../example":1}],16:[function(require,module,exports){"use strict";var example;example=require("../../../example");example.components.Physics=function(){Physics.prototype.body=null;function Physics(body){this.body=body}return Physics}()},{"../../../example":1}],17:[function(require,module,exports){"use strict";var Point,example;example=require("../../../example");Point=example.graphics.Point;example.components.Position=function(){Position.prototype.position=null;Position.prototype.rotation=0;Position.prototype.collisionRadius=0;function Position(x,y,rotation,collisionRadius){this.rotation=rotation;this.collisionRadius=collisionRadius;this.position=new Point(x,y)}return Position}()},{"../../../example":1}],18:[function(require,module,exports){"use strict";var example;example=require("../../../example");example.components.Spaceship=function(){Spaceship.prototype.fsm=null;function Spaceship(fsm){this.fsm=fsm}return Spaceship}()},{"../../../example":1}],19:[function(require,module,exports){"use strict";var example,__bind=function(fn,me){return function(){return fn.apply(me,arguments)}};example=require("../../../example");example.components.WaitForStart=function(){WaitForStart.prototype.waitForStart=null;WaitForStart.prototype.startGame=false;function WaitForStart(waitForStart){this.waitForStart=waitForStart;this.setStartGame=__bind(this.setStartGame,this);this.waitForStart.click.add(this.setStartGame)}WaitForStart.prototype.setStartGame=function(){return this.startGame=true};return WaitForStart}()},{"../../../example":1}],20:[function(require,module,exports){"use strict";var Animation,Asteroid,AsteroidView,Audio,Bullet,BulletView,Collision,DeathThroes,Display,GameState,Gun,GunControls,Hud,Motion,MotionControls,Physics,Position,Spaceship,SpaceshipView,WaitForStart,ash,b2Body,b2BodyDef,b2CircleShape,b2Contact,b2ContactFilter,b2ContactListener,b2DebugDraw,b2DistanceJointDef,b2Fixture,b2FixtureDef,b2Joint,b2Mat22,b2Math,b2PolygonShape,b2RevoluteJointDef,b2Transform,b2Vec2,b2World,example;ash=require("../../lib");example=require("../../example");Animation=example.components.Animation;Asteroid=example.components.Asteroid;Audio=example.components.Audio;Bullet=example.components.Bullet;Collision=example.components.Collision;DeathThroes=example.components.DeathThroes;Display=example.components.Display;GameState=example.components.GameState;Gun=example.components.Gun;GunControls=example.components.GunControls;Hud=example.components.Hud;Motion=example.components.Motion;MotionControls=example.components.MotionControls;Physics=example.components.Physics;Position=example.components.Position;Spaceship=example.components.Spaceship;WaitForStart=example.components.WaitForStart;AsteroidView=example.graphics.AsteroidView;BulletView=example.graphics.BulletView;SpaceshipView=example.graphics.SpaceshipView;b2Mat22=Box2D.Common.Math.b2Mat22;b2Math=Box2D.Common.Math.b2Math;b2Transform=Box2D.Common.Math.b2Transform;b2Vec2=Box2D.Common.Math.b2Vec2;b2Body=Box2D.Dynamics.b2Body;b2BodyDef=Box2D.Dynamics.b2BodyDef;b2Contact=Box2D.Dynamics.b2Contact;b2ContactFilter=Box2D.Dynamics.b2ContactFilter;b2ContactListener=Box2D.Dynamics.b2ContactListener;b2DebugDraw=Box2D.Dynamics.b2DebugDraw;b2Fixture=Box2D.Dynamics.b2Fixture;b2FixtureDef=Box2D.Dynamics.b2FixtureDef;b2World=Box2D.Dynamics.b2World;b2CircleShape=Box2D.Collision.Shapes.b2CircleShape;b2PolygonShape=Box2D.Collision.Shapes.b2PolygonShape;b2DistanceJointDef=Box2D.Dynamics.Joints.b2DistanceJointDef;b2Joint=Box2D.Dynamics.Joints.b2Joint;b2RevoluteJointDef=Box2D.Dynamics.Joints.b2RevoluteJointDef;example.EntityCreator=function(){var KEY_LEFT,KEY_RIGHT,KEY_UP,KEY_Z;KEY_LEFT=37;KEY_UP=38;KEY_RIGHT=39;KEY_Z=90;EntityCreator.prototype.game=null;EntityCreator.prototype.graphics=null;function EntityCreator(game,graphics,world){this.game=game;this.graphics=graphics;this.world=world}EntityCreator.prototype.destroyEntity=function(entity){this.game.removeEntity(entity)};EntityCreator.prototype.createAsteroid=function(radius,x,y){var angularVelocity,asteroid,collisionRadius,damping,rotation,velocityX,velocityY;velocityX=(Math.random()-.5)*4*(50-radius);velocityY=(Math.random()-.5)*4*(50-radius);angularVelocity=Math.random()*2-1;damping=0;rotation=0;collisionRadius=radius;asteroid=(new ash.core.Entity).add(new Asteroid).add(new Position(x,y,rotation,collisionRadius)).add(new Motion(velocityX,velocityY,angularVelocity,damping)).add(new Display(new AsteroidView(this.graphics,radius)));this.game.addEntity(asteroid);return asteroid};EntityCreator.prototype.createSpaceship=function(){var angularVelocity,body,bodyDef,collisionRadius,damping,fixDef,rotation,spaceship,velocityX,velocityY,vertices,x,y;velocityX=0;velocityY=0;angularVelocity=0;damping=15;x=400;y=300;rotation=1;collisionRadius=6;bodyDef=new b2BodyDef;bodyDef.type=b2Body.b2_dynamicBody;bodyDef.fixedRotation=true;bodyDef.position.x=x;bodyDef.position.y=y;bodyDef.linearVelocity.Set(velocityX,velocityY);bodyDef.angularVelocity=angularVelocity;vertices=[new b2Vec2(.45,0),new b2Vec2(-.25,.25),new b2Vec2(-.25,-.25)];fixDef=new b2FixtureDef;fixDef.density=1;fixDef.friction=.5;fixDef.restitution=.2;fixDef.shape=new b2PolygonShape;fixDef.shape.SetAsArray(vertices,vertices.length);body=this.world.CreateBody(bodyDef);body.CreateFixture(fixDef);spaceship=(new ash.core.Entity).add(new Spaceship).add(new Physics(body)).add(new Position(x,y,rotation,collisionRadius)).add(new Motion(velocityX,velocityY,angularVelocity,damping)).add(new MotionControls(KEY_LEFT,KEY_RIGHT,KEY_UP,100,3)).add(new Gun(8,0,.3,2)).add(new GunControls(KEY_Z)).add(new Display(new SpaceshipView(this.graphics)));body.SetUserData(spaceship);this.game.addEntity(spaceship);return spaceship};EntityCreator.prototype.createUserBullet=function(gun,parentPosition){var angularVelocity,bullet,collisionRadius,cos,damping,rotation,sin,velocityX,velocityY,x,y;cos=Math.cos(parentPosition.rotation);sin=Math.sin(parentPosition.rotation);velocityX=cos*150;velocityY=sin*150;angularVelocity=0;damping=0;x=cos*gun.offsetFromParent.x-sin*gun.offsetFromParent.y+parentPosition.position.x;y=sin*gun.offsetFromParent.x+cos*gun.offsetFromParent.y+parentPosition.position.y;rotation=0;collisionRadius=0;bullet=(new ash.core.Entity).add(new Bullet(gun.bulletLifetime)).add(new Position(x,y,rotation,collisionRadius)).add(new Motion(velocityX,velocityY,angularVelocity,damping)).add(new Display(new BulletView(this.graphics)));this.game.addEntity(bullet);return bullet};return EntityCreator}()},{"../../example":1,"../../lib":78}],21:[function(require,module,exports){"use strict";var example;example=require("../../../example");example.graphics.AsteroidView=function(){AsteroidView.prototype.x=0;AsteroidView.prototype.y=0;AsteroidView.prototype.width=0;AsteroidView.prototype.height=0;AsteroidView.prototype.rotation=0;AsteroidView.prototype.graphic=null;AsteroidView.prototype.radius=0;AsteroidView.prototype.points=null;AsteroidView.prototype.count=0;function AsteroidView(graphic,radius){var angle,length,posX,posY;this.graphic=graphic;this.radius=radius;this.width=this.radius;this.height=this.radius;this.points=[];angle=0;while(angle<Math.PI*2){length=(.75+Math.random()*.25)*this.radius;posX=Math.cos(angle)*length;posY=Math.sin(angle)*length;this.points.push({x:posX,y:posY});angle+=Math.random()*.5}this.draw()}AsteroidView.prototype.draw=function(){var graphic,i;graphic=this.graphic;graphic.save();graphic.beginPath();graphic.translate(this.x,this.y);graphic.rotate(this.rotation);graphic.fillStyle="#FFFFFF";graphic.moveTo(this.radius,0);i=0;while(i<this.points.length){graphic.lineTo(this.points[i].x,this.points[i].y);++i}graphic.lineTo(this.radius,0);graphic.fill();graphic.restore()};return AsteroidView}()},{"../../../example":1}],22:[function(require,module,exports){"use strict";var example;example=require("../../../example");example.graphics.BulletView=function(){BulletView.prototype.x=0;BulletView.prototype.y=0;BulletView.prototype.width=4;BulletView.prototype.height=4;BulletView.prototype.rotation=0;BulletView.prototype.graphic=null;function BulletView(graphic){this.graphic=graphic;this.draw()}BulletView.prototype.draw=function(){var graphic;graphic=this.graphic;graphic.save();graphic.beginPath();graphic.rotate(this.rotation);graphic.fillStyle="#FFFFFF";graphic.arc(this.x,this.y,2,0,Math.PI*2,false);graphic.fill();graphic.restore()};return BulletView}()},{"../../../example":1}],23:[function(require,module,exports){"use strict";var example;example=require("../../index");example.graphics.Point=function(){Point.prototype.x=0;Point.prototype.y=0;function Point(x,y){this.x=x!=null?x:0;this.y=y!=null?y:0}Point.prototype.distanceSquaredTo=function(targetPoint){var dx,dy;dx=this.x-targetPoint.x;dy=this.y-targetPoint.y;return dx*dx+dy*dy};Point.prototype.distanceTo=function(targetPoint){var dx,dy;dx=this.x-targetPoint.x;dy=this.y-targetPoint.y;return Math.sqrt(dx*dx+dy*dy)};return Point}()},{"../../index":1}],24:[function(require,module,exports){"use strict";var example;example=require("../../../example");example.graphics.SpaceshipView=function(){SpaceshipView.prototype.x=0;SpaceshipView.prototype.y=0;SpaceshipView.prototype.width=20;SpaceshipView.prototype.height=20;SpaceshipView.prototype.rotation=0;SpaceshipView.prototype.graphic=null;function SpaceshipView(graphic){this.graphic=graphic;this.draw()}SpaceshipView.prototype.draw=function(){var graphic;graphic=this.graphic;graphic.save();graphic.beginPath();graphic.translate(this.x,this.y);graphic.rotate(this.rotation);graphic.fillStyle="#FFFFFF";graphic.moveTo(10,0);graphic.lineTo(-7,7);graphic.lineTo(-4,0);graphic.lineTo(-7,-7);graphic.lineTo(10,0);graphic.fill();graphic.restore()};return SpaceshipView}()},{"../../../example":1}],25:[function(require,module,exports){"use strict";var example,__bind=function(fn,me){return function(){return fn.apply(me,arguments)}};example=require("../../../example");example.input.KeyPoll=function(){var displayObj,states;states=null;displayObj=null;function KeyPoll(displayObj){this.displayObj=displayObj;this.isUp=__bind(this.isUp,this);this.isDown=__bind(this.isDown,this);this.keyUpListener=__bind(this.keyUpListener,this);this.keyDownListener=__bind(this.keyDownListener,this);this.states={};this.displayObj.addEventListener("keydown",this.keyDownListener);this.displayObj.addEventListener("keyup",this.keyUpListener)}KeyPoll.prototype.keyDownListener=function(event){this.states[event.keyCode]=true};KeyPoll.prototype.keyUpListener=function(event){if(this.states[event.keyCode]){this.states[event.keyCode]=false}};KeyPoll.prototype.isDown=function(keyCode){return this.states[keyCode]};KeyPoll.prototype.isUp=function(keyCode){return!this.states[keyCode]};return KeyPoll}()},{"../../../example":1}],26:[function(require,module,exports){"use strict";var example;example=require("../../example");example.Main=function(){function Main(){var asteroids,canvas;canvas=this.canvas();asteroids=new example.Asteroids(canvas.getContext("2d"),canvas.width,canvas.height);asteroids.start();return}Main.prototype.canvas=function(){var canvas;canvas=document.createElement(navigator.isCocoonJS?"screencanvas":"canvas");canvas.width=window.innerWidth*window.devicePixelRatio;canvas.height=window.innerHeight*window.devicePixelRatio;canvas.style.width="100%";canvas.style.height="100%";canvas.style.backgroundColor="#000000";document.body.appendChild(canvas);return canvas};return Main}()},{"../../example":1}],27:[function(require,module,exports){"use strict";var ash,example,__hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};ash=require("../../../lib");example=require("../../../example");example.nodes.AsteroidCollision=function(_super){__extends(AsteroidCollision,_super);function AsteroidCollision(){return AsteroidCollision.__super__.constructor.apply(this,arguments)}AsteroidCollision.components={asteroid:example.components.Asteroid,position:example.components.Position};AsteroidCollision.prototype.asteroid=null;AsteroidCollision.prototype.position=null;return AsteroidCollision}(ash.core.Node)},{"../../../example":1,"../../../lib":78}],28:[function(require,module,exports){"use strict";
var ash,example,__hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};ash=require("../../../lib");example=require("../../../example");example.nodes.BulletAge=function(_super){__extends(BulletAge,_super);function BulletAge(){return BulletAge.__super__.constructor.apply(this,arguments)}BulletAge.components={bullet:example.components.Bullet};BulletAge.prototype.bullet=null;return BulletAge}(ash.core.Node)},{"../../../example":1,"../../../lib":78}],29:[function(require,module,exports){"use strict";var ash,example,__hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};ash=require("../../../lib");example=require("../../../example");example.nodes.BulletCollision=function(_super){__extends(BulletCollision,_super);function BulletCollision(){return BulletCollision.__super__.constructor.apply(this,arguments)}BulletCollision.components={bullet:example.components.Bullet,position:example.components.Position};BulletCollision.prototype.bullet=null;BulletCollision.prototype.position=null;return BulletCollision}(ash.core.Node)},{"../../../example":1,"../../../lib":78}],30:[function(require,module,exports){"use strict";var ash,example,__hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};ash=require("../../../lib");example=require("../../../example");example.nodes.GunControl=function(_super){__extends(GunControl,_super);function GunControl(){return GunControl.__super__.constructor.apply(this,arguments)}GunControl.components={control:example.components.GunControls,gun:example.components.Gun,position:example.components.Position};GunControl.prototype.control=null;GunControl.prototype.gun=null;GunControl.prototype.position=null;return GunControl}(ash.core.Node)},{"../../../example":1,"../../../lib":78}],31:[function(require,module,exports){"use strict";var ash,example,__hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};ash=require("../../../lib");example=require("../../../example");example.nodes.MotionControl=function(_super){__extends(MotionControl,_super);function MotionControl(){return MotionControl.__super__.constructor.apply(this,arguments)}MotionControl.components={control:example.components.MotionControls,position:example.components.Position,motion:example.components.Motion,physics:example.components.Physics};MotionControl.prototype.control=null;MotionControl.prototype.position=null;MotionControl.prototype.motion=null;MotionControl.prototype.physics=null;return MotionControl}(ash.core.Node)},{"../../../example":1,"../../../lib":78}],32:[function(require,module,exports){"use strict";var ash,example,__hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};ash=require("../../../lib");example=require("../../../example");example.nodes.Movement=function(_super){__extends(Movement,_super);function Movement(){return Movement.__super__.constructor.apply(this,arguments)}Movement.components={position:example.components.Position,motion:example.components.Motion};Movement.prototype.position=null;Movement.prototype.motion=null;return Movement}(ash.core.Node)},{"../../../example":1,"../../../lib":78}],33:[function(require,module,exports){"use strict";var ash,example,__hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};ash=require("../../../lib");example=require("../../../example");example.nodes.Physics=function(_super){__extends(Physics,_super);function Physics(){return Physics.__super__.constructor.apply(this,arguments)}Physics.components={physics:example.components.Physics,position:example.components.Position,motion:example.components.Motion};Physics.prototype.physics=null;Physics.prototype.position=null;Physics.prototype.motion=null;return Physics}(ash.core.Node)},{"../../../example":1,"../../../lib":78}],34:[function(require,module,exports){"use strict";var ash,example,__hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};ash=require("../../../lib");example=require("../../../example");example.nodes.Render=function(_super){__extends(Render,_super);function Render(){return Render.__super__.constructor.apply(this,arguments)}Render.components={position:example.components.Position,display:example.components.Display};Render.prototype.position=null;Render.prototype.display=null;return Render}(ash.core.Node)},{"../../../example":1,"../../../lib":78}],35:[function(require,module,exports){"use strict";var ash,example,__hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};ash=require("../../../lib");example=require("../../../example");example.nodes.SpaceshipCollision=function(_super){__extends(SpaceshipCollision,_super);function SpaceshipCollision(){return SpaceshipCollision.__super__.constructor.apply(this,arguments)}SpaceshipCollision.components={spaceship:example.components.Spaceship,position:example.components.Position};SpaceshipCollision.prototype.spaceship=0;SpaceshipCollision.prototype.position=0;return SpaceshipCollision}(ash.core.Node)},{"../../../example":1,"../../../lib":78}],36:[function(require,module,exports){"use strict";var BulletAge,ash,example,__bind=function(fn,me){return function(){return fn.apply(me,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};ash=require("../../../lib");example=require("../../../example");BulletAge=example.nodes.BulletAge;example.systems.BulletAgeSystem=function(_super){__extends(BulletAgeSystem,_super);BulletAgeSystem.prototype.creator=null;BulletAgeSystem.prototype.nodeList=null;function BulletAgeSystem(creator){this.updateNode=__bind(this.updateNode,this);this.update=__bind(this.update,this);this.creator=creator;return}BulletAgeSystem.prototype.addToEngine=function(engine){this.nodeList=engine.getNodeList(BulletAge)};BulletAgeSystem.prototype.removeFromEngine=function(engine){this.nodeList=null};BulletAgeSystem.prototype.update=function(time){var node;node=this.nodeList.head;while(node){this.updateNode(node,time);node=node.next}};BulletAgeSystem.prototype.updateNode=function(node,time){var bullet;bullet=node.bullet;bullet.lifeRemaining-=time;if(bullet.lifeRemaining<=0){this.creator.destroyEntity(node.entity)}};return BulletAgeSystem}(ash.core.System)},{"../../../example":1,"../../../lib":78}],37:[function(require,module,exports){"use strict";var AsteroidCollision,BulletCollision,SpaceshipCollision,ash,example,__bind=function(fn,me){return function(){return fn.apply(me,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};ash=require("../../../lib");example=require("../../../example");SpaceshipCollision=example.nodes.SpaceshipCollision;AsteroidCollision=example.nodes.AsteroidCollision;BulletCollision=example.nodes.BulletCollision;example.systems.CollisionSystem=function(_super){__extends(CollisionSystem,_super);CollisionSystem.prototype.creator=null;CollisionSystem.prototype.spaceships=null;CollisionSystem.prototype.asteroids=null;CollisionSystem.prototype.bullets=null;function CollisionSystem(creator){this.update=__bind(this.update,this);this.creator=creator;this}CollisionSystem.prototype.addToEngine=function(game){this.spaceships=game.getNodeList(SpaceshipCollision);this.asteroids=game.getNodeList(AsteroidCollision);this.bullets=game.getNodeList(BulletCollision)};CollisionSystem.prototype.removeFromEngine=function(game){this.spaceships=null;this.asteroids=null;this.bullets=null};CollisionSystem.prototype.update=function(time){var asteroid,bullet,spaceship;bullet=void 0;asteroid=void 0;spaceship=void 0;bullet=this.bullets.head;while(bullet){asteroid=this.asteroids.head;while(asteroid){if(asteroid.position.position.distanceTo(bullet.position.position)<=asteroid.position.collisionRadius){this.creator.destroyEntity(bullet.entity);if(asteroid.position.collisionRadius>10){this.creator.createAsteroid(asteroid.position.collisionRadius-10,asteroid.position.position.x+Math.random()*10-5,asteroid.position.position.y+Math.random()*10-5)}this.creator.destroyEntity(asteroid.entity);break}asteroid=asteroid.next}bullet=bullet.next}spaceship=this.spaceships.head;while(spaceship){asteroid=this.asteroids.head;while(asteroid){if(asteroid.position.position.distanceTo(spaceship.position.position)<=asteroid.position.collisionRadius+spaceship.position.collisionRadius){this.creator.destroyEntity(spaceship.entity);break}asteroid=asteroid.next}spaceship=spaceship.next}};return CollisionSystem}(ash.core.System)},{"../../../example":1,"../../../lib":78}],38:[function(require,module,exports){"use strict";var AsteroidCollision,BulletCollision,Point,SpaceshipCollision,ash,example,__bind=function(fn,me){return function(){return fn.apply(me,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};ash=require("../../../lib");example=require("../../../example");SpaceshipCollision=example.nodes.SpaceshipCollision;AsteroidCollision=example.nodes.AsteroidCollision;BulletCollision=example.nodes.BulletCollision;Point=example.graphics.Point;example.systems.GameManager=function(_super){__extends(GameManager,_super);GameManager.prototype.gameState=null;GameManager.prototype.creator=null;GameManager.prototype.spaceships=null;GameManager.prototype.asteroids=null;GameManager.prototype.bullets=null;function GameManager(gameState,creator){this.update=__bind(this.update,this);this.gameState=gameState;this.creator=creator;return}GameManager.prototype.addToEngine=function(game){this.spaceships=game.getNodeList(SpaceshipCollision);this.asteroids=game.getNodeList(AsteroidCollision);this.bullets=game.getNodeList(BulletCollision)};GameManager.prototype.update=function(time){var asteroid,asteroidCount,clearToAddSpaceship,i,newSpaceshipPosition,position,spaceship;if(this.spaceships.empty){if(this.gameState.lives>0){newSpaceshipPosition=new Point(this.gameState.width*.5,this.gameState.height*.5);clearToAddSpaceship=true;asteroid=this.asteroids.head;while(asteroid){if(asteroid.position.position.distanceTo(newSpaceshipPosition)<=asteroid.position.collisionRadius+50){clearToAddSpaceship=false;break}asteroid=asteroid.next}if(clearToAddSpaceship){this.creator.createSpaceship();this.gameState.lives--}}else{}}if(this.asteroids.empty&&this.bullets.empty&&!this.spaceships.empty){position=void 0;spaceship=this.spaceships.head;this.gameState.level++;asteroidCount=2+this.gameState.level;i=0;while(i<asteroidCount){while(true){position=new Point(Math.random()*this.gameState.width,Math.random()*this.gameState.height);if(!(position.distanceTo(spaceship.position.position)<=80)){break}}this.creator.createAsteroid(30,position.x,position.y);++i}}};GameManager.prototype.removeFromEngine=function(game){this.spaceships=null;this.asteroids=null;this.bullets=null};return GameManager}(ash.core.System)},{"../../../example":1,"../../../lib":78}],39:[function(require,module,exports){"use strict";var GunControl,ash,example,__bind=function(fn,me){return function(){return fn.apply(me,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};ash=require("../../../lib");example=require("../../../example");GunControl=example.nodes.GunControl;example.systems.GunControlSystem=function(_super){__extends(GunControlSystem,_super);GunControlSystem.prototype.keyPoll=null;GunControlSystem.prototype.creator=null;GunControlSystem.prototype.nodeList=null;function GunControlSystem(keyPoll,creator){this.updateNode=__bind(this.updateNode,this);this.update=__bind(this.update,this);this.keyPoll=keyPoll;this.creator=creator;return}GunControlSystem.prototype.addToEngine=function(engine){this.nodeList=engine.getNodeList(GunControl)};GunControlSystem.prototype.removeFromEngine=function(engine){this.nodeList=null};GunControlSystem.prototype.update=function(time){var node;node=this.nodeList.head;while(node){this.updateNode(node,time);node=node.next}};GunControlSystem.prototype.updateNode=function(node,time){var control,gun,position;control=node.control;position=node.position;gun=node.gun;gun.shooting=this.keyPoll.isDown(control.trigger);gun.timeSinceLastShot+=time;if(gun.shooting&&gun.timeSinceLastShot>=gun.minimumShotInterval){this.creator.createUserBullet(gun,position);gun.timeSinceLastShot=0}};return GunControlSystem}(ash.core.System)},{"../../../example":1,"../../../lib":78}],40:[function(require,module,exports){"use strict";var MotionControl,ash,b2Vec2,example,__bind=function(fn,me){return function(){return fn.apply(me,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};ash=require("../../../lib");example=require("../../../example");MotionControl=example.nodes.MotionControl;b2Vec2=Box2D.Common.Math.b2Vec2;example.systems.MotionControlSystem=function(_super){__extends(MotionControlSystem,_super);MotionControlSystem.prototype.keyPoll=null;MotionControlSystem.prototype.nodeList=null;function MotionControlSystem(keyPoll){this.updateNode=__bind(this.updateNode,this);this.update=__bind(this.update,this);this.keyPoll=keyPoll;this}MotionControlSystem.prototype.addToEngine=function(engine){this.nodeList=engine.getNodeList(MotionControl)};MotionControlSystem.prototype.removeFromEngine=function(engine){this.nodeList=null};MotionControlSystem.prototype.update=function(time){var node;node=this.nodeList.head;while(node){this.updateNode(node,time);node=node.next}};MotionControlSystem.prototype.updateNode=function(node,time){var control,left,motion,physics,position,right;control=node.control;position=node.position;motion=node.motion;physics=node.physics;left=this.keyPoll.isDown(control.left);right=this.keyPoll.isDown(control.right);if(left){position.rotation-=control.rotationRate*time}if(right){position.rotation+=control.rotationRate*time}if(this.keyPoll.isDown(control.accelerate)){motion.velocity.x+=Math.cos(position.rotation)*control.accelerationRate*time;motion.velocity.y+=Math.sin(position.rotation)*control.accelerationRate*time}if(left){physics.body.ApplyForce(new b2Vec2(100,100),physics.body.GetWorldCenter())}if(right){physics.body.ApplyForce(new b2Vec2(-100,-100),physics.body.GetWorldCenter())}};return MotionControlSystem}(ash.core.System)},{"../../../example":1,"../../../lib":78}],41:[function(require,module,exports){"use strict";var Movement,ash,example,__bind=function(fn,me){return function(){return fn.apply(me,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};ash=require("../../../lib");example=require("../../../example");Movement=example.nodes.Movement;example.systems.MovementSystem=function(_super){__extends(MovementSystem,_super);MovementSystem.prototype.gameState=null;MovementSystem.prototype.nodeList=null;MovementSystem.prototype.doAFewTimes=true;function MovementSystem(gameState){this.updateNode=__bind(this.updateNode,this);this.update=__bind(this.update,this);this.gameState=gameState;this}MovementSystem.prototype.addToEngine=function(engine){this.nodeList=engine.getNodeList(Movement)};MovementSystem.prototype.removeFromEngine=function(engine){this.nodeList=null};MovementSystem.prototype.update=function(time){var node;node=this.nodeList.head;while(node){this.updateNode(node,time);node=node.next}};MovementSystem.prototype.updateNode=function(node,time){var motion,position,xDamp,yDamp;position=node.position;motion=node.motion;position.position.x+=motion.velocity.x*time;position.position.y+=motion.velocity.y*time;if(position.position.x<0){position.position.x+=this.gameState.width}if(position.position.x>this.gameState.width){position.position.x-=this.gameState.width}if(position.position.y<0){position.position.y+=this.gameState.height}if(position.position.y>this.gameState.height){position.position.y-=this.gameState.height}position.rotation+=motion.angularVelocity*time;if(motion.damping>0){xDamp=Math.abs(Math.cos(position.rotation)*motion.damping*time);yDamp=Math.abs(Math.sin(position.rotation)*motion.damping*time);if(motion.velocity.x>xDamp){motion.velocity.x-=xDamp}else if(motion.velocity.x<-xDamp){motion.velocity.x+=xDamp}else{motion.velocity.x=0}if(motion.velocity.y>yDamp){motion.velocity.y-=yDamp}else if(motion.velocity.y<-yDamp){motion.velocity.y+=yDamp}else{motion.velocity.y=0}}};return MovementSystem}(ash.core.System)},{"../../../example":1,"../../../lib":78}],42:[function(require,module,exports){"use strict";var Physics,ash,b2Vec2,example,__bind=function(fn,me){return function(){return fn.apply(me,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};ash=require("../../../lib");example=require("../../../example");Physics=example.nodes.Physics;b2Vec2=Box2D.Common.Math.b2Vec2;example.systems.PhysicsSystem=function(_super){__extends(PhysicsSystem,_super);PhysicsSystem.prototype.world=null;PhysicsSystem.prototype.count=0;PhysicsSystem.prototype.kount=0;function PhysicsSystem(world){this.world=world;this.updateNode=__bind(this.updateNode,this);this.update=__bind(this.update,this)}PhysicsSystem.prototype.addToEngine=function(engine){this.nodeList=engine.getNodeList(Physics)};PhysicsSystem.prototype.removeFromEngine=function(engine){this.nodeList=null};PhysicsSystem.prototype.update=function(time){var node;this.world.Step(time,10,10);this.world.ClearForces();node=this.nodeList.head;while(node){this.updateNode(node,time);node=node.next}};PhysicsSystem.prototype.updateNode=function(node,time){if(this.count===1){console.log(node.physics.body.m_xf.position.x)}this.count++;if(this.count===60){this.count=0}};return PhysicsSystem}(ash.core.System)},{"../../../example":1,"../../../lib":78}],43:[function(require,module,exports){"use strict";var Render,ash,example,__bind=function(fn,me){return function(){return fn.apply(me,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};ash=require("../../../lib");example=require("../../../example");Render=example.nodes.Render;example.systems.RenderSystem=function(_super){__extends(RenderSystem,_super);RenderSystem.prototype.context=null;RenderSystem.prototype.nodes=null;function RenderSystem(graphicsContext){this.update=__bind(this.update,this);this.context=graphicsContext;this}RenderSystem.prototype.addToEngine=function(engine){var node;this.nodes=engine.getNodeList(Render);node=this.nodes.head;while(node){this.addToDisplay(node);node=node.next}this.nodes.nodeAdded.add(this.addToDisplay,this);this.nodes.nodeRemoved.add(this.removeFromDisplay,this)};RenderSystem.prototype.removeFromEngine=function(engine){this.nodes=null};RenderSystem.prototype.addToDisplay=function(node){};RenderSystem.prototype.removeFromDisplay=function(node){};RenderSystem.prototype.update=function(time){var display,graphic,node,position;this.context.save();this.context.translate(0,0);this.context.rotate(0);this.context.clearRect(0,0,this.context.canvas.width,this.context.canvas.height);node=this.nodes.head;while(node){display=node.display;graphic=display.graphic;position=node.position;graphic.x=position.position.x;graphic.y=position.position.y;graphic.rotation=position.rotation;graphic.draw();node=node.next}this.context.restore()};return RenderSystem}(ash.core.System)},{"../../../example":1,"../../../lib":78}],44:[function(require,module,exports){"use strict";var example;example=require("../../../example");example.systems.SystemPriorities=function(){function SystemPriorities(){}SystemPriorities.preUpdate=1;SystemPriorities.update=2;SystemPriorities.move=3;SystemPriorities.resolveCollisions=4;SystemPriorities.render=5;return SystemPriorities}()},{"../../../example":1}],45:[function(require,module,exports){"use strict";var Dictionary,NodeList,NodePool,ash,__bind=function(fn,me){return function(){return fn.apply(me,arguments)}};ash=require("../../../lib");NodeList=ash.core.NodeList;NodePool=ash.core.NodePool;Dictionary=function(){function Dictionary(){}return Dictionary}();ash.core.ComponentMatchingFamily=function(){ComponentMatchingFamily.prototype.nodes=null;ComponentMatchingFamily.prototype.entities=null;ComponentMatchingFamily.prototype.nodeClass=null;ComponentMatchingFamily.prototype.components=null;ComponentMatchingFamily.prototype.nodePool=null;ComponentMatchingFamily.prototype.engine=null;function ComponentMatchingFamily(nodeClass,engine){this.nodeClass=nodeClass;this.engine=engine;this.releaseNodePoolCache=__bind(this.releaseNodePoolCache,this);this.init()}ComponentMatchingFamily.prototype.init=function(){var name,type,_ref;this.nodes=new NodeList;this.entities=new Dictionary;this.components=new Dictionary;this.nodePool=new NodePool(this.nodeClass,this.nodeClass.components);_ref=this.nodeClass.components;for(name in _ref){type=_ref[name];this.components[type.name]=type}};Object.defineProperties(ComponentMatchingFamily.prototype,{nodeList:{get:function(){return this.nodes}}});ComponentMatchingFamily.prototype.newEntity=function(entity){this.addIfMatch(entity)};ComponentMatchingFamily.prototype.componentAddedToEntity=function(entity,componentClass){this.addIfMatch(entity)};ComponentMatchingFamily.prototype.componentRemovedFromEntity=function(entity,componentClass){if(componentClass.name in this.components){this.removeIfMatch(entity)}};ComponentMatchingFamily.prototype.removeEntity=function(entity){this.removeIfMatch(entity)};ComponentMatchingFamily.prototype.addIfMatch=function(entity){var componentClass,name,node,_ref,_ref1;if(this.entities[entity.name]==null){_ref=this.nodeClass.components;for(name in _ref){componentClass=_ref[name];if(!entity.has(componentClass)){return}}node=this.nodePool.get();node.entity=entity;_ref1=this.nodeClass.components;for(name in _ref1){componentClass=_ref1[name];node[name]=entity.get(componentClass)}this.entities[entity.name]=node;this.nodes.add(node)}};ComponentMatchingFamily.prototype.removeIfMatch=function(entity){var node;if(entity.name in this.entities){node=this.entities[entity.name];delete this.entities[entity.name];this.nodes.remove(node);if(this.engine.updating){this.nodePool.cache(node);this.engine.updateComplete.add(this.releaseNodePoolCache)}else{this.nodePool.dispose(node)}}};ComponentMatchingFamily.prototype.releaseNodePoolCache=function(){this.engine.updateComplete.remove(this.releaseNodePoolCache);this.nodePool.releaseCache()};ComponentMatchingFamily.prototype.cleanUp=function(){var node;node=this.nodes.head;while(node){this.entities.remove(node.entity);node=node.next}this.nodes.removeAll()};return ComponentMatchingFamily}()},{"../../../lib":78}],46:[function(require,module,exports){"use strict";var ComponentMatchingFamily,Dictionary,EntityList,Signal0,SystemList,ash,__bind=function(fn,me){return function(){return fn.apply(me,arguments)}};ash=require("../../../lib");ComponentMatchingFamily=ash.core.ComponentMatchingFamily;EntityList=ash.core.EntityList;Signal0=ash.signals.Signal0;SystemList=ash.core.SystemList;Dictionary=function(){function Dictionary(){}return Dictionary}();ash.core.Engine=function(){Engine.prototype.entityNames=null;Engine.prototype.entityList=null;Engine.prototype.systemList=null;Engine.prototype.families=null;Engine.prototype.updating=false;Engine.prototype.updateComplete=null;Engine.prototype.familyClass=ComponentMatchingFamily;function Engine(){this.update=__bind(this.update,this);this.entityList=new EntityList;this.entityNames=new Dictionary;this.systemList=new SystemList;this.families=new Dictionary;this.updateComplete=new Signal0}Object.defineProperties(Engine.prototype,{entities:{get:function(){var entities,entity;entities=[];entity=this.entityList.head;while(entity){this.entities.push(entity);entity=entity.next}return entities}},systems:{get:function(){var system,systems;systems=[];system=this.systemList.head;while(system){systems.push(system);system=system.next}return systems}}});Engine.prototype.addEntity=function(entity){var each,family,_ref;if(this.entityNames[entity.name]){throw"The entity name "+entity.name+" is already in use by another entity."}this.entityList.add(entity);this.entityNames[entity.name]=entity;entity.componentAdded.add(this.componentAdded);entity.componentRemoved.add(this.componentRemoved);entity.nameChanged.add(this.entityNameChanged);_ref=this.families;for(each in _ref){family=_ref[each];family.newEntity(entity)}};Engine.prototype.removeEntity=function(entity){var each,family,_ref;entity.componentAdded.remove(this.componentAdded);entity.componentRemoved.remove(this.componentRemoved);entity.nameChanged.remove(this.entityNameChanged);_ref=this.families;for(each in _ref){family=_ref[each];family.removeEntity(entity)}delete this.entityNames[entity.name];this.entityList.remove(entity)};Engine.prototype.entityNameChanged=function(entity,oldName){if(this.entityNames[oldName]===entity){delete this.entityNames[oldName];this.entityNames[entity.name]=entity}};Engine.prototype.getEntityByName=function(name){return this.entityNames[name]};Engine.prototype.removeAllEntities=function(){while(this.entityList.head!==null){this.removeEntity(this.entityList.head)}};Engine.prototype.componentAdded=function(entity,componentClass){var each,family,_ref;_ref=this.families;for(each in _ref){family=_ref[each];family.componentAddedToEntity(entity,componentClass)}};Engine.prototype.componentRemoved=function(entity,componentClass){var each,family,_ref;_ref=this.families;for(each in _ref){family=_ref[each];family.componentRemovedFromEntity(entity,componentClass)}};Engine.prototype.getNodeList=function(nodeClass){var entity,family;if(nodeClass.name in this.families){return this.families[nodeClass.name].nodeList}family=new this.familyClass(nodeClass,this);this.families[nodeClass.name]=family;entity=this.entityList.head;while(entity){family.newEntity(entity);entity=entity.next}return family.nodeList};Engine.prototype.releaseNodeList=function(nodeClass){if(nodeClass.name in this.families){this.families[nodeClass.name].cleanUp();delete this.families[nodeClass.name]}};Engine.prototype.addSystem=function(system,priority){system.priority=priority;system.addToEngine(this);this.systemList.add(system)};Engine.prototype.getSystem=function(type){return systemList.get(type)};Engine.prototype.removeSystem=function(system){this.systemList.remove(system);system.removeFromEngine(this)};Engine.prototype.removeAllSystems=function(){while(this.systemList.head!==null){this.removeSystem(this.systemList.head)}};Engine.prototype.update=function(time){var system;this.updating=true;system=this.systemList.head;while(system){system.update(time);system=system.next}this.updating=false;this.updateComplete.dispatch()};return Engine}()},{"../../../lib":78}],47:[function(require,module,exports){"use strict";var Dictionary,Signal2,ash;ash=require("../../../lib");Signal2=ash.signals.Signal2;Dictionary=function(){function Dictionary(){}return Dictionary}();ash.core.Entity=function(){var nameCount;nameCount=0;Entity.prototype._name="";Entity.prototype.componentAdded=null;Entity.prototype.componentRemoved=null;Entity.prototype.nameChanged=null;Entity.prototype.previous=null;Entity.prototype.next=null;Entity.prototype.components=null;function Entity(name){if(name==null){name=""}Object.defineProperties(this,{name:{get:function(){return this._name},set:function(value){var previous;if(this._name!==value){previous=this._name;this._name=value;return this.nameChanged.dispatch(this,previous)}}}});this.componentAdded=new Signal2;this.componentRemoved=new Signal2;this.nameChanged=new Signal2;this.components=new Dictionary;if(name!==""){this._name=name}else{this._name="_entity"+ ++nameCount}}Entity.prototype.add=function(component,componentClass){if(componentClass==null){componentClass=component.constructor}if(componentClass.name in this.components){this.remove(componentClass)}this.components[componentClass.name]=component;this.componentAdded.dispatch(this,componentClass);return this};Entity.prototype.remove=function(componentClass){var component,name;name="string"===typeof componentClass?componentClass:componentClass.name;component=this.components[name];if(component!==null){delete this.components[name];this.componentRemoved.dispatch(this,name);return component}return null};Entity.prototype.get=function(componentClass){return this.components[componentClass.name]};Entity.prototype.getAll=function(){var component,componentArray,_i,_len,_ref;componentArray=[];_ref=this.components;for(_i=0,_len=_ref.length;_i<_len;_i++){component=_ref[_i];componentArray.push(component)}return componentArray};Entity.prototype.has=function(componentClass){return componentClass.name in this.components};return Entity}()},{"../../../lib":78}],48:[function(require,module,exports){"use strict";var ash;ash=require("../../../lib");ash.core.EntityList=function(){function EntityList(){}EntityList.prototype.head=null;EntityList.prototype.tail=null;EntityList.prototype.add=function(entity){if(this.head===null){this.head=this.tail=entity;entity.next=entity.previous=null}else{this.tail.next=entity;entity.previous=this.tail;entity.next=null;this.tail=entity
}};EntityList.prototype.remove=function(entity){return;if(this.head===entity){this.head=this.head.next}if(this.tail===entity){this.tail=this.tail.previous}if(entity.previous!==null){entity.previous.next=entity.next}if(entity.next!==null){entity.next.previous=entity.previous}};EntityList.prototype.removeAll=function(){var entity;while(this.head!==null){entity=this.head;this.head=this.head.next;entity.previous=null;entity.next=null}this.tail=null};return EntityList}()},{"../../../lib":78}],49:[function(require,module,exports){"use strict";var ash;ash=require("../../../lib");ash.core.Family=function(){Family.prototype.nodes=null;function Family(){Object.defineProperties(this,{nodeList:{get:function(){return this.nodes}}})}Family.prototype.newEntity=function(entity){throw new Error("Method must be overriden")};Family.prototype.removeEntity=function(entity){throw new Error("Method must be overriden")};Family.prototype.componentAddedToEntity=function(entity,componentClass){throw new Error("Method must be overriden")};Family.prototype.componentRemovedFromEntity=function(entity,componentClass){throw new Error("Method must be overriden")};Family.prototype.cleanUp=function(){throw new Error("Method must be overriden")};return Family}()},{"../../../lib":78}],50:[function(require,module,exports){"use strict";var ash;ash=require("../../../lib");ash.core.Node=function(){function Node(){}Node.prototype.entity=null;Node.prototype.previous=null;Node.prototype.next=null;return Node}()},{"../../../lib":78}],51:[function(require,module,exports){"use strict";var Signal1,ash;ash=require("../../../lib");Signal1=ash.signals.Signal1;ash.core.NodeList=function(){NodeList.prototype.head=null;NodeList.prototype.tail=null;NodeList.prototype.nodeAdded=null;NodeList.prototype.nodeRemoved=null;function NodeList(){this.nodeAdded=new Signal1;this.nodeRemoved=new Signal1}NodeList.prototype.add=function(node){if(this.head===null){this.head=this.tail=node;node.next=node.previous=null}else{this.tail.next=node;node.previous=this.tail;node.next=null;this.tail=node}this.nodeAdded.dispatch(node)};NodeList.prototype.remove=function(node){if(this.head===node){this.head=this.head.next}if(this.tail===node){this.tail=this.tail.previous}if(node.previous!==null){node.previous.next=node.next}if(node.next!==null){node.next.previous=node.previous}this.nodeRemoved.dispatch(node)};NodeList.prototype.removeAll=function(){var node;while(this.head!==null){node=this.head;this.head=this.head.next;node.previous=null;node.next=null;this.nodeRemoved.dispatch(node)}this.tail=null};Object.defineProperties(NodeList.prototype,{empty:{get:function(){return this.head===null}}});NodeList.prototype.swap=function(node1,node2){var temp;if(node1.previous===node2){node1.previous=node2.previous;node2.previous=node1;node2.next=node1.next;node1.next=node2}else if(node2.previous===node1){node2.previous=node1.previous;node1.previous=node2;node1.next=node2.next;node2.next=node1}else{temp=node1.previous;node1.previous=node2.previous;node2.previous=temp;temp=node1.next;node1.next=node2.next;node2.next=temp}if(this.head===node1){this.head=node2}else if(this.head===node2){this.head=node1}if(this.tail===node1){this.tail=node2}else if(this.tail===node2){this.tail=node1}if(node1.previous!==null){node1.previous.next=node1}if(node2.previous!==null){node2.previous.next=node2}if(node1.next!==null){node1.next.previous=node1}if(node2.next!==null){node2.next.previous=node2}};NodeList.prototype.insertionSort=function(sortFunction){var node,other,remains;if(this.head===this.tail){return}remains=this.head.next;node=remains;while(node!==null){remains=node.next;other=node.previous;while(other!==null){if(sortFunction(node,other)>=0){if(node!==other.next){if(this.tail===node){this.tail=node.previous}node.previous.next=node.next;if(node.next!==null){node.next.previous=node.previous}node.next=other.next;node.previous=other;node.next.previous=node;other.next=node}break}other=other.previous}if(other===null){if(this.tail===node){this.tail=node.previous}node.previous.next=node.next;if(node.next!==null){node.next.previous=node.previous}node.next=this.head;this.head.previous=node;node.previous=null;this.head=node}node=remains}};NodeList.prototype.mergeSort=function(sortFunction){var end,lists,next,start;if(this.head===this.tail){return}lists=[];start=this.head;while(start!==null){end=start;while(end.next!==null&&sortFunction(end,end.next)<=0){end=end.next}next=end.next;start.previous=end.next=null;lists.push(start);start=next}while(lists.length>1){lists.push(this.merge(lists.shift(),lists.shift(),sortFunction))}this.tail=this.head=lists[0];while(this.tail.next!==null){this.tail=this.tail.next}};NodeList.prototype.merge=function(head1,head2,sortFunction){var head,node;if(sortFunction(head1,head2)<=0){head=node=head1;head1=head1.next}else{head=node=head2;head2=head2.next}while(head1!==null&&head2!==null){if(sortFunction(head1,head2)<=0){node.next=head1;head1.previous=node;node=head1;head1=head1.next}else{node.next=head2;head2.previous=node;node=head2;head2=head2.next}}if(head1!==null){node.next=head1;head1.previous=node}else{node.next=head2;head2.previous=node}return head};return NodeList}()},{"../../../lib":78}],52:[function(require,module,exports){"use strict";var ash;ash=require("../../../lib");ash.core.NodePool=function(){NodePool.prototype.tail=null;NodePool.prototype.nodeClass=null;NodePool.prototype.cacheTail=null;NodePool.prototype.components=null;function NodePool(nodeClass,components){this.nodeClass=nodeClass;this.components=components}NodePool.prototype.get=function(){var node;if(this.tail!==null){node=this.tail;this.tail=this.tail.previous;node.previous=null;return node}else{return new this.nodeClass.constructor}};NodePool.prototype.dispose=function(node){var componentName;for(componentName in this.components){node[componentName]=null}node.entity=null;node.next=null;node.previous=this.tail;this.tail=node};NodePool.prototype.cache=function(node){node.previous=this.cacheTail;this.cacheTail=node};NodePool.prototype.releaseCache=function(){var node;while(this.cacheTail!==null){node=this.cacheTail;this.cacheTail=node.previous;node.next=null;node.previous=this.tail;this.tail=node}};return NodePool}()},{"../../../lib":78}],53:[function(require,module,exports){"use strict";var ash,__bind=function(fn,me){return function(){return fn.apply(me,arguments)}};ash=require("../../../lib");ash.core.System=function(){function System(){this.update=__bind(this.update,this)}System.prototype.previous=null;System.prototype.next=null;System.prototype.priority=0;System.prototype.addToEngine=function(engine){};System.prototype.removeFromEngine=function(engine){};System.prototype.update=function(time){};return System}()},{"../../../lib":78}],54:[function(require,module,exports){"use strict";var ash;ash=require("../../../lib");ash.core.SystemList=function(){function SystemList(){}SystemList.prototype.head=null;SystemList.prototype.tail=null;SystemList.prototype.add=function(system){var node;if(this.head===null){this.head=this.tail=system;system.next=system.previous=null}else{node=this.tail;while(node!==null){if(node.priority<=system.priority){break}node=node.previous}if(node===this.tail){this.tail.next=system;system.previous=this.tail;system.next=null;this.tail=system}else if(node===null){system.next=this.head;system.previous=null;this.head.previous=system;this.head=system}else{system.next=node.next;system.previous=node;node.next.previous=system;node.next=system}}};SystemList.prototype.remove=function(system){if(this.head===system){this.head=this.head.next}if(this.tail===system){this.tail=this.tail.previous}if(system.previous!==null){system.previous.next=system.next}if(system.next!==null){system.next.previous=system.previous}};SystemList.prototype.removeAll=function(){var system;while(this.head!==null){system=this.head;this.head=this.head.next;system.previous=null;system.next=null}this.tail=null};SystemList.prototype.get=function(type){var system;system=this.systemList.head;while(system){if(system.constructor===type){return system}system=system.next}return null};return SystemList}()},{"../../../lib":78}],55:[function(require,module,exports){"use strict";var ash;ash=require("../../../lib");ash.fsm.ComponentInstanceProvider=function(){ComponentInstanceProvider.prototype.instance=null;function ComponentInstanceProvider(instance){this.instance=instance}ComponentInstanceProvider.prototype.getComponent=function(){return this.instance};Object.defineProperties(ComponentInstanceProvider.prototype,{identifier:{get:function(){return this.instance}}});return ComponentInstanceProvider}()},{"../../../lib":78}],56:[function(require,module,exports){"use strict";var ash;ash=require("../../../lib");ash.fsm.ComponentSingletonProvider=function(){ComponentSingletonProvider.prototype.componentType=null;ComponentSingletonProvider.prototype.instance=null;function ComponentSingletonProvider(type){this.componentType=type}ComponentSingletonProvider.prototype.getComponent=function(){if(this.instance==null){this.instance=new this.componentType}return this.instance};Object.defineProperties(ComponentSingletonProvider.prototype,{identifier:{get:function(){return this.getComponent()}}});return ComponentSingletonProvider}()},{"../../../lib":78}],57:[function(require,module,exports){"use strict";var ash;ash=require("../../../lib");ash.fsm.ComponentTypeProvider=function(){ComponentTypeProvider.prototype.componentType=null;function ComponentTypeProvider(type){this.componentType=type}ComponentTypeProvider.prototype.getComponent=function(){return new this.componentType};Object.defineProperties(ComponentTypeProvider.prototype,{identifier:{get:function(){return this.componentType}}});return ComponentTypeProvider}()},{"../../../lib":78}],58:[function(require,module,exports){"use strict";var ash;ash=require("../../../lib");ash.fsm.DynamicComponentProvider=function(){DynamicComponentProvider.prototype._closure=null;function DynamicComponentProvider(closure){this._closure=closure}DynamicComponentProvider.prototype.getComponent=function(){return this._closure};Object.defineProperties(DynamicComponentProvider.prototype,{identifier:{get:function(){return this._closure}}});return DynamicComponentProvider}()},{"../../../lib":78}],59:[function(require,module,exports){"use strict";var ash;ash=require("../../../lib");ash.fsm.DynamicSystemProvider=function(){DynamicSystemProvider.prototype.method=function(){};DynamicSystemProvider.prototype.systemPriority=0;function DynamicSystemProvider(method){this.method=method}DynamicSystemProvider.prototype.getSystem=function(){return this.method()};Object.defineProperties(DynamicSystemProvider.prototype,{identifier:{get:function(){return this.method}},priority:{get:function(){return this.systemPriority},set:function(value){return this.systemPriority=value}}});return DynamicSystemProvider}()},{"../../../lib":78}],60:[function(require,module,exports){"use strict";var DynamicSystemProvider,StateSystemMapping,SystemInstanceProvider,SystemSingletonProvider,ash;ash=require("../../../lib");SystemInstanceProvider=ash.fsm.SystemInstanceProvider;SystemSingletonProvider=ash.fsm.SystemSingletonProvider;DynamicSystemProvider=ash.fsm.DynamicSystemProvider;StateSystemMapping=ash.fsm.StateSystemMapping;ash.fsm.EngineState=function(){EngineState.prototype.providers=null;function EngineState(){this.providers=[]}EngineState.prototype.addInstance=function(system){return this.addProvider(new SystemInstanceProvider(system))};EngineState.prototype.addSingleton=function(type){return this.addProvider(new SystemSingletonProvider(type))};EngineState.prototype.addMethod=function(method){return this.addProvider(new DynamicSystemProvider(method))};EngineState.prototype.addProvider=function(provider){var mapping;mapping=new StateSystemMapping(this,provider);this.providers.push(provider);return mapping};return EngineState}()},{"../../../lib":78}],61:[function(require,module,exports){"use strict";var Dictionary,EngineState,ash;ash=require("../../../lib");EngineState=ash.fsm.EngineState;Dictionary=function(){function Dictionary(){}return Dictionary}();ash.fsm.EngineStateMachine=function(){EngineStateMachine.prototype.engine=null;EngineStateMachine.prototype.states=null;EngineStateMachine.prototype.currentState=null;function EngineStateMachine(engine){this.engine=engine;this.states=new Dictionary}EngineStateMachine.prototype.addState=function(name,state){this.states[name]=state;return this};EngineStateMachine.prototype.createState=function(name){var state;state=new EngineState;this.states[name]=state;return this};EngineStateMachine.prototype.changeState=function(name){var each,id,newState,other,provider,toAdd,_ref,_ref1;newState=this.states[name];if(newState==null){throw new Error("Engine state "+name+" doesn't exist")}if(newState===this.currentState){newState=null;return}toAdd=new Dictionary;_ref=newState.providers;for(each in _ref){provider=_ref[each];id=provider.identifier;toAdd[id]=provider}if(currentState){_ref1=this.currentState.providers;for(each in _ref1){provider=_ref1[each];id=provider.identifier;other=toAdd[id];if(other){delete toAdd[id]}else{this.engine.removeSystem(provider.getSystem())}}}for(each in toAdd){provider=toAdd[each];this.engine.addSystem(provider.getSystem(),provider.priority)}return this.currentState=newState};return EngineStateMachine}()},{"../../../lib":78}],62:[function(require,module,exports){"use strict";var Dictionary,StateComponentMapping,ash;ash=require("../../../lib");StateComponentMapping=ash.fsm.StateComponentMapping;Dictionary=function(){function Dictionary(){}return Dictionary}();ash.fsm.EntityState=function(){EntityState.prototype.providers=null;function EntityState(){this.providers=new Dictionary}EntityState.prototype.add=function(type){return new StateComponentMapping(this,type)};EntityState.prototype.get=function(type){return this.providers[type]};EntityState.prototype.has=function(type){return this.providers[type]!==null};return EntityState}()},{"../../../lib":78}],63:[function(require,module,exports){"use strict";var Dictionary,EntityState,ash;ash=require("../../../lib");EntityState=ash.fsm.EntityState;Dictionary=function(){function Dictionary(){}return Dictionary}();ash.fsm.EntityStateMachine=function(){EntityStateMachine.prototype.states=null;EntityStateMachine.prototype.currentState=null;EntityStateMachine.prototype.entity=null;function EntityStateMachine(entity){this.entity=entity;this.states=new Dictionary}EntityStateMachine.prototype.createState=function(name){var state;state=new EntityState;this.states.push(state);return state};EntityStateMachine.prototype.changeState=function(name){var currentState,newState,other,toAdd,type;newState=this.states[name];if(!newState){throw new Error("Entity state "+name+" doesn't exist")}if(newState===this.currentState){newState=null;return}if(this.currentState){toAdd=new Dictionary;for(type in newState.providers){toAdd[type]=newState.providers[type]}for(type in this.currentState.providers){other=toAdd[type];if(other&&other.identifier===currentState.providers[type].identifier){delete toAdd[type]}else{this.entity.remove(type)}}}else{toAdd=newState.providers}for(type in toAdd){this.entity.add(toAdd[type].getComponent(),type)}return currentState=newState};return EntityStateMachine}()},{"../../../lib":78}],64:[function(require,module,exports){"use strict";var ComponentInstanceProvider,ComponentSingletonProvider,ComponentTypeProvider,DynamicComponentProvider,ash;ash=require("../../../lib");ComponentInstanceProvider=ash.fsm.ComponentInstanceProvider;ComponentTypeProvider=ash.fsm.ComponentTypeProvider;ComponentSingletonProvider=ash.fsm.ComponentSingletonProvider;DynamicComponentProvider=ash.fsm.DynamicComponentProvider;ash.fsm.StateComponentMapping=function(){StateComponentMapping.prototype.componentType=null;StateComponentMapping.prototype.creatingState=null;StateComponentMapping.prototype.provider=null;function StateComponentMapping(creatingState,type){this.creatingState=creatingState;this.componentType=type;this.withType(type)}StateComponentMapping.prototype.withInstance=function(component){this.setProvider(new ComponentInstanceProvider(component));return this};StateComponentMapping.prototype.withType=function(type){this.setProvider(new ComponentTypeProvider(type));return this};StateComponentMapping.prototype.withSingleton=function(type){if(type==null){type=this.componentType}this.setProvider(new ComponentSingletonProvider(type));return this};StateComponentMapping.prototype.withMethod=function(method){this.setProvider(new DynamicComponentProvider(method));return this};StateComponentMapping.prototype.withProvider=function(provider){this.setProvider(provider);return this};StateComponentMapping.prototype.add=function(type){return this.creatingState.add(type)};StateComponentMapping.prototype.setProvider=function(provider){this.provider=provider;return this.creatingState.providers[this.componentType]=provider};return StateComponentMapping}()},{"../../../lib":78}],65:[function(require,module,exports){"use strict";var ash;ash=require("../../../lib");ash.fsm.StateSystemMapping=function(){StateSystemMapping.prototype.creatingState=null;StateSystemMapping.prototype.provider=null;function StateSystemMapping(creatingState,provider){this.creatingState=creatingState;this.provider=provider}StateSystemMapping.prototype.withPriority=function(priority){this.provider.priority=priority;return this};StateSystemMapping.prototype.addInstance=function(system){return creatingState.addInstance(system)};StateSystemMapping.prototype.addSingleton=function(type){return creatingState.addSingleton(type)};StateSystemMapping.prototype.addMethod=function(method){return creatingState.addMethod(method)};StateSystemMapping.prototype.addProvider=function(provider){return creatingState.addProvider(provider)};return StateSystemMapping}()},{"../../../lib":78}],66:[function(require,module,exports){"use strict";var ash;ash=require("../../../lib");ash.fsm.SystemInstanceProvider=function(){SystemInstanceProvider.prototype.instance=null;SystemInstanceProvider.prototype.systemPriority=0;function SystemInstanceProvider(instance){this.instance=instance}SystemInstanceProvider.prototype.getSystem=function(){return this.instance};Object.defineProperties(SystemInstanceProvider.prototype,{identifier:{get:function(){return this.instance}},priority:{get:function(){return this.systemPriority},set:function(value){return this.systemPriority=value}}});return SystemInstanceProvider}()},{"../../../lib":78}],67:[function(require,module,exports){"use strict";var ash;ash=require("../../../lib");ash.fsm.SystemSingletonProvider=function(){SystemSingletonProvider.prototype.componentType=null;SystemSingletonProvider.prototype.instance=null;SystemSingletonProvider.prototype.systemPriority=0;function SystemSingletonProvider(type){this.componentType=type}SystemSingletonProvider.prototype.getSystem=function(){if(!this.instance){this.instance=new this.componentType}return this.instance};Object.defineProperties(SystemSingletonProvider.prototype,{identifier:{get:function(){return this.getSystem()}},priority:{get:function(){return this.systemPriority},set:function(value){return this.systemPriority=value}}});return SystemSingletonProvider}()},{"../../../lib":78}],68:[function(require,module,exports){"use strict";var ash;ash=require("../../../lib");ash.signals.ListenerNode=function(){function ListenerNode(){}ListenerNode.prototype.previous=null;ListenerNode.prototype.next=null;ListenerNode.prototype.listener=null;ListenerNode.prototype.once=false;return ListenerNode}()},{"../../../lib":78}],69:[function(require,module,exports){"use strict";var ListenerNode,ash;ash=require("../../../lib");ListenerNode=ash.signals.ListenerNode;ash.signals.ListenerNodePool=function(){function ListenerNodePool(){}ListenerNodePool.prototype.tail=null;ListenerNodePool.prototype.cacheTail=null;ListenerNodePool.prototype.get=function(){var node;if(this.tail!==null){node=this.tail;this.tail=this.tail.previous;node.previous=null;return node}else{return new ListenerNode}};ListenerNodePool.prototype.dispose=function(node){node.listener=null;node.once=false;node.next=null;node.previous=this.tail;this.tail=node};ListenerNodePool.prototype.cache=function(node){node.listener=null;node.previous=this.cacheTail;this.cacheTail=node};ListenerNodePool.prototype.releaseCache=function(){var node;while(this.cacheTail!==null){node=this.cacheTail;this.cacheTail=node.previous;node.next=null;node.previous=this.tail;this.tail=node}};return ListenerNodePool}()},{"../../../lib":78}],70:[function(require,module,exports){"use strict";var ash,__hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};ash=require("../../../lib");ash.signals.Signal0=function(_super){__extends(Signal0,_super);function Signal0(){return Signal0.__super__.constructor.apply(this,arguments)}Signal0.prototype.dispatch=function(){var node;this.startDispatch();node=this.head;while(node!==null){node.listener();if(node.once){this.remove(node.listener)}node=node.next}return this.endDispatch()};return Signal0}(ash.signals.SignalBase)},{"../../../lib":78}],71:[function(require,module,exports){"use strict";var ash,__hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};ash=require("../../../lib");ash.signals.Signal1=function(_super){__extends(Signal1,_super);function Signal1(){return Signal1.__super__.constructor.apply(this,arguments)}Signal1.prototype.dispatch=function($1){var node;this.startDispatch();node=this.head;while(node!==null){node.listener($1);if(node.once){this.remove(node.listener)}node=node.next}return this.endDispatch()};return Signal1}(ash.signals.SignalBase)},{"../../../lib":78}],72:[function(require,module,exports){"use strict";var ash,__hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};ash=require("../../../lib");ash.signals.Signal2=function(_super){__extends(Signal2,_super);function Signal2(){return Signal2.__super__.constructor.apply(this,arguments)}Signal2.prototype.dispatch=function($1,$2){var node;this.startDispatch();node=this.head;while(node!==null){node.listener($1,$2);if(node.once){this.remove(node.listener)}node=node.next}return this.endDispatch()};return Signal2}(ash.signals.SignalBase)},{"../../../lib":78}],73:[function(require,module,exports){"use strict";var ash,__hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};ash=require("../../../lib");ash.signals.Signal3=function(_super){__extends(Signal3,_super);function Signal3(){return Signal3.__super__.constructor.apply(this,arguments)}Signal3.prototype.dispatch=function($1,$2,$3){var node;this.startDispatch();node=this.head;while(node!==null){node.listener($1,$2,$3);if(node.once){this.remove(node.listener)}node=node.next}return this.endDispatch()};return Signal3}(ash.signals.SignalBase)},{"../../../lib":78}],74:[function(require,module,exports){"use strict";var ListenerNodePool,ash;ash=require("../../../lib");ListenerNodePool=ash.signals.ListenerNodePool;ash.signals.SignalBase=function(){SignalBase.prototype.head=null;SignalBase.prototype.tail=null;SignalBase.prototype.numListeners=0;SignalBase.prototype.listenerNodePool=null;SignalBase.prototype.toAddHead=null;SignalBase.prototype.toAddTail=null;SignalBase.prototype.dispatching=false;function SignalBase(){this.listenerNodePool=new ListenerNodePool;this.numListeners=0}SignalBase.prototype.startDispatch=function(){this.dispatching=true};SignalBase.prototype.endDispatch=function(){this.dispatching=false;if(this.toAddHead!==null){if(this.head===null){this.head=this.toAddHead;this.tail=this.toAddTail}else{this.tail.next=this.toAddHead;this.toAddHead.previous=this.tail;this.tail=this.toAddTail}this.toAddHead=null;this.toAddTail=null}this.listenerNodePool.releaseCache()};SignalBase.prototype.getNode=function(listener){var node;node=this.head;while(node!==null){if(node.listener===listener){break}node=node.next}if(node===null){node=this.toAddHead;while(node!==null){if(node.listener===listener){break}node=node.next}}return node};SignalBase.prototype.nodeExists=function(listener){return this.getNode(listener)!==null};SignalBase.prototype.add=function(listener){var node;if(this.nodeExists(listener)){return}node=this.listenerNodePool.get();node.listener=listener;this.addNode(node)};SignalBase.prototype.addOnce=function(listener){var node;if(this.nodeExists(listener)){return}node=this.listenerNodePool.get();node.listener=listener;node.once=true;this.addNode(node)};SignalBase.prototype.addNode=function(node){if(this.dispatching){if(this.toAddHead===null){this.toAddHead=this.toAddTail=node}else{this.toAddTail.next=node;node.previous=this.toAddTail;this.toAddTail=node}}else{if(this.head===null){this.head=this.tail=node}else{this.tail.next=node;node.previous=this.tail;this.tail=node}}this.numListeners++};SignalBase.prototype.remove=function(listener){var node;node=this.getNode(listener);if(node!==null){if(this.head===node){this.head=this.head.next}if(this.tail===node){this.tail=this.tail.previous}if(this.toAddHead===node){this.toAddHead=this.toAddHead.next}if(this.toAddTail===node){this.toAddTail=this.toAddTail.previous}if(node.previous!==null){node.previous.next=node.next}if(node.next!==null){node.next.previous=node.previous}if(this.dispatching){this.listenerNodePool.cache(node)}else{this.listenerNodePool.dispose(node)}this.numListeners--}};SignalBase.prototype.removeAll=function(){var node;while(this.head!==null){node=this.head;this.head=this.head.next;this.listenerNodePool.dispose(node)}this.tail=null;this.toAddHead=null;this.toAddTail=null;this.numListeners=0};return SignalBase}()},{"../../../lib":78}],75:[function(require,module,exports){"use strict";var Signal1,ash,__bind=function(fn,me){return function(){return fn.apply(me,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};ash=require("../../../lib");Signal1=ash.signals.Signal1;ash.tick.FrameTickProvider=function(_super){__extends(FrameTickProvider,_super);FrameTickProvider.prototype.displayObject=null;FrameTickProvider.prototype.previousTime=0;FrameTickProvider.prototype.maximumFrameTime=0;FrameTickProvider.prototype.isPlaying=false;FrameTickProvider.prototype.request=null;FrameTickProvider.prototype.timeAdjustment=1;function FrameTickProvider(displayObject,maximumFrameTime){this.displayObject=displayObject;this.maximumFrameTime=maximumFrameTime;this.dispatchTick=__bind(this.dispatchTick,this);FrameTickProvider.__super__.constructor.apply(this,arguments)}Object.defineProperties(FrameTickProvider.prototype,{playing:{get:function(){return this.isPlaying}}});FrameTickProvider.prototype.start=function(){this.request=requestAnimationFrame(this.dispatchTick);this.isPlaying=true};FrameTickProvider.prototype.stop=function(){cancelRequestAnimationFrame(this.request);this.isPlaying=false};FrameTickProvider.prototype.dispatchTick=function(timestamp){var frameTime,temp;if(timestamp==null){timestamp=Date.now()}if(this.displayObject){this.displayObject.begin()}temp=this.previousTime||timestamp;this.previousTime=timestamp;frameTime=(timestamp-temp)*.001;this.dispatch(frameTime);requestAnimationFrame(this.dispatchTick);if(this.displayObject){this.displayObject.end()}};return FrameTickProvider}(Signal1)},{"../../../lib":78}],76:[function(require,module,exports){"use strict";var Dictionary,ash,__indexOf=[].indexOf||function(item){for(var i=0,l=this.length;i<l;i++){if(i in this&&this[i]===item)return i}return-1};ash=require("../../../lib");Dictionary=function(){function Dictionary(){}return Dictionary}();ash.tools.ComponentPool=function(){var getPool,pools;function ComponentPool(){}pools=new Dictionary;getPool=function(componentClass){var _ref;if(_ref=componentClass.name,__indexOf.call(pools,_ref)>=0){return pools[componentClass.name]}else{return pools[componentClass.name]=[]}};ComponentPool.get=function(componentClass){var pool;pool=getPool(componentClass);if(pool.length>0){return pool.pop()}else{return new componentClass}};ComponentPool.dispose=function(component){var pool,type;if(component){type=component.constructor;pool=getPool(type);pool.push(component)}};ComponentPool.empty=function(){return pools=new Dictionary};return ComponentPool}()},{"../../../lib":78}],77:[function(require,module,exports){"use strict";var Engine,Node,NodeList,System,ash,__hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};ash=require("../../../lib");Engine=ash.core.Engine;Node=ash.core.Node;NodeList=ash.core.NodeList;System=ash.core.System;ash.tools.ListIteratingSystem=function(_super){__extends(ListIteratingSystem,_super);ListIteratingSystem.prototype.nodeList=null;ListIteratingSystem.prototype.nodeClass=null;ListIteratingSystem.prototype.nodeUpdateFunction=null;ListIteratingSystem.prototype.nodeAddedFunction=null;ListIteratingSystem.prototype.nodeRemovedFunction=null;function ListIteratingSystem(nodeClass,nodeUpdateFunction,nodeAddedFunction,nodeRemovedFunction){if(nodeAddedFunction==null){nodeAddedFunction=null}if(nodeRemovedFunction==null){nodeRemovedFunction=null}this.nodeClass=nodeClass;this.nodeUpdateFunction=nodeUpdateFunction;this.nodeAddedFunction=nodeAddedFunction;this.nodeRemovedFunction=nodeRemovedFunction}ListIteratingSystem.prototype.addToEngine=function(engine){this.nodeList=engine.getNodeList(this.nodeClass);if(this.nodeAddedFunction!==null){for(var node=this.nodeList.head;node;node=node.next){this.nodeAddedFunction(node)}this.nodeList.nodeAdded.add(this.nodeAddedFunction)}if(this.nodeRemovedFunction!==null){this.nodeList.nodeRemoved.add(this.nodeRemovedFunction)}};ListIteratingSystem.prototype.removeFromEngine=function(engine){if(this.nodeAddedFunction!==null){this.nodeList.nodeAdded.remove(this.nodeAddedFunction)}if(this.nodeRemovedFunction!==null){this.nodeList.nodeRemoved.remove(this.nodeRemovedFunction)}this.nodeList=null};ListIteratingSystem.prototype.update=function(time){for(var node=this.nodeList.head;node;node=node.next){this.nodeUpdateFunction(node,time)}};return ListIteratingSystem}(System)},{"../../../lib":78}],78:[function(require,module,exports){"use strict";var ash;module.exports=ash=function(){function ash(){}return ash}();ash.signals=function(){function signals(){}return signals}();require("./ash/signals/listener_node");require("./ash/signals/listener_node_pool");require("./ash/signals/signal_base");require("./ash/signals/signal0");require("./ash/signals/signal1");require("./ash/signals/signal2");require("./ash/signals/signal3");ash.core=function(){function core(){}return core}();require("./ash/core/entity");require("./ash/core/entity_list");require("./ash/core/node");require("./ash/core/node_list");require("./ash/core/node_pool");require("./ash/core/system");require("./ash/core/system_list");require("./ash/core/family");require("./ash/core/component_matching_family");
require("./ash/core/engine");ash.fsm=function(){function fsm(){}return fsm}();require("./ash/fsm/component_instance_provider");require("./ash/fsm/component_singleton_provider");require("./ash/fsm/component_type_provider");require("./ash/fsm/dynamic_component_provider");require("./ash/fsm/dynamic_system_provider");require("./ash/fsm/engine_state");require("./ash/fsm/engine_state_machine");require("./ash/fsm/entity_state");require("./ash/fsm/entity_state_machine");require("./ash/fsm/state_component_mapping");require("./ash/fsm/state_system_mapping");require("./ash/fsm/system_instance_provider");require("./ash/fsm/system_singleton_provider");ash.tick=function(){function tick(){}return tick}();require("./ash/tick/frame_tick_provider");ash.tools=function(){function tools(){}return tools}();require("./ash/tools/component_pool");require("./ash/tools/list_iterating_system")},{"./ash/core/component_matching_family":45,"./ash/core/engine":46,"./ash/core/entity":47,"./ash/core/entity_list":48,"./ash/core/family":49,"./ash/core/node":50,"./ash/core/node_list":51,"./ash/core/node_pool":52,"./ash/core/system":53,"./ash/core/system_list":54,"./ash/fsm/component_instance_provider":55,"./ash/fsm/component_singleton_provider":56,"./ash/fsm/component_type_provider":57,"./ash/fsm/dynamic_component_provider":58,"./ash/fsm/dynamic_system_provider":59,"./ash/fsm/engine_state":60,"./ash/fsm/engine_state_machine":61,"./ash/fsm/entity_state":62,"./ash/fsm/entity_state_machine":63,"./ash/fsm/state_component_mapping":64,"./ash/fsm/state_system_mapping":65,"./ash/fsm/system_instance_provider":66,"./ash/fsm/system_singleton_provider":67,"./ash/signals/listener_node":68,"./ash/signals/listener_node_pool":69,"./ash/signals/signal0":70,"./ash/signals/signal1":71,"./ash/signals/signal2":72,"./ash/signals/signal3":73,"./ash/signals/signal_base":74,"./ash/tick/frame_tick_provider":75,"./ash/tools/component_pool":76,"./ash/tools/list_iterating_system":77}]},{},[1])(1)});new Example.Main;